var cr={plugins_:{},behaviors:{}};"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,o){this.set(t,e,i,o),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return 0<t&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return e<t?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return 0<=t?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:1+e},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,o,n,s,r,a){var h,l,c=t<i?(u=t,i):(u=i,t),m=n<r?(h=n,r):(h=r,n);if(c<h||m<u)return!1;if(u=s<a?(l=s,a):(l=a,s),(e<o?(p=e,o):(p=o,e))<l||u<p)return!1;var u=n-t+r-i,p=s-e+a-o,t=i-t,e=o-e,n=r-n,a=a-s,s=cr.abs(e*n-a*t),a=n*p-a*u;if(cr.abs(a)>s)return!1;u=t*p-e*u;return cr.abs(u)<=s},e.prototype.set=function(t,e,i,o){this.left=t,this.top=e,this.right=i,this.bottom=o},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){var i,o,n,s,r,a,h;0===e?this.set_from_rect(t):(a=Math.sin(e),h=Math.cos(e),i=t.left*a,o=t.top*a,n=t.right*a,s=t.bottom*a,r=t.left*h,e=t.top*h,a=t.right*h,h=t.bottom*h,this.tlx=r-o,this.tly=e+i,this.trx=a-o,this.try_=e+n,this.brx=a-s,this.bry=h+n,this.blx=r-s,this.bly=h+i)},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var n=0,s=0;function o(t,e,i,o){s=t<e?i<o?(n=t<i?t:i,o<e?e:o):(n=t<o?t:o,i<e?e:i):i<o?(n=e<i?e:i,o<t?t:o):(n=e<o?e:o,i<t?t:i)}i.prototype.bounding_box=function(t){o(this.tlx,this.trx,this.brx,this.blx),t.left=n,t.right=s,o(this.tly,this.try_,this.bry,this.bly),t.top=n,t.bottom=s},i.prototype.contains_pt=function(t,e){var i=this.tlx,o=this.tly,n=this.trx-i,s=this.try_-o,r=this.brx-i,a=this.bry-o,h=t-i,l=e-o,c=n*n+s*s,m=n*r+s*a,u=n*h+s*l,p=r*r+a*a,y=r*h+a*l,_=1/(c*p-m*m),t=(p*u-m*y)*_,e=(c*y-m*u)*_;if(0<=t&&0<e&&t+e<1)return!0;e=((c=(n=this.blx-i)*n+(s=this.bly-o)*s)*y-(m=n*r+s*a)*(u=n*h+s*l))*(_=1/(c*p-m*m));return 0<=(t=(p*u-m*y)*_)&&0<e&&t+e<1},i.prototype.at=function(t,e){if(e)switch(t){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:default:return this.tlx}else switch(t){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:default:return this.tly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,o){if(this.contains_pt(t,e)||this.contains_pt(i,o))return!0;for(var n,s,r,a,h=0;h<4;h++)if(n=this.at(h,!0),s=this.at(h,!1),r=this.at(h+1,!0),a=this.at(h+1,!1),cr.segments_intersect(t,e,i,o,n,s,r,a))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,o,n,s,r,a,h,l,c,m=t.midX(),u=t.midY();if(this.contains_pt(m,u))return!0;if(m=this.midX(),u=this.midY(),t.contains_pt(m,u))return!0;for(l=0;l<4;l++)for(c=0;c<4;c++)if(e=this.at(l,!0),i=this.at(l,!1),o=this.at(l+1,!0),n=this.at(l+1,!1),s=t.at(c,!0),r=t.at(c,!1),a=t.at(c+1,!0),h=t.at(c+1,!1),cr.segments_intersect(e,i,o,n,s,r,a,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16},cr.GetRValue=function(t){return 255&t},cr.GetGValue=function(t){return(65280&t)>>8},cr.GetBValue=function(t){return(16711680&t)>>16},cr.shallowCopy=function(t,e,i){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t},cr.arrayRemove=function(t,e){var i,o;if(!((e=cr.floor(e))<0||e>=t.length)){for(i=e,o=t.length-1;i<o;i++)t[i]=t[i+1];cr.truncateArray(t,o)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,o;for(cr.clearArray(t),i=0,o=e.length;i<o;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){for(var i=0,o=t.length;i<o;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){e=cr.fastIndexOf(t,e);-1!==e&&cr.arrayRemove(t,e)},cr.clamp=function(t,e,i){return t<e?e:i<t?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return(t%=360)<0&&(t+=360),t},cr.clamp_angle=function(t){return(t%=2*cr.PI)<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,o){t=i-t,e=o-e;return Math.atan2(e,t)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),t=Math.cos(t),e=i*Math.sin(e)+t*Math.cos(e);return 1<=e?0:e<=-1?cr.PI:Math.acos(e)},cr.angleRotate=function(t,e,i){var o=Math.sin(t),n=Math.cos(t),s=Math.sin(e),r=Math.cos(e);return Math.acos(o*s+n*r)>i?0<n*s-o*r?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t);return Math.cos(t)*Math.sin(e)-i*Math.cos(e)<=0},cr.rotatePtAround=function(t,e,i,o,n,s){if(0===i)return s?t:e;var r=Math.sin(i),a=Math.cos(i),i=(t-=o)*r;return t=t*a-(e-=n)*r,e=e*a+i,t+=o,e+=n,s?t:e},cr.distanceTo=function(t,e,i,o){t=i-t,e=o-e;return Math.sqrt(t*t+e*e)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var o=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+o*i:t-o*i},cr.qarp=function(t,e,i,o){return cr.lerp(cr.lerp(t,e,o),cr.lerp(e,i,o),o)},cr.cubic=function(t,e,i,o,n){return cr.lerp(cr.qarp(t,e,i,n),cr.qarp(e,i,o,n),n)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){for(var e in t)t.hasOwnProperty(e)&&delete t[e]};var r=+new Date,a=!(cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-r}),h=!1,l=!1;"undefined"!=typeof window&&(a=!(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&/safari/i.test(navigator.userAgent),h=/(iphone|ipod|ipad)/i.test(navigator.userAgent),l=window.c2ejecta);var c=!a&&!l&&!h&&"undefined"!=typeof Set&&void 0!==Set.prototype.forEach;function m(){this.s=null,this.items=null,this.item_count=0,c&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}m.prototype.contains=function(t){return!this.isEmpty()&&(c?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},m.prototype.add=function(t){var e,i;c?this.s.has(t)||(this.s.add(t),this.cache_valid=!1):(e=t.toString(),(i=this.items)?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1))},m.prototype.remove=function(t){var e;this.isEmpty()||(c?this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1):this.items&&(e=t.toString(),(t=this.items).hasOwnProperty(e)&&(delete t[e],this.item_count--,this.cache_valid=!1)))},m.prototype.clear=function(){this.isEmpty()||(c?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},m.prototype.isEmpty=function(){return 0===this.count()},m.prototype.count=function(){return c?this.s.size:this.item_count};var u=null,p=0;function y(t){u[p++]=t}m.prototype.update_cache=function(){if(!this.cache_valid){if(c)cr.clearArray(this.values_cache),u=this.values_cache,p=0,this.s.forEach(y),u=null,p=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,o=this.items;if(o)for(e in o)o.hasOwnProperty(e)&&(t[i++]=o[e])}this.cache_valid=!0}},m.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=m;var _=new cr.ObjectSet;function d(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function f(t){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(t),cr.seal(this)}function x(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function g(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}cr.removeArrayDuplicates=function(t){for(var e=0,i=t.length;e<i;++e)_.add(t[e]);cr.shallowAssignArray(t,_.valuesRef()),_.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){c?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){for(var i,o=0,n=0,s=t.length;o<s;++o)i=t[o],e.has(i)||(t[n++]=i);cr.truncateArray(t,n)},cr.arrayRemoveAll_arr=function(t,e){for(var i,o=0,n=0,s=t.length;o<s;++o)i=t[o],-1===cr.fastIndexOf(e,i)&&(t[n++]=i);cr.truncateArray(t,n)},d.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},d.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=d,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},f.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},f.prototype.is_empty=function(){return!this.pts_array.length},f.prototype.update_bbox=function(){for(var t,e,i=this.pts_cache,o=i[0],n=o,s=i[1],r=s,a=1,h=this.pts_count;a<h;++a)(t=i[e=2*a])<o&&(o=t),n<t&&(n=t),(e=i[1+e])<s&&(s=e),r<e&&(r=e);this.bboxLeft=o,this.bboxRight=n,this.bboxTop=s,this.bboxBottom=r},f.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var o=this.pts_cache;o[0]=t.left-e,o[1]=t.top-i,o[2]=t.right-e,o[3]=t.top-i,o[4]=t.right-e,o[5]=t.bottom-i,o[6]=t.left-e,o[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},f.prototype.set_from_quad=function(t,e,i,o,n){this.pts_cache.length=8,this.pts_count=4;var s=this.pts_cache;s[0]=t.tlx-e,s[1]=t.tly-i,s[2]=t.trx-e,s[3]=t.try_-i,s[4]=t.brx-e,s[5]=t.bry-i,s[6]=t.blx-e,s[7]=t.bly-i,this.cache_width=o,this.cache_height=n,this.update_bbox()},f.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop,t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},f.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var o,n,s,r,a,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var l=0,c=1,m=this.pts_array,u=this.pts_cache;for(0!==i&&(l=Math.sin(i),c=Math.cos(i)),o=0,r=this.pts_count;o<r;o++)s=1+(n=2*o),a=m[n]*t,h=m[s]*e,u[n]=a*c-h*l,u[s]=h*c+a*l;this.update_bbox()}},f.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;for(var o,n,s,r,a=this.pts_count,h=this.bboxLeft-110,l=this.bboxTop-101,c=this.bboxRight+131,m=this.bboxBottom+120,u=0,p=0,y=0;y<a;y++)r=(y+1)%a*2,o=i[s=2*y],n=i[1+s],s=i[r],r=i[1+r],cr.segments_intersect(h,l,t,e,o,n,s,r)&&u++,cr.segments_intersect(c,m,t,e,o,n,s,r)&&p++;return u%2==1||p%2==1},f.prototype.intersects_poly=function(t,e,i){var o,n,s,r,a,h,l,c,m,u,p,y,_,d,f=t.pts_cache,x=this.pts_cache;if(this.contains_pt(f[0]+e,f[1]+i))return!0;if(t.contains_pt(x[0]-e,x[1]-i))return!0;for(o=0,r=this.pts_count;o<r;o++)for(s=(o+1)%r*2,l=x[n=2*o],c=x[1+n],m=x[s],u=x[1+s],a=0,h=t.pts_count;a<h;a++)if(d=(a+1)%h*2,p=f[_=2*a]+e,y=f[1+_]+i,_=f[d]+e,d=f[1+d]+i,cr.segments_intersect(l,c,m,u,p,y,_,d))return!0;return!1},f.prototype.intersects_segment=function(t,e,i,o,n,s){var r,a,h,l,c,m,u=this.pts_cache;if(this.contains_pt(i-t,o-e))return!0;for(r=0,a=this.pts_count;r<a;r++)if(m=(r+1)%a*2,h=u[c=2*r]+t,l=u[1+c]+e,c=u[m]+t,m=u[1+m]+e,cr.segments_intersect(i,o,n,s,h,l,c,m))return!0;return!1},f.prototype.mirror=function(t){for(var e,i=0,o=this.pts_count;i<o;++i)e=2*i,this.pts_cache[e]=2*t-this.pts_cache[e]},f.prototype.flip=function(t){for(var e,i=0,o=this.pts_count;i<o;++i)e=2*i+1,this.pts_cache[e]=2*t-this.pts_cache[e]},f.prototype.diag=function(){for(var t,e,i,o=0,n=this.pts_count;o<n;++o)e=1+(t=2*o),i=this.pts_cache[t],this.pts_cache[t]=this.pts_cache[e],this.pts_cache[e]=i},cr.CollisionPoly=f,x.prototype.totalCellCount=0,x.prototype.getCell=function(t,e,i){var o,n=this.cells[t];return n?(o=n[e])||(i?(o=v(this,t,e),this.cells[t][e]=o):null):i?(o=v(this,t,e),this.cells[t]={},this.cells[t][e]=o):null},x.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},x.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},x.prototype.update=function(t,e,i){var o,n,s,r,a;if(e)for(o=e.left,n=e.right;o<=n;++o)for(s=e.top,r=e.bottom;s<=r;++s)i&&i.contains_pt(o,s)||(a=this.getCell(o,s,!1))&&(a.remove(t),a.isEmpty()&&(a=a,x.prototype.totalCellCount--,a.objects.clear(),b.length<1e3&&b.push(a),this.cells[o][s]=null));if(i)for(o=i.left,n=i.right;o<=n;++o)for(s=i.top,r=i.bottom;s<=r;++s)e&&e.contains_pt(o,s)||this.getCell(o,s,!0).insert(t)},x.prototype.queryRange=function(t,e){for(var i,o,n=this.XToCell(t.left),s=this.YToCell(t.top),r=this.XToCell(t.right),a=this.YToCell(t.bottom);n<=r;++n)for(i=s;i<=a;++i)(o=this.getCell(n,i,!1))&&o.dump(e)},cr.SparseGrid=x,g.prototype.totalCellCount=0,g.prototype.getCell=function(t,e,i){var o,n=this.cells[t];return n?(o=n[e])||(i?(o=C(this,t,e),this.cells[t][e]=o):null):i?(o=C(this,t,e),this.cells[t]={},this.cells[t][e]=o):null},g.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},g.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},g.prototype.update=function(t,e,i){var o,n,s,r,a;if(e)for(o=e.left,n=e.right;o<=n;++o)for(s=e.top,r=e.bottom;s<=r;++s)i&&i.contains_pt(o,s)||(a=this.getCell(o,s,!1))&&(a.remove(t),a.isEmpty()&&(a=a,g.prototype.totalCellCount--,a.reset(),D.length<1e3&&D.push(a),this.cells[o][s]=null));if(i)for(o=i.left,n=i.right;o<=n;++o)for(s=i.top,r=i.bottom;s<=r;++s)e&&e.contains_pt(o,s)||this.getCell(o,s,!0).insert(t)},g.prototype.queryRange=function(t,e,i,o,n){for(var s,r,a=this.XToCell(t),h=this.YToCell(e),l=this.XToCell(i),c=this.YToCell(o);a<=l;++a)for(s=h;s<=c;++s)(r=this.getCell(a,s,!1))&&r.dump(n)},g.prototype.markRangeChanged=function(t){for(var e,i,o=t.left,n=t.top,s=t.right,r=t.bottom;o<=s;++o)for(e=n;e<=r;++e)(i=this.getCell(o,e,!1))&&(i.is_sorted=!1)},cr.RenderGrid=g;var b=[];function v(t,e,i){var o;return x.prototype.totalCellCount++,b.length?((o=b.pop()).grid=t,o.x=e,o.y=i,o):new cr.GridCell(t,e,i)}function B(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}B.prototype.isEmpty=function(){return this.objects.isEmpty()},B.prototype.insert=function(t){this.objects.add(t)},B.prototype.remove=function(t){this.objects.remove(t)},B.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=B;var D=[];function C(t,e,i){var o;return g.prototype.totalCellCount++,D.length?((o=D.pop()).grid=t,o.x=e,o.y=i,o):new cr.RenderCell(t,e,i)}function w(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function S(t,e){return t.zindex-e.zindex}w.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},w.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));this.objects.length?(this.objects[this.objects.length-1].get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)):(this.objects.push(t),this.is_sorted=!0)},w.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,30<=this.pending_removal.count()&&this.flush_pending()},w.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},w.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(S),this.is_sorted=!0)},w.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},w.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=w;var A=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||11<=t?"source-over":A[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.isCanvasInputEvent=function(t){t=t.target;return!t||(t===document||t===window||(!(!document||!document.body||t!==document.body)||!!cr.equals_nocase(t.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return(e=e||t)[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e=e||t;var i=t[0],o=t[1],n=t[2],t=Math.sqrt(i*i+o*o+n*n);return t?1===t?(e[0]=i,e[1]=o,e[2]=n):(t=1/t,e[0]=i*t,e[1]=o*t,e[2]=n*t):(e[0]=0,e[1]=0,e[2]=0),e},vec3.cross=function(t,e,i){i=i||t;var o=t[0],n=t[1],t=t[2],s=e[0],r=e[1],e=e[2];return i[0]=n*e-t*r,i[1]=t*s-o*e,i[2]=o*r-n*s,i},vec3.length=function(t){var e=t[0],i=t[1],t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i=i||t;var o=t[0]-e[0],n=t[1]-e[1],t=t[2]-e[2];return(e=Math.sqrt(o*o+n*n+t*t))?(e=1/e,i[0]=o*e,i[1]=n*e,i[2]=t*e):(i[0]=0,i[1]=0,i[2]=0),i},vec3.lerp=function(t,e,i,o){return(o=o||t)[0]=t[0]+i*(e[0]-t[0]),o[1]=t[1]+i*(e[1]-t[1]),o[2]=t[2]+i*(e[2]-t[2]),o},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(e&&t!==e)return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e;var i=t[1],o=t[2],e=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=o,t[7]=e,t},mat3.toMat4=function(t,e){return(e=e||mat4.create())[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(e&&t!==e)return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e;var i=t[1],o=t[2],n=t[3],s=t[6],r=t[7],e=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=o,t[9]=s,t[11]=t[14],t[12]=n,t[13]=r,t[14]=e,t},mat4.determinant=function(t){var e=t[0],i=t[1],o=t[2],n=t[3],s=t[4],r=t[5],a=t[6],h=t[7],l=t[8],c=t[9],m=t[10],u=t[11],p=t[12],y=t[13],_=t[14];return p*c*a*n-l*y*a*n-p*r*m*n+s*y*m*n+l*r*_*n-s*c*_*n-p*c*o*h+l*y*o*h+p*i*m*h-e*y*m*h-l*i*_*h+e*c*_*h+p*r*o*u-s*y*o*u-p*i*a*u+e*y*a*u+s*i*_*u-e*r*_*u-l*r*o*(t=t[15])+s*c*o*t+l*i*a*t-e*c*a*t-s*i*m*t+e*r*m*t},mat4.inverse=function(t,e){e=e||t;var i=t[0],o=t[1],n=t[2],s=t[3],r=t[4],a=t[5],h=t[6],l=t[7],c=t[8],m=t[9],u=t[10],p=t[11],y=t[12],_=t[13],d=t[14],f=t[15],x=i*a-o*r,g=i*h-n*r,b=i*l-s*r,v=o*h-n*a,B=o*l-s*a,D=n*l-s*h,C=c*_-m*y,w=c*d-u*y,S=c*f-p*y,A=m*d-u*_,M=m*f-p*_,T=u*f-p*d,t=1/(x*T-g*M+b*A+v*S-B*w+D*C);return e[0]=(a*T-h*M+l*A)*t,e[1]=(-o*T+n*M-s*A)*t,e[2]=(_*D-d*B+f*v)*t,e[3]=(-m*D+u*B-p*v)*t,e[4]=(-r*T+h*S-l*w)*t,e[5]=(i*T-n*S+s*w)*t,e[6]=(-y*D+d*b-f*g)*t,e[7]=(c*D-u*b+p*g)*t,e[8]=(r*M-a*S+l*C)*t,e[9]=(-i*M+o*S-s*C)*t,e[10]=(y*B-_*b+f*x)*t,e[11]=(-c*B+m*b-p*x)*t,e[12]=(-r*A+a*w-h*C)*t,e[13]=(i*A-o*w+n*C)*t,e[14]=(-y*v+_*g-d*x)*t,e[15]=(c*v-m*g+u*x)*t,e},mat4.toRotationMat=function(t,e){return(e=e||mat4.create())[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return(e=e||mat3.create())[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],o=t[1],n=t[2],s=t[4],r=t[5],a=t[6],h=t[8],l=t[9],c=t[10],m=c*r-a*l,u=-c*s+a*h,p=l*s-r*h,t=i*m+o*u+n*p;return t?(t=1/t,(e=e||mat3.create())[0]=m*t,e[1]=(-c*o+n*l)*t,e[2]=(a*o-n*r)*t,e[3]=u*t,e[4]=(c*i-n*h)*t,e[5]=(-a*i+n*s)*t,e[6]=p*t,e[7]=(-l*i+o*h)*t,e[8]=(r*i-o*s)*t,e):null},mat4.multiply=function(t,e,i){i=i||t;var o=t[0],n=t[1],s=t[2],r=t[3],a=t[4],h=t[5],l=t[6],c=t[7],m=t[8],u=t[9],p=t[10],y=t[11],_=t[12],d=t[13],f=t[14],t=t[15],x=e[0],g=e[1],b=e[2],v=e[3],B=e[4],D=e[5],C=e[6],w=e[7],S=e[8],A=e[9],M=e[10],T=e[11],I=e[12],P=e[13],L=e[14],e=e[15];return i[0]=x*o+g*a+b*m+v*_,i[1]=x*n+g*h+b*u+v*d,i[2]=x*s+g*l+b*p+v*f,i[3]=x*r+g*c+b*y+v*t,i[4]=B*o+D*a+C*m+w*_,i[5]=B*n+D*h+C*u+w*d,i[6]=B*s+D*l+C*p+w*f,i[7]=B*r+D*c+C*y+w*t,i[8]=S*o+A*a+M*m+T*_,i[9]=S*n+A*h+M*u+T*d,i[10]=S*s+A*l+M*p+T*f,i[11]=S*r+A*c+M*y+T*t,i[12]=I*o+P*a+L*m+e*_,i[13]=I*n+P*h+L*u+e*d,i[14]=I*s+P*l+L*p+e*f,i[15]=I*r+P*c+L*y+e*t,i},mat4.multiplyVec3=function(t,e,i){i=i||e;var o=e[0],n=e[1],e=e[2];return i[0]=t[0]*o+t[4]*n+t[8]*e+t[12],i[1]=t[1]*o+t[5]*n+t[9]*e+t[13],i[2]=t[2]*o+t[6]*n+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i=i||e;var o=e[0],n=e[1],s=e[2],e=e[3];return i[0]=t[0]*o+t[4]*n+t[8]*s+t[12]*e,i[1]=t[1]*o+t[5]*n+t[9]*s+t[13]*e,i[2]=t[2]*o+t[6]*n+t[10]*s+t[14]*e,i[3]=t[3]*o+t[7]*n+t[11]*s+t[15]*e,i},mat4.translate=function(t,e,i){var o,n,s,r,a,h,l,c,m,u,p,y,_=e[0],d=e[1],e=e[2];return i&&t!==i?(o=t[0],n=t[1],s=t[2],r=t[3],a=t[4],h=t[5],l=t[6],c=t[7],m=t[8],u=t[9],p=t[10],y=t[11],i[0]=o,i[1]=n,i[2]=s,i[3]=r,i[4]=a,i[5]=h,i[6]=l,i[7]=c,i[8]=m,i[9]=u,i[10]=p,i[11]=y,i[12]=o*_+a*d+m*e+t[12],i[13]=n*_+h*d+u*e+t[13],i[14]=s*_+l*d+p*e+t[14],i[15]=r*_+c*d+y*e+t[15],i):(t[12]=t[0]*_+t[4]*d+t[8]*e+t[12],t[13]=t[1]*_+t[5]*d+t[9]*e+t[13],t[14]=t[2]*_+t[6]*d+t[10]*e+t[14],t[15]=t[3]*_+t[7]*d+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var o=e[0],n=e[1],e=e[2];return i&&t!==i?(i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=o,t[1]*=o,t[2]*=o,t[3]*=o,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,o){var n,s,r,a,h,l,c,m,u,p,y,_,d,f,x,g,b,v,B,D,C=i[0],w=i[1],i=i[2],S=Math.sqrt(C*C+w*w+i*i);return S?(1!==S&&(C*=S=1/S,w*=S,i*=S),n=Math.sin(e),r=1-(s=Math.cos(e)),e=t[0],S=t[1],a=t[2],h=t[3],l=t[4],c=t[5],m=t[6],u=t[7],p=t[8],y=t[9],_=t[10],d=t[11],f=C*C*r+s,x=w*C*r+i*n,g=i*C*r-w*n,b=C*w*r-i*n,v=w*w*r+s,B=i*w*r+C*n,D=C*i*r+w*n,C=w*i*r-C*n,w=i*i*r+s,o?t!==o&&(o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]):o=t,o[0]=e*f+l*x+p*g,o[1]=S*f+c*x+y*g,o[2]=a*f+m*x+_*g,o[3]=h*f+u*x+d*g,o[4]=e*b+l*v+p*B,o[5]=S*b+c*v+y*B,o[6]=a*b+m*v+_*B,o[7]=h*b+u*v+d*B,o[8]=e*D+l*C+p*w,o[9]=S*D+c*C+y*w,o[10]=a*D+m*C+_*w,o[11]=h*D+u*C+d*w,o):null},mat4.rotateX=function(t,e,i){var o=Math.sin(e),e=Math.cos(e),n=t[4],s=t[5],r=t[6],a=t[7],h=t[8],l=t[9],c=t[10],m=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=n*e+h*o,i[5]=s*e+l*o,i[6]=r*e+c*o,i[7]=a*e+m*o,i[8]=n*-o+h*e,i[9]=s*-o+l*e,i[10]=r*-o+c*e,i[11]=a*-o+m*e,i},mat4.rotateY=function(t,e,i){var o=Math.sin(e),e=Math.cos(e),n=t[0],s=t[1],r=t[2],a=t[3],h=t[8],l=t[9],c=t[10],m=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*-o,i[1]=s*e+l*-o,i[2]=r*e+c*-o,i[3]=a*e+m*-o,i[8]=n*o+h*e,i[9]=s*o+l*e,i[10]=r*o+c*e,i[11]=a*o+m*e,i},mat4.rotateZ=function(t,e,i){var o=Math.sin(e),e=Math.cos(e),n=t[0],s=t[1],r=t[2],a=t[3],h=t[4],l=t[5],c=t[6],m=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*o,i[1]=s*e+l*o,i[2]=r*e+c*o,i[3]=a*e+m*o,i[4]=n*-o+h*e,i[5]=s*-o+l*e,i[6]=r*-o+c*e,i[7]=a*-o+m*e,i},mat4.frustum=function(t,e,i,o,n,s,r){var a=e-t,h=o-i,l=s-n;return(r=r||mat4.create())[0]=2*n/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*n/h,r[6]=0,r[7]=0,r[8]=(e+t)/a,r[9]=(o+i)/h,r[10]=-(s+n)/l,r[11]=-1,r[12]=0,r[13]=0,r[14]=-s*n*2/l,r[15]=0,r},mat4.perspective=function(t,e,i,o,n){return e*=t=i*Math.tan(t*Math.PI/360),mat4.frustum(-e,e,-t,t,i,o,n)},mat4.ortho=function(t,e,i,o,n,s,r){var a=e-t,h=o-i,l=s-n;return(r=r||mat4.create())[0]=2/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=-2/l,r[11]=0,r[12]=-(t+e)/a,r[13]=-(o+i)/h,r[14]=-(s+n)/l,r[15]=1,r},mat4.lookAt=function(t,e,i,o){o=o||mat4.create();var n,s,r,a,h,l=t[0],c=t[1],t=t[2],m=i[0],u=i[1],p=i[2];return i=e[1],r=e[2],l===e[0]&&c===i&&t===r?mat4.identity(o):(i=l-e[0],r=c-e[1],a=t-e[2],e=u*(a*=h=1/Math.sqrt(i*i+r*r+a*a))-p*(r*=h),p=p*(i*=h)-m*a,m=m*r-u*i,(h=Math.sqrt(e*e+p*p+m*m))?(e*=h=1/h,p*=h,m*=h):m=p=e=0,u=r*m-a*p,n=a*e-i*m,s=i*p-r*e,(h=Math.sqrt(u*u+n*n+s*s))?(u*=h=1/h,n*=h,s*=h):s=n=u=0,o[0]=e,o[1]=u,o[2]=i,o[3]=0,o[4]=p,o[5]=n,o[6]=r,o[7]=0,o[8]=m,o[9]=s,o[10]=a,o[11]=0,o[12]=-(e*l+p*c+m*t),o[13]=-(u*l+n*c+s*t),o[14]=-(i*l+r*c+a*t),o[15]=1,o)},mat4.fromRotationTranslation=function(t,e,i){i=i||mat4.create();var o=t[0],n=t[1],s=t[2],r=t[3],a=o+o,h=n+n,l=s+s,t=o*a,c=o*h;o*=l;var m=n*h;return n*=l,s*=l,a*=r,h*=r,r*=l,i[0]=1-(m+s),i[1]=c+r,i[2]=o-h,i[3]=0,i[4]=c-r,i[5]=1-(t+s),i[6]=n+a,i[7]=0,i[8]=o+h,i[9]=n-a,i[10]=1-(t+m),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],o=t[1],n=t[2];return e&&t!==e?(e[0]=i,e[1]=o,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-o*o-n*n)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-o*o-n*n)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],o=t[2],t=t[3];return Math.sqrt(e*e+i*i+o*o+t*t)},quat4.normalize=function(t,e){e=e||t;var i=t[0],o=t[1],n=t[2],s=t[3],t=Math.sqrt(i*i+o*o+n*n+s*s);return 0===t?(e[0]=0,e[1]=0,e[2]=0,e[3]=0):(t=1/t,e[0]=i*t,e[1]=o*t,e[2]=n*t,e[3]=s*t),e},quat4.multiply=function(t,e,i){i=i||t;var o=t[0],n=t[1],s=t[2],t=t[3],r=e[0],a=e[1],h=e[2],e=e[3];return i[0]=o*e+t*r+n*h-s*a,i[1]=n*e+t*a+s*r-o*h,i[2]=s*e+t*h+o*a-n*r,i[3]=t*e-o*r-n*a-s*h,i},quat4.multiplyVec3=function(t,e,i){i=i||e;var o=e[0],n=e[1],s=e[2],e=t[0],r=t[1],a=t[2],h=(t=t[3])*o+r*s-a*n,l=t*n+a*o-e*s,c=t*s+e*n-r*o,o=-e*o-r*n-a*s;return i[0]=h*t+o*-e+l*-a-c*-r,i[1]=l*t+o*-r+c*-e-h*-a,i[2]=c*t+o*-a+h*-r-l*-e,i},quat4.toMat3=function(t,e){e=e||mat3.create();var i=t[0],o=t[1],n=t[2],s=t[3],r=i+i,a=o+o,h=n+n,l=i*r,c=i*a;i*=h;t=o*a;return o*=h,n*=h,r*=s,a*=s,s*=h,e[0]=1-(t+n),e[1]=c+s,e[2]=i-a,e[3]=c-s,e[4]=1-(l+n),e[5]=o+r,e[6]=i+a,e[7]=o-r,e[8]=1-(l+t),e},quat4.toMat4=function(t,e){e=e||mat4.create();var i=t[0],o=t[1],n=t[2],s=t[3],r=i+i,a=o+o,h=n+n,l=i*r,c=i*a;i*=h;t=o*a;return o*=h,n*=h,r*=s,a*=s,s*=h,e[0]=1-(t+n),e[1]=c+s,e[2]=i-a,e[3]=0,e[4]=c-s,e[5]=1-(l+n),e[6]=o+r,e[7]=0,e[8]=i+a,e[9]=o-r,e[10]=1-(l+t),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,o){o=o||t;var n,s,r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return 1<=Math.abs(r)?(o!==t&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]),o):(n=Math.acos(r),s=Math.sqrt(1-r*r),Math.abs(s)<.001?(o[0]=.5*t[0]+.5*e[0],o[1]=.5*t[1]+.5*e[1],o[2]=.5*t[2]+.5*e[2],o[3]=.5*t[3]+.5*e[3]):(r=Math.sin((1-i)*n)/s,i=Math.sin(i*n)/s,o[0]=t[0]*r+e[0]*i,o[1]=t[1]*r+e[1]*i,o[2]=t[2]*r+e[2]*i,o[3]=t[3]*r+e[3]*i),o)},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){var i=mat4.create();function t(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.initState()}function m(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelWidth=t.getUniformLocation(e,"pixelWidth"),this.locPixelHeight=t.getUniformLocation(e,"pixelHeight"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.locViewOrigin=t.getUniformLocation(e,"viewOrigin"),this.locScrollPos=t.getUniformLocation(e,"scrollPos"),this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpViewOriginX=0,this.lpViewOriginY=0,this.lpScrollPosX=0,this.lpScrollPosY=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locViewOrigin&&t.uniform2f(this.locViewOrigin,0,0),this.locScrollPos&&t.uniform2f(this.locScrollPos,0,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function o(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.shaderParams=[],cr.seal(this)}t.prototype.initState=function(){var t=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.disable(t.CULL_FACE),t.disable(t.STENCIL_TEST),t.disable(t.DITHER),this.enableFrontToBack?(t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)):t.disable(t.DEPTH_TEST),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.lastSrcBlend=t.ONE,this.lastDestBlend=t.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(8e3*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16e3),this.pointData=new Float32Array(32e3),this.pointBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.pointBuffer),t.bufferData(t.ARRAY_BUFFER,this.pointData.byteLength,t.DYNAMIC_DRAW),this.vertexBuffers=new Array(4),this.texcoordBuffers=new Array(4),n=0;n<4;n++)this.vertexBuffers[n]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffers[n]),t.bufferData(t.ARRAY_BUFFER,this.vertexData.byteLength,t.DYNAMIC_DRAW),this.texcoordBuffers[n]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffers[n]),t.bufferData(t.ARRAY_BUFFER,this.texcoordData.byteLength,t.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var e,i,o=new Uint16Array(12e3),n=0,s=0;n<12e3;)o[n++]=s,o[n++]=s+1,o[n++]=s+2,o[n++]=s,o[n++]=s+2,o[n++]=s+3,s+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],e=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),i=(this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"]:["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"]).join("\n");var r=this.createShaderProgram({src:e},i,"<default>");this.shaderPrograms.push(r),e=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var a=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");r=this.createShaderProgram({src:e},a,"<point>"),this.shaderPrograms.push(r),e=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");r=this.createShaderProgram({src:e},i,"<earlyz>");this.shaderPrograms.push(r),e=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");var h,r=this.createShaderProgram({src:e},i,"<fill>");for(h in this.shaderPrograms.push(r),cr.shaders)cr.shaders.hasOwnProperty(h)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[h],i,h));t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=t.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=t.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);r=t.getParameter(t.ALIASED_POINT_SIZE_RANGE);this.minPointSize=r[0],this.maxPointSize=r[1],2048<this.maxPointSize&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},m.prototype.updateMatMV=function(t){e(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},t.prototype.createShaderProgram=function(t,e,i){var o=this.gl,n=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(n,t.src),o.compileShader(n),!o.getShaderParameter(n,o.COMPILE_STATUS)){var s=o.getShaderInfoLog(n);throw o.deleteShader(n),new Error("error compiling fragment shader: "+s)}var r=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(r,e),o.compileShader(r),!o.getShaderParameter(r,o.COMPILE_STATUS)){s=o.getShaderInfoLog(r);throw o.deleteShader(n),o.deleteShader(r),new Error("error compiling vertex shader: "+s)}var a=o.createProgram();if(o.attachShader(a,n),o.attachShader(a,r),o.linkProgram(a),!o.getProgramParameter(a,o.LINK_STATUS)){s=o.getProgramInfoLog(a);throw o.deleteShader(n),o.deleteShader(r),o.deleteProgram(a),new Error("error linking shader program: "+s)}o.useProgram(a),o.deleteShader(n),o.deleteShader(r);var h,l,c=new m(o,a,i);for(c.extendBoxHorizontal=t.extendBoxHorizontal||0,c.extendBoxVertical=t.extendBoxVertical||0,c.crossSampling=!!t.crossSampling,c.preservesOpaqueness=!!t.preservesOpaqueness,c.animated=!!t.animated,c.parameters=t.parameters||[],h=0,l=c.parameters.length;h<l;h++)c.parameters[h][1]=o.getUniformLocation(a,c.parameters[h][0]),c.lastCustomParams.push(0),o.uniform1f(c.parameters[h][1],0);return cr.seal(c),c},t.prototype.getShaderIndex=function(t){for(var e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},t.prototype.project=function(t,e,i){var o=this.matMV,n=this.matP,s=[0,0,0,0,0,0,0,0];s[0]=o[0]*t+o[4]*e+o[12],s[1]=o[1]*t+o[5]*e+o[13],s[2]=o[2]*t+o[6]*e+o[14],s[3]=o[3]*t+o[7]*e+o[15],s[4]=n[0]*s[0]+n[4]*s[1]+n[8]*s[2]+n[12]*s[3],s[5]=n[1]*s[0]+n[5]*s[1]+n[9]*s[2]+n[13]*s[3],s[6]=n[2]*s[0]+n[6]*s[1]+n[10]*s[2]+n[14]*s[3],s[7]=-s[2],0!==s[7]&&(s[7]=1/s[7],s[4]*=s[7],s[5]*=s[7],s[6]*=s[7],i[0]=(.5*s[4]+.5)*this.width,i[1]=(.5*s[5]+.5)*this.height)},t.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var o,n,s,r=this.gl;for(this.width=t,this.height=e,r.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack?(mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP),t=[0,0],e=[0,0],this.project(0,0,t),this.project(1,1,e),this.worldScale[0]=1/(e[0]-t[0]),this.worldScale[1]=-1/(e[1]-t[1])),o=0,n=this.shaderPrograms.length;o<n;o++)(s=this.shaderPrograms[o]).hasCurrentMatMV=!1,s.locMatP&&(r.useProgram(s.shaderProgram),r.uniformMatrix4fv(s.locMatP,!1,this.matP));r.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,this.fbo),r.bindRenderbuffer(r.RENDERBUFFER,this.depthBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),this.renderToTex=null)}},t.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},t.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},t.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},t.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},t.prototype.updateModelView=function(){var t;e(this.lastMV,this.matMV)||((t=this.pushBatch()).type=5,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(32760<t&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},o.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},o.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},o.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},o.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;e=e.currentShader;e.locOpacity&&e.lpOpacity!==t&&(e.lpOpacity=t,this.gl.uniform1f(e.locOpacity,t))},o.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},o.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},o.prototype.doUpdateModelView=function(){for(var t,e=this.glwrap.shaderPrograms,i=this.glwrap.currentProgram,o=0,n=e.length;o<n;o++)t=e[o],o===i&&t.locMatMV?(t.updateMatMV(this.mat4param),t.hasCurrentMatMV=!0):t.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},o.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},o.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},o.prototype.doSetDepthTestEnabled=function(){var t=this.gl;0!==this.startIndex?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},o.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},o.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},o.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},o.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,o=this.gl,n=this.mat4param;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,o.activeTexture(o.TEXTURE0));var s,r=n[0];if(i.locPixelWidth&&r!==i.lpPixelWidth&&(i.lpPixelWidth=r,o.uniform1f(i.locPixelWidth,r)),r=n[1],i.locPixelHeight&&r!==i.lpPixelHeight&&(i.lpPixelHeight=r,o.uniform1f(i.locPixelHeight,r)),r=n[2],s=n[3],!i.locDestStart||r===i.lpDestStartX&&s===i.lpDestStartY||(i.lpDestStartX=r,i.lpDestStartY=s,o.uniform2f(i.locDestStart,r,s)),r=n[4],s=n[5],!i.locDestEnd||r===i.lpDestEndX&&s===i.lpDestEndY||(i.lpDestEndX=r,i.lpDestEndY=s,o.uniform2f(i.locDestEnd,r,s)),r=n[6],i.locLayerScale&&r!==i.lpLayerScale&&(i.lpLayerScale=r,o.uniform1f(i.locLayerScale,r)),r=n[7],i.locLayerAngle&&r!==i.lpLayerAngle&&(i.lpLayerAngle=r,o.uniform1f(i.locLayerAngle,r)),r=n[8],s=n[9],!i.locViewOrigin||r===i.lpViewOriginX&&s===i.lpViewOriginY||(i.lpViewOriginX=r,i.lpViewOriginY=s,o.uniform2f(i.locViewOrigin,r,s)),r=n[10],s=n[11],!i.locScrollPos||r===i.lpScrollPosX&&s===i.lpScrollPosY||(i.lpScrollPosX=r,i.lpScrollPosY=s,o.uniform2f(i.locScrollPos,r,s)),r=n[12],i.locSeconds&&r!==i.lpSeconds&&(i.lpSeconds=r,o.uniform1f(i.locSeconds,r)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)(r=this.shaderParams[t])!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=r,o.uniform1f(i.parameters[t][1],r))},t.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new o(0,this)),this.batch[this.batchPtr++]},t.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var t,e,i,o,n=this.gl;for(0<this.pointPtr&&(n.bindBuffer(n.ARRAY_BUFFER,this.pointBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),t&&0<=t.locAPos&&"<point>"===t.name&&n.vertexAttribPointer(t.locAPos,4,n.FLOAT,!1,0,0)),0<this.vertexPtr&&(t=this.currentShader,n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),t&&0<=t.locAPos&&"<point>"!==t.name&&n.vertexAttribPointer(t.locAPos,this.enableFrontToBack?3:2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),n.bufferSubData(n.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),t&&0<=t.locATex&&"<point>"!==t.name&&n.vertexAttribPointer(t.locATex,2,n.FLOAT,!1,0,0)),e=0,i=this.batchPtr;e<i;e++)switch((o=this.batch[e]).type){case 1:o.doQuad();break;case 2:o.doSetTexture();break;case 3:o.doSetOpacity();break;case 4:o.doSetBlend();break;case 5:o.doUpdateModelView();break;case 6:o.doRenderToTexture();break;case 7:o.doClear();break;case 8:o.doPoints();break;case 9:o.doSetProgram();break;case 10:o.doSetProgramParameters();break;case 11:o.doSetTexture1();break;case 12:o.doSetColor();break;case 13:o.doSetDepthTestEnabled();break;case 14:o.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,4<=this.curBuffer&&(this.curBuffer=0)}},t.prototype.setOpacity=function(t){var e;t!==this.lastOpacity&&(this.isEarlyZPass||((e=this.pushBatch()).type=3,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1))},t.prototype.setTexture=function(t){var e;t!==this.lastTexture0&&((e=this.pushBatch()).type=2,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.setBlend=function(t,e){var i;t===this.lastSrcBlend&&e===this.lastDestBlend||this.isEarlyZPass||((i=this.pushBatch()).type=4,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},t.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},t.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)},t.prototype.quad=function(t,e,i,o,n,s,r,a){15992<=this.vertexPtr&&this.endBatch();var h,l=this.vertexPtr,c=this.texPtr,m=this.vertexData,u=this.texcoordData,p=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((h=this.pushBatch()).type=1,h.startIndex=this.enableFrontToBack?l:l/2*3,h.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1),this.enableFrontToBack?(m[l++]=t,m[l++]=e,m[l++]=p,m[l++]=i,m[l++]=o,m[l++]=p,m[l++]=n,m[l++]=s,m[l++]=p,m[l++]=r,m[l++]=a,m[l++]=p):(m[l++]=t,m[l++]=e,m[l++]=i,m[l++]=o,m[l++]=n,m[l++]=s,m[l++]=r,m[l++]=a),u[c++]=0,u[c++]=0,u[c++]=1,u[c++]=0,u[c++]=1,u[c++]=1,u[c++]=0,u[c++]=1,this.vertexPtr=l,this.texPtr=c},t.prototype.quadTex=function(t,e,i,o,n,s,r,a,h){15992<=this.vertexPtr&&this.endBatch();var l=this.vertexPtr,c=this.texPtr,m=this.vertexData,u=this.texcoordData,p=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((d=this.pushBatch()).type=1,d.startIndex=this.enableFrontToBack?l:l/2*3,d.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1);var y=h.left,_=h.top,d=h.right,h=h.bottom;this.enableFrontToBack?(m[l++]=t,m[l++]=e,m[l++]=p,m[l++]=i,m[l++]=o,m[l++]=p,m[l++]=n,m[l++]=s,m[l++]=p,m[l++]=r,m[l++]=a,m[l++]=p):(m[l++]=t,m[l++]=e,m[l++]=i,m[l++]=o,m[l++]=n,m[l++]=s,m[l++]=r,m[l++]=a),u[c++]=y,u[c++]=_,u[c++]=d,u[c++]=_,u[c++]=d,u[c++]=h,u[c++]=y,u[c++]=h,this.vertexPtr=l,this.texPtr=c},t.prototype.quadTexUV=function(t,e,i,o,n,s,r,a,h,l,c,m,u,p,y,_){15992<=this.vertexPtr&&this.endBatch();var d,f=this.vertexPtr,x=this.texPtr,g=this.vertexData,b=this.texcoordData,v=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((d=this.pushBatch()).type=1,d.startIndex=this.enableFrontToBack?f:f/2*3,d.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1),this.enableFrontToBack?(g[f++]=t,g[f++]=e,g[f++]=v,g[f++]=i,g[f++]=o,g[f++]=v,g[f++]=n,g[f++]=s,g[f++]=v,g[f++]=r,g[f++]=a,g[f++]=v):(g[f++]=t,g[f++]=e,g[f++]=i,g[f++]=o,g[f++]=n,g[f++]=s,g[f++]=r,g[f++]=a),b[x++]=h,b[x++]=l,b[x++]=c,b[x++]=m,b[x++]=u,b[x++]=p,b[x++]=y,b[x++]=_,this.vertexPtr=f,this.texPtr=x},t.prototype.convexPoly=function(t){for(var e,i,o,n,s,r,a=t.length/2-2,h=a-1,l=t[0],c=t[1],m=0;m<a;m+=2)e=t[2+(r=2*m)],i=t[3+r],o=t[4+r],n=t[5+r],m===h?this.quad(l,c,e,i,o,n,o,n):(s=t[6+r],r=t[7+r],this.quad(l,c,e,i,o,n,s,r))},t.prototype.point=function(t,e,i,o){7996<=this.pointPtr&&this.endBatch();var n,s=this.pointPtr,r=this.pointData;this.hasPointBatchTop?this.batch[this.batchPtr-1].indexCount++:((n=this.pushBatch()).type=8,n.startIndex=s,n.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1),r[s++]=t,r[s++]=e,r[s++]=i,r[s++]=o,this.pointPtr=s},t.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}e=this.pushBatch();e.type=9,e.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.programUsesDest=function(t){t=this.shaderPrograms[t];return!(!t.locDestStart&&!t.locDestEnd)},t.prototype.programUsesCrossSampling=function(t){t=this.shaderPrograms[t];return!!(t.locDestStart||t.locDestEnd||t.crossSampling)},t.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},t.prototype.programExtendsBox=function(t){t=this.shaderPrograms[t];return 0!==t.extendBoxHorizontal||0!==t.extendBoxVertical},t.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},t.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},t.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},t.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},t.prototype.setProgramParameters=function(t,e,i,o,n,s,r,a,h,l,c,m,u,p,y){var _,d,f,x,g,b=this.shaderPrograms[this.lastProgram];if(b.hasAnyOptionalUniforms||y.length){if((f=this.pushBatch()).type=10,f.mat4param?mat4.set(this.matMV,f.mat4param):f.mat4param=mat4.create(),(x=f.mat4param)[0]=e,x[1]=i,x[2]=o,x[3]=n,x[4]=s,x[5]=r,x[6]=a,x[7]=h,x[8]=l,x[9]=c,x[10]=m,x[11]=u,x[12]=p,b.locSamplerBack?f.texParam=t:f.texParam=null,y.length)for((g=f.shaderParams).length=y.length,_=0,d=y.length;_<d;_++)g[_]=y[_];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.clear=function(t,e,i,o){var n=this.pushBatch();n.type=7,n.startIndex=0,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=o,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.clearRect=function(t,e,i,o){var n;i<0||o<0||((n=this.pushBatch()).type=7,n.startIndex=1,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=o,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.clearDepth=function(){var t=this.pushBatch();t.type=7,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setEarlyZPass=function(t){var e;this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t&&((e=this.pushBatch()).type=14,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)))},t.prototype.setDepthTestEnabled=function(t){var e;this.enableFrontToBack&&((e=this.pushBatch()).type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,i),this.resetModelView(),this.updateModelView();var t=this.width/2,e=this.height/2;this.quad(-t,e,t,e,t,-e,-t,-e),mat4.set(i,this.matMV),this.updateModelView()},t.prototype.setColorFillMode=function(t,e,i,o){this.switchProgram(3);var n=this.pushBatch();n.type=12,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=o,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setTextureFillMode=function(){this.switchProgram(0)},t.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},t.prototype.present=function(){this.endBatch(),this.gl.flush()};var y=[],_={};t.prototype.contextLost=function(){cr.clearArray(y),_={}},t.prototype.loadTexture=function(t,e,i,o,n,s){e=!!e,i=!!i;var r=t.src+","+e+","+i+(e?","+n:""),a=null;if(void 0!==t.src&&_.hasOwnProperty(r))return(a=_[r]).c2refcount++,a;this.endBatch();var h=this.gl,l=cr.isPOT(t.width)&&cr.isPOT(t.height),a=h.createTexture();h.bindTexture(h.TEXTURE_2D,a),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var c,m=h.RGBA,u=h.RGBA,p=h.UNSIGNED_BYTE;if(o&&!this.isIE)switch(o){case 1:m=h.RGB,u=h.RGB;break;case 2:p=h.UNSIGNED_SHORT_4_4_4_4;break;case 3:p=h.UNSIGNED_SHORT_5_5_5_1;break;case 4:m=h.RGB,u=h.RGB,p=h.UNSIGNED_SHORT_5_6_5}return 1===this.version&&!l&&e?((c=document.createElement("canvas")).width=cr.nextHighestPowerOfTwo(t.width),c.height=cr.nextHighestPowerOfTwo(t.height),void 0!==(o=c.getContext("2d")).imageSmoothingEnabled?o.imageSmoothingEnabled=i:(o.webkitImageSmoothingEnabled=i,o.mozImageSmoothingEnabled=i,o.msImageSmoothingEnabled=i),o.drawImage(t,0,0,t.width,t.height,0,0,c.width,c.height),h.texImage2D(h.TEXTURE_2D,0,m,u,p,c)):h.texImage2D(h.TEXTURE_2D,0,m,u,p,t),e?"repeat-x"===n?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)):("repeat-y"===n?h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)),i?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),(l||2<=this.version)&&this.enable_mipmaps&&!s?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.generateMipmap(h.TEXTURE_2D)):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST)),h.bindTexture(h.TEXTURE_2D,null),this.lastTexture0=null,a.c2width=t.width,a.c2height=t.height,a.c2refcount=1,a.c2texkey=r,y.push(a),_[r]=a},t.prototype.createEmptyTexture=function(t,e,i,o,n){this.endBatch();var s=this.gl;this.isIE&&(o=!1);var r=s.createTexture();return s.bindTexture(s.TEXTURE_2D,r),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,o?s.UNSIGNED_SHORT_4_4_4_4:s.UNSIGNED_BYTE,null),n?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i?s.LINEAR:s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,i?s.LINEAR:s.NEAREST),s.bindTexture(s.TEXTURE_2D,null),this.lastTexture0=null,r.c2width=t,r.c2height=e,y.push(r),r},t.prototype.videoToTexture=function(t,e,i){this.endBatch();var o=this.gl;this.isIE&&(i=!1),o.bindTexture(o.TEXTURE_2D,e),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,i?o.UNSIGNED_SHORT_4_4_4_4:o.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}o.bindTexture(o.TEXTURE_2D,null),this.lastTexture0=null},t.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&1<t.c2refcount?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(y,t),void 0!==t.c2texkey&&delete _[t.c2texkey],this.gl.deleteTexture(t)))},t.prototype.estimateVRAM=function(){for(var t,e=this.width*this.height*4*2,i=0,o=y.length;i<o;i++)e+=(t=y[i]).c2width*t.c2height*4;return e},t.prototype.textureCount=function(){return y.length},t.prototype.setRenderingToTexture=function(t){var e;t!==this.renderToTex&&((e=this.pushBatch()).type=6,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},cr.GLWrap=t}(),function(){var m=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;function i(t){var e;t&&(t.getContext||t.dc)&&(t.c2runtime||((e=t.c2runtime=this).isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova=this.isCrosswalk||void 0!==window.device&&(void 0!==window.device.cordova||void 0!==window.device.phonegap)||void 0!==window.c2iscordova&&window.c2iscordova,this.isPhoneGap=this.isCordova,this.isDirectCanvas=!!t.dc,this.isAppMobi=void 0!==window.AppMobi||this.isDirectCanvas,this.isCocoonJs=!!window.c2cocoonjs,this.isEjecta=!!window.c2ejecta,this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener(function(){e.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){e.setSuspended(!1)})),this.isEjecta&&(document.addEventListener("pagehide",function(){e.setSuspended(!0)}),document.addEventListener("pageshow",function(){e.setSuspended(!1)}),document.addEventListener("resize",function(){e.setSize(window.innerWidth,window.innerHeight)})),this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad||this.isEjecta,this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent),this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs=void 0!==window.c2nodewebkit||void 0!==window.c2nwjs||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade=void 0!==window.is_scirra_arcade,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindows8Capable=!(void 0===window.c2isWindows8Capable||!window.c2isWindows8Capable),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10=!!window.cr_windows10,this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit),"undefined"==typeof cr_is_preview||this.isNWjs||"?nw"!==window.location.search&&!/nodewebkit/i.test(navigator.userAgent)&&!/nwjs/i.test(navigator.userAgent)||(this.isNWjs=!0),this.isDebug="undefined"!=typeof cr_is_preview&&-1<window.location.search.indexOf("debug"),this.canvas=t,this.canvasdiv=document.getElementById("c2canvasdiv"),this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isDirectCanvas&&(window.c2runtime=this),this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isAndroidStockBrowser&&"undefined"!=typeof jQuery&&jQuery("canvas").parents("*").css("overflow","visible"),this.width=t.width,this.height=t.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.isNodeFullscreen=!1,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],this.requestProjectData()))}i.prototype.requestProjectData=function(){var e=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("https://cdn.jsdelivr.net/gh/bobydob/canvas-nest@e2491e779b6c725ba931d88bd8c251b44c45252a/lib/wb/data.js",function(t){e.loadProject(JSON.parse(t))},function(t){alert("Error fetching data.js")});else{var i=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,o="https://cdn.jsdelivr.net/gh/bobydob/canvas-nest@e2491e779b6c725ba931d88bd8c251b44c45252a/lib/wb/data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(o="data.json"),i.open("GET",o,!0);var n=!1;if(!this.isDomFree&&"response"in i&&"responseType"in i)try{i.responseType="json",n="json"===i.responseType}catch(t){n=!1}if(!n&&"responseType"in i)try{i.responseType="text"}catch(t){}if("overrideMimeType"in i)try{i.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?i.onreadystatechange=function(){4===i.readyState&&e.loadProject(JSON.parse(i.responseText))}:(i.onload=function(){var t;n?e.loadProject(i.response):e.isEjecta?(t=(t=i.responseText).substr(t.indexOf("{")),e.loadProject(JSON.parse(t))):e.loadProject(JSON.parse(i.responseText))},i.onerror=function(t){cr.logerror("Error requesting "+o+":"),cr.logerror(t)}),i.send()}},i.prototype.initRendererAndLoader=function(){var t,e,i,o,n,s,r,a,h,l,c,m=this;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1),this.devicePixelRatio=this.isRetina&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio)||1,"object"==typeof window.StatusBar&&window.StatusBar.hide(),this.ClearDeathRow(),0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0),this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),m.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(t){m.glwrap.initState(),m.glwrap.setSize(m.glwrap.width,m.glwrap.height,!0),m.layer_tex=null,m.layout_tex=null,m.fx_tex[0]=null,m.fx_tex[1]=null,m.onContextRestored(),m.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(c={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},this.isAndroid||(this.gl=this.canvas.getContext("webgl2",c)),this.gl||(this.gl=this.canvas.getContext("webgl",c)||this.canvas.getContext("experimental-webgl",c)))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var u,p=this.gl.getExtension("WEBGL_debug_renderer_info");for(p&&(u=this.gl.getParameter(p.UNMASKED_VENDOR_WEBGL),p=this.gl.getParameter(p.UNMASKED_RENDERER_WEBGL),this.glUnmaskedRenderer=p+" ["+u+"]"),this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,t=0,e=this.types_by_index.length;t<e;t++)for(i=0,o=(r=this.types_by_index[t]).effect_types.length;i<o;i++)(a=r.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(i=0,o=(h=this.layouts_by_index[t]).effect_types.length;i<o;i++)(a=h.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex);for(h.updateActiveEffects(),i=0,o=h.layers.length;i<o;i++){for(n=0,s=(l=h.layers[i]).effect_types.length;n<s;n++)(a=l.effect_types[n]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);l.updateActiveEffects()}}}else{if(0<this.fullscreen_mode&&this.isDirectCanvas){this.canvas=null,document.oncontextmenu=function(t){return!1},document.onselectstart=function(t){return!1},this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0,this.ctx.imageSmoothingEnabled=this.linearSampling}catch(t){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(c=this.isCocoonJs?{antialias:!!this.linearSampling,alpha:!0}:{alpha:!0},this.ctx=this.canvas.getContext("2d",c),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling)),this.overlay_canvas=null,this.overlay_ctx=null}this.tickFunc=function(t){m.tick(!1,t)},window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),"undefined"!=typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){m.setSuspended(!1)}),jQuery(window).blur(function(){var t=window.parent;t&&t.document.hasFocus()||m.setSuspended(!0)}))),window.addEventListener("blur",function(){m.onWindowBlur()}),this.isDomFree||(u=function(t){if(cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}},"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",u):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",u):document.addEventListener("touchstart",u),document.addEventListener("mousedown",u)),0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio&&this.setSize(this.original_width,this.original_height,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)},i.prototype.setSize=function(t,e,i){var o,n,s,r,a=0,h=0,l=0,c=0,m=0;this.lastWindowWidth===t&&this.lastWindowHeight===e&&!i||(this.lastWindowWidth=t,this.lastWindowHeight=e,o=this.fullscreen_mode,((r=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova)||0!==this.fullscreen_mode||i)&&(r&&(o=this.fullscreen_scaling),i=this.devicePixelRatio,4<=o?(5===o&&1!==i&&(t+=1,e+=1),(n=this.original_width/this.original_height)<(s=t/e)?(l=e*n,5===o?(1<(m=l*i/this.original_width)?m=Math.floor(m):m<1&&(m=1/Math.ceil(1/m)),a=(t-(l=this.original_width*m/i))/2,h=(e-(c=this.original_height*m/i))/2,t=l,e=c):(a=(t-l)/2,t=l)):(c=t/n,e=(5===o?(1<(m=c*i/this.original_height)?m=Math.floor(m):m<1&&(m=1/Math.ceil(1/m)),a=(t-(l=this.original_width*m/i))/2,h=(e-(c=this.original_height*m/i))/2,t=l):h=(e-c)/2,c))):r&&0===o&&(a=Math.floor((t-this.original_width)/2),h=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),o<2&&(this.aspect_scale=i),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*i),this.height=Math.round(e*i),this.redraw=!0,this.wantFullscreenScalingQuality||this.width<this.original_width&&this.height<this.original_height||1===o?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===o?(n=this.original_width/this.original_height,(s=this.lastWindowWidth/this.lastWindowHeight)<n?this.draw_width=this.draw_height*s:n<s&&(this.draw_height=this.draw_width/s)):3===o&&((n=this.original_width/this.original_height)<(s=this.lastWindowWidth/this.lastWindowHeight)?this.draw_width=this.draw_height*s:s<n&&(this.draw_height=this.draw_width/s))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(t)+"px",height:Math.round(e)+"px","margin-left":Math.floor(a)+"px","margin-top":Math.floor(h)+"px"}),"undefined"!=typeof cr_is_preview&&jQuery("#borderwrap").css({width:Math.round(t)+"px",height:Math.round(e)+"px"})),this.canvas&&(this.canvas.width=Math.round(t*i),this.canvas.height=Math.round(e*i),this.isEjecta?(this.canvas.style.left=Math.floor(a)+"px",this.canvas.style.top=Math.floor(h)+"px",this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*i),this.overlay_canvas.height=Math.round(e*i),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*i),Math.round(e*i)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(t),this.ctx.height=Math.round(e)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)))},i.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch(function(){}):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},i.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onLostWebGLContext&&i.onLostWebGLContext()},i.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onRestoreWebGLContext&&i.onRestoreWebGLContext()},i.prototype.positionOverlayCanvas=function(){var t;this.isDomFree||((t=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova?jQuery(this.canvas).offset():jQuery(this.canvas).position()).position="absolute",jQuery(this.overlay_canvas).css(t))};var o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;i.prototype.setSuspended=function(t){var e,i;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&o&&o(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,e=this.logictime=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!1);this.tick(!1)}},i.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},i.prototype.GetObjectReference=function(t){return this.objectRefTable[t]};var y=!(i.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,i,o,n,s,r,a,h,l,c,m,u,p,y,_,d,f,x,g,b,v=t.project;for(this.name=v[0],this.first_layout=v[1],this.fullscreen_mode=v[12],this.fullscreen_mode_set=v[12],this.original_width=v[10],this.original_height=v[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(4<=v[12]||0===v[12])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=v[18],this.loaderstyle=v[19],0===this.loaderstyle?((m=new Image).crossOrigin="anonymous",this.setImageSrc(m,"https://cdn.jsdelivr.net/gh/ubg98/WheelieBike@f18403fb0dd4939b01a8e4b9160cc1b970a942e0/loading-logo.png"),this.loaderlogos={logo:m}):4===this.loaderstyle&&((e=new Image).src="",(i=new Image).src="",(o=new Image).src="",(n=new Image).src="",(s=new Image).src="",(r=new Image).src="",(a=new Image).src="",(h=new Image).src="",(l=new Image).src="",(c=new Image).src="",(t=new Image).src="",(m=new Image).src="",this.loaderlogos={logo:[e,i,o,n],powered:[s,r,a,h],website:[l,c,t,m]}),this.next_uid=v[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),u=0,p=v[2].length;u<p;u++)y=v[2][u],x=this.GetObjectReference(y[0]),cr.add_common_aces(y,x.prototype),(g=new x(this)).singleglobal=y[1],g.is_world=y[2],g.is_rotatable=y[5],g.must_predraw=y[9],g.onCreate&&g.onCreate(),cr.seal(g),this.plugins.push(g);for(this.objectRefTable=cr.getObjectRefTable(),u=0,p=v[3].length;u<p;u++){for(y=v[3][u],b=this.GetObjectReference(y[1]),g=null,L=0,V=this.plugins.length;L<V;L++)if(this.plugins[L]instanceof b){g=this.plugins[L];break}var B,D=new g.Type(g);for(D.name=y[0],D.is_family=y[2],D.instvar_sids=y[3].slice(0),D.vars_count=y[3].length,D.behs_count=y[4],D.fx_count=y[5],D.sid=y[11],D.is_family?(D.members=[],D.family_index=this.family_count++,D.families=null):(D.members=null,D.family_index=-1,D.families=[]),D.family_var_map=null,D.family_beh_map=null,D.family_fx_map=null,D.is_contained=!1,D.container=null,y[6]?(D.texture_file=y[6][0],D.texture_filesize=y[6][1],D.texture_pixelformat=y[6][2]):(D.texture_file=null,D.texture_filesize=0,D.texture_pixelformat=0),y[7]?D.animations=y[7]:D.animations=null,D.index=u,D.instances=[],D.deadCache=[],D.solstack=[new cr.selection(D)],D.cur_sol=0,D.default_instance=null,D.default_layerindex=0,D.stale_iids=!0,D.updateIIDs=cr.type_updateIIDs,D.getFirstPicked=cr.type_getFirstPicked,D.getPairedInstance=cr.type_getPairedInstance,D.getCurrentSol=cr.type_getCurrentSol,D.pushCleanSol=cr.type_pushCleanSol,D.pushCopySol=cr.type_pushCopySol,D.popSol=cr.type_popSol,D.getBehaviorByName=cr.type_getBehaviorByName,D.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,D.getEffectIndexByName=cr.type_getEffectIndexByName,D.applySolToContainer=cr.type_applySolToContainer,D.getInstanceByIID=cr.type_getInstanceByIID,D.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),D.any_cell_changed=!0,D.any_instance_parallaxed=!1,D.extra={},D.toString=cr.type_toString,D.behaviors=[],L=0,V=y[8].length;L<V;L++){_=y[8][L];for(var C=this.GetObjectReference(_[1]),w=null,S=0,A=this.behaviors.length;S<A;S++)if(this.behaviors[S]instanceof C){w=this.behaviors[S];break}w||((w=new C(this)).my_types=[],w.my_instances=new cr.ObjectSet,w.onCreate&&w.onCreate(),cr.seal(w),this.behaviors.push(w),cr.behaviors.solid&&w instanceof cr.behaviors.solid&&(this.solidBehavior=w),cr.behaviors.jumpthru&&w instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=w),cr.behaviors.shadowcaster&&w instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=w)),-1===w.my_types.indexOf(D)&&w.my_types.push(D);var M=new w.Type(w,D);M.name=_[0],M.sid=_[2],M.onCreate(),cr.seal(M),D.behaviors.push(M)}for(D.global=y[9],D.isOnLoaderLayout=y[10],D.effect_types=[],L=0,V=y[12].length;L<V;L++)D.effect_types.push({id:y[12][L][0],name:y[12][L][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:L});D.tile_poly_data=y[13],this.uses_loader_layout&&!D.is_family&&!D.isOnLoaderLayout&&g.is_world||(D.onCreate(),cr.seal(D)),D.name&&(this.types[D.name]=D),this.types_by_index.push(D),g.singleglobal&&((B=new g.Instance(D)).uid=this.next_uid++,B.puid=this.next_puid++,B.iid=0,B.get_iid=cr.inst_get_iid,B.toString=cr.inst_toString,B.properties=y[14],B.onCreate(),cr.seal(B),D.instances.push(B),this.objectsByUid[B.uid.toString()]=B)}for(u=0,p=v[4].length;u<p;u++)for(var T,I=v[4][u],P=this.types_by_index[I[0]],L=1,V=I.length;L<V;L++)(T=this.types_by_index[I[L]]).families.push(P),P.members.push(T);for(u=0,p=v[28].length;u<p;u++){var R=v[28][u],E=[];for(L=0,V=R.length;L<V;L++)E.push(this.types_by_index[R[L]]);for(L=0,V=E.length;L<V;L++)E[L].is_contained=!0,E[L].container=E}if(0<this.family_count)for(u=0,p=this.types_by_index.length;u<p;u++)if(!(d=this.types_by_index[u]).is_family&&d.families.length){d.family_var_map=new Array(this.family_count),d.family_beh_map=new Array(this.family_count),d.family_fx_map=new Array(this.family_count);var G=[],F=0,k=0,O=0;for(L=0,V=d.families.length;L<V;L++)for(f=d.families[L],d.family_var_map[f.family_index]=F,F+=f.vars_count,d.family_beh_map[f.family_index]=k,k+=f.behs_count,d.family_fx_map[f.family_index]=O,O+=f.fx_count,S=0,A=f.effect_types.length;S<A;S++)G.push(cr.shallowCopy({},f.effect_types[S]));for(d.effect_types=G.concat(d.effect_types),L=0,V=d.effect_types.length;L<V;L++)d.effect_types[L].index=L}for(u=0,p=v[5].length;u<p;u++){y=v[5][u];var N=new cr.layout(this,y);cr.seal(N),this.layouts[N.name]=N,this.layouts_by_index.push(N)}for(u=0,p=v[6].length;u<p;u++){y=v[6][u];var J=new cr.eventsheet(this,y);cr.seal(J),this.eventsheets[J.name]=J,this.eventsheets_by_index.push(J)}for(u=0,p=this.eventsheets_by_index.length;u<p;u++)this.eventsheets_by_index[u].postInit();for(u=0,p=this.eventsheets_by_index.length;u<p;u++)this.eventsheets_by_index[u].updateDeepIncludes();for(u=0,p=this.triggers_to_postinit.length;u<p;u++)this.triggers_to_postinit[u].postInit();cr.clearArray(this.triggers_to_postinit),this.audio_to_preload=v[7],this.files_subfolder=v[8],this.pixel_rounding=v[9],this.aspect_scale=1,this.enableWebGL=v[13],this.linearSampling=v[14],this.clearBackground=v[15],this.versionstr=v[16],this.useHighDpi=v[17],this.orientations=v[20],this.autoLockOrientation=0<this.orientations,this.pauseOnBlur=v[22],this.wantFullscreenScalingQuality=v[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=v[24],this.preloadSounds=v[25],this.projectName=v[26],this.enableFrontToBack=v[27]&&!this.isIE,this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.initRendererAndLoader()}),n=0,s=[];i.prototype.queueImageLoad=function(t,e){function i(){n--,o.maybeLoadNextImages()}var o=this;t.addEventListener("load",i),t.addEventListener("error",i),s.push([t,e]),this.maybeLoadNextImages()},i.prototype.maybeLoadNextImages=function(){for(var t;s.length&&n<100;)n++,t=s.shift(),this.setImageSrc(t[0],t[1])},i.prototype.waitForImageLoad=function(e,i){e.cocoonLazyLoad=!0,e.onerror=function(t){e.c2error=!0,y=!0,console&&console.error&&console.error("Error loading image '"+e.src+"': ",t)},this.isEjecta?e.src=i:e.src||("undefined"!=typeof XAPKReader?XAPKReader.get(i,function(t){e.src=t},function(t){e.c2error=!0,y=!0,console&&console.error&&console.error("Error extracting image '"+i+"' from expansion file: ",t)}):(e.crossOrigin="anonymous",this.queueImageLoad(e,i))),this.wait_for_textures.push(e)};var h=0,l=!(i.prototype.findWaitingTexture=function(t){for(var e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null});i.prototype.getready=function(){this.audioInstance&&(h=this.audioInstance.setPreloadList(this.audio_to_preload))};var _=!(i.prototype.areAllTexturesAndSoundsLoaded=function(){for(var t,e,i=h,o=0,n=!0,s=0,r=this.wait_for_textures.length;s<r;s++){var a=(e=this.wait_for_textures[s]).cr_filesize;(!a||a<=0)&&(a=5e4),i+=a,e.src&&(e.complete||e.loaded)&&!e.c2error?o+=a:n=!1}return n&&this.preloadSounds&&this.audioInstance&&(l||(this.audioInstance.startPreloads(),l=!0),o+=t=this.audioInstance.getPreloadedSize(),t<h&&(n=!1)),this.progress=0==i?1:o/i,n});i.prototype.go=function(){if(this.ctx||this.glwrap){var t=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();var e=window.innerWidth,i=window.innerHeight;this.lastWindowWidth===e&&this.lastWindowHeight===i||this.setSize(e,i),this.progress=0,this.last_progress=-1;var o=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||_))this.go_loading_finished();else{var n=Date.now()-this.start_time;if(t){var s=this.width,r=this.height,a=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||500<=n&&this.last_progress!=this.progress)){t.clearRect(0,0,s,r);var h=s/2,l=r/2,c=0===this.loaderstyle&&this.loaderlogos.logo.complete,e=40*a,i=0,n=80*a;c&&(e=(n=(s=this.loaderlogos.logo).width*a)/2,i=(r=s.height*a)/2,t.drawImage(s,cr.floor(h-e),cr.floor(l-i),n,r)),this.loaderstyle<=1?(l+=i+(c?12*a:0),h-=e,h=cr.floor(h)+.5,l=cr.floor(l)+.5,t.fillStyle=y?"red":"DodgerBlue",t.fillRect(h,l,Math.floor(n*this.progress),6*a),t.strokeStyle="black",t.strokeRect(h,l,n,6*a),t.strokeStyle="white",t.strokeRect(h-+a,l-+a,n+2*a,8*a)):2===this.loaderstyle&&(t.font=this.isEjecta?"12pt ArialMT":"12pt Arial",t.fillStyle=y?"#f00":"#999",t.textBaseLine="middle",n=Math.round(100*this.progress)+"%",a=(a=t.measureText?t.measureText(n):null)?a.width:0,t.fillText(n,h-a/2,l)),this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c2_splash_loader(t),void(m?m(function(){o.go()}):setTimeout(function(){o.go()},16))}setTimeout(function(){o.go()},this.isCocoonJs?10:100)}}};var d=-1,f="undefined"==typeof cr_is_preview?200:0,x=!0,g=!1,b=0,v=0,B="undefined"==typeof cr_is_preview?3e3:0,D=null,C=null,w=0;function S(t,e){return e<=128?t[3]:e<=256?t[2]:e<=512?t[1]:t[0]}i.prototype.draw_c2_splash_loader=function(t){if(!_){for(var e=Math.ceil(this.width),i=Math.ceil(this.height),o=(this.devicePixelRatio,this.loaderlogos.logo),n=this.loaderlogos.powered,s=this.loaderlogos.website,r=0;r<4;++r)if(!o[r].complete||!n[r].complete||!s[r].complete)return;0===w&&(d=Date.now());var a,h,l,c,m=Date.now(),u=!1,p=t;x||g?(t.clearRect(0,0,e,i),l=e,c=i,D&&D.width===l&&D.height===c||((D=document.createElement("canvas")).width=l,D.height=c,C=D.getContext("2d")),p=C,u=!0,x&&1===w&&(d=Date.now())):t.globalAlpha=1,p.fillStyle="#333333",p.fillRect(0,0,e,i),256<this.cssHeight?(h=.25*(a=cr.clamp(.22*i,105,.6*e)),p.drawImage(S(n,a),.5*e-a/2,.2*i-h/2,a,h),h=a=Math.min(.395*i,.95*e),p.drawImage(S(o,a),.5*e-a/2,.485*i-h/2,a,h),h=.25*(a=cr.clamp(.22*i,105,.6*e)),p.drawImage(S(s,a),.5*e-a/2,.868*i-h/2,a,h),p.fillStyle="#3C3C3C",a=e,h=Math.max(.005*i,2),p.fillRect(0,.8*i-h/2,a,h),p.fillStyle=y?"red":"#E0FF65",a=e*this.progress,p.fillRect(.5*e-a/2,.8*i-h/2,a,h)):(h=a=.55*i,p.drawImage(S(o,a),.5*e-a/2,.45*i-h/2,a,h),p.fillStyle="#3C3C3C",a=e,h=Math.max(.005*i,2),p.fillRect(0,.85*i-h/2,a,h),p.fillStyle=y?"red":"#E0FF65",a=e*this.progress,p.fillRect(.5*e-a/2,.85*i-h/2,a,h)),u&&(x?t.globalAlpha=0===w?0:Math.min((m-d)/300,1):g&&(t.globalAlpha=Math.max(1-(m-v)/300,0)),t.drawImage(D,0,0,e,i)),x&&300<=m-d&&2<=w&&(x=!1,b=m),!x&&B<=m-b&&!g&&1<=this.progress&&(g=!0,v=m),(g&&300+f<=m-v||"undefined"!=typeof cr_is_preview&&1<=this.progress&&Date.now()-d<500)&&(g=x=!(_=!0),C=D=null,this.loaderlogos=null),++w}},i.prototype.go_loading_finished=function(){var t,e,i,o,n;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();for(2<=this.fullscreen_mode&&(o=this.original_width/this.original_height,n=this.width/this.height,2!==this.fullscreen_mode&&o<n||2===this.fullscreen_mode&&n<o?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width),(this.first_layout?this.layouts[this.first_layout]:this.layouts_by_index[0]).startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onAppBegin&&i.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1),this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")},i.prototype.tick=function(t,e,i){var o,n,s;this.running_layout&&(o=s=cr.performance_now(),!i&&this.isSuspended&&!t||(t||(m?this.raf_id=m(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16)),n=e||s,i=this.fullscreen_mode,((e=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)||this.isNodeFullscreen)&&0<this.fullscreen_scaling&&(i=this.fullscreen_scaling),0<i&&(s=window.innerWidth,i=window.innerHeight,this.lastWindowWidth===s&&this.lastWindowHeight===i||this.setSize(s,i)),this.isDomFree||(e?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height)),this.isloading&&(e=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,e&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW())),this.logic(n),!this.redraw&&!this.isCocoonJs||this.is_WebGL_context_lost||this.suspendDrawing||t||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-o))},i.prototype.logic=function(t){var e,i,o,n;1e3<=t-this.last_fps_time&&(this.last_fps_time+=1e3,1e3<=t-this.last_fps_time&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);var s=0;0!==this.last_tick_time&&((r=t-this.last_tick_time)<0&&(r=0),s=r/1e3,this.dt1=s,.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)),this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(s);var r,a=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova;2<=this.fullscreen_mode||a&&0<this.fullscreen_scaling?(r=this.original_width/this.original_height,t=this.width/this.height,s=this.fullscreen_mode,a&&0<this.fullscreen_scaling&&(s=this.fullscreen_scaling),this.aspect_scale=2!==s&&r<t||2===s&&t<r?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))):this.aspect_scale=this.isRetina?this.devicePixelRatio:1,this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;for(var h=this.objects_to_pretick.valuesRef(),l=0,c=h.length;l<c;l++)h[l].pretick();for(l=0,c=this.types_by_index.length;l<c;l++)if(!(o=this.types_by_index[l]).is_family&&(o.behaviors.length||o.families.length))for(e=0,i=o.instances.length;e<i;e++)for(u=0,p=(m=o.instances[e]).behavior_insts.length;u<p;u++)m.behavior_insts[u].tick();for(l=0,c=this.types_by_index.length;l<c;l++)if(!(o=this.types_by_index[l]).is_family&&(o.behaviors.length||o.families.length))for(e=0,i=o.instances.length;e<i;e++)for(u=0,p=(m=o.instances[e]).behavior_insts.length;u<p;u++)(n=m.behavior_insts[u]).posttick&&n.posttick();for(l=0,c=(h=this.objects_to_tick.valuesRef()).length;l<c;l++)h[l].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),l=0;this.changelayout&&l++<10;)this.doChangeLayout(this.changelayout);for(l=0,c=this.eventsheets_by_index.length;l<c;l++)this.eventsheets_by_index[l].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,l=0,c=this.types_by_index.length;l<c;l++)if(!(o=this.types_by_index[l]).is_family&&(o.behaviors.length||o.families.length))for(e=0,i=o.instances.length;e<i;e++)for(var m,u=0,p=(m=o.instances[e]).behavior_insts.length;u<p;u++)(n=m.behavior_insts[u]).tick2&&n.tick2();for(l=0,c=(h=this.objects_to_tick2.valuesRef()).length;l<c;l++)h[l].tick2();this.isInOnDestroy--},i.prototype.onWindowBlur=function(){for(var t,e,i,o,n,s,r,a=0,h=this.types_by_index.length;a<h;a++)if(!(n=this.types_by_index[a]).is_family)for(t=0,e=n.instances.length;t<e;t++)if((s=n.instances[t]).onWindowBlur&&s.onWindowBlur(),s.behavior_insts)for(i=0,o=s.behavior_insts.length;i<o;i++)(r=s.behavior_insts[i]).onWindowBlur&&r.onWindowBlur()},i.prototype.doChangeLayout=function(t){var e,i,o,n=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)(o=this.types_by_index[e]).is_family||!o.unloadTextures||o.global&&0!==o.instances.length||-1!==t.initial_types.indexOf(o)||o.unloadTextures();n==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},i.prototype.runLayoutChangeMethods=function(t){for(var e,i,o,n,s,r,a,h,l=0,c=this.behaviors.length;l<c;l++)e=this.behaviors[l],t?e.onBeforeLayoutChange&&e.onBeforeLayoutChange():e.onLayoutChange&&e.onLayoutChange();for(l=0,c=this.types_by_index.length;l<c;l++)if((i=this.types_by_index[l]).global||i.plugin.singleglobal)for(o=0,n=i.instances.length;o<n;o++)if(s=i.instances[o],t?s.onBeforeLayoutChange&&s.onBeforeLayoutChange():s.onLayoutChange&&s.onLayoutChange(),s.behavior_insts)for(r=0,a=s.behavior_insts.length;r<a;r++)h=s.behavior_insts[r],t?h.onBeforeLayoutChange&&h.onBeforeLayoutChange():h.onLayoutChange&&h.onLayoutChange()},i.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},i.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},i.prototype.tickMe=function(t){this.objects_to_tick.add(t)},i.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},i.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},i.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},i.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},i.prototype.draw=function(){this.running_layout.draw(this.ctx),this.isDirectCanvas&&this.ctx.present()},i.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},i.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},i.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},i.prototype.getObjectByUID=function(t){t=t.toString();return this.objectsByUid.hasOwnProperty(t)?this.objectsByUid[t]:null};var p=[];i.prototype.DestroyInstance=function(t){var e,i,o=t.type.name,n=null;if(this.deathRow.hasOwnProperty(o)){if((n=this.deathRow[o]).contains(t))return}else n=p.length?p.pop():new cr.ObjectSet,this.deathRow[o]=n;if(n.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&n.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},i.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,o,n,s;for(this.isInClearDeathRow=!0,i=0,n=this.createRow.length;i<n;++i)for((e=(t=this.createRow[i]).type).instances.push(t),o=0,s=e.families.length;o<s;++o)e.families[o].instances.push(t),e.families[o].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},i.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},i.prototype.ClearDeathRowForType=function(t){var e,i,o,n,s,r,a,h,l=t.valuesRef(),c=l[0].type;for(cr.arrayRemoveAllFromObjectSet(c.instances,t),c.stale_iids=!0,0===c.instances.length&&(c.any_instance_parallaxed=!1),e=0,i=c.families.length;e<i;++e)r=c.families[e],cr.arrayRemoveAllFromObjectSet(r.instances,t),r.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if((s=this.system.waits[e]).sols.hasOwnProperty(c.index)&&cr.arrayRemoveAllFromObjectSet(s.sols[c.index].insts,t),!c.is_family)for(o=0,n=c.families.length;o<n;++o)r=c.families[o],s.sols.hasOwnProperty(r.index)&&cr.arrayRemoveAllFromObjectSet(s.sols[r.index].insts,t);var m,u=l[0].layer;if(u){if(u.useRenderCells)for(e=0,i=(a=u.instances).length;e<i;++e)h=a[e],t.contains(h)&&(h.update_bbox(),u.render_grid.update(h,h.rendercells,null),h.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(u.instances,t),u.setZIndicesStaleFrom(0)}for(e=0;e<l.length;++e)this.ClearDeathRowForSingleInstance(l[e],c);(m=t).clear(),p.push(m),this.redraw=!0},i.prototype.ClearDeathRowForSingleInstance=function(t,e){for(var i,o=0,n=this.destroycallbacks.length;o<n;++o)this.destroycallbacks[o](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var s=t.layer;if(s&&s.removeFromInstanceList(t,!0),t.behavior_insts)for(o=0,n=t.behavior_insts.length;o<n;++o)(i=t.behavior_insts[o]).onDestroy&&i.onDestroy(),i.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},i.prototype.createInstance=function(t,e,i,o){if(t.is_family){var n=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[n],e,i,o)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,o,!1):null};var A=[];i.prototype.createInstanceFromInit=function(t,e,i,o,n,s){var r,a,h,l,c;if(!t)return null;var m=this.types_by_index[t[1]],u=m.plugin.is_world;if(this.isloading&&u&&!m.isOnLoaderLayout)return null;if(u&&!this.glwrap&&11===t[0][11])return null;var p,y=e;for(u||(e=null),m.deadCache.length?((p=m.deadCache.pop()).recycled=!0,m.plugin.Instance.call(p,m)):(p=new m.plugin.Instance(m)).recycled=!1,!i||s||this.objectsByUid.hasOwnProperty(t[2].toString())?p.uid=this.next_uid++:p.uid=t[2],(this.objectsByUid[p.uid.toString()]=p).puid=this.next_puid++,p.iid=m.instances.length,r=0,a=this.createRow.length;r<a;++r)this.createRow[r].type===m&&p.iid++;p.get_iid=cr.inst_get_iid,p.toString=cr.inst_toString;var _,d,f=t[3];if(p.recycled)cr.wipe(p.extra);else{if(p.extra={},"undefined"!=typeof cr_is_preview)for(p.instance_var_names=[],p.instance_var_names.length=f.length,r=0,a=f.length;r<a;r++)p.instance_var_names[r]=f[r][1];p.instance_vars=[],p.instance_vars.length=f.length}for(r=0,a=f.length;r<a;r++)p.instance_vars[r]=f[r][0];if(u){var x=t[0];if(p.x=cr.is_undefined(o)?x[0]:o,p.y=cr.is_undefined(n)?x[1]:n,p.z=x[2],p.width=x[3],p.height=x[4],p.depth=x[5],p.angle=x[6],p.opacity=x[7],p.hotspotX=x[8],p.hotspotY=x[9],p.blend_mode=x[10],c=x[11],!this.glwrap&&m.effect_types.length&&(p.blend_mode=c),p.compositeOp=cr.effectToCompositeOp(p.blend_mode),this.gl&&cr.setGLBlend(p,p.blend_mode,this.gl),p.recycled){for(r=0,a=x[12].length;r<a;r++)for(h=0,l=x[12][r].length;h<l;h++)p.effect_params[r][h]=x[12][r][h];p.bbox.set(0,0,0,0),p.collcells.set(0,0,-1,-1),p.rendercells.set(0,0,-1,-1),p.bquad.set_from_rect(p.bbox),cr.clearArray(p.bbox_changed_callbacks)}else{for(p.effect_params=x[12].slice(0),r=0,a=p.effect_params.length;r<a;r++)p.effect_params[r]=x[12][r].slice(0);p.active_effect_types=[],p.active_effect_flags=[],p.active_effect_flags.length=m.effect_types.length,p.bbox=new cr.rect(0,0,0,0),p.collcells=new cr.rect(0,0,-1,-1),p.rendercells=new cr.rect(0,0,-1,-1),p.bquad=new cr.quad,p.bbox_changed_callbacks=[],p.set_bbox_changed=cr.set_bbox_changed,p.add_bbox_changed_callback=cr.add_bbox_changed_callback,p.contains_pt=cr.inst_contains_pt,p.update_bbox=cr.update_bbox,p.update_render_cell=cr.update_render_cell,p.update_collision_cell=cr.update_collision_cell,p.get_zindex=cr.inst_get_zindex}for(p.tilemap_exists=!1,p.tilemap_width=0,p.tilemap_height=0,p.tilemap_data=null,14===x.length&&(p.tilemap_exists=!0,p.tilemap_width=x[13][0],p.tilemap_height=x[13][1],p.tilemap_data=x[13][2]),r=0,a=m.effect_types.length;r<a;r++)p.active_effect_flags[r]=!0;p.shaders_preserve_opaqueness=!0,p.updateActiveEffects=cr.inst_updateActiveEffects,p.updateActiveEffects(),p.uses_shaders=!!p.active_effect_types.length,p.bbox_changed=!0,p.cell_changed=!0,m.any_cell_changed=!0,p.visible=!0,p.my_timescale=-1,p.layer=e,p.zindex=e.instances.length,void(p.earlyz_index=0)===p.collision_poly&&(p.collision_poly=null),p.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(A),r=0,a=m.families.length;r<a;r++)A.push.apply(A,m.families[r].behaviors);if(A.push.apply(A,m.behaviors),p.recycled)for(r=0,a=A.length;r<a;r++){var g=A[r];for((d=p.behavior_insts[r]).recycled=!0,g.behavior.Instance.call(d,g,p),h=0,l=(_=t[4][r]).length;h<l;h++)d.properties[h]=_[h];d.onCreate(),g.behavior.my_instances.add(p)}else for(p.behavior_insts=[],r=0,a=A.length;r<a;r++)(d=new(g=A[r]).behavior.Instance(g,p)).recycled=!1,d.properties=t[4][r].slice(0),d.onCreate(),cr.seal(d),p.behavior_insts.push(d),g.behavior.my_instances.add(p);if(_=t[5],p.recycled)for(r=0,a=_.length;r<a;r++)p.properties[r]=_[r];else p.properties=_.slice(0);if(this.createRow.push(p),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(p,!0),1===e.parallaxX&&1===e.parallaxY||(m.any_instance_parallaxed=!0)),this.objectcount++,m.is_contained){if(p.is_contained=!0,p.recycled?cr.clearArray(p.siblings):p.siblings=[],!i&&!s){for(r=0,a=m.container.length;r<a;r++)if(m.container[r]!==m){if(!m.container[r].default_instance)return null;p.siblings.push(this.createInstanceFromInit(m.container[r].default_instance,y,!1,u?p.x:o,u?p.y:n,!0))}for(r=0,a=p.siblings.length;r<a;r++)for(p.siblings[r].siblings.push(p),h=0;h<a;h++)r!==h&&p.siblings[r].siblings.push(p.siblings[h])}}else p.is_contained=!1,p.siblings=null;for(p.onCreate(),p.recycled||cr.seal(p),r=0,a=p.behavior_insts.length;r<a;r++)p.behavior_insts[r].postCreate&&p.behavior_insts[r].postCreate();return p},i.prototype.getLayerByName=function(t){for(var e=0,i=this.running_layout.layers.length;e<i;e++){var o=this.running_layout.layers[e];if(cr.equals_nocase(o.name,t))return o}return null},i.prototype.getLayerByNumber=function(t){return(t=cr.floor(t))<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},i.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},i.prototype.clearSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},i.prototype.pushCleanSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},i.prototype.pushCopySol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].pushCopySol()},i.prototype.popSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].popSol()},i.prototype.updateAllCells=function(t){if(t.any_cell_changed){for(var e=t.instances,i=0,o=e.length;i<o;++i)e[i].update_collision_cell();var n=this.createRow;for(i=0,o=n.length;i<o;++i)n[i].type===t&&n[i].update_collision_cell();t.any_cell_changed=!1}},i.prototype.getCollisionCandidates=function(t,e,i,o){var n,s,r,a=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(n=0,s=e.members.length;n<s;++n)r=e.members[n],a||r.any_instance_parallaxed?cr.appendArray(o,r.instances):(this.updateAllCells(r),r.collision_grid.queryRange(i,o));else a||e.any_instance_parallaxed?cr.appendArray(o,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,o))},i.prototype.getTypesCollisionCandidates=function(t,e,i,o){for(var n=0,s=e.length;n<s;++n)this.getCollisionCandidates(t,e[n],i,o)},i.prototype.getSolidCollisionCandidates=function(t,e,i){var o=this.getSolidBehavior();if(!o)return null;this.getTypesCollisionCandidates(t,o.my_types,e,i)},i.prototype.getJumpthruCollisionCandidates=function(t,e,i){var o=this.getJumpthruBehavior();if(!o)return null;this.getTypesCollisionCandidates(t,o.my_types,e,i)},i.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,o){var n,s,r,a,h,l,c,m=t.getCurrentSol(),u=this.getCurrentEventStack().current_event.orblock;if(m.select_all)for(o||(m.select_all=!1,cr.clearArray(m.instances)),n=0,a=t.instances.length;n<a;n++)if((r=t.instances[n]).update_bbox(),h=r.layer.canvasToLayer(e,i,!0),l=r.layer.canvasToLayer(e,i,!1),r.contains_pt(h,l)){if(o)return!1;m.instances.push(r)}else u&&m.else_instances.push(r);else{for(n=s=0,a=(c=u?m.else_instances:m.instances).length;n<a;n++)if((r=c[n]).update_bbox(),h=r.layer.canvasToLayer(e,i,!0),l=r.layer.canvasToLayer(e,i,!1),r.contains_pt(h,l)){if(o)return!1;u?m.instances.push(r):(m.instances[s]=m.instances[n],s++)}o||(c.length=s)}return t.applySolToContainer(),!!o||m.hasObjects()},i.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,o,n,s,r,a,h,l,c,m,u=t.layer,p=e.layer;if(u===p||u.parallaxX===p.parallaxX&&p.parallaxY==p.parallaxY&&u.scale===p.scale&&u.angle===p.angle&&u.zoomRate===p.zoomRate)return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),l=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!l||(c=h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),this.temp_poly),m=l?(e.collision_poly.cache_poly(e.width,e.height,e.angle),e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),this.temp_poly),c.intersects_poly(m,e.x-t.x,e.y-t.y))))));for(h=t.collision_poly&&!t.collision_poly.is_empty(),l=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),c=this.temp_poly,l?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),m=this.temp_poly2,i=0,o=c.pts_count;i<o;i++)s=(n=2*i)+1,r=c.pts_cache[n],a=c.pts_cache[s],c.pts_cache[n]=u.layerToCanvas(r+t.x,a+t.y,!0),c.pts_cache[s]=u.layerToCanvas(r+t.x,a+t.y,!1);for(c.update_bbox(),i=0,o=m.pts_count;i<o;i++)s=(n=2*i)+1,r=m.pts_cache[n],a=m.pts_cache[s],m.pts_cache[n]=p.layerToCanvas(r+e.x,a+e.y,!0),m.pts_cache[s]=p.layerToCanvas(r+e.x,a+e.y,!1);return m.update_bbox(),c.intersects_poly(m,0,0)};var u=new cr.quad,M=new cr.rect(0,0,0,0),T=[];i.prototype.testTilemapOverlap=function(t,e){var i,o,n=e.bbox,s=t.x,r=t.y;t.getCollisionRectCandidates(n,T);for(var a=T,h=e.collision_poly&&!e.collision_poly.is_empty(),l=0,c=a.length;l<c;++l)if(i=a[l],o=i.rc,n.intersects_rect_off(o,s,r)&&(u.set_from_rect(o),u.offset(s,r),u.intersects_quad(e.bquad)))if(h){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),i.poly){if(i.poly.intersects_poly(e.collision_poly,e.x-(s+o.left),e.y-(r+o.top)))return cr.clearArray(T),!0}else if(this.temp_poly.set_from_quad(u,0,0,o.right-o.left,o.bottom-o.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(T),!0}else{if(!i.poly)return cr.clearArray(T),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),i.poly.intersects_poly(this.temp_poly,-(s+o.left),-(r+o.top)))return cr.clearArray(T),!0}return cr.clearArray(T),!1},i.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,T);for(var i,o,n=T,s=e.x,r=e.y,a=0,h=n.length;a<h;++a)if(o=(i=n[a]).rc,t.intersects_rect_off(o,s,r)){if(!i.poly)return cr.clearArray(T),!0;if(this.temp_poly.set_from_rect(t,0,0),i.poly.intersects_poly(this.temp_poly,-(s+o.left),-(r+o.top)))return cr.clearArray(T),!0}return cr.clearArray(T),!1}return u.set_from_rect(t),!!e.bquad.intersects_quad(u)&&(!(e.collision_poly&&!e.collision_poly.is_empty())||(e.collision_poly.cache_poly(e.width,e.height,e.angle),u.offset(-t.left,-t.top),this.temp_poly.set_from_quad(u,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},i.prototype.testSegmentOverlap=function(t,e,i,o,n){if(!n||!n.collisionsEnabled)return!1;n.update_bbox();n.layer;if(M.set(cr.min(t,i),cr.min(e,o),cr.max(t,i),cr.max(e,o)),!n.bbox.intersects_rect(M))return!1;if(n.tilemap_exists){n.getCollisionRectCandidates(M,T);for(var s,r,a=T,h=n.x,l=n.y,c=0,m=a.length;c<m;++c)if(s=a[c],r=s.rc,M.intersects_rect_off(r,h,l)&&(u.set_from_rect(r),u.offset(h,l),u.intersects_segment(t,e,i,o))){if(!s.poly)return cr.clearArray(T),!0;if(s.poly.intersects_segment(h+r.left,l+r.top,t,e,i,o))return cr.clearArray(T),!0}return cr.clearArray(T),!1}return!!n.bquad.intersects_segment(t,e,i,o)&&(!(n.collision_poly&&!n.collision_poly.is_empty())||(n.collision_poly.cache_poly(n.width,n.height,n.angle),n.collision_poly.intersects_segment(n.x,n.y,t,e,i,o)))},i.prototype.typeHasBehavior=function(t,e){if(!e)return!1;for(var i,o,n,s=0,r=t.behaviors.length;s<r;s++)if(t.behaviors[s].behavior instanceof e)return!0;if(!t.is_family)for(s=0,r=t.families.length;s<r;s++)for(i=0,o=(n=t.families[s]).behaviors.length;i<o;i++)if(n.behaviors[i].behavior instanceof e)return!0;return!1},i.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},i.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},i.prototype.getSolidBehavior=function(){return this.solidBehavior},i.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var r=[];i.prototype.testOverlapSolid=function(t){var e,i,o;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,r),e=0,i=r.length;e<i;++e)if(o=r[e],o.extra.solidEnabled&&this.testOverlap(t,o))return cr.clearArray(r),o;return cr.clearArray(r),null},i.prototype.testRectOverlapSolid=function(t){var e,i,o;for(this.getSolidCollisionCandidates(null,t,r),e=0,i=r.length;e<i;++e)if(o=r[e],o.extra.solidEnabled&&this.testRectOverlap(t,o))return cr.clearArray(r),o;return cr.clearArray(r),null};var a=[];i.prototype.testOverlapJumpThru=function(t,e){var i,o,n,s=null;for(e&&(s=a,cr.clearArray(s)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,r),i=0,o=r.length;i<o;++i)if(n=r[i],n.extra.jumpthruEnabled&&this.testOverlap(t,n)){if(!e)return cr.clearArray(r),n;s.push(n)}return cr.clearArray(r),s},i.prototype.pushOutSolid=function(t,e,i,o,n,s){for(var r=o||50,a=t.x,h=t.y,l=null,c=null,m=0;m<r;m++)if(t.x=a+e*m,t.y=h+i*m,t.set_bbox_changed(),!this.testOverlap(t,l)&&(l=this.testOverlapSolid(t),l&&(c=l),!l&&(n&&(l=s?this.testOverlap(t,s)?s:null:this.testOverlapJumpThru(t))&&(c=l),!l)))return c&&this.pushInFractional(t,e,i,c,16),!0;return t.x=a,t.y=h,t.set_bbox_changed(),!1},i.prototype.pushOutSolidAxis=function(t,e,i,o){o=o||50;for(var n,s,r=t.x,a=t.y,h=null,l=null,c=0;c<o;++c)for(n=0;n<2;++n)if(s=2*n-1,t.x=r+e*c*s,t.y=a+i*c*s,t.set_bbox_changed(),!this.testOverlap(t,h)){if(!(h=this.testOverlapSolid(t)))return l&&this.pushInFractional(t,e*s,i*s,l,16),!0;l=h}return t.x=r,t.y=a,t.set_bbox_changed(),!1},i.prototype.pushOut=function(t,e,i,o,n){for(var s=o||50,r=t.x,a=t.y,h=0;h<s;h++)if(t.x=r+e*h,t.y=a+i*h,t.set_bbox_changed(),!this.testOverlap(t,n))return!0;return t.x=r,t.y=a,t.set_bbox_changed(),!1},i.prototype.pushInFractional=function(t,e,i,o,n){for(var s,r=2,a=!1,h=!1,l=t.x,c=t.y;r<=n;)s=1/r,r*=2,t.x+=e*s*(a?1:-1),t.y+=i*s*(a?1:-1),t.set_bbox_changed(),this.testOverlap(t,o)?h=a=!0:(h=a=!1,l=t.x,c=t.y);h&&(t.x=l,t.y=c,t.set_bbox_changed())},i.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,o=0,n=t.x,s=t.y,r=0,a=0,h=0,l=this.testOverlapSolid(t);if(!l)return!0;for(;o<=i;){switch(r){case 0:a=0,h=-1,o++;break;case 1:h=-(a=1);break;case 2:a=1,h=0;break;case 3:h=a=1;break;case 4:a=0,h=1;break;case 5:a=-1,h=1;break;case 6:a=-1,h=0;break;case 7:h=a=-1}if(r=(r+1)%8,t.x=cr.floor(n+a*o),t.y=cr.floor(s+h*o),t.set_bbox_changed(),!this.testOverlap(t,l)&&!(l=this.testOverlapSolid(t)))return!0}return t.x=n,t.y=s,t.set_bbox_changed(),!1},i.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},i.prototype.addRegisteredCollisionCandidates=function(t,e,i){for(var o,n,s=0,r=this.registered_collisions.length;s<r;++s){if((o=this.registered_collisions[s])[0]===t)n=o[1];else{if(o[1]!==t)continue;n=o[0]}if(e.is_family){if(-1===e.members.indexOf(e))continue}else if(n.type!==e)continue;-1===i.indexOf(n)&&i.push(n)}},i.prototype.checkRegisteredCollision=function(t,e){for(var i,o=0,n=this.registered_collisions.length;o<n;o++)if((i=this.registered_collisions[o])[0]===t&&i[1]===e||i[0]===e&&i[1]===t)return!0;return!1},i.prototype.calculateSolidBounceAngle=function(t,e,i,o){var n=t.x,s=t.y,r=cr.max(10,cr.distanceTo(e,i,n,s)),a=cr.angleTo(e,i,n,s),h=o||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(a+cr.PI);for(var l,c,m,u=h,p=cr.to_radians(5),y=1;y<36;y++)if(l=a-y*p,t.x=e+Math.cos(l)*r,t.y=i+Math.sin(l)*r,t.set_bbox_changed(),!this.testOverlap(t,u)&&!(u=o?null:this.testOverlapSolid(t))){c=l;break}36===y&&(c=cr.clamp_angle(a+cr.PI));u=h;for(y=1;y<36;y++)if(l=a+y*p,t.x=e+Math.cos(l)*r,t.y=i+Math.sin(l)*r,t.set_bbox_changed(),!this.testOverlap(t,u)&&!(u=o?null:this.testOverlapSolid(t))){m=l;break}if(36===y&&(m=cr.clamp_angle(a+cr.PI)),t.x=n,t.y=s,t.set_bbox_changed(),m===c)return m;var _=cr.angleDiff(m,c)/2,d=cr.angleClockwise(m,c)?cr.clamp_angle(c+_+cr.PI):cr.clamp_angle(m+_),h=Math.cos(a),n=Math.sin(a),s=Math.cos(d),_=Math.sin(d),d=h*s+n*_,s=h-2*d*s,_=n-2*d*_;return cr.angleTo(0,0,s,_)};var I=-1;function c(){try{return window.indexedDB}catch(t){return}}function P(t){t.target.result.createObjectStore("saves",{keyPath:"slot"})}function L(){cr.logexport("Reloading for continuous preview"),window.c2cocoonjs?CocoonJS.App.reload():-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location=window.location+"?continuous"}function V(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&(t[e]instanceof cr.ObjectSet||t[e]&&void 0!==t[e].c2userdata||"spriteCreatedDestroyCallback"!==e&&(i[e]=t[e]));return i}i.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var o=this.running_layout.event_sheet;if(!o)return!1;var n,s=!1;I++;for(var r=o.deep_includes,a=0,h=r.length;a<h;++a)n=this.triggerOnSheet(t,e,r[a],i),s=s||n;return n=this.triggerOnSheet(t,e,o,i),I--,s=s||n},i.prototype.triggerOnSheet=function(t,e,i,o){var n,s,r,a,h=!1;if(e)for(r=this.triggerOnSheetForTypeName(t,e,e.type.name,i,o),h=h||r,n=0,s=(a=e.type.families).length;n<s;++n)r=this.triggerOnSheetForTypeName(t,e,a[n].name,i,o),h=h||r;else r=this.triggerOnSheetForTypeName(t,e,"system",i,o),h=h||r;return h},i.prototype.triggerOnSheetForTypeName=function(t,e,i,o,n){var s,r,a,h=!1,l=void 0!==n,c=(l?o.fasttriggers:o.triggers)[i];if(!c)return h;for(var m,u=null,p=0,y=c.length;p<y;++p)if(c[p].method==t){u=c[p].evs;break}if(!u)return h;if(!(m=l?u[n]:u))return null;for(p=0,y=m.length;p<y;p++)r=m[p][0],a=m[p][1],s=this.executeSingleTrigger(e,i,r,a),h=h||s;return h},i.prototype.executeSingleTrigger=function(t,e,i,o){var n,s,r=!1;this.trigger_depth++;var a=this.getCurrentEventStack().current_event;a&&this.pushCleanSol(a.solModifiersIncludingParents);var h=1<this.trigger_depth;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var l,c=this.pushEventStack(i);c.current_event=i,t&&((l=this.types[e].getCurrentSol()).select_all=!1,cr.clearArray(l.instances),l.instances[0]=t,this.types[e].applySolToContainer());var m=!0;if(i.parent){for(var u=c.temp_parents_arr,p=i.parent;p;)u.push(p),p=p.parent;for(u.reverse(),n=0,s=u.length;n<s;n++)if(!u[n].run_pretrigger()){m=!1;break}}return m&&(this.execcount++,i.orblock?i.run_orblocktrigger(o):i.run(),r=r||c.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),a&&this.popSol(a.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===I&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,r},i.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},i.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type},i.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex},i.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},i.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},i.prototype.popLocalVarStack=function(){this.localvar_stack_index--},i.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},i.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},i.prototype.popEventStack=function(){this.event_stack_index--},i.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},i.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},i.prototype.popLoopStack=function(){this.loop_stack_index--},i.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},i.prototype.getEventVariableByName=function(t,e){for(var i,o,n,s,r,a;e;){for(i=0,o=e.subevents.length;i<o;i++)if((a=e.subevents[i])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;e=e.parent}for(i=0,o=this.eventsheets_by_index.length;i<o;i++)for(n=0,s=(r=this.eventsheets_by_index[i]).events.length;n<s;n++)if((a=r.events[n])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;return null},i.prototype.getLayoutBySid=function(t){for(var e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},i.prototype.getObjectTypeBySid=function(t){for(var e=0,i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},i.prototype.getGroupBySid=function(t){for(var e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},i.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},i.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},i.prototype.handleSaveLoad=function(){var i=this,t=this.saveToSlot,o=this.lastSaveJson,e=this.loadFromSlot,n=!1;if(this.signalledContinuousPreview&&(n=!0,t="__c2_continuouspreview",this.signalledContinuousPreview=!1),t.length){if(this.ClearDeathRow(),o=this.saveToJSONString(),c()&&!this.isCocoonJs)!function(e,i,o,n){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=P,t.onerror=n,t.onsuccess=function(t){t=t.target.result;t.onerror=n,t.transaction(["saves"],"readwrite").objectStore("saves").put({slot:e,data:i}).onsuccess=o}}catch(t){n(t)}}(t,o,function(){cr.logexport("Saved state to IndexedDB storage ("+o.length+" bytes)"),i.lastSaveJson=o,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",n&&L()},function(e){try{localStorage.setItem("__c2save_"+t,o),cr.logexport("Saved state to WebStorage ("+o.length+" bytes)"),i.lastSaveJson=o,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",n&&L()}catch(t){cr.logexport("Failed to save game state: "+e+"; "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+t,o),cr.logexport("Saved state to WebStorage ("+o.length+" bytes)"),i.lastSaveJson=o,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",n&&L()}catch(t){cr.logexport("Error saving to WebStorage: "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(e.length){if(c()&&!this.isCocoonJs)!function(i,o,n){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=P,t.onerror=n,t.onsuccess=function(t){t=t.target.result;t.onerror=n;var e=t.transaction(["saves"]).objectStore("saves").get(i);e.onsuccess=function(t){e.result?o(e.result.data):o(null)}}}catch(t){n(t)}}(e,function(t){t?(i.loadFromJson=t,cr.logexport("Loaded state from IndexedDB storage ("+i.loadFromJson.length+" bytes)")):(i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)")),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(t){i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)"),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)},i.prototype.saveToJSONString=function(){for(var t,e,i,o,n,s,r,a,h,l,c={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}},m=0,u=this.types_by_index.length;m<u;m++)if(!(i=this.types_by_index[m]).is_family&&!this.typeHasNoSaveBehavior(i)){for(n={instances:[]},cr.hasAnyOwnProperty(i.extra)&&(n.ex=V(i.extra)),t=0,e=i.instances.length;t<e;t++)n.instances.push(this.saveInstanceToJSON(i.instances[t]));c.types[i.sid.toString()]=n}for(m=0,u=this.layouts_by_index.length;m<u;m++)o=this.layouts_by_index[m],c.layouts[o.sid.toString()]=o.saveToJSON();var p=c.events.groups;for(m=0,u=this.allGroups.length;m<u;m++)p[(s=this.allGroups[m]).sid.toString()]=this.groups_by_name[s.group_name].group_active;var y=c.events.cnds;for(l in this.cndsBySid)this.cndsBySid.hasOwnProperty(l)&&(r=this.cndsBySid[l],cr.hasAnyOwnProperty(r.extra)&&(y[l]={ex:V(r.extra)}));var _=c.events.acts;for(l in this.actsBySid)this.actsBySid.hasOwnProperty(l)&&(a=this.actsBySid[l],cr.hasAnyOwnProperty(a.extra)&&(_[l]={ex:V(a.extra)}));var d=c.events.vars;for(l in this.varsBySid)this.varsBySid.hasOwnProperty(l)&&((h=this.varsBySid[l]).is_constant||h.parent&&!h.is_static||(d[l]=h.data));return c.system=this.system.saveToJSON(),JSON.stringify(c)},i.prototype.refreshUidMap=function(){var t,e,i,o,n,s;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(!(i=this.types_by_index[t]).is_family)for(o=0,n=i.instances.length;o<n;o++)s=i.instances[o],this.objectsByUid[s.uid.toString()]=s},i.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(1<e.version)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var o,n,s,r,a,h,l,c,m,u,p,y,_,d,f,x,g,b=i.running_layout;if(b!==this.running_layout.sid){b=this.getLayoutBySid(b);if(!b)return;this.doChangeLayout(b)}var v=e.types;for(l in v)if(v.hasOwnProperty(l)&&(c=this.getObjectTypeBySid(parseInt(l,10)))&&!c.is_family&&!this.typeHasNoSaveBehavior(c)){for(v[l].ex?c.extra=v[l].ex:cr.wipe(c.extra),m=c.instances,u=v[l].instances,o=0,n=cr.min(m.length,u.length);o<n;o++)this.loadInstanceFromJSON(m[o],u[o]);for(o=u.length,n=m.length;o<n;o++)this.DestroyInstance(m[o]);for(o=m.length,n=u.length;o<n;o++)d=null,c.plugin.is_world&&!(d=this.running_layout.getLayerBySid(u[o].w.l))||(p=this.createInstanceFromInit(c.default_instance,d,!1,0,0,!0),this.loadInstanceFromJSON(p,u[o]));c.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var B=e.layouts;for(l in B)B.hasOwnProperty(l)&&(_=this.getLayoutBySid(parseInt(l,10)))&&_.loadFromJSON(B[l]);var D=e.events.groups;for(l in D)D.hasOwnProperty(l)&&(f=this.getGroupBySid(parseInt(l,10)))&&this.groups_by_name[f.group_name]&&this.groups_by_name[f.group_name].setGroupActive(D[l]);var C=e.events.cnds;for(l in this.cndsBySid)this.cndsBySid.hasOwnProperty(l)&&(C.hasOwnProperty(l)?this.cndsBySid[l].extra=C[l].ex:this.cndsBySid[l].extra={});var w=e.events.acts;for(l in this.actsBySid)this.actsBySid.hasOwnProperty(l)&&(w.hasOwnProperty(l)?this.actsBySid[l].extra=w[l].ex:this.actsBySid[l].extra={});var S=e.events.vars;for(l in S)S.hasOwnProperty(l)&&this.varsBySid.hasOwnProperty(l)&&(this.varsBySid[l].data=S[l]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,o=0,n=this.fireOnCreateAfterLoad.length;o<n;++o)p=this.fireOnCreateAfterLoad[o],this.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),o=0,n=this.types_by_index.length;o<n;o++)if(!(c=this.types_by_index[o]).is_family&&!this.typeHasNoSaveBehavior(c))for(s=0,r=c.instances.length;s<r;s++){if(p=c.instances[s],c.is_contained)for(x=p.get_iid(),cr.clearArray(p.siblings),a=0,h=c.container.length;a<h;a++)c!==(g=c.container[a])&&p.siblings.push(g.instances[x]);if(p.afterLoad&&p.afterLoad(),p.behavior_insts)for(a=0,h=p.behavior_insts.length;a<h;a++)(y=p.behavior_insts[a]).afterLoad&&y.afterLoad()}return this.redraw=!0},i.prototype.saveInstanceToJSON=function(t,e){var i,o,n,s,r,a=t.type,h=a.plugin,l={};if(e?l.c2=!0:l.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(l.ex=V(t.extra)),t.instance_vars&&t.instance_vars.length)for(l.ivs={},i=0,o=t.instance_vars.length;i<o;i++)l.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(n={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(n.a=t.angle),1!==t.opacity&&(n.o=t.opacity),.5!==t.hotspotX&&(n.hX=t.hotspotX),.5!==t.hotspotY&&(n.hY=t.hotspotY),0!==t.blend_mode&&(n.bm=t.blend_mode),t.visible||(n.v=t.visible),t.collisionsEnabled||(n.ce=t.collisionsEnabled),-1!==t.my_timescale&&(n.mts=t.my_timescale),a.effect_types.length)for(n.fx=[],i=0,o=a.effect_types.length;i<o;i++)r=a.effect_types[i],n.fx.push({name:r.name,active:t.active_effect_flags[r.index],params:t.effect_params[r.index]});l.w=n}if(t.behavior_insts&&t.behavior_insts.length)for(l.behs={},i=0,o=t.behavior_insts.length;i<o;i++)(s=t.behavior_insts[i]).saveToJSON&&(l.behs[s.type.sid.toString()]=s.saveToJSON());return t.saveToJSON&&(l.data=t.saveToJSON()),l},i.prototype.getInstanceVarIndexBySid=function(t,e){for(var i=0,o=t.instvar_sids.length;i<o;i++)if(t.instvar_sids[i]===e)return i;return-1},i.prototype.getBehaviorIndexBySid=function(t,e){for(var i=0,o=t.behavior_insts.length;i<o;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},i.prototype.loadInstanceFromJSON=function(t,e,i){var o,n,s,r,a,h,l,c,m,u,p=t.type,y=p.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),a=e.ivs)for(o in a)a.hasOwnProperty(o)&&((r=this.getInstanceVarIndexBySid(p,parseInt(o,10)))<0||r>=t.instance_vars.length||(null===(u=a[o])&&(u=NaN),t.instance_vars[r]=u));if(y.is_world){if(h=e.w,t.layer.sid!==h.l&&(y=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(y.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=y,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(n=0,s=h.fx.length;n<s;n++)(l=p.getEffectIndexByName(h.fx[n].name))<0||(t.active_effect_flags[l]=h.fx[n].active,t.effect_params[l]=h.fx[n].params);t.updateActiveEffects()}if(c=e.behs)for(o in c)c.hasOwnProperty(o)&&((m=this.getBehaviorIndexBySid(t,parseInt(o,10)))<0||t.behavior_insts[m].loadFromJSON(c[o]));e.data&&t.loadFromJSON(e.data)},i.prototype.fetchLocalFileViaCordova=function(t,e,i){t=cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(t,function(t){t.file(e,i)},i)},i.prototype.fetchLocalFileViaCordovaAsText=function(t,i,o){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.onerror=o,e.readAsText(t)},o)};var R=[],E=0;i.prototype.maybeStartNextArrayBufferRead=function(){var t;R.length&&(8<=E||(E++,t=R.shift(),this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)))},i.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var o=this;R.push({filename:t,successCallback:function(t){E--,o.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){E--,o.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},i.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,i,e){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.readAsArrayBuffer(t)},e)},i.prototype.fetchLocalFileViaCordovaAsURL=function(t,e,i){var o="",n=t.toLowerCase(),s=n.substr(n.length-4),n=n.substr(n.length-5);".mp4"===s?o="video/mp4":".webm"===n?o="video/webm":".m4a"===s?o="audio/mp4":".mp3"===s&&(o="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){t=new Blob([t],{type:o}),t=URL.createObjectURL(t);e(t)},i)},i.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},i.prototype.setImageSrc=function(e,t){this.isWKWebView&&!this.isAbsoluteUrl(t)?this.fetchLocalFileViaCordovaAsURL(t,function(t){e.src=t},function(t){alert("Failed to load image: "+t)}):e.src=t},i.prototype.setCtxImageSmoothingEnabled=function(t,e){void 0!==t.imageSmoothingEnabled?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)},cr.runtime=i,cr.createRuntime=function(t){return new i(document.getElementById(t))},cr.createDCRuntime=function(t,e){return new i({dc:!0,width:t,height:e})},window.cr_createRuntime=cr.createRuntime,window.cr_createDCRuntime=cr.createDCRuntime,window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var t=document.createElement("screencanvas")||document.createElement("canvas");t.screencanvas=!0,document.body.appendChild(t);t=new i(t);return window.c2runtime=t,window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)}),window.c2runtime.setSize(window.innerWidth,window.innerHeight),t},window.createEjectaRuntime=function(){var t=new i(document.getElementById("canvas"));return window.c2runtime=t,window.c2runtime.setSize(window.innerWidth,window.innerHeight),t}}(),window.cr_getC2Runtime=function(){var t=document.getElementById("c2canvas");return t?t.c2runtime:window.c2runtime||null},window.cr_getSnapshot=function(t,e){var i=window.cr_getC2Runtime();i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){var i;0===t||0===e||(i=window.cr_getC2Runtime())&&i.setSize(t,e)},window.cr_setSuspended=function(t){var e=window.cr_getC2Runtime();e&&e.setSuspended(t)},function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,o,n=e[6];for(this.layers=[],this.initial_types=[],i=0,o=n.length;i<o;i++){var s=new cr.layer(this,n[i]);s.number=i,cr.seal(s),this.layers.push(s)}var r=e[7];for(this.initial_nonworld=[],i=0,o=r.length;i<o;i++){var a=r[i],h=this.runtime.types_by_index[a[1]];h.default_instance||(h.default_instance=a),this.initial_nonworld.push(a),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,o=e[8].length;i<o;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1),this.persist_data={}}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]),this.persist_data[e].push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){for(var e,i=0,o=this.effect_types.length;i<o;i++)if((e=this.effect_types[i]).name===t)return e;return null};var d=[];function f(t,e){return t.zindex-e.zindex}var x=!0;t.prototype.startRunning=function(){var t,e,i,o,n,s,r,a,h,l,c,m,u,p,y;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),(this.runtime.running_layout=this).width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,i=this.runtime.types_by_index.length;t<i;t++)if(!(n=this.runtime.types_by_index[t]).is_family)for(e=0,o=(s=n.instances).length;e<o;e++)(p=s[e]).layer&&((u=p.layer.number)>=this.layers.length&&(u=this.layers.length-1),p.layer=this.layers[u],-1===p.layer.instances.indexOf(p)&&p.layer.instances.push(p),p.layer.zindices_stale=!0);if(!x)for(t=0,i=this.layers.length;t<i;++t)this.layers[t].instances.sort(f);for(cr.clearArray(d),this.boundScrolling(),t=0,i=this.layers.length;t<i;t++)(y=this.layers[t]).createInitialInstances(),y.updateViewport(null);var _=!1;if(!this.first_visit){for(c in this.persist_data)if(this.persist_data.hasOwnProperty(c)&&(n=this.runtime.getObjectTypeBySid(parseInt(c,10)))&&!n.is_family&&this.runtime.typeHasPersistBehavior(n)){for(t=0,i=(m=this.persist_data[c]).length;t<i;t++)y=null,n.plugin.is_world&&!(y=this.getLayerBySid(m[t].w.l))||(p=this.runtime.createInstanceFromInit(n.default_instance,y,!1,0,0,!0),this.runtime.loadInstanceFromJSON(p,m[t]),_=!0,d.push(p));cr.clearArray(m)}for(t=0,i=this.layers.length;t<i;t++)this.layers[t].instances.sort(f),this.layers[t].zindices_stale=!0}for(_&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),t=0;t<d.length;t++)if((p=d[t]).type.is_contained)for(a=p.get_iid(),e=0,o=p.type.container.length;e<o;e++)h=p.type.container[e],p.type!==h&&(h.instances.length>a?p.siblings.push(h.instances[a]):h.default_instance&&(l=this.runtime.createInstanceFromInit(h.default_instance,p.layer,!0,p.x,p.y,!0),this.runtime.ClearDeathRow(),h.updateIIDs(),p.siblings.push(l),d.push(l)));for(t=0,i=this.initial_nonworld.length;t<i;t++)r=this.initial_nonworld[t],(n=this.runtime.types_by_index[r[1]]).is_contained||(p=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(t=0,i=this.runtime.types_by_index.length;t<i;t++)!(h=this.runtime.types_by_index[t]).is_family&&h.instances.length&&h.preloadCanvas2D&&h.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,d);else for(t=0,i=d.length;t<i;t++)p=d[t],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);cr.clearArray(d),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createGlobalNonWorlds=function(){for(var t,e,i=0,o=0,n=this.initial_nonworld.length;i<n;i++)t=this.initial_nonworld[i],(e=this.runtime.types_by_index[t[1]]).global?e.is_contained||this.runtime.createInstanceFromInit(t,null,!0):(this.initial_nonworld[o]=t,o++);cr.truncateArray(this.initial_nonworld,o)},t.prototype.stopRunning=function(){var t,e,i,o,n,s,r;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),i=0,o=(n=this.layers[t].instances).length;i<o;i++)(s=n[i]).type.global||this.runtime.typeHasPersistBehavior(s.type)&&this.saveObjectToPersist(s);for(t=0,e=this.layers.length;t<e;t++){for(i=0,o=(n=this.layers[t].instances).length;i<o;i++)(s=n[i]).type.global||this.runtime.DestroyInstance(s);this.runtime.ClearDeathRow(),cr.clearArray(n),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(!((r=this.runtime.types_by_index[t]).global||r.plugin.is_world||r.plugin.singleglobal||r.is_family)){for(i=0,o=r.instances.length;i<o;i++)this.runtime.DestroyInstance(r.instances[i]);this.runtime.ClearDeathRow()}x=!1,this.runtime.isEndingLayout=!1};var a=new cr.rect(0,0,0,0);function e(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=h(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,o,n=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,o=n.length;i<o;i++){var s=n[i],r=this.runtime.types_by_index[s[1]];r.default_instance||(r.default_instance=s,r.default_layerindex=this.index),this.initial_instances.push(s),-1===this.layout.initial_types.indexOf(r)&&this.layout.initial_types.push(r)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,o=e[15].length;i<o;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1)}t.prototype.recreateInitialObjects=function(t,e,i,o,n){var s,r;for(a.set(e,i,o,n),s=0,r=this.layers.length;s<r;s++)this.layers[s].recreateInitialObjects(t,a)},t.prototype.draw=function(t){var e,i,o,n,s=t,r=!1,a=!this.runtime.fullscreenScalingQuality;for(a&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),(e=this.runtime.layout_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),r=!0),e=this.runtime.layout_canvas,s=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,r=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,r=!0),r&&this.runtime.setCtxImageSmoothingEnabled(s,this.runtime.linearSampling)),s.globalAlpha=1,s.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&s.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,o=this.layers.length;i<o;i++)(n=this.layers[i]).visible&&0<n.opacity&&11!==n.blend_mode&&(n.instances.length||!n.transparent)?n.draw(s):n.updateViewport(null);a&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;0<=e;--e)(i=this.layers[e]).visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,o,n,s=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(s?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)(o=this.layers[e]).visible&&0<o.opacity&&(o.instances.length||!o.transparent)?o.drawGL(t):o.updateViewport(null);s&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(n=this.active_effect_types[0].index,t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[n]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):t.switchProgram(0),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView(),s=this.runtime.width/2,n=this.runtime.height/2,t.quad(-s,n,s,n,s,-n,-s,-n),t.setTexture(null),t.setDepthTestEnabled(!0)):this.renderEffectChain(t,null,null,null))},t.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){for(var t,e=this.layers[0].getScale(),i=1,o=this.layers.length;i<o;i++)0===(t=this.layers[i]).parallaxX&&0===t.parallaxY||t.getScale()<e&&(e=t.getScale());return e},t.prototype.scrollToX=function(t){var e;this.unbounded_scrolling||(e=this.runtime.draw_width*(1/this.getMinLayerScale())/2,t>this.width-e&&(t=this.width-e),t<e&&(t=e)),this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){var e;this.unbounded_scrolling||(e=this.runtime.draw_height*(1/this.getMinLayerScale())/2,t>this.height-e&&(t=this.height-e),t<e&&(t=e)),this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.renderEffectChain=function(t,e,i,o){var n=(i||e||this).active_effect_types,s=1,r=0,a=0,h=0,l=this.runtime.draw_width,c=this.runtime.draw_height;i?(s=i.layer.getScale(),r=i.layer.getAngle(),a=i.layer.viewLeft,h=i.layer.viewTop,l=i.layer.viewRight,c=i.layer.viewBottom):e&&(s=e.getScale(),r=e.getAngle(),a=e.viewLeft,h=e.viewTop,l=e.viewRight,c=e.viewBottom);var m,u,p=this.runtime.fx_tex,y=0,_=1,d=this.runtime.draw_width,f=this.runtime.draw_height,x=d/2,g=f/2,b=(e||this).rcTex,v=(e||this).rcTex2,B=0,D=0,C=0,w=0,S=d,A=d,M=f,T=f,I=0,P=0,L=i?i.layer.getAngle():0;if(i){for(z=0,W=n.length;z<W;z++)I+=t.getProgramBoxExtendHorizontal(n[z].shaderindex),P+=t.getProgramBoxExtendVertical(n[z].shaderindex);var V,R,E,G=i.bbox;B=e.layerToCanvas(G.left,G.top,!0,!0),C=e.layerToCanvas(G.left,G.top,!1,!0),S=e.layerToCanvas(G.right,G.bottom,!0,!0),M=e.layerToCanvas(G.right,G.bottom,!1,!0),0!==L&&(V=e.layerToCanvas(G.right,G.top,!0,!0),R=e.layerToCanvas(G.right,G.top,!1,!0),L=e.layerToCanvas(G.left,G.bottom,!0,!0),G=e.layerToCanvas(G.left,G.bottom,!1,!0),E=Math.min(B,S,V,L),S=Math.max(B,S,V,L),B=E,E=Math.min(C,M,R,G),M=Math.max(C,M,R,G),C=E),B-=I,C-=P,S+=I,M+=P,v.left=B/d,v.top=1-C/f,v.right=S/d,v.bottom=1-M/f,D=B=cr.floor(B),w=C=cr.floor(C),A=S=cr.ceil(S),T=M=cr.ceil(M),B<0&&(B=0),C<0&&(C=0),d<S&&(S=d),f<M&&(M=f),(D-=I)<0&&(D=0),(w-=P)<0&&(w=0),d<(A+=I)&&(A=d),f<(T+=P)&&(T=f),b.left=B/d,b.top=1-C/f,b.right=S/d,b.bottom=1-M/f}else b.left=v.left=0,b.top=v.top=0,b.right=v.right=1,b.bottom=v.bottom=1;var F=i&&(t.programUsesDest(n[0].shaderindex)||0!==I||0!==P||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),F&&(p[y]||(p[y]=t.createEmptyTexture(d,f,this.runtime.linearSampling)),p[y].c2width===d&&p[y].c2height===f||(t.deleteTexture(p[y]),p[y]=t.createEmptyTexture(d,f,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(p[y]),m=f-w-(u=T-w),t.clearRect(D,m,A-D,u),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-x,-g),t.updateModelView(),t.quadTex(B,M,S,M,S,C,B,C,b)),v.left=v.top=0,v.right=v.bottom=1,i&&(E=b.top,b.top=b.bottom,b.bottom=E),y=1,_=0),t.setOpacity(1);for(var k,O,N,J=n.length-1,j=t.programUsesCrossSampling(n[J].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,z=0,W=n.length;z<W;z++)p[y]||(p[y]=t.createEmptyTexture(d,f,this.runtime.linearSampling)),p[y].c2width===d&&p[y].c2height===f||(t.deleteTexture(p[y]),p[y]=t.createEmptyTexture(d,f,this.runtime.linearSampling)),t.switchProgram(n[z].shaderindex),k=n[z].index,t.programIsAnimated(n[z].shaderindex)&&(this.runtime.redraw=!0),0!=z||F?(t.setProgramParameters(o,1/d,1/f,v.left,v.top,v.right,v.bottom,s,r,a,h,(a+l)/2,(h+c)/2,this.runtime.kahanTime.sum,(i||e||this).effect_params[k]),t.setTexture(null),z!==J||j?(t.setRenderingToTexture(p[y]),m=f-w-(u=T-w),t.clearRect(D,m,A-D,u)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(o)),t.setTexture(p[_]),t.resetModelView(),t.translate(-x,-g),t.updateModelView(),t.quadTex(B,M,S,M,S,C,B,C,b),z!==J||j||t.setTexture(null)):(t.setRenderingToTexture(p[y]),m=f-w-(u=T-w),t.clearRect(D,m,A-D,u),i?(N=i.curFrame&&i.curFrame.texture_img?(O=1/(N=i.curFrame.texture_img).width,1/N.height):(O=1/i.width,1/i.height),t.setProgramParameters(o,O,N,v.left,v.top,v.right,v.bottom,s,r,a,h,(a+l)/2,(h+c)/2,this.runtime.kahanTime.sum,i.effect_params[k]),i.drawGL(t)):(t.setProgramParameters(o,1/d,1/f,0,0,1,1,s,r,a,h,(a+l)/2,(h+c)/2,this.runtime.kahanTime.sum,(e||this).effect_params[k]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-x,-g),t.updateModelView(),t.quadTex(B,M,S,M,S,C,B,C,b)),v.left=v.top=0,v.right=v.bottom=1,i&&!j&&(E=M,M=C,C=E)),_=0===(y=0===y?1:0)?1:0;j&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),x=this.runtime.width/2,g=this.runtime.height/2,C=B=0,S=this.runtime.width,M=this.runtime.height),t.setRenderingToTexture(o),t.setTexture(p[_]),t.resetModelView(),t.translate(-x,-g),t.updateModelView(),i&&1===n.length&&!F?t.quadTex(B,C,S,C,S,M,B,M,b):t.quadTex(B,M,S,M,S,C,B,C,b),t.setTexture(null))},t.prototype.getLayerBySid=function(t){for(var e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){for(var t,e,i={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}},o=0,n=this.effect_types.length;o<n;o++)e=this.effect_types[o],i.fx.push({name:e.name,active:e.active,params:this.effect_params[e.index]});for(o=0,n=this.layers.length;o<n;o++)t=this.layers[o],i.layers[t.sid.toString()]=t.saveToJSON();return i},t.prototype.loadFromJSON=function(t){var e,i,o;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);for(var n=t.fx,s=0,r=n.length;s<r;s++)(e=this.getEffectByName(n[s].name))&&(e.active=n[s].active,this.effect_params[e.index]=n[s].params);this.updateActiveEffects();var a=t.layers;for(i in a)a.hasOwnProperty(i)&&(o=this.getLayerBySid(parseInt(i,10)))&&o.loadFromJSON(a[i])},cr.layout=t,e.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},e.prototype.getEffectByName=function(t){for(var e,i=0,o=this.effect_types.length;i<o;i++)if((e=this.effect_types[i]).name===t)return e;return null},e.prototype.createInitialInstances=function(){for(var t,e,i,o=0,n=0,s=this.initial_instances.length;o<s;o++){if(t=this.initial_instances[o],e=this.runtime.types_by_index[t[1]],i=!0,!this.runtime.typeHasPersistBehavior(e)||this.layout.first_visit){if(!(t=this.runtime.createInstanceFromInit(t,this,!0)))continue;d.push(t),t.type.global&&(i=!1,this.created_globals.push(t.uid))}i&&(this.initial_instances[n]=this.initial_instances[o],n++)}this.initial_instances.length=n,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},e.prototype.recreateInitialObjects=function(t,e){for(var i,o,n,s,r,a,h,l=this.runtime.types_by_index,c=t.is_family,m=t.members,u=0,p=this.initial_instances.length;u<p;++u)if(o=(n=(i=this.initial_instances[u])[0])[0],n=n[1],e.contains_pt(o,n)){if((n=l[i[1]])!==t){if(!c)continue;if(m.indexOf(n)<0)continue}if(s=this.runtime.createInstanceFromInit(i,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(n.plugin).cnds.OnCreated,s),s.is_contained)for(r=0,a=s.siblings.length;r<a;r++)h=s.siblings[u],this.runtime.trigger(Object.getPrototypeOf(h.type.plugin).cnds.OnCreated,h);this.runtime.isInOnDestroy--}},e.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},e.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},e.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},e.prototype.moveInstanceAdjacent=function(t,e,i){var o=t.get_zindex(),e=e.get_zindex();cr.arrayRemove(this.instances,o),o<e&&e--,i&&e++,e===this.instances.length?this.instances.push(t):this.instances.splice(e,0,t),this.setZIndicesStaleFrom(o<e?o:e)},e.prototype.setZIndicesStaleFrom=function(t){(-1===this.zindices_stale_from||t<this.zindices_stale_from)&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},e.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)(i=this.instances[t]).zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},e.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},e.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},e.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var i=[];function h(){return i.length?i.pop():[]}function m(t){cr.clearArray(t),i.push(t)}var l=[];function o(t,e){for(var i,o,n,s=0,r=t.length;s<r-1;s+=2)(function(t,e,i){var o,n,s=0,r=0,a=0,h=t.length,l=e.length;for(i.length=h+l;s<h&&r<l;++a)o=t[s],n=e[r],o.zindex<n.zindex?(i[a]=o,++s):(i[a]=n,++r);for(;s<h;++s,++a)i[a]=t[s];for(;r<l;++r,++a)i[a]=e[r]})(i=t[s],o=t[s+1],n=h()),e||(m(i),m(o)),l.push(n);r%2==1&&(e?(i=h(),cr.shallowAssignArray(i,t[r-1]),l.push(i)):l.push(t[r-1])),cr.shallowAssignArray(t,l),cr.clearArray(l)}var n=[];e.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,n),!n.length)return h();if(1===n.length){var t=h();return cr.shallowAssignArray(t,n[0]),cr.clearArray(n),t}t=function(t){for(var e=!0;1<t.length;)o(t,e),e=!1;return t[0]}(n);return cr.clearArray(n),t},e.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,o=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),(e=this.runtime.layer_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),o=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,o=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,o=!0),o&&this.runtime.setCtxImageSmoothingEnabled(i,this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var n=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(n=Math.round(n),s=Math.round(s)),this.rotateViewport(n,s,i);var r,o=this.getScale();i.scale(o,o),i.translate(-n,-s),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(m(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances;for(var a,h=null,l=0,c=r.length;l<c;++l)(a=r[l])!==h&&(this.drawInstance(a,i),h=a);this.useRenderCells&&(this.last_render_list=r),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},e.prototype.drawInstance=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e)))},e.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},e.prototype.rotateViewport=function(t,e,i){var o=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/o),this.viewBottom=e+this.runtime.draw_height*(1/o),this.viewLeft>this.viewRight&&(n=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=n),this.viewTop>this.viewBottom&&(n=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=n);var n=this.getAngle();0!==n&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-n),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,n),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},e.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var o,i=this.getScale();t.resetModelView(),t.scale(i,i),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(m(this.last_render_list),o=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):o=this.last_render_list):o=this.instances;for(var n,s=null,r=o.length-1;0<=r;--r)(n=o[r])!==s&&(this.drawInstanceGL_earlyZPass(o[r],t),s=n);this.useRenderCells&&(this.last_render_list=o),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},e.prototype.drawGL=function(t){this.runtime.draw_width,this.runtime.draw_height;var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var o=this.canvasToLayer(0,0,!0,!0),n=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(o=Math.round(o),n=Math.round(n)),this.rotateViewport(o,n,null);var s,n=this.getScale();t.resetModelView(),t.scale(n,n),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(m(this.last_render_list),s=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):s=this.last_render_list):s=this.instances;for(var r,a=null,h=0,l=s.length;h<l;++h)(r=s[h])!==a&&(this.drawInstanceGL(s[h],t),a=r);this.useRenderCells&&(this.last_render_list=s),this.render_offscreen&&(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity?(1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,n,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView(),i=this.runtime.draw_width/2,e=this.runtime.draw_height/2,t.quad(-i,e,i,e,i,-e,-i,-e),t.setTexture(null)):this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget()))},e.prototype.drawInstanceGL=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e))))},e.prototype.drawInstanceGL_earlyZPass=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e))))},e.prototype.drawInstanceWithShadersGL=function(t,e){var i,o,n,s,r,a,h,l,c,m=t.active_effect_types[0].shaderindex,u=t.active_effect_types[0].index,p=this.getScale();1!==t.active_effect_types.length||e.programUsesCrossSampling(m)||e.programExtendsBox(m)||(t.angle||t.layer.getAngle())&&e.programUsesDest(m)||1!==t.opacity||t.type.plugin.must_predraw?(this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(p,p),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView()):(e.switchProgram(m),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(m)&&(this.runtime.redraw=!0),h=a=r=s=0,e.programUsesDest(m)&&(n=t.bbox,i=this.layerToCanvas(n.left,n.top,!0,!0),o=this.layerToCanvas(n.left,n.top,!1,!0),m=this.layerToCanvas(n.right,n.bottom,!0,!0),n=this.layerToCanvas(n.right,n.bottom,!1,!0),s=i/windowWidth,r=1-o/windowHeight,a=m/windowWidth,h=1-n/windowHeight),c=t.curFrame&&t.curFrame.texture_img?(l=1/(c=t.curFrame.texture_img).width,1/c.height):(l=1/t.width,1/t.height),e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),l,c,s,r,a,h,p,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,t.effect_params[u]),t.drawGL(e))},e.prototype.canvasToLayer=function(t,e,i,o){var n=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=n,e*=n);var s=this.runtime.parallax_x_origin,r=this.runtime.parallax_y_origin,a=(this.layout.scrollX-s)*this.parallaxX+s,h=(this.layout.scrollY-r)*this.parallaxY+r,n=a,s=h,r=1/this.getScale(!o);o?(n-=this.runtime.draw_width*r/2,s-=this.runtime.draw_height*r/2):(n-=this.runtime.width*r/2,s-=this.runtime.height*r/2),n+=t*r,s+=e*r;t=this.getAngle();return 0!==t&&(s-=h,t=(n-=a)*(e=Math.cos(t))-s*(r=Math.sin(t)),s=s*e+n*r,n=t,n+=a,s+=h),i?n:s},e.prototype.layerToCanvas=function(t,e,i,o){var n=this.runtime.parallax_x_origin,s=this.runtime.parallax_y_origin,r=(this.layout.scrollX-n)*this.parallaxX+n,a=(this.layout.scrollY-s)*this.parallaxY+s,h=r,l=a,c=this.getAngle();0!==c&&(e-=a,c=(t-=r)*(n=Math.cos(-c))-e*(s=Math.sin(-c)),e=e*n+t*s,t=c,t+=r,e+=a);a=1/this.getScale(!o);o?(h-=this.runtime.draw_width*a/2,l-=this.runtime.draw_height*a/2):(h-=this.runtime.width*a/2,l-=this.runtime.height*a/2),h=(t-h)/a,l=(e-l)/a;a=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!o&&(h/=a,l/=a),i?h:l},e.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var o=this.layerToCanvas(t,e,!0),t=this.layerToCanvas(t,e,!1);this.disableAngle=!0;e=this.canvasToLayer(o,t,!0),t=this.canvasToLayer(o,t,!0);return this.disableAngle=!1,i?e:t},e.prototype.saveToJSON=function(){for(var t,e={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]},i=0,o=this.effect_types.length;i<o;i++)t=this.effect_types[i],e.fx.push({name:t.name,active:t.active,params:this.effect_params[t.index]});return e},e.prototype.loadFromJSON=function(t){var e,i;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);for(var o=new cr.ObjectSet,n=0,s=this.created_globals.length;n<s;++n)o.add(this.created_globals[n]);for(e=n=0,s=this.initial_instances.length;n<s;++n)o.contains(this.initial_instances[n][2])||(this.initial_instances[e]=this.initial_instances[n],++e);cr.truncateArray(this.initial_instances,e);var r=t.fx;for(n=0,s=r.length;n<s;n++)(i=this.getEffectByName(r[n].name))&&(i.active=r[n].active,this.effect_params[i.index]=r[n].params);this.updateActiveEffects(),this.instances.sort(f),this.zindices_stale=!0},cr.layer=e}(),function(){var r=[];function a(t,e){return t.index-e.index}function n(t){var e,i,o,n,s;for(2===t.length?t[0].index>t[1].index&&(n=t[0],t[0]=t[1],t[1]=n):2<t.length&&t.sort(a),t.length>=r.length&&(r.length=t.length+1),r[t.length]||(r[t.length]=[]),e=0,i=(s=r[t.length]).length;e<i;e++)if(function(t,e){var i,o=t.length;switch(o){case 0:return 1;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<o;i++)if(t[i]!==e[i])return;return 1}}(t,o=s[e]))return o;return s.push(t),t}function t(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,o,n=e[1];for(this.events=[],i=0,o=n.length;i<o;i++)this.init_event(n[i],null,this.events)}function e(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function i(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,i[1]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var o=i[5];for(h=0,l=o.length;h<l;h++){var n=new cr.condition(this,o[h]);n.index=h,cr.seal(n),this.conditions.push(n),this.addSolModifier(n.type)}var s=i[6];for(h=0,l=s.length;h<l;h++){var r=new cr.action(this,s[h]);r.index=h,cr.seal(r),this.actions.push(r)}if(8===i.length)for(var a=i[7],h=0,l=a.length;h<l;h++)this.sheet.init_event(a[h],this,this.subevents);this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function o(t,e){var i,o,n;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,o=t.container.length;i<o;i++)t!==(n=t.container[i])&&-1===e.indexOf(n)&&e.push(n)}function s(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=0<e[3],this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){for(var i=e[9],o=0,n=i.length;o<n;o++){var s=new cr.parameter(this,i[o]);cr.seal(s),this.parameters.push(s)}this.results.length=i.length}}function h(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,6===e.length){for(var i=e[5],o=0,n=i.length;o<n;o++){var s=new cr.parameter(this,i[o]);cr.seal(s),this.parameters.push(s)}this.results.length=i.length}}t.prototype.toString=function(){return this.name},t.prototype.init_event=function(t,e,i){switch(t[0]){case 0:var o,n,s=new cr.eventblock(this,e,t);if(cr.seal(s),s.orblock)for(i.push(s),o=0,n=s.conditions.length;o<n;o++)s.conditions[o].trigger&&this.init_trigger(s,o);else s.is_trigger()?this.init_trigger(s,0):i.push(s);break;case 1:var r=new cr.eventvariable(this,e,t);cr.seal(r),i.push(r);break;case 2:r=new cr.eventinclude(this,e,t);cr.seal(r),i.push(r)}},t.prototype.postInit=function(){for(var t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},t.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},t.prototype.addDeepIncludes=function(t){for(var e,i,o=t.deep_includes,n=t.already_included_sheets,s=this.includes.valuesRef(),r=0,a=s.length;r<a;++r)i=(e=s[r]).include_sheet,!e.isActive()||t===i||-1<n.indexOf(i)||(n.push(i),i.addDeepIncludes(t),o.push(i))},t.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var o=this.events[e];o.run(),this.runtime.clearSol(o.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},t.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i=t.conditions[e],o=i.type?i.type.name:"system",n=i.fasttrigger,s=n?this.fasttriggers:this.triggers;s[o]||(s[o]=[]);var r=s[o],a=i.func;if(n){if(i.parameters.length){var h=i.parameters[0];if(1===h.type&&2===h.expression.type){var l,c,m,u=h.expression.value.toLowerCase();for(c=0,m=r.length;c<m;c++)if(r[c].method==a)return void((l=r[c].evs)[u]?l[u].push([t,e]):l[u]=[[t,e]]);(l={})[u]=[[t,e]],r.push({method:a,evs:l})}}}else{for(c=0,m=r.length;c<m;c++)if(r[c].method==a)return void r[c].evs.push([t,e]);h=a,cr.plugins_.Sprite&&h===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?r.unshift({method:a,evs:[[t,e]]}):r.push({method:a,evs:[[t,e]]})}},cr.eventsheet=t,e.prototype.hasObjects=function(){return(this.select_all?this.type:this).instances.length},e.prototype.getObjects=function(){return(this.select_all?this.type:this).instances},e.prototype.pick_one=function(t){var e;t&&(t.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1),-1!==(e=this.else_instances.indexOf(t))&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t))},cr.selection=e,window._c2hh_="ABA32F84FCC471E8897448AA84686728C4598B8A",i.prototype.postInit=function(t){var e,i,o=this.parent;if(this.group)for(this.toplevelgroup=!0;o;){if(!o.group){this.toplevelgroup=!1;break}o=o.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t,this.solModifiersIncludingParents=this.solModifiers.slice(0),o=this.parent;o;){for(e=0,i=o.solModifiers.length;e<i;e++)this.addParentSolModifier(o.solModifiers[e]);o=o.parent}for(this.solModifiers=n(this.solModifiers),this.solModifiersIncludingParents=n(this.solModifiersIncludingParents),e=0,i=this.conditions.length;e<i;e++)this.conditions[e].postInit();for(e=0,i=this.actions.length;e<i;e++)this.actions[e].postInit();for(e=0,i=this.subevents.length;e<i;e++)this.subevents[e].postInit(e<i-1&&this.subevents[e+1].is_else_block)},i.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();0<i&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},i.prototype.addSolModifier=function(t){o(t,this.solModifiers)},i.prototype.addParentSolModifier=function(t){o(t,this.solModifiersIncludingParents)},i.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},i.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},i.prototype.run=function(){var t,e,i=!1,o=this.runtime,n=this.runtime.getCurrentEventStack(),s=(n.current_event=this).conditions;if(this.is_else_block||(n.else_branch_ran=!1),this.orblock){for(0===s.length&&(i=!0),n.cndindex=0,t=s.length;n.cndindex<t;n.cndindex++)(e=s[n.cndindex]).trigger||e.run()&&(i=!0);(n.last_event_true=i)&&this.run_actions_and_subevents()}else{for(n.cndindex=0,t=s.length;n.cndindex<t;n.cndindex++)if(!s[n.cndindex].run())return n.last_event_true=!1,void(this.toplevelevent&&o.hasPendingInstances&&o.ClearDeathRow());n.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(n)},i.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},i.prototype.run_orblocktrigger=function(t){(this.runtime.getCurrentEventStack().current_event=this).conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},i.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},i.prototype.resume_actions_and_subevents=function(){for(var t=this.runtime.getCurrentEventStack(),e=this.actions.length;t.actindex<e;t.actindex++)if(this.actions[t.actindex].run())return;this.run_subevents()},i.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,o,n=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],(o=!this.toplevelgroup||!this.group&&t<n)&&this.runtime.pushCopySol(i.solModifiers),i.run(),o?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},i.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},i.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},i.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;0<=e;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=i,s.prototype.postInit=function(){for(var t,e=0,i=this.parameters.length;e<i;e++)(t=this.parameters[e]).postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},s.prototype.run_true=function(){return!0},s.prototype.run_system=function(){for(var t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},s.prototype.run_static=function(){for(var t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype||this.type,this.results);return this.type.applySolToContainer(),i},s.prototype.run_object=function(){var t,e,i,o,n,s,r,a,h,l=this.type,c=l.getCurrentSol(),m=this.block.orblock&&!this.trigger,u=0,p=l.is_contained,y=l.is_family,_=l.family_index,d=this.beh_index,f=-1<d,x=this.anyParamVariesPerInstance,g=this.parameters,b=this.results,v=this.inverted,B=this.func;if(x)for(t=0,i=g.length;t<i;++t)(o=g[t]).variesPerInstance||(b[t]=o.get(0));else for(t=0,i=g.length;t<i;++t)b[t]=g[t].get(0);if(c.select_all){for(cr.clearArray(c.instances),cr.clearArray(c.else_instances),S=0,A=(D=l.instances).length;S<A;++S){if(s=D[S],x)for(t=0,i=g.length;t<i;++t)(o=g[t]).variesPerInstance&&(b[t]=o.get(S));n=f?(u=0,y&&(u=s.type.family_beh_map[_]),B.apply(s.behavior_insts[d+u],b)):B.apply(s,b),cr.xor(n,v)?c.instances.push(s):m&&c.else_instances.push(s)}return l.finish&&l.finish(!0),c.select_all=!1,l.applySolToContainer(),c.hasObjects()}e=0;for(var D,C=m&&!this.block.isFirstConditionOfType(this),w=!1,S=0,A=(D=C?c.else_instances:c.instances).length;S<A;++S){if(s=D[S],x)for(t=0,i=g.length;t<i;++t)(o=g[t]).variesPerInstance&&(b[t]=o.get(S));if(n=f?(u=0,y&&(u=s.type.family_beh_map[_]),B.apply(s.behavior_insts[d+u],b)):B.apply(s,b),cr.xor(n,v))if(w=!0,C){if(c.instances.push(s),p)for(t=0,i=s.siblings.length;t<i;t++)(r=s.siblings[t]).type.getCurrentSol().instances.push(r)}else{if(D[e]=s,p)for(t=0,i=s.siblings.length;t<i;t++)(r=s.siblings[t]).type.getCurrentSol().instances[e]=r;e++}else if(C){if(D[e]=s,p)for(t=0,i=s.siblings.length;t<i;t++)(r=s.siblings[t]).type.getCurrentSol().else_instances[e]=r;e++}else if(m&&(c.else_instances.push(s),p))for(t=0,i=s.siblings.length;t<i;t++)(r=s.siblings[t]).type.getCurrentSol().else_instances.push(r)}if(cr.truncateArray(D,e),p)for(S=0,A=(h=l.container).length;S<A;S++)a=h[S].getCurrentSol(),C?cr.truncateArray(a.else_instances,e):cr.truncateArray(a.instances,e);var M=w;if(C&&!w)for(S=0,A=c.instances.length;S<A;S++){if(s=c.instances[S],x)for(t=0,i=g.length;t<i;t++)(o=g[t]).variesPerInstance&&(b[t]=o.get(S));if(n=f?B.apply(s.behavior_insts[d],b):B.apply(s,b),cr.xor(n,v)){w=!0;break}}return l.finish&&l.finish(M||m),m?w:c.hasObjects()},cr.condition=s,h.prototype.postInit=function(){for(var t,e=0,i=this.parameters.length;e<i;e++)(t=this.parameters[e]).postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},h.prototype.run_system=function(){for(var t=this.runtime,e=this.parameters,i=this.results,o=0,n=e.length;o<n;++o)i[o]=e[o].get();return this.func.apply(t.system,i)},h.prototype.run_object=function(){var t,e,i,o,n,s,r,a=this.type,h=this.beh_index,l=a.family_index,c=this.anyParamVariesPerInstance,m=this.parameters,u=this.results,p=this.func,y=a.getCurrentSol().getObjects(),_=a.is_family,d=-1<h;if(c)for(e=0,o=m.length;e<o;++e)(n=m[e]).variesPerInstance||(u[e]=n.get(0));else for(e=0,o=m.length;e<o;++e)u[e]=m[e].get(0);for(t=0,i=y.length;t<i;++t){if(s=y[t],c)for(e=0,o=m.length;e<o;++e)(n=m[e]).variesPerInstance&&(u[e]=n.get(t));d?(r=0,_&&(r=s.type.family_beh_map[l]),p.apply(s.behavior_insts[h+r],u)):p.apply(s,u)}return!1},cr.action=h;var l=[],c=-1;function m(){return c++,l.length===c&&l.push(new cr.expvalue),l[c]}function u(){c--}function p(t,e){var i,o,n;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,e[0]){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,o=e.length;i<o;i++)n=new cr.parameter(this.owner,e[i]),cr.seal(n),this.subparams.push(n),this.variadicret.push(0)}}function y(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],(this.runtime.varsBySid[this.sid.toString()]=this).data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function _(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function d(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}p.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},p.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},p.prototype.setVaries=function(){this.variesPerInstance=!0},p.prototype.get_exp=function(t){this.solindex=t||0;t=m();return this.expression.get(t),u(),t.data},p.prototype.get_exp_str=function(t){this.solindex=t||0;t=m();return this.expression.get(t),u(),cr.is_string(t.data)?t.data:""},p.prototype.get_object=function(){return this.object},p.prototype.get_combosel=function(){return this.combosel},p.prototype.get_layer=function(t){this.solindex=t||0;t=m();return this.expression.get(t),u(),t.is_number()?this.runtime.getLayerByNumber(t.data):this.runtime.getLayerByName(t.data)},p.prototype.get_layout=function(){return this.layout},p.prototype.get_key=function(){return this.key},p.prototype.get_instvar=function(){return this.index},p.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,o=null,n=i.getCurrentSol(),t=n.getObjects();if(t.length)o=t[e%t.length].type;else if(n.else_instances.length)o=n.else_instances[e%n.else_instances.length].type;else{if(!i.instances.length)return 0;o=i.instances[e%i.instances.length].type}return this.index+o.family_var_map[i.family_index]},p.prototype.get_eventvar=function(){return this.eventvar},p.prototype.get_audiofile=function(){return this.fileinfo},p.prototype.get_variadic=function(){for(var t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=p,y.prototype.postInit=function(){this.solModifiers=n(this.solModifiers)},y.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},y.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length||void 0===t[this.localIndex]?this.initial:t[this.localIndex]},y.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=y,_.prototype.toString=function(){return"include:"+this.include_sheet.toString()},_.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=n(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},_.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},_.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},_.prototype.isActive=function(){return this.active},cr.eventinclude=_,d.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},d.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=d}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(i=e[2],this.results.length=i.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(i=e[5],this.results.length=i.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(i=e[6],this.results.length=i.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),4<=this.type&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),i)for(var o=0,n=i.length;o<n;o++)this.parameters.push(new cr.expNode(t,i[o]));cr.seal(this)}t.prototype.postInit=function(){if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(var t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var e=[],i=-1;function c(){return++i,e.length===i&&e.push(new cr.expvalue),e[i]}function m(){--i}function u(t,e,i){for(var o=0,n=t.length;o<n;++o)t[o].get(i),e[o+1]=i.data}function o(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.eval_system_exp=function(t){var e=this.parameters,i=this.results;i[0]=t,u(e,i,c()),m(),this.func.apply(this.runtime.system,i)},t.prototype.eval_object_exp=function(t){var e=this.object_type,i=this.results,o=this.parameters,n=this.instance_expr,s=this.func,r=this.owner.solindex,a=e.getCurrentSol(),h=a.getObjects();if(!h.length){if(!a.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));h=a.else_instances}(i[0]=t).object_class=e;t=c();u(o,i,t),n&&(n.get(t),t.is_number()&&(r=t.data,h=e.instances)),m();e=h.length;(e<=r||r<=-e)&&(r%=e),r<0&&(r+=e);s.apply(h[r],i)},t.prototype.eval_behavior_exp=function(t){var e=this.object_type,i=this.results,o=this.parameters,n=this.instance_expr,s=this.beh_index,r=this.func,a=this.owner.solindex,h=e.getCurrentSol(),l=h.getObjects();if(!l.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));l=h.else_instances}(i[0]=t).object_class=e;t=c();u(o,i,t),n&&(n.get(t),t.is_number()&&(a=t.data,l=e.instances)),m();t=l.length;(t<=a||a<=-t)&&(a%=t),a<0&&(a+=t);l=l[a],a=0;e.is_family&&(a=l.type.family_beh_map[e.family_index]);r.apply(l.behavior_insts[s+a],i)},t.prototype.eval_instvar_exp=function(t){var e,i=this.instance_expr,o=this.object_type,n=this.varindex,s=this.owner.solindex,r=o.getCurrentSol(),a=r.getObjects();if(!a.length){if(!r.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));a=r.else_instances}if(i){r=c();if(i.get(r),r.is_number()){s=r.data;var h=o.instances;0!==h.length&&(s%=h.length)<0&&(s+=h.length);var l=(e=o.getInstanceByIID(s)).instance_vars[n];return cr.is_string(l)?t.set_string(l):t.set_float(l),void m()}m()}h=a.length;(h<=s||s<=-h)&&(s%=h),s<0&&(s+=h),e=a[s];s=0;o.is_family&&(s=e.type.family_var_map[o.family_index]);l=e.instance_vars[n+s];cr.is_string(l)?t.set_string(l):t.set_float(l)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var e=c();this.second.get(e),t.is_number()&&e.is_number()&&(t.data+=e.data,e.is_float()&&t.make_float()),m()},t.prototype.eval_subtract=function(t){this.first.get(t);var e=c();this.second.get(e),t.is_number()&&e.is_number()&&(t.data-=e.data,e.is_float()&&t.make_float()),m()},t.prototype.eval_multiply=function(t){this.first.get(t);var e=c();this.second.get(e),t.is_number()&&e.is_number()&&(t.data*=e.data,e.is_float()&&t.make_float()),m()},t.prototype.eval_divide=function(t){this.first.get(t);var e=c();this.second.get(e),t.is_number()&&e.is_number()&&(t.data/=e.data,t.make_float()),m()},t.prototype.eval_mod=function(t){this.first.get(t);var e=c();this.second.get(e),t.is_number()&&e.is_number()&&(t.data%=e.data,e.is_float()&&t.make_float()),m()},t.prototype.eval_power=function(t){this.first.get(t);var e=c();this.second.get(e),t.is_number()&&e.is_number()&&(t.data=Math.pow(t.data,e.data),e.is_float()&&t.make_float()),m()},t.prototype.eval_and=function(t){this.first.get(t);var e=c();this.second.get(e),e.is_string()||t.is_string()?this.eval_and_stringconcat(t,e):this.eval_and_logical(t,e),m()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var e=c();this.second.get(e),t.is_number()&&e.is_number()&&(t.data||e.data?t.set_int(1):t.set_int(0)),m()},t.prototype.eval_conditional=function(t){this.first.get(t),(t.data?this.second:this.third).get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var e=c();this.second.get(e),t.set_int(t.data===e.data?1:0),m()},t.prototype.eval_notequal=function(t){this.first.get(t);var e=c();this.second.get(e),t.set_int(t.data!==e.data?1:0),m()},t.prototype.eval_less=function(t){this.first.get(t);var e=c();this.second.get(e),t.set_int(t.data<e.data?1:0),m()},t.prototype.eval_lessequal=function(t){this.first.get(t);var e=c();this.second.get(e),t.set_int(t.data<=e.data?1:0),m()},t.prototype.eval_greater=function(t){this.first.get(t);var e=c();this.second.get(e),t.set_int(t.data>e.data?1:0),m()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var e=c();this.second.get(e),t.set_int(t.data>=e.data?1:0),m()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();cr.is_number(e)?t.set_float(e):t.set_string(e)},cr.expNode=t,o.prototype.is_int=function(){return this.type===cr.exptype.Integer},o.prototype.is_float=function(){return this.type===cr.exptype.Float},o.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},o.prototype.is_string=function(){return this.type===cr.exptype.String},o.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},o.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},o.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},o.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},o.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},o.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},o.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=o,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){for(var t,e,i,o,n,s,r,a={waits:[]},h=a.waits,l=0,c=this.waits.length;l<c;l++){for(r={t:(o=this.waits[l]).time,st:o.signaltag,s:o.signalled,ev:o.ev.sid,sm:[],sols:{}},o.ev.actions[o.actindex]&&(r.act=o.ev.actions[o.actindex].sid),t=0,e=o.solModifiers.length;t<e;t++)r.sm.push(o.solModifiers[t].sid);for(i in o.sols)if(o.sols.hasOwnProperty(i)){for(n=this.runtime.types_by_index[parseInt(i,10)],s={sa:o.sols[i].sa,insts:[]},t=0,e=o.sols[i].insts.length;t<e;t++)s.insts.push(o.sols[i].insts[t].uid);r.sols[n.sid.toString()]=s}h.push(r)}return a},cr.system_object.prototype.loadFromJSON=function(t){var e,i,o,n,s,r,a,h,l,c,m,u,p,y=t.waits;for(cr.clearArray(this.waits),e=0,i=y.length;e<i;e++)if(r=y[e],h=this.runtime.blocksBySid[r.ev.toString()]){for(l=-1,o=0,n=h.actions.length;o<n;o++)if(h.actions[o].sid===r.act){l=o;break}if(-1!==l){for((a={sols:{},solModifiers:[],deleteme:!1}).time=r.t,a.signaltag=r.st||"",a.signalled=!!r.s,a.ev=h,a.actindex=l,o=0,n=r.sm.length;o<n;o++)(c=this.runtime.getObjectTypeBySid(r.sm[o]))&&a.solModifiers.push(c);for(s in r.sols)if(r.sols.hasOwnProperty(s)&&(c=this.runtime.getObjectTypeBySid(parseInt(s,10)))){for(u={sa:(m=r.sols[s]).sa,insts:[]},o=0,n=m.insts.length;o<n;o++)(p=this.runtime.getObjectByUID(m.insts[o]))&&u.insts.push(p);a.sols[c.index.toString()]=u}this.waits.push(a)}}},function(){var t=cr.system_object.prototype;function e(){}e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},e.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0!==t)return cr.do_cmp(i,t,e);t=this.runtime.getCurrentCondition();return!t.extra.CompareTime_executed&&e<=i&&(t.extra.CompareTime_executed=!0)},e.prototype.LayerVisible=function(t){return!!t&&t.visible},e.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},e.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},e.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),o=i.current_event,i=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(i)for(e=0;e<t&&!n.stopped;e++)this.runtime.pushCopySol(o.solModifiers),n.index=e,o.retrigger(),this.runtime.popSol(o.solModifiers);else for(e=0;e<t&&!n.stopped;e++)n.index=e,o.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),o=i.current_event,i=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(i)for(e=0;!n.stopped;e++)this.runtime.pushCopySol(o.solModifiers),n.index=e,o.retrigger()||(n.stopped=!0),this.runtime.popSol(o.solModifiers);else for(e=0;!n.stopped;e++)n.index=e,o.retrigger()||(n.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(t,e,i){var o,n=this.runtime.getCurrentEventStack(),s=n.current_event,n=n.isModifierAfterCnds(),r=this.runtime.pushLoopStack(t);if(i<e)if(n)for(o=e;i<=o&&!r.stopped;--o)this.runtime.pushCopySol(s.solModifiers),r.index=o,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(o=e;i<=o&&!r.stopped;--o)r.index=o,s.retrigger();else if(n)for(o=e;o<=i&&!r.stopped;++o)this.runtime.pushCopySol(s.solModifiers),r.index=o,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(o=e;o<=i&&!r.stopped;++o)r.index=o,s.retrigger();return this.runtime.popLoopStack(),!1};var f=[],x=-1;function g(t,e){t=t.extra.c2_feo_val,e=e.extra.c2_feo_val;return cr.is_number(t)&&cr.is_number(e)?t-e:(t=""+t)<(e=""+e)?-1:e<t?1:0}e.prototype.ForEach=function(t){var e=t.getCurrentSol();x++,f.length===x&&f.push([]);var i=f[x];cr.shallowAssignArray(i,e.getObjects());var o,n,s,r,a,h,l,c=this.runtime.getCurrentEventStack(),m=c.current_event,c=c.isModifierAfterCnds(),u=this.runtime.pushLoopStack(),p=t.is_contained;if(c)for(o=0,n=i.length;o<n&&!u.stopped;o++){if(this.runtime.pushCopySol(m.solModifiers),a=i[o],(e=t.getCurrentSol()).select_all=!1,cr.clearArray(e.instances),e.instances[0]=a,p)for(s=0,r=a.siblings.length;s<r;s++)(l=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(l.instances),l.instances[0]=h;u.index=o,m.retrigger(),this.runtime.popSol(m.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),o=0,n=i.length;o<n&&!u.stopped;o++){if(a=i[o],e.instances[0]=a,p)for(s=0,r=a.siblings.length;s<r;s++)(l=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(l.instances),l.instances[0]=h;u.index=o,m.retrigger()}return cr.clearArray(i),this.runtime.popLoopStack(),x--,!1},e.prototype.ForEachOrdered=function(t,e,i){var o=t.getCurrentSol();x++,f.length===x&&f.push([]);var n=f[x];cr.shallowAssignArray(n,o.getObjects());for(var s,r,a,h,l,c=this.runtime.getCurrentEventStack(),m=c.current_event,u=this.runtime.getCurrentCondition(),c=c.isModifierAfterCnds(),p=this.runtime.pushLoopStack(),y=0,_=n.length;y<_;y++)n[y].extra.c2_feo_val=u.parameters[1].get(y);n.sort(g),1===i&&n.reverse();var d=t.is_contained;if(c)for(y=0,_=n.length;y<_&&!p.stopped;y++){if(this.runtime.pushCopySol(m.solModifiers),a=n[y],(o=t.getCurrentSol()).select_all=!1,cr.clearArray(o.instances),o.instances[0]=a,d)for(s=0,r=a.siblings.length;s<r;s++)(l=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(l.instances),l.instances[0]=h;p.index=y,m.retrigger(),this.runtime.popSol(m.solModifiers)}else for(o.select_all=!1,cr.clearArray(o.instances),y=0,_=n.length;y<_&&!p.stopped;y++){if(a=n[y],o.instances[0]=a,d)for(s=0,r=a.siblings.length;s<r;s++)(l=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(l.instances),l.instances[0]=h;p.index=y,m.retrigger()}return cr.clearArray(n),this.runtime.popLoopStack(),x--,!1},e.prototype.PickByComparison=function(t,e,i,o){var n;if(t){x++,f.length===x&&f.push([]);var s=f[x],r=t.getCurrentSol();cr.shallowAssignArray(s,r.getObjects()),r.select_all&&cr.clearArray(r.else_instances);for(var a=this.runtime.getCurrentCondition(),h=0,l=0,c=s.length;h<c;h++)n=s[h],s[l]=n,e=a.parameters[1].get(h),o=a.parameters[3].get(h),cr.do_cmp(e,i,o)?l++:r.else_instances.push(n);return cr.truncateArray(s,l),r.select_all=!1,cr.shallowAssignArray(r.instances,s),cr.clearArray(s),x--,t.applySolToContainer(),!!r.instances.length}},e.prototype.PickByEvaluate=function(t,e){var i;if(t){x++,f.length===x&&f.push([]);var o=f[x],n=t.getCurrentSol();cr.shallowAssignArray(o,n.getObjects()),n.select_all&&cr.clearArray(n.else_instances);for(var s=this.runtime.getCurrentCondition(),r=0,a=0,h=o.length;r<h;r++)i=o[r],o[a]=i,s.parameters[1].get(r)?a++:n.else_instances.push(i);return cr.truncateArray(o,a),n.select_all=!1,cr.shallowAssignArray(n.instances,o),cr.clearArray(o),x--,t.applySolToContainer(),!!n.instances.length}},e.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},e.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,o=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var n=e.extra.Every_seconds;return i+n<=o?(e.extra.Every_lastTime=i+n,o>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=o),e.extra.Every_seconds=t,!0):(o<i-.1&&(e.extra.Every_lastTime=o),!1)},e.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),o=i.getObjects();if((e=cr.floor(e))<0||e>=o.length)return!1;e=o[e];return i.pick_one(e),t.applySolToContainer(),!0},e.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),o=cr.floor(Math.random()*i.length);if(o>=i.length)return!1;o=i[o];return e.pick_one(o),t.applySolToContainer(),!0},e.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},e.prototype.IsGroupActive=function(t){t=this.runtime.groups_by_name[t.toLowerCase()];return t&&t.group_active},e.prototype.IsPreview=function(){return"undefined"!=typeof cr_is_preview},e.prototype.PickAll=function(t){return!!t&&(!!t.instances.length&&(t.getCurrentSol().select_all=!0,t.applySolToContainer(),!0))},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(t,e,i){return e<=t&&t<=i},e.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},e.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isDomFree||e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:return e.isCocoonJs;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10;default:return!1}};var i=null,o="",n="";function s(t,e){return i&&t===o&&e===n||(i=new RegExp(t,e),o=t,n=e),i.lastIndex=0,i}e.prototype.RegexTest=function(t,e,i){return s(e,i).test(t)};var c=[];function r(){}e.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var o,n,s,r=t.getCurrentSol(),a=r.getObjects(),h=this.runtime.getCurrentEventStack().current_event.orblock,l=this.runtime.getCurrentCondition();for(r.select_all?(cr.shallowAssignArray(c,a),cr.clearArray(r.else_instances),r.select_all=!1,cr.clearArray(r.instances)):h?(cr.shallowAssignArray(c,r.else_instances),cr.clearArray(r.else_instances)):(cr.shallowAssignArray(c,a),cr.clearArray(r.instances)),o=0,n=c.length;o<n;++o)(s=c[o]).update_bbox(),(cr.xor(s.contains_pt(e,i),l.inverted)?r.instances:r.else_instances).push(s);return t.applySolToContainer(),cr.xor(!!r.instances.length,l.inverted)},e.prototype.IsNaN=function(t){return!!isNaN(t)},e.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},e.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},e.prototype.IsBetweenAngles=function(t,e,i){t=cr.to_clamped_radians(t),e=cr.to_clamped_radians(e),i=cr.to_clamped_radians(i);return!cr.angleClockwise(i,e)?!(!cr.angleClockwise(t,e)&&cr.angleClockwise(t,i)):cr.angleClockwise(t,e)&&!cr.angleClockwise(t,i)},e.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},t.cnds=new e,r.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},r.prototype.NextPrevLayout=function(t){var e;this.runtime.isloading||this.runtime.changelayout||(e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout),t&&0===e||!t&&e===this.runtime.layouts_by_index.length-1||(t=this.runtime.layouts_by_index[e+(t?-1:1)],this.runtime.changelayout=t))},r.prototype.CreateObject=function(t,e,i,o){if(e&&t){var n,s,r,a=this.runtime.createInstance(t,e,i,o);if(a){if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,a),a.is_contained)for(n=0,s=a.siblings.length;n<s;n++)r=a.siblings[n],this.runtime.trigger(Object.getPrototypeOf(r.type.plugin).cnds.OnCreated,r);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),(h.instances[0]=a).is_contained)for(n=0,s=a.siblings.length;n<s;n++)(h=(r=a.siblings[n]).type.getCurrentSol()).select_all=!1,cr.clearArray(h.instances),h.instances[0]=r}}},r.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},r.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},r.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},r.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},r.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},r.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},r.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},r.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},r.prototype.ScrollToObject=function(t){t=t.getFirstPicked();t&&(this.runtime.running_layout.scrollToX(t.x),this.runtime.running_layout.scrollToY(t.y))},r.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},r.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},r.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},r.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},r.prototype.SetTimescale=function(t){t<0&&(t=0),this.runtime.timescale=t},r.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t)for(var o=t.getCurrentSol().getObjects(),n=0,s=o.length;n<s;n++)o[n].my_timescale=i},r.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;for(var e=t.getCurrentSol().getObjects(),i=0,o=e.length;i<o;i++)e[i].my_timescale=-1};var l=[];function a(){var t=l.length?l.pop():{sols:{},solModifiers:[]};return t.deleteme=!1,t}var m=[];function h(){var t=m.length?m.pop():{insts:[]};return t.sa=!1,t}function y(t,e){var i=t[0]-e[0];return 0!=i?i:t[1]-e[1]}function _(t,e){return t[1]-e[1]}function u(){}r.prototype.Wait=function(t){if(!(t<0)){var e,i,o,n,s=this.runtime.getCurrentEventStack(),r=a();for(r.time=this.runtime.kahanTime.sum+t,r.signaltag="",r.signalled=!1,r.ev=s.current_event,r.actindex=s.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(o=(n=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===s.current_event.solModifiers.indexOf(n)||(r.solModifiers.push(n),(n=h()).sa=o.select_all,cr.shallowAssignArray(n.insts,o.instances),r.sols[e.toString()]=n);return this.waits.push(r),!0}},r.prototype.WaitForSignal=function(t){var e,i,o,n,s=this.runtime.getCurrentEventStack(),r=a();for(r.time=-1,r.signaltag=t.toLowerCase(),r.signalled=!1,r.ev=s.current_event,r.actindex=s.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(o=(n=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===s.current_event.solModifiers.indexOf(n)||(r.solModifiers.push(n),(n=h()).sa=o.select_all,cr.shallowAssignArray(n.insts,o.instances),r.sols[e.toString()]=n);return this.waits.push(r),!0},r.prototype.Signal=function(t){for(var e,i=t.toLowerCase(),o=0,n=this.waits.length;o<n;++o)-1===(e=this.waits[o]).time&&e.signaltag===i&&(e.signalled=!0)},r.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},r.prototype.ResetGlobals=function(){for(var t,e=0,i=this.runtime.all_global_vars.length;e<i;e++)(t=this.runtime.all_global_vars[e]).data=t.initial},r.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},r.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},r.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY)for(var o=t.instances,n=0,s=o.length;n<s;++n)o[n].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}},r.prototype.SetLayerBackground=function(t,e){var i,o;t&&(i=cr.GetRValue(e),o=cr.GetGValue(e),e=cr.GetBValue(e),t.background_color[0]===i&&t.background_color[1]===o&&t.background_color[2]===e||(t.background_color[0]=i,t.background_color[1]=o,t.background_color[2]=e,this.runtime.redraw=!0))},r.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},r.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},r.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},r.prototype.GoToLayoutByName=function(t){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},r.prototype.RestartLayout=function(t){var e,i,o;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)(o=this.runtime.allGroups[e]).setGroupActive(o.initially_activated)},r.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},r.prototype.SetCanvasSize=function(t,e){var i;t<=0||e<=0||(i=this.runtime.fullscreen_mode,(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen)&&0<this.runtime.fullscreen_scaling&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)))},r.prototype.SetLayoutEffectEnabled=function(t,e){this.runtime.running_layout&&this.runtime.glwrap&&((e=this.runtime.running_layout.getEffectByName(e))&&(t=1===t,e.active!=t&&(e.active=t,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)))},r.prototype.SetLayerEffectEnabled=function(t,e,i){t&&this.runtime.glwrap&&((i=t.getEffectByName(i))&&(e=1===e,i.active!=e&&(i.active=e,t.updateActiveEffects(),this.runtime.redraw=!0)))},r.prototype.SetLayoutEffectParam=function(t,e,i){var o;this.runtime.running_layout&&this.runtime.glwrap&&((o=this.runtime.running_layout.getEffectByName(t))&&(t=this.runtime.running_layout.effect_params[o.index],(e=Math.floor(e))<0||e>=t.length||(1===this.runtime.glwrap.getProgramParameterType(o.shaderindex,e)&&(i/=100),t[e]!==i&&(t[e]=i,o.active&&(this.runtime.redraw=!0)))))},r.prototype.SetLayerEffectParam=function(t,e,i,o){t&&this.runtime.glwrap&&((e=t.getEffectByName(e))&&(t=t.effect_params[e.index],(i=Math.floor(i))<0||i>=t.length||(1===this.runtime.glwrap.getProgramParameterType(e.shaderindex,i)&&(o/=100),t[i]!==o&&(t[i]=o,e.active&&(this.runtime.redraw=!0)))))},r.prototype.SaveState=function(t){this.runtime.saveToSlot=t},r.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},r.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},r.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},r.prototype.SetFullscreenQuality=function(t){(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},r.prototype.ResetPersisted=function(){for(var t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},r.prototype.RecreateInitialObjects=function(t,e,i,o,n){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,o,n)},r.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},r.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),120<t&&(t=120),this.runtime.minimumFramerate=t},r.prototype.SortZOrderByInstVar=function(t,e){if(t){for(var i,o,n,s,r=t.getCurrentSol().getObjects(),a=[],h=[],l=this.runtime.running_layout,c=t.is_family,m=t.family_index,u=0,p=r.length;u<p;++u)(i=r[u]).layer&&(o=c?i.instance_vars[e+i.type.family_var_map[m]]:i.instance_vars[e],a.push([i.layer.index,i.get_zindex()]),h.push([i,o]));if(a.length)for(a.sort(y),h.sort(_),u=0,p=a.length;u<p;++u)i=h[u][0],n=l.layers[a[u][0]],s=a[u][1],n.instances[s]!==i&&((n.instances[s]=i).layer=n).setZIndicesStaleFrom(s)}},t.acts=new r,u.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},u.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},u.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},u.prototype.len=function(t,e){t.set_int(e.length||0)},u.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},u.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},u.prototype.abs=function(t,e){t.set_float(Math.abs(e))},u.prototype.round=function(t,e){t.set_int(Math.round(e))},u.prototype.floor=function(t,e){t.set_int(Math.floor(e))},u.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},u.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},u.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},u.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},u.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},u.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},u.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},u.prototype.exp=function(t,e){t.set_float(Math.exp(e))},u.prototype.ln=function(t,e){t.set_float(Math.log(e))},u.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},u.prototype.max=function(t){var e,i,o,n=arguments[1];for("number"!=typeof n&&(n=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(o=arguments[e])&&n<o&&(n=o);t.set_float(n)},u.prototype.min=function(t){var e,i,o,n=arguments[1];for("number"!=typeof n&&(n=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(o=arguments[e])&&o<n&&(n=o);t.set_float(n)},u.prototype.dt=function(t){t.set_float(this.runtime.dt)},u.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},u.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},u.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},u.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},u.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},u.prototype.fps=function(t){t.set_int(this.runtime.fps)},u.prototype.loopindex=function(t,e){var i,o;if(this.runtime.loop_stack.length)if(e){for(o=this.runtime.loop_stack_index;0<=o;--o)if((i=this.runtime.loop_stack[o]).name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},u.prototype.distance=function(t,e,i,o,n){t.set_float(cr.distanceTo(e,i,o,n))},u.prototype.angle=function(t,e,i,o,n){t.set_float(cr.to_degrees(cr.angleTo(e,i,o,n)))},u.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},u.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},u.prototype.newline=function(t){t.set_string("\n")},u.prototype.lerp=function(t,e,i,o){t.set_float(cr.lerp(e,i,o))},u.prototype.qarp=function(t,e,i,o,n){t.set_float(cr.qarp(e,i,o,n))},u.prototype.cubic=function(t,e,i,o,n,s){t.set_float(cr.cubic(e,i,o,n,s))},u.prototype.cosp=function(t,e,i,o){t.set_float(cr.cosp(e,i,o))},u.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},u.prototype.windowheight=function(t){t.set_int(this.runtime.height)},u.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},u.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},u.prototype.clamp=function(t,e,i,o){e<i?t.set_float(i):o<e?t.set_float(o):t.set_float(e)},u.prototype.layerscale=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(e.scale):t.set_float(0)},u.prototype.layeropacity=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(100*e.opacity):t.set_float(0)},u.prototype.layerscalerate=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(e.zoomRate):t.set_float(0)},u.prototype.layerparallaxx=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(100*e.parallaxX):t.set_float(0)},u.prototype.layerparallaxy=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(100*e.parallaxY):t.set_float(0)},u.prototype.layerindex=function(t,e){e=this.runtime.getLayer(e);e?t.set_int(e.index):t.set_int(-1)},u.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},u.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},u.prototype.layerangle=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(cr.to_degrees(e.angle)):t.set_float(0)},u.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},u.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},u.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},u.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},u.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},u.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},u.prototype.mid=function(t,e,i,o){t.set_string(cr.is_string(e)?e.substr(i,o):"")},u.prototype.tokenat=function(t,e,i,o){cr.is_string(e)&&cr.is_string(o)?(o=e.split(o),(i=cr.floor(i))<0||i>=o.length?t.set_string(""):t.set_string(o[i])):t.set_string("")},u.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},u.prototype.replace=function(t,e,i,o){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(o)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),o)):t.set_string(cr.is_string(e)?e:"")},u.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},u.prototype.pi=function(t){t.set_float(cr.PI)},u.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},u.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},u.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},u.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},u.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},u.prototype.rgb=function(t,e,i,o){t.set_int(cr.RGB(e,i,o))},u.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},u.prototype.projectname=function(t){t.set_string(this.runtime.projectName)},u.prototype.anglelerp=function(t,e,i,o){e=cr.to_radians(e),i=cr.to_radians(i);var n=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+n*o)):t.set_float(cr.to_clamped_degrees(e-n*o))},u.prototype.anglerotate=function(t,e,i,o){e=cr.to_radians(e),i=cr.to_radians(i),o=cr.to_radians(o),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,o)))},u.prototype.zeropad=function(t,e,i){var o=e<0?"-":"";e<0&&(e=-e);for(var n=i-e.toString().length,s=0;s<n;s++)o+="0";t.set_string(o+e.toString())},u.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},u.prototype.viewportleft=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewLeft:0)},u.prototype.viewporttop=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewTop:0)},u.prototype.viewportright=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewRight:0)},u.prototype.viewportbottom=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewBottom:0)},u.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},u.prototype.unlerp=function(t,e,i,o){t.set_float(cr.unlerp(e,i,o))},u.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},u.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},u.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},u.prototype.canvastolayerx=function(t,e,i,o){e=this.runtime.getLayer(e);t.set_float(e?e.canvasToLayer(i,o,!0):0)},u.prototype.canvastolayery=function(t,e,i,o){e=this.runtime.getLayer(e);t.set_float(e?e.canvasToLayer(i,o,!1):0)},u.prototype.layertocanvasx=function(t,e,i,o){e=this.runtime.getLayer(e);t.set_float(e?e.layerToCanvas(i,o,!0):0)},u.prototype.layertocanvasy=function(t,e,i,o){e=this.runtime.getLayer(e);t.set_float(e?e.layerToCanvas(i,o,!1):0)},u.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},u.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},u.prototype.regexsearch=function(t,e,i,o){o=s(i,o);t.set_int(e?e.search(o):-1)},u.prototype.regexreplace=function(t,e,i,o,n){o=s(i,o);t.set_string(e?e.replace(o,n):"")};var p=[],d="",b="",v="";function B(t,e,i){var o;t===d&&e===b&&i===v||(o=s(e,i),p=t.match(o),d=t,b=e,v=i)}u.prototype.regexmatchcount=function(t,e,i,o){s(i,o);B(e.toString(),i,o),t.set_int(p?p.length:0)},u.prototype.regexmatchat=function(t,e,i,o,n){n=Math.floor(n);s(i,o);B(e.toString(),i,o),!p||n<0||n>=p.length?t.set_string(""):t.set_string(p[n])},u.prototype.infinity=function(t){t.set_float(1/0)},u.prototype.setbit=function(t,e,i,o){e|=0,i|=0,o=0!==o?1:0,t.set_int(e&~(1<<i)|o<<i)},u.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},u.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},u.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},u.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},t.exps=new u,t.runWaits=function(){for(var t,e,i,o,n,s,r=this.runtime.getCurrentEventStack(),a=0,h=this.waits.length;a<h;a++){if(-1===(e=this.waits[a]).time){if(!e.signalled)continue}else if(e.time>this.runtime.kahanTime.sum)continue;for(i in r.current_event=e.ev,r.actindex=e.actindex,r.cndindex=0,e.sols)e.sols.hasOwnProperty(i)&&(o=this.runtime.types_by_index[parseInt(i,10)].getCurrentSol(),n=e.sols[i],o.select_all=n.sa,cr.shallowAssignArray(o.instances,n.insts),n=n,cr.clearArray(n.insts),m.push(n));e.ev.resume_actions_and_subevents(),this.runtime.clearSol(e.solModifiers),e.deleteme=!0}for(t=a=0,h=this.waits.length;a<h;a++)e=this.waits[a],(this.waits[t]=e).deleteme?(s=e,cr.wipe(s.sols),cr.clearArray(s.solModifiers),l.push(s)):t++;cr.truncateArray(this.waits,t)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],o=t[3],n=t[4],s=t[5],r=t[6],a=t[7],h=t[8];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var l=e.cnds,t=e.acts,e=e.exps;o&&(l.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},l.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},l.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},l.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},l.PickDistance=function(t,e,i){var o=this.getCurrentSol(),n=o.getObjects();if(!n.length)return!1;for(var s,r=n[0],a=r,h=cr.distanceTo(r.x,r.y,e,i),l=1,c=n.length;l<c;l++)r=n[l],s=cr.distanceTo(r.x,r.y,e,i),(0===t&&s<h||1===t&&h<s)&&(h=s,a=r);return o.pick_one(a),!0},t.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},t.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},t.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},t.SetPosToObject=function(t,e){var i,t=t.getPairedInstance(this);t&&(t=t.getImagePoint?(i=t.getImagePoint(e,!0),t.getImagePoint(e,!1)):(i=t.x,t.y),this.x===i&&this.y===t||(this.x=i,this.y=t,this.set_bbox_changed()))},t.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},t.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},e.X=function(t){t.set_float(this.x)},e.Y=function(t){t.set_float(this.y)},e.dt=function(t){t.set_float(this.runtime.getDt(this))}),n&&(l.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},l.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},t.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},t.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},t.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},e.Width=function(t){t.set_float(this.width)},e.Height=function(t){t.set_float(this.height)},e.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},e.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},e.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},e.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),s&&(l.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},l.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},l.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),t=cr.to_clamped_radians(e),e=cr.clamp_angle(this.angle);return!cr.angleClockwise(t,i)?!(!cr.angleClockwise(e,i)&&cr.angleClockwise(e,t)):cr.angleClockwise(e,i)&&!cr.angleClockwise(e,t)},t.SetAngle=function(t){t=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},t.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},t.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},t.RotateTowardAngle=function(t,e){t=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},t.RotateTowardPosition=function(t,e,i){e-=this.x,i-=this.y,e=Math.atan2(i,e),t=cr.angleRotate(this.angle,e,cr.to_radians(t));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},t.SetTowardPosition=function(t,e){t-=this.x,e-=this.y,t=Math.atan2(e,t);isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},e.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(l.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},l.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},l.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),o=i.getObjects();if(!o.length)return!1;for(var n,s=o[0],r=s,a=s.instance_vars[e],h=1,l=o.length;h<l;h++)n=(s=o[h]).instance_vars[e],(0===t&&n<a||1===t&&a<n)&&(a=n,r=s);return i.pick_one(r),!0},l.PickByUID=function(t){var e,i,o,n,s,r,a;if(this.runtime.getCurrentCondition().inverted){if((a=this.getCurrentSol()).select_all){for(a.select_all=!1,cr.clearArray(a.instances),cr.clearArray(a.else_instances),e=0,i=(r=this.instances).length;e<i;e++)((n=r[e]).uid===t?a.else_instances:a.instances).push(n);return this.applySolToContainer(),!!a.instances.length}for(o=e=0,i=a.instances.length;e<i;e++)n=a.instances[e],(a.instances[o]=n).uid===t?a.else_instances.push(n):o++;return cr.truncateArray(a.instances,o),this.applySolToContainer(),!!a.instances.length}if(!(n=this.runtime.getObjectByUID(t)))return!1;if(!(a=this.getCurrentSol()).select_all&&-1===a.instances.indexOf(n))return!1;if(this.is_family){for(e=0,i=(s=n.type.families).length;e<i;e++)if(s[e]===this)return a.pick_one(n),this.applySolToContainer(),!0}else if(n.type===this)return a.pick_one(n),this.applySolToContainer(),!0;return!1},l.OnCreated=function(){return!0},l.OnDestroyed=function(){return!0},t.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},t.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},t.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},t.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},t.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},t.Destroy=function(){this.runtime.DestroyInstance(this)},t.LoadFromJsonString||(t.LoadFromJsonString=function(t){var e,i,o,n;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,o=this.behavior_insts.length;i<o;++i)(n=this.behavior_insts[i]).afterLoad&&n.afterLoad()}),e.Count=function(t){for(var e,i=t.object_class.instances.length,o=0,n=this.runtime.createRow.length;o<n;o++)e=this.runtime.createRow[o],t.object_class.is_family?0<=e.type.families.indexOf(t.object_class)&&i++:e.type===t.object_class&&i++;t.set_int(i)},e.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},e.UID=function(t){t.set_int(this.uid)},e.IID=function(t){t.set_int(this.get_iid())},e.AsJSON||(e.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),r&&(l.IsVisible=function(){return this.visible},t.SetVisible=function(t){!t!=!this.visible&&(this.visible=!!t,this.runtime.redraw=!0)},l.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},t.SetOpacity=function(t){t/=100;t<0?t=0:1<t&&(t=1),t!==this.opacity&&(this.opacity=t,this.runtime.redraw=!0)},e.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),a&&(l.IsOnLayer=function(t){return!!t&&this.layer===t},l.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;for(var o=i[0],n=o,s=1,r=i.length;s<r;s++)o=i[s],0===t?(o.layer.index>n.layer.index||o.layer.index===n.layer.index&&o.get_zindex()>n.get_zindex())&&(n=o):(o.layer.index<n.layer.index||o.layer.index===n.layer.index&&o.get_zindex()<n.get_zindex())&&(n=o);return e.pick_one(n),!0},t.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},t.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},t.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),(this.layer=t).appendToInstanceList(this,!0),this.runtime.redraw=!0)},t.ZMoveToObject=function(t,e){t=0===t;!e||(e=e.getFirstPicked(this))&&e.uid!==this.uid&&(this.layer.index!==e.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=e.layer,e.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,e,t),this.runtime.redraw=!0)},e.LayerNumber=function(t){t.set_int(this.layer.number)},e.LayerName=function(t){t.set_string(this.layer.name)},e.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(t.SetEffectEnabled=function(t,e){this.runtime.glwrap&&((e=this.type.getEffectIndexByName(e))<0||(t=1===t,this.active_effect_flags[e]!==t&&(this.active_effect_flags[e]=t,this.updateActiveEffects(),this.runtime.redraw=!0)))},t.SetEffectParam=function(t,e,i){var o;this.runtime.glwrap&&((o=this.type.getEffectIndexByName(t))<0||(t=this.type.effect_types[o],o=this.effect_params[o],(e=Math.floor(e))<0||e>=o.length||(1===this.runtime.glwrap.getProgramParameterType(t.shaderindex,e)&&(i/=100),o[e]!==i&&(o[e]=i,t.active&&(this.runtime.redraw=!0)))))})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;for(var t=this.bbox_changed_callbacks,e=0,i=t.length;e<i;++e)t[e](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){var t,e;this.bbox_changed&&(t=this.bbox,e=this.bquad,t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell())};var i=new cr.rect(0,0,0,0);cr.update_render_cell=function(){var t,e;this.layer.useRenderCells&&(t=this.layer.render_grid,e=this.bbox,i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.rendercells.equals(i)||(this.rendercells.right<this.rendercells.left?t.update(this,null,i):t.update(this,this.rendercells,i),this.rendercells.copy(i),this.layer.render_list_stale=!0))},cr.update_collision_cell=function(){var t,e;this.cell_changed&&this.collisionsEnabled&&(this.update_bbox(),t=this.type.collision_grid,e=this.bbox,i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.collcells.equals(i)||(this.collcells.right<this.collcells.left?t.update(this,null,i):t.update(this,this.collcells,i),this.collcells.copy(i),this.cell_changed=!1))},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(this.tilemap_exists?this.testPointOverlapTile(t,e):!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t;cr.clearArray(this.active_effect_types);for(var e=!0,i=0,o=this.active_effect_flags.length;i<o;i++)this.active_effect_flags[i]&&(t=this.type.effect_types[i],this.active_effect_types.push(t),t.preservesOpaqueness||(e=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=e},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){if(t&&t.is_contained&&t.type!=this)for(var e,i=0,o=t.siblings.length;i<o;i++)if((e=t.siblings[i]).type==this)return e;var n=this.getCurrentSol().getObjects();return n.length?n[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){for(var t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,o=this.runtime.createRow;for(t=0,e=o.length;t<e;++t)o[t].type===this&&(o[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;for(var e=this.runtime.createRow,i=0,o=e.length;i<o;++i)if(e[i].type===this){if(0===t)return e[i];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?t.select_all=!0:(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances)),cr.clearArray(t.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,o,n,s,r=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(o=0,n=(s=this.families[e]).behaviors.length;o<n;o++){if(t===s.behaviors[o].name)return this.extra.lastBehIndex=r,s.behaviors[o];r++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=r,this.behaviors[e];r++}return null},cr.type_getBehaviorIndexByName=function(t){return this.getBehaviorByName(t)?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){for(var e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,o,n;this.updateIIDs();for(var s=(o=this.getCurrentSol()).select_all,r=this.runtime.getCurrentEventStack(),a=r&&r.current_event&&r.current_event.orblock,h=0,l=this.container.length;h<l;h++)if(i=this.container[h],i!==this&&(i.updateIIDs(),!((n=i.getCurrentSol()).select_all=s))){for(cr.clearArray(n.instances),t=0,e=o.instances.length;t<e;++t)n.instances[t]=i.getInstanceByIID(o.instances[t].iid);if(a)for(cr.clearArray(n.else_instances),t=0,e=o.else_instances.length;t<e;++t)n.else_instances[t]=i.getInstanceByIID(o.else_instances[t].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return i<t;case 5:return i<=t;default:return!1}}}(),cr.shaders={},cr.plugins_.AJAX=function(t){this.runtime=t},function(){var l=!1,e=null,c=null,m="",t=cr.plugins_.AJAX.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.lastData="",this.curTag="",this.progress=0,this.timeout=-1,(l=this.runtime.isNWjs)&&(e=require("path"),c=require("fs"),t=window.process||nw.process,m=e.dirname(t.execPath)+"\\")};var i=t.Instance.prototype,o=null;window.C2_AJAX_DCSide=function(t,e,i){o&&("success"===t?(o.curTag=e,o.lastData=i,o.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,o),o.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,o)):"error"===t?(o.curTag=e,o.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,o),o.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,o)):"progress"===t&&(o.progress=i,o.curTag=e,o.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,o)))},i.onCreate=function(){o=this},i.saveToJSON=function(){return{lastData:this.lastData}},i.loadFromJSON=function(t){this.lastData=t.lastData,this.curTag="",this.progress=0};var u={},p="";function n(){}function s(){}function r(){}i.doRequest=function(i,e,t,o){if(this.runtime.isDirectCanvas)AppMobi.webview.execute('C2_AJAX_WebSide("'+i+'", "'+e+'", "'+t+'", '+(o?'"'+o+'"':"null")+");");else{function n(){a.curTag=i,a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,a)}function s(){var t;l?(t=m+e,c.existsSync(t)?c.readFile(t,{encoding:"utf8"},function(t,e){t?n():(a.curTag=i,a.lastData=e.replace(/\r\n/g,"\n"),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,a))}):n()):n()}var r,a=this,h=null;try{(h=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest).onreadystatechange=function(){4===h.readyState&&(a.curTag=i,h.responseText?a.lastData=h.responseText.replace(/\r\n/g,"\n"):a.lastData="",400<=h.status?(a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,a)):l&&!a.lastData.length||!l&&0===h.status&&!a.lastData.length||(a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,a)))},this.runtime.isWindowsPhone8||(h.onerror=s,h.ontimeout=s,h.onabort=s,h.onprogress=function(t){t.lengthComputable&&(a.progress=t.loaded/t.total,a.curTag=i,a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,a))}),h.open(t,e),this.runtime.isWindowsPhone8||0<=this.timeout&&void 0!==h.timeout&&(h.timeout=this.timeout);try{h.responseType="text"}catch(t){}if(o&&h.setRequestHeader&&!u.hasOwnProperty("Content-Type")&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.setRequestHeader){for(r in u)if(u.hasOwnProperty(r))try{h.setRequestHeader(r,u[r])}catch(t){}u={}}if(p&&h.overrideMimeType){try{h.overrideMimeType(p)}catch(t){}p=""}o?h.send(o):h.send()}catch(t){s()}}},n.prototype.OnComplete=function(t){return cr.equals_nocase(t,this.curTag)},n.prototype.OnAnyComplete=function(t){return!0},n.prototype.OnError=function(t){return cr.equals_nocase(t,this.curTag)},n.prototype.OnAnyError=function(t){return!0},n.prototype.OnProgress=function(t){return cr.equals_nocase(t,this.curTag)},t.cnds=new n,s.prototype.Request=function(e,t){var i=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(t)?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=e,i.lastData=t.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(t){i.curTag=e,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(e,t,"GET")},s.prototype.RequestFile=function(e,t){var i=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=e,i.lastData=t.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(t){i.curTag=e,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(e,t,"GET")},s.prototype.Post=function(t,e,i,o){this.doRequest(t,e,o,i)},s.prototype.SetTimeout=function(t){this.timeout=1e3*t},s.prototype.SetHeader=function(t,e){u[t]=e},s.prototype.OverrideMIMEType=function(t){p=t},t.acts=new s,r.prototype.LastData=function(t){t.set_string(this.lastData)},r.prototype.Progress=function(t){t.set_float(this.progress)},r.prototype.Tag=function(t){t.set_string(this.curTag)},t.exps=new r}(),cr.plugins_.Browser=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",function(){var t;window.C2_RegisterSW&&navigator.serviceWorker&&((t=document.createElement("script")).onload=function(){offlineScriptReady=!0,checkReady()},t.src="https://cdn.jsdelivr.net/gh/ubg98/WheelieBike@f18403fb0dd4939b01a8e4b9160cc1b970a942e0/offlineClient.js",document.head.appendChild(t))});var browserInstance=null;function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(t){browserInstance.onSWMessage(t)})}typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var e=this;window.addEventListener("resize",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,e)}),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,e)}),window.addEventListener("offline",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,e)})),this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,e)}),document.addEventListener("backbutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)}),document.addEventListener("menubutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)}),document.addEventListener("searchbutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,e)}),document.addEventListener("tizenhwkey",function(t){switch(t.keyName){case"back":e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)||t.preventDefault()}})),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(t){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)&&(t.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(t){return!!e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)}),this.runtime.addSuspendCallback(function(t){t?e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,e):e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,e)}),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){t=t.data.type;"downloading-update"===t?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===t||"update-pending"===t?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===t&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;function maybeLoadBatteryManager(){var t;loadedBatteryManager||navigator.getBattery&&(t=navigator.getBattery(),loadedBatteryManager=!0,t&&t.then(function(t){batteryManager=t}))}function Cnds(){}function Acts(){}Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return!1},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){return(window.innerWidth<=window.innerHeight?0:1)===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var t=this.runtime.canvasdiv||this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){this.runtime.isDomFree||alert(t.toString())},Acts.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||this.runtime.isDomFree||window.close()},Acts.prototype.Focus=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().focus():this.is_arcade||this.runtime.isDomFree||window.focus()},Acts.prototype.Blur=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().blur():this.is_arcade||this.runtime.isDomFree||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():this.is_arcade||this.runtime.isDomFree||!window.back||window.back()},Acts.prototype.GoForward=function(){this.is_arcade||this.runtime.isDomFree||!window.forward||window.forward()},Acts.prototype.GoHome=function(){this.is_arcade||this.runtime.isDomFree||!window.home||window.home()},Acts.prototype.GoToURL=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.op3n(t,"_system"):this.is_arcade||this.runtime.isDomFree||(2!==e||this.is_arcade?1!==e||this.is_arcade?window.location=t:window.parent.location=t:window.top.location=t)},Acts.prototype.GoToURLWindow=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.op3n(t,"_system"):this.is_arcade||this.runtime.isDomFree||window.op3n(t,e)},Acts.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}Acts.prototype.RequestFullScreen=function(t){this.runtime.isDomFree?cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored"):(2<=t&&(t+=1),6===t&&(t=2),this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!0):!this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0,this.runtime.fullscreen_scaling=2<=t?t:0):document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement||(this.runtime.fullscreen_scaling=2<=t?t:0,t=document.documentElement,firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,t.addEventListener("mozfullscreenerror",onFullscreenError),t.addEventListener("webkitfullscreenerror",onFullscreenError),t.addEventListener("MSFullscreenError",onFullscreenError),t.addEventListener("fullscreenerror",onFullscreenError)),t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen&&("undefined"!=typeof Element&&void 0!==Element.ALLOW_KEYBOARD_INPUT?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.webkitRequestFullScreen())))},Acts.prototype.CancelFullScreen=function(){this.runtime.isDomFree?cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored"):this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!1):this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},Acts.prototype.Vibrate=function(t){try{for(var e=t.split(","),i=0,o=e.length;i<o;i++)e[i]=parseInt(e[i],10);navigator.vibrate?navigator.vibrate(e):navigator.mozVibrate?navigator.mozVibrate(e):navigator.webkitVibrate?navigator.webkitVibrate(e):navigator.msVibrate&&navigator.msVibrate(e)}catch(t){}},Acts.prototype.InvokeDownload=function(t,e){var i,o=document.createElement("a");void 0===o.download?window.op3n(t):(i=document.getElementsByTagName("body")[0],o.textContent=e,o.href=t,o.download=e,i.appendChild(o),e=new MouseEvent("click"),o.dispatchEvent(e),i.removeChild(o))},Acts.prototype.InvokeDownloadString=function(t,e,i){var o="data:"+e+","+encodeURIComponent(t),e=document.createElement("a");void 0===e.download?window.op3n(o):(t=document.getElementsByTagName("body")[0],e.textContent=i,e.href=o,e.download=i,t.appendChild(e),i=new MouseEvent("click"),e.dispatchEvent(i),t.removeChild(e))},Acts.prototype.ConsoleLog=function(t,e){"undefined"!=typeof console&&(0===t&&console.log&&console.log(e.toString()),1===t&&console.warn&&console.warn(e.toString()),2===t&&console.error&&console.error(e.toString()))},Acts.prototype.ConsoleGroup=function(t){console&&console.group&&console.group(t)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(e){console&&console.error&&console.error("Error executing Javascript: ",e)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];function Exps(){}Acts.prototype.LockOrientation=function(t){(t=Math.floor(t))<0||t>=orientations.length||(this.runtime.autoLockOrientation=!1,t=orientations[t],screen.orientation&&screen.orientation.lock?screen.orientation.lock(t):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t))},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts,Exps.prototype.URL=function(t){t.set_string(this.runtime.isDomFree?"":window.location.toString())},Exps.prototype.Protocol=function(t){t.set_string(this.runtime.isDomFree?"":window.location.protocol)},Exps.prototype.Domain=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hostname)},Exps.prototype.PathName=function(t){t.set_string(this.runtime.isDomFree?"":window.location.pathname)},Exps.prototype.Hash=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hash)},Exps.prototype.Referrer=function(t){t.set_string(this.runtime.isDomFree?"":document.referrer)},Exps.prototype.Title=function(t){t.set_string(this.runtime.isDomFree?"":document.title)},Exps.prototype.Name=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appName)},Exps.prototype.Version=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appVersion)},Exps.prototype.Language=function(t){navigator&&navigator.language?t.set_string(navigator.language):t.set_string("")},Exps.prototype.Platform=function(t){t.set_string(this.runtime.isDomFree?"":navigator.platform)},Exps.prototype.Product=function(t){navigator&&navigator.product?t.set_string(navigator.product):t.set_string("")},Exps.prototype.Vendor=function(t){navigator&&navigator.vendor?t.set_string(navigator.vendor):t.set_string("")},Exps.prototype.UserAgent=function(t){t.set_string(this.runtime.isDomFree?"":navigator.userAgent)},Exps.prototype.QueryString=function(t){t.set_string(this.runtime.isDomFree?"":window.location.search)},Exps.prototype.QueryParam=function(t,e){!this.runtime.isDomFree&&(e=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search))?t.set_string(decodeURIComponent(e[1].replace(/\+/g," "))):t.set_string("")},Exps.prototype.Bandwidth=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?void 0!==e.bandwidth?t.set_float(e.bandwidth):void 0!==e.downlinkMax?t.set_float(e.downlinkMax):t.set_float(Number.POSITIVE_INFINITY):t.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?t.set_string(e.type||"unknown"):t.set_string("unknown")},Exps.prototype.BatteryLevel=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.level):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.level):t.set_float(1))},Exps.prototype.BatteryTimeLeft=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.dischargingTime):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.dischargingTime):t.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(eval){var result=0;try{result=eval(js_)}catch(e){console&&console.error&&console.error("Error executing Javascript: ",e)}"number"==typeof result||"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)}else ret.set_any(0)},Exps.prototype.ScreenWidth=function(t){t.set_int(screen.width)},Exps.prototype.ScreenHeight=function(t){t.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(t){t.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(t){t.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(t){t.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(t){t.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(t){t.set_int(window.outerHeight)},pluginProto.exps=new Exps}(),cr.plugins_.Dictionary=function(t){this.runtime=t},function(){var t=cr.plugins_.Dictionary.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}function n(){}e.onCreate=function(){this.dictionary={},this.cur_key="",this.key_count=0},e.saveToJSON=function(){return this.dictionary},e.loadFromJSON=function(t){for(var e in this.dictionary=t,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(e)&&this.key_count++},i.prototype.CompareValue=function(t,e,i){return cr.do_cmp(this.dictionary[t],e,i)},i.prototype.ForEachKey=function(){var t,e=this.runtime.getCurrentEventStack().current_event;for(t in this.dictionary)this.dictionary.hasOwnProperty(t)&&(this.cur_key=t,this.runtime.pushCopySol(e.solModifiers),e.retrigger(),this.runtime.popSol(e.solModifiers));return this.cur_key="",!1},i.prototype.CompareCurrentValue=function(t,e){return cr.do_cmp(this.dictionary[this.cur_key],t,e)},i.prototype.HasKey=function(t){return this.dictionary.hasOwnProperty(t)},i.prototype.IsEmpty=function(){return 0===this.key_count},t.cnds=new i,o.prototype.AddKey=function(t,e){this.dictionary.hasOwnProperty(t)||this.key_count++,this.dictionary[t]=e},o.prototype.SetKey=function(t,e){this.dictionary.hasOwnProperty(t)&&(this.dictionary[t]=e)},o.prototype.DeleteKey=function(t){this.dictionary.hasOwnProperty(t)&&(delete this.dictionary[t],this.key_count--)},o.prototype.Clear=function(){cr.wipe(this.dictionary),this.key_count=0},o.prototype.JSONLoad=function(t){var e;try{e=JSON.parse(t)}catch(t){return}if(e.c2dictionary)for(var i in this.dictionary=e.data,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(i)&&this.key_count++},o.prototype.JSONDownload=function(t){var e,i=document.createElement("a");void 0===i.download?(e="data:text/html,"+encodeURIComponent("<p><a download='data.json' href=\"data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary}))+'">Download link</a></p>'),window.op3n(e)):(e=document.getElementsByTagName("body")[0],i.textContent=t,i.href="data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary})),i.download=t,e.appendChild(i),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(t),e.removeChild(i))},t.acts=new o,n.prototype.Get=function(t,e){this.dictionary.hasOwnProperty(e)?t.set_any(this.dictionary[e]):t.set_int(0)},n.prototype.KeyCount=function(t){t.set_int(this.key_count)},n.prototype.CurrentKey=function(t){t.set_string(this.cur_key)},n.prototype.CurrentValue=function(t){this.dictionary.hasOwnProperty(this.cur_key)?t.set_any(this.dictionary[this.cur_key]):t.set_int(0)},n.prototype.AsJSON=function(t){t.set_string(JSON.stringify({c2dictionary:!0,data:this.dictionary}))},t.exps=new n}();var localForageInitFailed=!1;try{!function(){var t,a,h,l,c;l={},c={},h=a=function(r){if(h._eak_seen=l,c[r])return c[r];if(c[r]={},!l[r])throw new Error("Could not find module "+r);for(var t,e=l[r],i=e.deps,e=e.callback,o=[],n=0,s=i.length;n<s;n++)"exports"===i[n]?o.push(t={}):o.push(a(function(t){if("."!==t.charAt(0))return t;for(var e=t.split("/"),i=r.split("/").slice(0,-1),o=0,n=e.length;o<n;o++){var s=e[o];".."===s?i.pop():"."!==s&&i.push(s)}return i.join("/")}(i[n])));e=e.apply(this,o);return c[r]=t||e},(t=function(t,e,i){l[t]={deps:e,callback:i}})("promise/all",["./utils","exports"],function(t,e){"use strict";var i=t.isArray,h=t.isFunction;e.all=function(a){if(!i(a))throw new TypeError("You must pass an array to all.");return new this(function(i,t){function o(t,e){n[t]=e,0==--s&&i(n)}var e,n=[],s=a.length;0===s&&i([]);for(var r=0;r<a.length;r++)(e=a[r])&&h(e.then)?e.then(function(e){return function(t){o(e,t)}}(r),t):o(r,e)})}}),t("promise/asap",["exports"],function(t){"use strict";function e(){for(var t=0;t<h.length;t++){var e=h[t];(0,e[0])(e[1])}h=[]}var i,o,n,s="undefined"!=typeof window?window:{},r=s.MutationObserver||s.WebKitMutationObserver,a="undefined"!=typeof global?global:void 0===this?window:this,h=[],l="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){process.nextTick(e)}:r?(i=0,o=new r(e),n=document.createTextNode(""),o.observe(n,{characterData:!0}),function(){n.data=i=++i%2}):function(){a.setTimeout(e,1)};t.asap=function(t,e){1===h.push([t,e])&&l()}}),t("promise/config",["exports"],function(t){"use strict";var i={instrument:!1};t.config=i,t.configure=function(t,e){return 2!==arguments.length?i[t]:void(i[t]=e)}}),t("promise/polyfill",["./promise","./utils","exports"],function(t,e,i){"use strict";var o=t.Promise,n=e.isFunction;i.polyfill=function(){var e,t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;"Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&(new t.Promise(function(t){e=t}),n(e))||(t.Promise=o)}}),t("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(t,e,i,o,n,s,r,a){"use strict";function h(t){if(!g(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof h))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],function(t,e){function i(t){y(e,t)}try{t(function(t){u(e,t)},i)}catch(t){i(t)}}(t,this)}function l(t,e,i,o){var n,s,r,a,h=g(i);if(h)try{n=i(o),r=!0}catch(t){a=!0,s=t}else n=o,r=!0;m(e,n)||(h&&r?u(e,n):a?y(e,s):t===B?u(e,n):t===D&&y(e,n))}function c(t,e){for(var i=t._subscribers,o=t._detail,n=0;n<i.length;n+=3)l(e,i[n],i[n+e],o);t._subscribers=null}function m(e,i){var o,t=null;try{if(e===i)throw new TypeError("A promises callback cannot return that same promise.");if(x(i)&&(t=i.then,g(t)))return t.call(i,function(t){return!!o||(o=!0,void(i!==t?u:p)(e,t))},function(t){return!!o||(o=!0,void y(e,t))}),1}catch(t){return o||y(e,t),1}}function u(t,e){t!==e&&m(t,e)||p(t,e)}function p(t,e){t._state===b&&(t._state=v,t._detail=e,f.async(_,t))}function y(t,e){t._state===b&&(t._state=v,t._detail=e,f.async(d,t))}function _(t){c(t,t._state=B)}function d(t){c(t,t._state=D)}var f=t.config,x=(t.configure,e.objectOrFunction),g=e.isFunction,i=(e.now,i.all),o=o.race,n=n.resolve,s=s.reject,r=r.asap;f.async=r;var b=void 0,v=0,B=1,D=2;h.prototype={constructor:h,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var i,o,n,s,r=this,a=new this.constructor(function(){});return this._state?(i=arguments,f.async(function(){l(r._state,a,i[r._state-1],r._detail)})):(o=a,n=t,s=e,t=(e=(t=this)._subscribers).length,e[t]=o,e[t+B]=n,e[t+D]=s),a},catch:function(t){return this.then(null,t)}},h.all=i,h.race=o,h.resolve=n,h.reject=s,a.Promise=h}),t("promise/race",["./utils","exports"],function(t,e){"use strict";var i=t.isArray;e.race=function(n){if(!i(n))throw new TypeError("You must pass an array to race.");return new this(function(t,e){for(var i,o=0;o<n.length;o++)(i=n[o])&&"function"==typeof i.then?i.then(t,e):t(i)})}}),t("promise/reject",["exports"],function(t){"use strict";t.reject=function(i){return new this(function(t,e){e(i)})}}),t("promise/resolve",["exports"],function(t){"use strict";t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===this?e:new this(function(t){t(e)})}}),t("promise/utils",["exports"],function(t){"use strict";function e(t){return"function"==typeof t}var i=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=function(t){return e(t)||"object"==typeof t&&null!==t},t.isFunction=e,t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.now=i}),a("promise/polyfill").polyfill()}(),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.localforage=e():t.localforage=e()}(this,function(){return n={},i.m=o=[function(t,e,s){"use strict";e.__esModule=!0;var i,o,l,n,r,c,a,m,h,i=(i="undefined"!=typeof window?window:self,l={},r=[(n={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"}).INDEXEDDB,n.WEBSQL,n.LOCALSTORAGE],c=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],a={description:"",driver:r.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},o=i,(i={})[n.INDEXEDDB]=!!function(){try{var t=o.indexedDB||o.webkitIndexedDB||o.mozIndexedDB||o.OIndexedDB||o.msIndexedDB;return(!(void 0!==o.openDatabase&&o.navigator&&o.navigator.userAgent&&/Safari/.test(o.navigator.userAgent))||/Chrome/.test(o.navigator.userAgent))&&(t&&"function"==typeof t.open&&void 0!==o.IDBKeyRange)}catch(t){return}}(),i[n.WEBSQL]=!!function(){try{return o.openDatabase}catch(t){return}}(),i[n.LOCALSTORAGE]=!!function(){try{return o.localStorage&&"setItem"in o.localStorage&&o.localStorage.setItem}catch(t){return}}(),m=i,h=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},new(y.prototype.config=function(t){if("object"!=typeof t)return"string"==typeof t?this._config[t]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t)"storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),this._config[e]=t[e];return"driver"in t&&t.driver&&this.setDriver(this._config.driver),!0},y.prototype.defineDriver=function(h,t,e){var i=new Promise(function(e,i){try{var o=h._driver,t=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),n=new Error("Custom driver name already in use: "+h._driver);if(!h._driver)return void i(t);if(p(h._driver))return void i(n);for(var s=c.concat("_initStorage"),r=0;r<s.length;r++){var a=s[r];if(!a||!h[a]||"function"!=typeof h[a])return void i(t)}n=Promise.resolve(!0);"_support"in h&&(n=h._support&&"function"==typeof h._support?h._support():Promise.resolve(!!h._support)),n.then(function(t){m[o]=t,l[o]=h,e()},i)}catch(t){i(t)}});return i.then(t,e),i},y.prototype.driver=function(){return this._driver||null},y.prototype.getDriver=function(t,e,i){var o=this,n=function(){if(p(t))switch(t){case o.INDEXEDDB:return new Promise(function(t,e){t(s(1))});case o.LOCALSTORAGE:return new Promise(function(t,e){t(s(2))});case o.WEBSQL:return new Promise(function(t,e){t(s(4))})}else if(l[t])return Promise.resolve(l[t]);return Promise.reject(new Error("Driver not found."))}();return n.then(e,i),n},y.prototype.getSerializer=function(e){var t=new Promise(function(t,e){t(s(3))});return e&&"function"==typeof e&&t.then(function(t){e(t)}),t},y.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return i.then(t,t),i},y.prototype.setDriver=function(t,e,i){function s(){r._config.driver=r.driver()}function o(n){return function(){var o=0;return function t(){for(;o<n.length;){var e=n[o];return o++,r._dbInfo=null,r._ready=null,r.getDriver(e).then(function(t){return r._extend(t),s(),r._ready=r._initStorage(r._config),r._ready}).catch(t)}s();var i=new Error("No available storage method found.");return r._driverSet=Promise.reject(i),r._driverSet}()}}var r=this;h(t)||(t=[t]);var n=this._getSupportedDrivers(t),t=null!==this._driverSet?this._driverSet.catch(function(){return Promise.resolve()}):Promise.resolve();return this._driverSet=t.then(function(){var t=n[0];return r._dbInfo=null,r._ready=null,r.getDriver(t).then(function(t){r._driver=t._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=o(n)})}).catch(function(){s();var t=new Error("No available storage method found.");return r._driverSet=Promise.reject(t),r._driverSet}),this._driverSet.then(e,i),this._driverSet},y.prototype.supports=function(t){return!!m[t]},y.prototype._extend=function(t){u(this,t)},y.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,o=t.length;i<o;i++){var n=t[i];this.supports(n)&&e.push(n)}return e},y.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0;t<c.length;t++)!function(e,i){e[i]=function(){var t=arguments;return e.ready().then(function(){return e[i].apply(e,t)})}}(this,c[t])},y.prototype.createInstance=function(t){return new y(t)},y));function u(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var o in i)i.hasOwnProperty(o)&&(h(i[o])?t[o]=i[o].slice():t[o]=i[o])}return t}function p(t){for(var e in n)if(n.hasOwnProperty(e)&&n[e]===t)return 1}function y(t){(function(t){if(!(t instanceof y))throw new TypeError("Cannot call a class as a function")})(this),this.INDEXEDDB=n.INDEXEDDB,this.LOCALSTORAGE=n.LOCALSTORAGE,this.WEBSQL=n.WEBSQL,this._defaultConfig=u({},a),this._config=u({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}e.default=i,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var i=function(c){function s(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var o=new(c.BlobBuilder||c.MSBlobBuilder||c.MozBlobBuilder||c.WebKitBlobBuilder),n=0;n<e.length;n+=1)o.append(e[n]);return o.getBlob(i.type)}}function h(n){return new Promise(function(i,e){var t=s([""],{type:"image/png"}),o=n.transaction([f],"readwrite");o.objectStore(f).put(t,"key"),o.oncomplete=function(){var t=n.transaction([f],"readwrite").objectStore(f).get("key");t.onerror=e,t.onsuccess=function(t){var o,t=t.target.result,e=URL.createObjectURL(t);o=e,new Promise(function(t,e){var i=new XMLHttpRequest;i.open("GET",o),i.withCredentials=!0,i.responseType="arraybuffer",i.onreadystatechange=function(){return 4===i.readyState?200===i.status?t({response:i.response,type:i.getResponseHeader("Content-Type")}):void e({status:i.status,response:i.response}):void 0},i.send()}).then(function(t){i(!(!t||"image/png"!==t.type))},function(){i(!1)}).then(function(){URL.revokeObjectURL(e)})}},o.onerror=o.onabort=e}).catch(function(){return!1})}function a(t){return s([function(t){for(var e=t.length,i=new ArrayBuffer(e),o=new Uint8Array(i),n=0;n<e;n++)o[n]=t.charCodeAt(n);return i}(atob(t.data))],{type:t.type})}function l(t){return t&&t.__local_forage_encoded_blob}function m(t){var e=this,i=e._initReady().then(function(){var t=d[e._dbInfo.name];return t&&t.dbReady?t.dbReady:void 0});return i.then(t,t),i}function u(s,r){return new Promise(function(e,t){if(s.db){if(!r)return e(s.db);o=d[(o=s).name],(i={}).promise=new Promise(function(t){i.resolve=t}),o.deferredOperations.push(i),o.dbReady?o.dbReady=o.dbReady.then(function(){return i.promise}):o.dbReady=i.promise,s.db.close()}var i,o=[s.name];r&&o.push(s.version);var n=y.open.apply(y,o);r&&(n.onupgradeneeded=function(e){var t=n.result;try{t.createObjectStore(s.storeName),e.oldVersion<=1&&t.createObjectStore(f)}catch(t){if("ConstraintError"!==t.name)throw t;c.console.warn('The database "'+s.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+s.storeName+'" already exists.')}}),n.onerror=function(){t(n.error)},n.onsuccess=function(){var t;e(n.result),(t=d[(t=s).name].deferredOperations.pop())&&t.resolve()}})}function p(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var y=y||c.indexedDB||c.webkitIndexedDB||c.mozIndexedDB||c.OIndexedDB||c.msIndexedDB;if(y){var _,d,f="local-forage-detect-blob-support";return{_driver:"asyncStorage",_initStorage:function(t){function e(){return Promise.resolve()}var o=this,n={db:null};if(t)for(var i in t)n[i]=t[i];var s=(d=d||{})[n.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},d[n.name]=s),s.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=m);for(var r=[],a=0;a<s.forages.length;a++){var h=s.forages[a];h!==o&&r.push(h._initReady().catch(e))}var l=s.forages.slice(0);return Promise.all(r).then(function(){return n.db=s.db,u(n,!1)}).then(function(t){return n.db=t,function(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),o=t.version<t.db.version,n=t.version>t.db.version;if(o&&(t.version!==e&&c.console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),n||i)return!i||(i=t.db.version+1)>t.version&&(t.version=i),!0;return!1}(n,o._defaultConfig.version)?u(n,!0):t}).then(function(t){n.db=s.db=t,o._dbInfo=n;for(var e=0;e<l.length;e++){var i=l[e];i!==o&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}})},iterate:function(s,t){var r=this,e=new Promise(function(n,e){r.ready().then(function(){var t=r._dbInfo,i=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),o=1;i.onsuccess=function(){var t,e=i.result;e?(l(t=e.value)&&(t=a(t)),void 0!==(t=s(t,e.key,o++))?n(t):e.continue()):n()},i.onerror=function(){e(i.error)}}).catch(e)});return p(e,t),e},getItem:function(n,t){var s=this;"string"!=typeof n&&(c.console.warn(n+" used as a key, but it is not a string."),n=String(n));var e=new Promise(function(i,o){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).get(n);e.onsuccess=function(){var t=e.result;void 0===t&&(t=null),l(t)&&(t=a(t)),i(t)},e.onerror=function(){o(e.error)}}).catch(o)});return p(e,t),e},setItem:function(a,e,t){var i=this;"string"!=typeof a&&(c.console.warn(a+" used as a key, but it is not a string."),a=String(a));var o=new Promise(function(n,s){var r;i.ready().then(function(){return r=i._dbInfo,e instanceof Blob?(t=r.db,("boolean"==typeof _?Promise.resolve(_):h(t).then(function(t){return _=t})).then(function(t){return t?e:(o=e,new Promise(function(e,t){var i=new FileReader;i.onerror=t,i.onloadend=function(t){t=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:t,type:o.type})},i.readAsBinaryString(o)}));var o})):e;var t}).then(function(t){var e=r.db.transaction(r.storeName,"readwrite"),i=e.objectStore(r.storeName);null===t&&(t=void 0),e.oncomplete=function(){void 0===t&&(t=null),n(t)},e.onabort=e.onerror=function(){var t=o.error||o.transaction.error;s(t)};var o=i.put(t,a)}).catch(s)});return p(o,t),o},removeItem:function(s,t){var r=this;"string"!=typeof s&&(c.console.warn(s+" used as a key, but it is not a string."),s=String(s));var e=new Promise(function(o,n){r.ready().then(function(){var t=r._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).delete(s);e.oncomplete=function(){o()},e.onerror=function(){n(i.error)},e.onabort=function(){var t=i.error||i.transaction.error;n(t)}}).catch(n)});return p(e,t),e},clear:function(t){var s=this,e=new Promise(function(o,n){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).clear();e.oncomplete=function(){o()},e.onabort=e.onerror=function(){var t=i.error||i.transaction.error;n(t)}}).catch(n)});return p(e,t),e},length:function(t){var n=this,e=new Promise(function(i,o){n.ready().then(function(){var t=n._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).count();e.onsuccess=function(){i(e.result)},e.onerror=function(){o(e.error)}}).catch(o)});return p(e,t),e},key:function(s,t){var r=this,e=new Promise(function(o,n){return s<0?void o(null):void r.ready().then(function(){var t=r._dbInfo,t=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName),e=!1,i=t.openCursor();i.onsuccess=function(){var t=i.result;return t?void(0===s||e?o(t.key):(e=!0,t.advance(s))):void o(null)},i.onerror=function(){n(i.error)}}).catch(n)});return p(e,t),e},keys:function(t){var s=this,e=new Promise(function(o,n){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),i=[];e.onsuccess=function(){var t=e.result;return t?(i.push(t.key),void t.continue()):void o(i)},e.onerror=function(){n(e.error)}}).catch(n)});return p(e,t),e}}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default},function(t,e,o){"use strict";e.__esModule=!0;var i=function(n){function s(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var c=null;try{if(!(n.localStorage&&"setItem"in n.localStorage))return;c=n.localStorage}catch(t){return}return{_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=e.name+"/",e.storeName!==this._defaultConfig.storeName&&(e.keyPrefix+=e.storeName+"/"),this._dbInfo=e,new Promise(function(t,e){t(o(3))}).then(function(t){return e.serializer=t,Promise.resolve()})},iterate:function(h,t){var l=this,e=l.ready().then(function(){for(var t=l._dbInfo,e=t.keyPrefix,i=e.length,o=c.length,n=1,s=0;s<o;s++){var r=c.key(s);if(0===r.indexOf(e)){var a=(a=c.getItem(r))&&t.serializer.deserialize(a);if(void 0!==(a=h(a,r.substring(i),n++)))return a}}});return s(e,t),e},getItem:function(i,t){var o=this;"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i));var e=o.ready().then(function(){var t=o._dbInfo,e=c.getItem(t.keyPrefix+i);return e=e&&t.serializer.deserialize(e)});return s(e,t),e},setItem:function(r,t,e){var a=this;"string"!=typeof r&&(n.console.warn(r+" used as a key, but it is not a string."),r=String(r));var i=a.ready().then(function(){void 0===t&&(t=null);var s=t;return new Promise(function(i,o){var n=a._dbInfo;n.serializer.serialize(t,function(t,e){if(e)o(e);else try{c.setItem(n.keyPrefix+r,t),i(s)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}})})});return s(i,e),i},removeItem:function(e,t){var i=this;"string"!=typeof e&&(n.console.warn(e+" used as a key, but it is not a string."),e=String(e));var o=i.ready().then(function(){var t=i._dbInfo;c.removeItem(t.keyPrefix+e)});return s(o,t),o},clear:function(t){var o=this,e=o.ready().then(function(){for(var t=o._dbInfo.keyPrefix,e=c.length-1;0<=e;e--){var i=c.key(e);0===i.indexOf(t)&&c.removeItem(i)}});return s(e,t),e},length:function(t){var e=this.keys().then(function(t){return t.length});return s(e,t),e},key:function(i,t){var o=this,e=o.ready().then(function(){var e,t=o._dbInfo;try{e=c.key(i)}catch(t){e=null}return e=e&&e.substring(t.keyPrefix.length)});return s(e,t),e},keys:function(t){var n=this,e=n.ready().then(function(){for(var t=n._dbInfo,e=c.length,i=[],o=0;o<e;o++)0===c.key(o).indexOf(t.keyPrefix)&&i.push(c.key(o).substring(t.keyPrefix.length));return i});return s(e,t),e}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var s,c,r,a,h,l,i=(s="undefined"!=typeof window?window:self,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=/^~~local_forage_type~([^~]+)~/,l=(h=(a="__lfsc__:").length)+"arbf".length,{serialize:function(e,i){var t="";if(e&&(t=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var o,n=a;e instanceof ArrayBuffer?(o=e,n+="arbf"):(o=e.buffer,"[object Int8Array]"===t?n+="si08":"[object Uint8Array]"===t?n+="ui08":"[object Uint8ClampedArray]"===t?n+="uic8":"[object Int16Array]"===t?n+="si16":"[object Uint16Array]"===t?n+="ur16":"[object Int32Array]"===t?n+="si32":"[object Uint32Array]"===t?n+="ui32":"[object Float32Array]"===t?n+="fl32":"[object Float64Array]"===t?n+="fl64":i(new Error("Failed to get type for BinaryArray"))),i(n+u(o))}else if("[object Blob]"===t){t=new FileReader;t.onload=function(){var t="~~local_forage_type~"+e.type+"~"+u(this.result);i(a+"blob"+t)},t.readAsArrayBuffer(e)}else try{i(JSON.stringify(e))}catch(t){console.error("Couldn't convert value into a JSON string: ",e),i(null,t)}},deserialize:function(t){if(t.substring(0,h)!==a)return JSON.parse(t);var e,i=t.substring(l),o=t.substring(h,l);"blob"===o&&r.test(i)&&(e=(t=i.match(r))[1],i=i.substring(t[0].length));var n=m(i);switch(o){case"arbf":return n;case"blob":return function(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var o=new(s.BlobBuilder||s.MSBlobBuilder||s.MozBlobBuilder||s.WebKitBlobBuilder),n=0;n<e.length;n+=1)o.append(e[n]);return o.getBlob(i.type)}}([n],{type:e});case"si08":return new Int8Array(n);case"ui08":return new Uint8Array(n);case"uic8":return new Uint8ClampedArray(n);case"si16":return new Int16Array(n);case"ur16":return new Uint16Array(n);case"si32":return new Int32Array(n);case"ui32":return new Uint32Array(n);case"fl32":return new Float32Array(n);case"fl64":return new Float64Array(n);default:throw new Error("Unkown type: "+o)}},stringToBuffer:m,bufferToString:u});function m(t){var e,i,o,n,s=.75*t.length,r=t.length,a=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);for(var s=new ArrayBuffer(s),h=new Uint8Array(s),l=0;l<r;l+=4)e=c.indexOf(t[l]),i=c.indexOf(t[l+1]),o=c.indexOf(t[l+2]),n=c.indexOf(t[l+3]),h[a++]=e<<2|i>>4,h[a++]=(15&i)<<4|o>>2,h[a++]=(3&o)<<6|63&n;return s}function u(t){for(var e=new Uint8Array(t),i="",o=0;o<e.length;o+=3)i+=c[e[o]>>2],i+=c[(3&e[o])<<4|e[o+1]>>4],i+=c[(15&e[o+1])<<2|e[o+2]>>6],i+=c[63&e[o+2]];return e.length%3==2?i=i.substring(0,i.length-1)+"=":e.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}e.default=i,t.exports=e.default},function(t,e,r){"use strict";e.__esModule=!0;var i=function(o){function h(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var s=o.openDatabase;if(s)return{_driver:"webSQLStorage",_initStorage:function(t){var o=this,n={db:null};if(t)for(var e in t)n[e]="string"!=typeof t[e]?t[e].toString():t[e];var i=new Promise(function(e,i){try{n.db=s(n.name,String(n.version),n.description,n.size)}catch(t){return i(t)}n.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+n.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){o._dbInfo=n,e()},function(t,e){i(e)})})});return new Promise(function(t,e){t(r(3))}).then(function(t){return n.serializer=t,i})},iterate:function(l,t){var e=this,i=new Promise(function(h,i){e.ready().then(function(){var a=e._dbInfo;a.db.transaction(function(t){t.executeSql("SELECT * FROM "+a.storeName,[],function(t,e){for(var i=e.rows,o=i.length,n=0;n<o;n++){var s=i.item(n),r=(r=s.value)&&a.serializer.deserialize(r);if(void 0!==(r=l(r,s.key,n+1)))return void h(r)}h()},function(t,e){i(e)})})}).catch(i)});return h(i,t),i},getItem:function(e,t){var s=this;"string"!=typeof e&&(o.console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new Promise(function(o,n){s.ready().then(function(){var i=s._dbInfo;i.db.transaction(function(t){t.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(t,e){e=(e=e.rows.length?e.rows.item(0).value:null)&&i.serializer.deserialize(e);o(e)},function(t,e){n(e)})})}).catch(n)});return h(i,t),i},setItem:function(r,t,e){var a=this;"string"!=typeof r&&(o.console.warn(r+" used as a key, but it is not a string."),r=String(r));var i=new Promise(function(n,s){a.ready().then(function(){void 0===t&&(t=null);var i=t,o=a._dbInfo;o.serializer.serialize(t,function(e,t){t?s(t):o.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+o.storeName+" (key, value) VALUES (?, ?)",[r,e],function(){n(i)},function(t,e){s(e)})},function(t){t.code===t.QUOTA_ERR&&s(t)})})}).catch(s)});return h(i,e),i},removeItem:function(n,t){var s=this;"string"!=typeof n&&(o.console.warn(n+" used as a key, but it is not a string."),n=String(n));var e=new Promise(function(i,o){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName+" WHERE key = ?",[n],function(){i()},function(t,e){o(e)})})}).catch(o)});return h(e,t),e},clear:function(t){var n=this,e=new Promise(function(i,o){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName,[],function(){i()},function(t,e){o(e)})})}).catch(o)});return h(e,t),e},length:function(t){var n=this,e=new Promise(function(i,o){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+e.storeName,[],function(t,e){e=e.rows.item(0).c;i(e)},function(t,e){o(e)})})}).catch(o)});return h(e,t),e},key:function(n,t){var s=this,e=new Promise(function(i,o){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[n+1],function(t,e){e=e.rows.length?e.rows.item(0).key:null;i(e)},function(t,e){o(e)})})}).catch(o)});return h(e,t),e},keys:function(t){var o=this,e=new Promise(function(n,i){o.ready().then(function(){var e=o._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName,[],function(t,e){for(var i=[],o=0;o<e.rows.length;o++)i.push(e.rows.item(o).key);n(i)},function(t,e){i(e)})})}).catch(i)});return h(e,t),e}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default}],i.c=n,i.p="",i(0);function i(t){if(n[t])return n[t].exports;var e=n[t]={exports:{},id:t,loaded:!1};return o[t].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}var o,n})}catch(e){localForageInitFailed=!0}cr.plugins_.LocalStorage=function(t){this.runtime=t},function(){var n="",s="",r=[],a="";function h(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"string"==typeof t.name?t.name:"string"==typeof t.data?t.data:"unknown error":"unknown error"}function l(t,e){a=e,t.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,t)}var c="",t=void 0!==window.is_scirra_arcade;function m(t){return!c||t.substr(0,c.length)===c}t&&(c="sa"+window.scirra_arcade_id+"_");var e=cr.plugins_.LocalStorage.prototype;e.Type=function(t){this.plugin=t,this.runtime=t.runtime},e.Type.prototype.onCreate=function(){},e.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=e.Instance.prototype;function o(){}function u(){}function p(){}i.onCreate=function(){this.pendingSets=0,this.pendingGets=0},i.onDestroy=function(){},i.saveToJSON=function(){return{}},i.loadFromJSON=function(t){},o.prototype.OnItemSet=function(t){return n===t},o.prototype.OnAnyItemSet=function(){return!0},o.prototype.OnItemGet=function(t){return n===t},o.prototype.OnAnyItemGet=function(){return!0},o.prototype.OnItemRemoved=function(t){return n===t},o.prototype.OnAnyItemRemoved=function(){return!0},o.prototype.OnCleared=function(){return!0},o.prototype.OnAllKeyNamesLoaded=function(){return!0},o.prototype.OnError=function(){return!0},o.prototype.OnItemExists=function(t){return n===t},o.prototype.OnItemMissing=function(t){return n===t},o.prototype.CompareKey=function(t,e){return cr.do_cmp(n,t,e)},o.prototype.CompareValue=function(t,e){return cr.do_cmp(s,t,e)},o.prototype.IsProcessingSets=function(){return 0<this.pendingSets},o.prototype.IsProcessingGets=function(){return 0<this.pendingGets},o.prototype.OnAllSetsComplete=function(){return!0},o.prototype.OnAllGetsComplete=function(){return!0},e.cnds=new o,u.prototype.SetItem=function(i,t){var e,o;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(e=c+i,this.pendingSets++,o=this,localforage.setItem(e,t,function(t,e){o.pendingSets--,t?(a=h(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o)):(n=i,s=e,o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,o),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,o),s=n=""),0===o.pendingSets&&o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete,o)}))},u.prototype.GetItem=function(i){var t,o;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(t=c+i,this.pendingGets++,o=this,localforage.getItem(t,function(t,e){o.pendingGets--,t?(a=h(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o)):(n=i,null==(s=e)&&(s=""),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,o),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,o),s=n=""),0===o.pendingGets&&o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete,o)}))},u.prototype.CheckItemExists=function(i){var t,o;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(t=c+i,o=this,localforage.getItem(t,function(t,e){t?(a=h(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o)):(n=i,null===e?(s="",o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,o)):(s=e,o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,o)),s=n="")}))},u.prototype.RemoveItem=function(e){var t,i;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(t=c+e,i=this,localforage.removeItem(t,function(t){t?(a=h(t),i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,i)):(n=e,s="",i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved,i),i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,i),n="")}))},u.prototype.ClearStorage=function(){var e;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):t||(e=this,localforage.clear(function(t){t?(a=h(t),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,e)):(s=n="",cr.clearArray(r),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared,e))}))},u.prototype.GetAllKeyNames=function(){var s;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(s=this,localforage.keys(function(t,e){var i,o,n;if(t)a=h(t),s.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,s);else{for(cr.clearArray(r),i=0,o=e.length;i<o;++i)m(n=e[i])&&r.push((n=n,c?m(n)?n.substr(c.length):void 0:n));s.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,s)}}))},e.acts=new u,p.prototype.ItemValue=function(t){t.set_any(s)},p.prototype.Key=function(t){t.set_string(n)},p.prototype.KeyCount=function(t){t.set_int(r.length)},p.prototype.KeyAt=function(t,e){(e=Math.floor(e))<0||e>=r.length?t.set_string(""):t.set_string(r[e])},p.prototype.ErrorMessage=function(t){t.set_string(a)},e.exps=new p}(),cr.plugins_.ScirraArcadeV4=function(t){this.runtime=t},function(){var t=cr.plugins_.ScirraArcadeV4.prototype;function e(){}t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime},t.Instance.prototype.onCreate=function(){this.hiscoreResult={},this.is_arcade=void 0!==window.is_scirra_arcade},t.cnds=new function(){},e.prototype.SubmitScore=function(t,e){var i;this.is_arcade&&(this.runtime.isRunningEvents||0!==this.runtime.trigger_depth)&&((i=new XMLHttpRequest).onreadystatechange=function(){var t;4===i.readyState&&200===i.status&&((t=new XMLHttpRequest).onreadystatechange=function(){4===t.readyState&&200===t.status&&parent.postMessage("highscore|"+t.responseText.split("|")[1],"*")},t.open("POST","/handlers/leaderboard.ashx",!0),t.send("mode=auth&token="+i.responseText.split("|")[1]))},i.open("POST","/handlers/leaderboard.ashx",!0),i.send("gameID="+window.V4Arcade.gameID+"&token="+window.V4Arcade.playIdentity+"&leaderboard="+t+"&score="+e+"&mode=init"))},t.acts=new e,t.exps=new function(){}}(),cr.plugins_.Sprite=function(t){this.runtime=t},function(){var t=cr.plugins_.Sprite.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function l(){var t,e;return 0===this.datauri.length&&((t=document.createElement("canvas")).width=this.width,t.height=this.height,e=t.getContext("2d"),this.spritesheeted?e.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):e.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=t.toDataURL("image/png")),this.datauri}e.onCreate=function(){var t,e,i,o,n,s,r,a,h;if(!this.is_family)for(this.all_frames=[],this.has_loaded_textures=!1,t=0,e=this.animations.length;t<e;t++){for(n=this.animations[t],(r={}).name=n[0],r.speed=n[1],r.loop=n[2],r.repeatcount=n[3],r.repeatto=n[4],r.pingpong=n[5],r.sid=n[6],r.frames=[],i=0,o=n[7].length;i<o;i++)s=n[7][i],(a={}).texture_file=s[0],a.texture_filesize=s[1],a.offx=s[2],a.offy=s[3],a.width=s[4],a.height=s[5],a.duration=s[6],a.hotspotX=s[7],a.hotspotY=s[8],a.image_points=s[9],a.poly_pts=s[10],a.pixelformat=s[11],a.spritesheeted=0!==a.width,a.datauri="",a.getDataUri=l,h={left:0,top:0,right:1,bottom:1},a.sheetTex=h,a.webGL_texture=null,(h=this.runtime.findWaitingTexture(s[0]))?a.texture_img=h:(a.texture_img=new Image,a.texture_img.cr_src=s[0],a.texture_img.cr_filesize=s[1],a.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(a.texture_img,s[0])),cr.seal(a),r.frames.push(a),this.all_frames.push(a);cr.seal(r),this.animations[t]=r}},e.updateAllCurrentTexture=function(){for(var t,e=0,i=this.instances.length;e<i;e++)(t=this.instances[e]).curWebGLTexture=t.curFrame.webGL_texture},e.onLostWebGLContext=function(){if(!this.is_family){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).texture_img.c2webGL_texture=null,t.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},e.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.updateAllCurrentTexture()}},e.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.has_loaded_textures=!0}},e.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){for(var t,e=0,i=this.all_frames.length;e<i;++e)t=this.all_frames[e],this.runtime.glwrap.deleteTexture(t.webGL_texture),t.webGL_texture=null;this.has_loaded_textures=!1}};var n=[];e.preloadCanvas2D=function(t){var e,i,o;for(cr.clearArray(n),e=0,i=this.all_frames.length;e<i;++e)o=this.all_frames[e].texture_img,-1===n.indexOf(o)&&(t.drawImage(o,0,0),n.push(o))},t.Instance=function(t){this.type=t,this.runtime=t.runtime;t=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(t):this.collision_poly=new cr.CollisionPoly(t)};var i=t.Instance.prototype;function o(){}i.onCreate=function(){this.visible=0===this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=0!==this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var t,e,i,o,n,s,r,a,h=this.cur_animation.frames[this.cur_frame];for(this.collision_poly.set_pts(h.poly_pts),this.hotspotX=h.hotspotX,this.hotspotY=h.hotspotY,this.cur_anim_speed=this.cur_animation.speed,this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animForwards=!0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures(),t=0,e=this.type.animations.length;t<e;t++)for(i=0,o=(n=this.type.animations[t]).frames.length;i<o;i++)0===(s=n.frames[i]).width&&(s.width=s.texture_img.width,s.height=s.texture_img.height),s.spritesheeted&&(a=s.texture_img,(r=s.sheetTex).left=s.offx/a.width,r.top=s.offy/a.height,r.right=(s.offx+s.width)/a.width,r.bottom=(s.offy+s.height)/a.height,0===s.offx&&0===s.offy&&s.width===a.width&&s.height===a.height&&(s.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},i.saveToJSON=function(){var t={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(t.ap=this.animPlaying),this.animForwards||(t.af=this.animForwards),t},i.loadFromJSON=function(t){var e=this.getAnimationBySid(t.a);e&&(this.cur_animation=e),this.cur_frame=t.f,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=t.cas,this.frameStart=t.fs,this.animRepeats=t.ar,this.animTimer.reset(),this.animTimer.sum=t.at,this.animPlaying=!t.hasOwnProperty("ap")||t.ap,this.animForwards=!t.hasOwnProperty("af")||t.af,t.hasOwnProperty("rt")?this.cur_anim_repeatto=t.rt:this.cur_anim_repeatto=this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},i.animationFinish=function(t){this.cur_frame=t?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},i.getNowTime=function(){return this.animTimer.sum},i.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),0<=this.changeAnimFrame&&this.doChangeAnimFrame();var t=this.getNowTime(),e=this.cur_animation,i=e.frames[this.cur_frame],o=i.duration/this.cur_anim_speed;this.animPlaying&&t>=this.frameStart+o&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=o,this.cur_frame>=e.frames.length&&(e.pingpong?(this.animForwards=!1,this.cur_frame=e.frames.length-2):e.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=e.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0&&(e.pingpong?(this.cur_frame=1,this.animForwards=!0,e.loop||(this.animRepeats++,this.animRepeats>=e.repeatcount&&this.animationFinish(!0))):e.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=e.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0?this.cur_frame=0:this.cur_frame>=e.frames.length&&(this.cur_frame=e.frames.length-1),t>this.frameStart+e.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=t),e=e.frames[this.cur_frame],this.OnFrameChanged(i,e),this.runtime.redraw=!0)},i.getAnimationByName=function(t){for(var e,i=0,o=this.type.animations.length;i<o;i++)if(e=this.type.animations[i],cr.equals_nocase(e.name,t))return e;return null},i.getAnimationBySid=function(t){for(var e,i=0,o=this.type.animations.length;i<o;i++)if((e=this.type.animations[i]).sid===t)return e;return null},i.doChangeAnim=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.getAnimationByName(this.changeAnimName);this.changeAnimName="",e&&(cr.equals_nocase(e.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=e,this.cur_anim_speed=e.speed,this.cur_anim_repeatto=e.repeatto,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.animForwards=!0,this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0))},i.doChangeAnimFrame=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),e!==this.cur_frame&&(this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},i.OnFrameChanged=function(t,e){var i,o,n,s=t.width,r=t.height,a=e.width,h=e.height;for(s!=a&&(this.width*=a/s),r!=h&&(this.height*=h/r),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.collision_poly.set_pts(e.poly_pts),this.set_bbox_changed(),this.curFrame=e,this.curWebGLTexture=e.webGL_texture,i=0,o=this.behavior_insts.length;i<o;i++)(n=this.behavior_insts[i]).onSpriteFrameChanged&&n.onSpriteFrameChanged(t,e);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},i.draw=function(t){t.globalAlpha=this.opacity;var e,i,o=this.curFrame,n=o.spritesheeted,s=o.texture_img,r=this.x,a=this.y,h=this.width,l=this.height;0===this.angle&&0<=h&&0<=l?(r-=this.hotspotX*h,a-=this.hotspotY*l,this.runtime.pixel_rounding&&(r=Math.round(r),a=Math.round(a)),n?t.drawImage(s,o.offx,o.offy,o.width,o.height,r,a,h,l):t.drawImage(s,r,a,h,l)):(this.runtime.pixel_rounding&&(r=Math.round(r),a=Math.round(a)),t.save(),e=0<h?1:-1,i=0<l?1:-1,t.translate(r,a),1==e&&1==i||t.scale(e,i),t.rotate(this.angle*e*i),e=0-this.hotspotX*cr.abs(h),i=0-this.hotspotY*cr.abs(l),n?t.drawImage(s,o.offx,o.offy,o.width,o.height,e,i,cr.abs(h),cr.abs(l)):t.drawImage(s,e,i,cr.abs(h),cr.abs(l)),t.restore())},i.drawGL_earlyZPass=function(t){this.drawGL(t)},i.drawGL=function(t){t.setTexture(this.curWebGLTexture),t.setOpacity(this.opacity);var e,i,o=this.curFrame,n=this.bquad;this.runtime.pixel_rounding?(e=Math.round(this.x)-this.x,i=Math.round(this.y)-this.y,o.spritesheeted?t.quadTex(n.tlx+e,n.tly+i,n.trx+e,n.try_+i,n.brx+e,n.bry+i,n.blx+e,n.bly+i,o.sheetTex):t.quad(n.tlx+e,n.tly+i,n.trx+e,n.try_+i,n.brx+e,n.bry+i,n.blx+e,n.bly+i)):o.spritesheeted?t.quadTex(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly,o.sheetTex):t.quad(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly)},i.getImagePointIndexByName=function(t){for(var e=this.curFrame,i=0,o=e.image_points.length;i<o;i++)if(cr.equals_nocase(t,e.image_points[i][0]))return i;return-1},i.getImagePoint=function(t,e){var i=this.curFrame,o=i.image_points,n=cr.is_string(t)?this.getImagePointIndexByName(t):t-1;if((n=cr.floor(n))<0||n>=o.length)return e?this.x:this.y;var s=(o[n][1]-i.hotspotX)*this.width,t=((t=o[n][2])-i.hotspotY)*this.height,o=Math.cos(this.angle),n=Math.sin(this.angle),i=s*o-t*n;return t=t*o+s*n,s=i,s+=this.x,t+=this.y,e?s:t};var r=[];function g(t){t[0]=0,t[1]=0,t[2]=0,r.push(t)}function b(t,e){return t<e?t+","+e:e+","+t}function v(t,e,i,o){var n=e.uid,s=i.uid,e=b(n,s);t.hasOwnProperty(e)?t[e][2]=o:((i=r.length?r.pop():[0,0,0])[0]=n,i[1]=s,i[2]=o,t[e]=i)}var B=-2,D=[];o.prototype.OnCollision=function(t){if(!t)return!1;var e=this.runtime,i=e.getCurrentCondition(),o=i.type,n=null;i.extra.collmemory?n=i.extra.collmemory:(n={},i.extra.collmemory=n),i.extra.spriteCreatedDestroyCallback||(i.extra.spriteCreatedDestroyCallback=!0,e.addDestroyCallback(function(n){!function(t){var e,i,o=n.uid;for(e in t)t.hasOwnProperty(e)&&((i=t[e])[0]!==o&&i[1]!==o||(g(t[e]),delete t[e]))}(i.extra.collmemory)}));for(var s,r,a,h,l,c,m,u=o.getCurrentSol(),p=t.getCurrentSol(),y=u.getObjects(),_=this.runtime.tickcount,d=_-1,f=e.getCurrentEventStack().current_event,x=(f.orblock,0);x<y.length;x++){for(r=y[x],p.select_all?(r.update_bbox(),this.runtime.getCollisionCandidates(r.layer,t,r.bbox,D),s=D,this.runtime.addRegisteredCollisionCandidates(r,t,s)):s=p.getObjects(),a=0;a<s.length;a++)l=s[a],e.testOverlap(r,l)||e.checkRegisteredCollision(r,l)?(c=n,m=l,m=b(r.uid,m.uid),m=!(c.hasOwnProperty(m)?(B=c[m][2],!0):!(B=-2))||B<d,v(n,r,l,_),m&&(e.pushCopySol(f.solModifiers),m=o.getCurrentSol(),h=t.getCurrentSol(),m.select_all=!1,h.select_all=!1,o===t?(m.instances.length=2,m.instances[0]=r,m.instances[1]=l,o.applySolToContainer()):(m.instances.length=1,h.instances.length=1,m.instances[0]=r,h.instances[0]=l,o.applySolToContainer(),t.applySolToContainer()),f.retrigger(),e.popSol(f.solModifiers))):(h=n,l=l,l=b(r.uid,l.uid),h.hasOwnProperty(l)&&(g(h[l]),delete h[l]));cr.clearArray(D)}return!1};var _=null,d=new cr.ObjectSet,f=!1,x=[],C=new cr.rect(0,0,0,0);function s(t,e,i){if(!t)return!1;var o,n,s,r,a,h=0!==e||0!==i,l=!1,c=this.runtime.getCurrentCondition(),m=c.type,u=c.inverted,p=t.getCurrentSol(),c=this.runtime.getCurrentEventStack().current_event.orblock,y=p.select_all?(this.update_bbox(),C.copy(this.bbox),C.offset(e,i),this.runtime.getCollisionCandidates(this.layer,t,C,x),x):!c||this.runtime.isCurrentConditionFirst()&&!p.else_instances.length&&p.instances.length?p.instances:p.else_instances;for(f=m!==(_=t)&&!u,h&&(o=this.x,n=this.y,this.x+=e,this.y+=i,this.set_bbox_changed()),s=0,r=y.length;s<r;s++)if(a=y[s],this.runtime.testOverlap(this,a)){if(l=!0,u)break;m!==t&&d.add(a)}return h&&(this.x=o,this.y=n,this.set_bbox_changed()),cr.clearArray(x),l}function a(){}function h(){}e.finish=function(t){if(f){if(t){var e,t=this.runtime.getCurrentEventStack().current_event.orblock,i=_.getCurrentSol(),o=d.valuesRef();if(i.select_all){for(i.select_all=!1,cr.clearArray(i.instances),s=0,r=o.length;s<r;++s)i.instances[s]=o[s];if(t)for(cr.clearArray(i.else_instances),s=0,r=_.instances.length;s<r;++s)e=_.instances[s],d.contains(e)||i.else_instances.push(e)}else if(t)for(var n=i.instances.length,s=0,r=o.length;s<r;++s)i.instances[n+s]=o[s],cr.arrayFindRemove(i.else_instances,o[s]);else cr.shallowAssignArray(i.instances,o);_.applySolToContainer()}d.clear(),f=!1}},o.prototype.IsOverlapping=function(t){return s.call(this,t,0,0)},o.prototype.IsOverlappingOffset=function(t,e,i){return s.call(this,t,e,i)},o.prototype.IsAnimPlaying=function(t){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,t):cr.equals_nocase(this.cur_animation.name,t)},o.prototype.CompareFrame=function(t,e){return cr.do_cmp(this.cur_frame,t,e)},o.prototype.CompareAnimSpeed=function(t,e){var i=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(i,t,e)},o.prototype.OnAnimFinished=function(t){return cr.equals_nocase(this.animTriggerName,t)},o.prototype.OnAnyAnimFinished=function(){return!0},o.prototype.OnFrameChanged=function(){return!0},o.prototype.IsMirrored=function(){return this.width<0},o.prototype.IsFlipped=function(){return this.height<0},o.prototype.OnURLLoaded=function(){return!0},o.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},t.cnds=new o,a.prototype.Spawn=function(t,e,i){if(t&&e){var o,n,s,r=this.runtime.createInstance(t,e,this.getImagePoint(i,!0),this.getImagePoint(i,!1));if(r){if(void 0!==r.angle&&(r.angle=this.angle,r.set_bbox_changed()),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,r),r.is_contained)for(o=0,n=r.siblings.length;o<n;o++)s=r.siblings[o],this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated,s);this.runtime.isInOnDestroy--;var a,i=this.runtime.getCurrentAction(),h=!1;if((cr.is_undefined(i.extra.Spawn_LastExec)||i.extra.Spawn_LastExec<this.runtime.execcount)&&(h=!0,i.extra.Spawn_LastExec=this.runtime.execcount),t!=this.type&&((a=t.getCurrentSol()).select_all=!1,h?(cr.clearArray(a.instances),a.instances[0]=r):a.instances.push(r),r.is_contained))for(o=0,n=r.siblings.length;o<n;o++)(a=(s=r.siblings[o]).type.getCurrentSol()).select_all=!1,h?(cr.clearArray(a.instances),a.instances[0]=s):a.instances.push(s)}}},a.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},a.prototype.StopAnim=function(){this.animPlaying=!1},a.prototype.StartAnim=function(t){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===t&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},a.prototype.SetAnim=function(t,e){this.changeAnimName=t,this.changeAnimFrom=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},a.prototype.SetAnimFrame=function(t){this.changeAnimFrame=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},a.prototype.SetAnimSpeed=function(t){this.cur_anim_speed=cr.abs(t),this.animForwards=0<=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},a.prototype.SetAnimRepeatToFrame=function(t){(t=Math.floor(t))<0&&(t=0),t>=this.cur_animation.frames.length&&(t=this.cur_animation.frames.length-1),this.cur_anim_repeatto=t},a.prototype.SetMirrored=function(t){t=cr.abs(this.width)*(0===t?-1:1);this.width!==t&&(this.width=t,this.set_bbox_changed())},a.prototype.SetFlipped=function(t){t=cr.abs(this.height)*(0===t?-1:1);this.height!==t&&(this.height=t,this.set_bbox_changed())},a.prototype.SetScale=function(t){var e=this.curFrame,i=this.width<0?-1:1,o=this.height<0?-1:1,i=e.width*t*i,o=e.height*t*o;this.width===i&&this.height===o||(this.width=i,this.height=o,this.set_bbox_changed())},a.prototype.LoadURL=function(t,e,i){var o=new Image,n=this,s=this.curFrame;o.onload=function(){if(s.texture_img.src===o.src)return n.runtime.glwrap&&n.curFrame===s&&(n.curWebGLTexture=s.webGL_texture),0===e&&(n.width=o.width,n.height=o.height,n.set_bbox_changed()),n.runtime.redraw=!0,void n.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,n);s.texture_img=o,s.offx=0,s.offy=0,s.width=o.width,s.height=o.height,s.spritesheeted=!1,s.datauri="",s.pixelformat=0,n.runtime.glwrap&&(s.webGL_texture&&n.runtime.glwrap.deleteTexture(s.webGL_texture),s.webGL_texture=n.runtime.glwrap.loadTexture(o,!1,n.runtime.linearSampling),n.curFrame===s&&(n.curWebGLTexture=s.webGL_texture),n.type.updateAllCurrentTexture()),0===e&&(n.width=o.width,n.height=o.height,n.set_bbox_changed()),n.runtime.redraw=!0,n.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,n)},"data:"!==t.substr(0,5)&&0===i&&(o.crossOrigin="anonymous"),this.runtime.setImageSrc(o,t)},a.prototype.SetCollisions=function(t){this.collisionsEnabled!==(0!==t)&&(this.collisionsEnabled=0!==t,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},t.acts=new a,h.prototype.AnimationFrame=function(t){t.set_int(this.cur_frame)},h.prototype.AnimationFrameCount=function(t){t.set_int(this.cur_animation.frames.length)},h.prototype.AnimationName=function(t){t.set_string(this.cur_animation.name)},h.prototype.AnimationSpeed=function(t){t.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},h.prototype.ImagePointX=function(t,e){t.set_float(this.getImagePoint(e,!0))},h.prototype.ImagePointY=function(t,e){t.set_float(this.getImagePoint(e,!1))},h.prototype.ImagePointCount=function(t){t.set_int(this.curFrame.image_points.length)},h.prototype.ImageWidth=function(t){t.set_float(this.curFrame.width)},h.prototype.ImageHeight=function(t){t.set_float(this.curFrame.height)},t.exps=new h}(),cr.plugins_.Spritefont2=function(t){this.runtime=t},function(){var t=cr.plugins_.Spritefont2.prototype;t.onCreate=function(){},t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function u(t){return t.replace(/\s\s*$/,"")}e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.crossOrigin="anonymous",this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime},(e=t.Instance.prototype).onDestroy=function(){var t;h(this.lines),t=this.clipList,o(b,t,!1),t=this.clipUV,o(v,t,!1),cr.wipe(this.characterWidthList)},e.onCreate=function(){this.texture_img=this.type.texture_img,this.characterWidth=this.properties[0],this.characterHeight=this.properties[1],this.characterSet=this.properties[2],this.text=this.properties[3],this.characterScale=this.properties[4],this.visible=0===this.properties[5],this.halign=this.properties[6]/2,this.valign=this.properties[7]/2,this.wrapbyword=0===this.properties[9],this.characterSpacing=this.properties[10],this.lineHeight=this.properties[11],this.textWidth=0,this.textHeight=0,this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={}),this.text_changed=!0,this.lastwrapwidth=this.width,this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture),this.SplitSheet()},e.saveToJSON=function(){var t,e={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}};for(t in this.characterWidthList)e.cw[t]=this.characterWidthList[t];return e},e.loadFromJSON=function(t){for(var e in this.text=t.t,this.characterScale=t.csc,this.characterSpacing=t.csp,this.lineHeight=t.lh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,t.hasOwnProperty("ha")&&(this.halign=t.ha),t.hasOwnProperty("va")&&(this.valign=t.va),t.cw)this.characterWidthList[e]=t.cw[e];this.text_changed=!0,this.lastwrapwidth=this.width};var i=1e3;function g(t,e){return t.length?t.pop():new e}function p(t,e){t.length<i&&t.push(e)}function o(t,e,i){if(i){for(var o=0,n=e.length;o<n;o++)p(t,e[o]);cr.clearArray(e)}else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(p(t,e[s]),delete e[s])}function y(t,e,i){var o=t.lines;i=u(i),e>=o.length&&o.push(a()),(e=o[e]).text=i,e.width=t.measureWidth(i),t.textWidth=cr.max(t.textWidth,e.width)}var _=[];function a(){return g(_,Object)}function h(t){o(_,t,!0)}var b=[],v=[];e.SplitSheet=function(){for(var t,e,i,o,n,s,r=this.texture_img,a=r.width,r=r.height,h=this.characterWidth,l=this.characterHeight,c=h/a,m=l/r,u=this.characterSet,p=Math.floor(a/h),y=Math.floor(r/l),_=0;_<u.length&&!(p*y<=_);_++){var d=_%p,f=Math.floor(_/p),x=u.charAt(_);this.runtime.glwrap?(t=this.clipUV,i=d*c,o=f*m,n=(1+d)*c,s=(f+1)*m,void 0===t[e=x]&&(t[e]=g(v,cr.rect)),t[e].left=i,t[e].top=o,t[e].right=n,t[e].bottom=s):(t=this.clipList,e=d*h,s=f*l,d=h,f=l,void 0===t[x=x]&&(t[x]=g(b,Object)),t[x].x=e,t[x].y=s,t[x].w=d,t[x].h=f)}};var d=[];t.TokeniseWords=function(t){cr.clearArray(d);for(var e,i="",o=0;o<t.length;)if("\n"===(e=t.charAt(o)))i.length&&(d.push(i),i=""),d.push("\n"),++o;else if(" "===e||"\t"===e||"-"===e){for(;i+=t.charAt(o),o++,o<t.length&&(" "===t.charAt(o)||"\t"===t.charAt(o)););d.push(i),i=""}else o<t.length&&(i+=e,o++);i.length&&d.push(i)},t.WordWrap=function(t){var e=t.text,i=t.lines;if(e&&e.length){var o=t.width;if(o<=2)h(i);else{var n=t.characterWidth,s=t.characterScale,r=t.characterSpacing;if(e.length*(n*s+r)-r<=o&&-1===e.indexOf("\n")){r=t.measureWidth(e);if(r<=o)return h(i),i.push(a()),i[0].text=e,i[0].width=r,t.textWidth=r,void(t.textHeight=t.characterHeight*s+t.lineHeight)}t.wrapbyword;this.WrapText(t),t.textHeight=i.length*(t.characterHeight*s+t.lineHeight)}}else h(i)},t.WrapText=function(t){for(var e,i,o=t.wrapbyword,n=t.text,s=t.lines,r=t.width,a=o?(this.TokeniseWords(n),d):n,h="",l=0,c=!1,m=0;m<a.length;m++)"\n"!==a[m]?(c=!1,e=h,h+=a[m],r<t.measureWidth(u(h))&&(""===e?(y(t,l,h),c=!(h="")):(y(t,l,e),h=a[m]),l++,o||" "!==h||(h=""))):(!0===c?c=!1:(y(t,l,h),l++),h="");for(u(h).length&&(y(t,l,h),l++),m=l;m<s.length;m++)i=s[m],p(_,i);s.length=l},e.measureWidth=function(t){for(var e=this.characterSpacing,i=t.length,o=0,n=0;n<i;n++)o+=this.getCharacterWidth(t.charAt(n))*this.characterScale+e;return o-=0<o?e:0},e.getCharacterWidth=function(t){var e=this.characterWidthList;return void 0!==e[t]?e[t]:this.characterWidth},e.rebuildText=function(){!this.text_changed&&this.width===this.lastwrapwidth||(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)},e.draw=function(t,e){var i=this.texture_img;if(""!==this.text&&null!=i&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){t.globalAlpha=this.opacity;var o=this.x,n=this.y;this.runtime.pixel_rounding&&(o=Math.round(o),n=Math.round(n));var s=this.layer.viewLeft,r=this.layer.viewTop,a=this.layer.viewRight,h=this.layer.viewBottom;t.save(),t.translate(o,n),t.rotate(this.angle);for(var l,c=this.angle,m=this.halign,u=this.valign,p=this.characterScale,y=this.characterHeight*p,_=this.lineHeight,d=this.characterSpacing,f=this.lines,i=this.textHeight,u=u*cr.max(0,this.height-i),x=-(this.hotspotX*this.width),i=-(this.hotspotY*this.height),g=i+=u,b=0;b<f.length;b++){var v=f[b].text,B=f[b].width,D=x+m*cr.max(0,this.width-B);if(g+=_,0===c&&n+g+y<r)g+=y;else{for(var C=0;C<v.length;C++){var w=v.charAt(C),S=this.getCharacterWidth(w),A=this.clipList[w];if(0===c&&o+D+S*p+d<s)D+=S*p+d;else{if(D+S*p>this.width+1e-5)break;if(void 0!==A&&(l=D,w=g,0===c&&1===p&&(l=Math.round(l),w=Math.round(w)),t.drawImage(this.texture_img,A.x,A.y,A.w,A.h,l,w,A.w*p,A.h*p)),D+=S*p+d,0===c&&a<o+D)break}}if(g+=y,0===c&&(g+y+_>this.height||h<n+g))break}}t.restore()}};var V=new cr.quad;function n(){}function s(){}function r(){}e.drawGL=function(t){if(t.setTexture(this.webGL_texture),t.setOpacity(this.opacity),this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var e=this.bquad,i=0,o=0;this.runtime.pixel_rounding&&(i=Math.round(this.x)-this.x,o=Math.round(this.y)-this.y);var n,s,r=this.layer.viewLeft,a=this.layer.viewTop,h=this.layer.viewRight,l=this.layer.viewBottom,c=this.angle,m=this.halign,u=this.valign,p=this.characterScale,y=this.characterHeight*p,_=this.lineHeight,d=this.characterSpacing,f=this.lines,x=this.textHeight;0!==c&&(n=Math.cos(c),s=Math.sin(c));for(var x=u*cr.max(0,this.height-x),g=e.tlx+i,b=e.tly+o,v=x,B=0;B<f.length;B++){var D=f[B].text,C=f[B].width,w=m*cr.max(0,this.width-C);if(v+=_,0===c&&b+v+y<a)v+=y;else{for(var S=0;S<D.length;S++){var A,M,T,I=D.charAt(S),P=this.getCharacterWidth(I),L=this.clipUV[I];if(0===c&&g+w+P*p+d<r)w+=P*p+d;else{if(w+P*p>this.width+1e-5)break;if(void 0!==L&&(A=this.characterWidth*p,M=this.characterHeight*p,T=w,I=v,0===c&&1===p&&(T=Math.round(T),I=Math.round(I)),V.tlx=T,V.tly=I,V.trx=T+A,V.try_=I,V.blx=T,V.bly=I+M,V.brx=T+A,V.bry=I+M,0!==c&&(T=n,A=s,I=void 0,I=(M=V).tlx*T-M.tly*A,M.tly=M.tly*T+M.tlx*A,M.tlx=I,I=M.trx*T-M.try_*A,M.try_=M.try_*T+M.trx*A,M.trx=I,I=M.blx*T-M.bly*A,M.bly=M.bly*T+M.blx*A,M.blx=I,I=M.brx*T-M.bry*A,M.bry=M.bry*T+M.brx*A,M.brx=I),V.offset(g,b),t.quadTex(V.tlx,V.tly,V.trx,V.try_,V.brx,V.bry,V.blx,V.bly,L)),w+=P*p+d,0===c&&h<g+w)break}}if(v+=y,0===c&&(v+y+_>this.height||l<b+v))break}}}},n.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},t.cnds=new n,s.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);t=t.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);t=t.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetScale=function(t){t!==this.characterScale&&(this.characterScale=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetCharacterSpacing=function(t){t!==this.CharacterSpacing&&(this.characterSpacing=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetLineHeight=function(t){t!==this.lineHeight&&(this.lineHeight=t,this.text_changed=!0,this.runtime.redraw=!0)},e.SetCharWidth=function(t,e){e=parseInt(e,10);this.characterWidthList[t]!==e&&(this.characterWidthList[t]=e,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetCharacterWidth=function(t,e){if(""!==t)for(var i=0;i<t.length;i++)this.SetCharWidth(t.charAt(i),e)},s.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},s.prototype.SetHAlign=function(t){this.halign=t/2,this.text_changed=!0,this.runtime.redraw=!0},s.prototype.SetVAlign=function(t){this.valign=t/2,this.text_changed=!0,this.runtime.redraw=!0},t.acts=new s,r.prototype.CharacterWidth=function(t,e){t.set_int(this.getCharacterWidth(e))},r.prototype.CharacterHeight=function(t){t.set_int(this.characterHeight)},r.prototype.CharacterScale=function(t){t.set_float(this.characterScale)},r.prototype.CharacterSpacing=function(t){t.set_int(this.characterSpacing)},r.prototype.LineHeight=function(t){t.set_int(this.lineHeight)},r.prototype.Text=function(t){t.set_string(this.text)},r.prototype.TextWidth=function(t){this.rebuildText(),t.set_float(this.textWidth)},r.prototype.TextHeight=function(t){this.rebuildText(),t.set_float(this.textHeight)},t.exps=new r}(),cr.plugins_.Text=function(t){this.runtime=t},function(){var t=cr.plugins_.Text.prototype;t.onCreate=function(){t.acts.SetWidth=function(t){this.width!==t&&(this.width=t,this.text_changed=!0,this.set_bbox_changed())}},t.Type=function(t){this.plugin=t,this.runtime=t.runtime},(e=t.Type.prototype).onCreate=function(){},e.onLostWebGLContext=function(){if(!this.is_family)for(var t,e=0,i=this.instances.length;e<i;e++)(t=this.instances[e]).mycanvas=null,t.myctx=null,t.mytex=null},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.recycled?cr.clearArray(this.lines):this.lines=[],this.text_changed=!0};var e=t.Instance.prototype,r={};e.onCreate=function(){this.text=this.properties[0],this.visible=0===this.properties[1],this.font=this.properties[2],this.color=this.properties[3],this.halign=this.properties[4],this.valign=this.properties[5],this.wrapbyword=0===this.properties[7],this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height,this.line_height_offset=this.properties[8],this.facename="",this.fontstyle="",this.ptSize=0,this.textWidth=0,this.textHeight=0,this.parseFont(),this.mycanvas=null,this.myctx=null,this.mytex=null,this.need_text_redraw=!1,this.last_render_tick=this.runtime.tickcount,this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1),this.runtime.glwrap&&this.runtime.tickMe(this)},e.parseFont=function(){for(var t=this.font.split(" "),e=0;e<t.length;e++)if("pt"===t[e].substr(t[e].length-2,2)){for(this.ptSize=parseInt(t[e].substr(0,t[e].length-2)),this.pxHeight=Math.ceil(this.ptSize/72*96)+4,0<e&&(this.fontstyle=t[e-1]),this.facename=t[e+1],e+=2;e<t.length;e++)this.facename+=" "+t[e];break}},e.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}},e.loadFromJSON=function(t){this.text=t.t,this.font=t.f,this.color=t.c,this.halign=t.ha,this.valign=t.va,this.wrapbyword=t.wr,this.line_height_offset=t.lho,this.facename=t.fn,this.fontstyle=t.fs,this.ptSize=t.ps,this.pxHeight=t.pxh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,this.text_changed=!0,this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height},e.tick=function(){var t,e;this.runtime.glwrap&&this.mytex&&300<=this.runtime.tickcount-this.last_render_tick&&(t=this.layer,this.update_bbox(),((e=this.bbox).right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)&&(this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null,this.myctx=null,this.mycanvas=null))},e.onDestroy=function(){this.myctx=null,this.mycanvas=null,this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null},e.updateFont=function(){this.font=this.fontstyle+" "+this.ptSize.toString()+"pt "+this.facename,this.text_changed=!0,this.runtime.redraw=!0},e.draw=function(t,e){t.font=this.font,t.textBaseline="top",t.fillStyle=this.color,t.globalAlpha=e?1:this.opacity;var i;e&&(i=Math.abs(this.layer.getScale()),t.save(),t.scale(i,i)),!this.text_changed&&this.width===this.lastwrapwidth||(this.type.plugin.WordWrap(this.text,this.lines,t,this.width,this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width),this.update_bbox();var o=e?0:this.bquad.tlx,n=e?0:this.bquad.tly;this.runtime.pixel_rounding&&(o=o+.5|0,n=n+.5|0),0===this.angle||e||(t.save(),t.translate(o,n),t.rotate(this.angle),n=o=0);var s,r,a=n+this.height,h=this.pxHeight;for(h+=this.line_height_offset,1===this.valign?n+=Math.max(this.height/2-this.lines.length*h/2,0):2===this.valign&&(n+=Math.max(this.height-this.lines.length*h-2,0)),r=0;r<this.lines.length&&(s=o,1===this.halign?s=o+(this.width-this.lines[r].width)/2:2===this.halign&&(s=o+(this.width-this.lines[r].width)),t.fillText(this.lines[r].text,s,n),!(a-h<=(n+=h)));r++);0===this.angle&&!e||t.restore(),this.last_render_tick=this.runtime.tickcount},e.drawGL=function(t){var e,i,o,n,s,r,a,h,l,c,m,u,p,y,_,d,f;this.width<1||this.height<1||(u=this.text_changed||this.need_text_redraw,this.need_text_redraw=!1,e=this.layer.getScale(),i=this.layer.getAngle(),o=this.rcTex,n=e*this.width,s=e*this.height,r=Math.ceil(n),a=Math.ceil(s),p=Math.abs(r),y=Math.abs(a),_=this.runtime.draw_width/2,d=this.runtime.draw_height/2,this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=p,this.mycanvas.height=y,this.lastwidth=p,this.lastheight=y,u=!0,this.myctx=this.mycanvas.getContext("2d")),p===this.lastwidth&&y===this.lastheight||(this.mycanvas.width=p,this.mycanvas.height=y,this.mytex&&(t.deleteTexture(this.mytex),this.mytex=null),u=!0),u&&(this.myctx.clearRect(0,0,p,y),this.draw(this.myctx,!0),this.mytex||(this.mytex=t.createEmptyTexture(p,y,this.runtime.linearSampling,this.runtime.isMobile)),t.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile)),this.lastwidth=p,this.lastheight=y,t.setTexture(this.mytex),t.setOpacity(this.opacity),t.resetModelView(),t.translate(-_,-d),t.updateModelView(),f=this.bquad,h=this.layer.layerToCanvas(f.tlx,f.tly,!0,!0),l=this.layer.layerToCanvas(f.tlx,f.tly,!1,!0),c=this.layer.layerToCanvas(f.trx,f.try_,!0,!0),m=this.layer.layerToCanvas(f.trx,f.try_,!1,!0),u=this.layer.layerToCanvas(f.brx,f.bry,!0,!0),p=this.layer.layerToCanvas(f.brx,f.bry,!1,!0),y=this.layer.layerToCanvas(f.blx,f.bly,!0,!0),_=this.layer.layerToCanvas(f.blx,f.bly,!1,!0),(this.runtime.pixel_rounding||0===this.angle&&0===i)&&(h+=d=(h+.5|0)-h,l+=f=(l+.5|0)-l,c+=d,m+=f,u+=d,p+=f,y+=d,_+=f),0===this.angle&&0===i?(u=c=h+r,y=h,_=p=(m=l)+a,o.right=1,o.bottom=1):(o.right=n/r,o.bottom=s/a),t.quadTex(h,l,c,m,u,p,y,_,o),t.resetModelView(),t.scale(e,e),t.rotateZ(-this.layer.getAngle()),t.translate((this.layer.viewLeft+this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2),t.updateModelView(),this.last_render_tick=this.runtime.tickcount)};var m=[];t.TokeniseWords=function(t){cr.clearArray(m);for(var e,i="",o=0;o<t.length;)if("\n"===(e=t.charAt(o)))i.length&&(m.push(i),i=""),m.push("\n"),++o;else if(" "===e||"\t"===e||"-"===e){for(;i+=t.charAt(o),o++,o<t.length&&(" "===t.charAt(o)||"\t"===t.charAt(o)););m.push(i),i=""}else o<t.length&&(i+=e,o++);i.length&&m.push(i)};var i=[];function u(){return i.length?i.pop():{}}function p(t){i.push(t)}function a(t){for(var e=0,i=t.length;e<i;e++)p(t[e]);cr.clearArray(t)}function y(t){return t.length&&" "===t.charAt(t.length-1)?t.substring(0,t.length-1):t}function o(){}function n(){}function s(){}t.WordWrap=function(t,e,i,o,n){if(t&&t.length)if(o<=2)a(e);else{if(t.length<=100&&-1===t.indexOf("\n")){var s=i.measureText(t).width;if(s<=o)return a(e),e.push(u()),e[0].text=t,void(e[0].width=s)}this.WrapText(t,e,i,o,n)}else a(e)},t.WrapText=function(t,e,i,o,n){for(var s,r,a=n?(this.TokeniseWords(t),m):t,h="",l=0,c=0;c<a.length;c++)"\n"!==a[c]?(s=h,h+=a[c],o<=i.measureText(h).width&&(l>=e.length&&e.push(u()),s=y(s),(r=e[l]).text=s,r.width=i.measureText(s).width,l++,h=a[c],n||" "!==h||(h=""))):(l>=e.length&&e.push(u()),h=y(h),(r=e[l]).text=h,r.width=i.measureText(h).width,l++,h="");for(h.length&&(l>=e.length&&e.push(u()),h=y(h),(r=e[l]).text=h,r.width=i.measureText(h).width,l++),c=l;c<e.length;c++)p(e[c]);e.length=l},o.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},t.cnds=new o,n.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);t=t.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)},n.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);t=t.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)},n.prototype.SetFontFace=function(t,e){var i="";switch(e){case 1:i="bold";break;case 2:i="italic";break;case 3:i="bold italic"}t===this.facename&&i===this.fontstyle||(this.facename=t,this.fontstyle=i,this.updateFont())},n.prototype.SetFontSize=function(t){this.ptSize!==t&&(this.ptSize=t,this.pxHeight=Math.ceil(this.ptSize/72*96)+4,this.updateFont())},n.prototype.SetFontColor=function(t){t="rgb("+cr.GetRValue(t).toString()+","+cr.GetGValue(t).toString()+","+cr.GetBValue(t).toString()+")";t!==this.color&&(this.color=t,this.need_text_redraw=!0,this.runtime.redraw=!0)},n.prototype.SetWebFont=function(t,e){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");else{function i(){o.runtime.redraw=!0,o.text_changed=!0}var o=this;if(r.hasOwnProperty(e)){var n="'"+t+"'";if(this.facename!==n){this.facename=n,this.updateFont();for(var s=1;s<10;s++)setTimeout(i,100*s),setTimeout(i,1e3*s)}}else{n=document.createElement("link");n.href=e,n.rel="stylesheet",n.type="text/css",n.onload=i,document.getElementsByTagName("head")[0].appendChild(n),r[e]=!0,this.facename="'"+t+"'",this.updateFont();for(s=1;s<10;s++)setTimeout(i,100*s),setTimeout(i,1e3*s)}}},n.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},t.acts=new n,s.prototype.Text=function(t){t.set_string(this.text)},s.prototype.FaceName=function(t){t.set_string(this.facename)},s.prototype.FaceSize=function(t){t.set_int(this.ptSize)},s.prototype.TextWidth=function(t){for(var e,i=0,o=0,n=this.lines.length;o<n;o++)i<(e=this.lines[o].width)&&(i=e);t.set_int(i)},s.prototype.TextHeight=function(t){t.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)},t.exps=new s}(),cr.plugins_.TiledBg=function(t){this.runtime=t},function(){var t=cr.plugins_.TiledBg.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function i(){}function o(){}function n(){}e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.crossOrigin="anonymous",this.texture_img.cr_filesize=this.texture_filesize,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.pattern=null,this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime},(e=t.Instance.prototype).onCreate=function(){this.visible=0===this.properties[0],this.rcTex=new cr.rect(0,0,0,0),this.has_own_texture=!1,this.texture_img=this.type.texture_img,this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)},e.afterLoad=function(){this.has_own_texture=!1,this.texture_img=this.type.texture_img},e.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.draw=function(t){t.globalAlpha=this.opacity,t.save(),t.fillStyle=this.pattern;var e=this.x,i=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i));var o=-(this.hotspotX*this.width),n=-(this.hotspotY*this.height),s=o%this.texture_img.width,r=n%this.texture_img.height;s<0&&(s+=this.texture_img.width),r<0&&(r+=this.texture_img.height),t.translate(e,i),t.rotate(this.angle),t.translate(s,r),t.fillRect(o-s,n-r,this.width,this.height),t.restore()},e.drawGL_earlyZPass=function(t){this.drawGL(t)},e.drawGL=function(t){t.setTexture(this.webGL_texture),t.setOpacity(this.opacity);var e=this.rcTex;e.right=this.width/this.texture_img.width,e.bottom=this.height/this.texture_img.height;var i,o,n=this.bquad;this.runtime.pixel_rounding?(i=Math.round(this.x)-this.x,o=Math.round(this.y)-this.y,t.quadTex(n.tlx+i,n.tly+o,n.trx+i,n.try_+o,n.brx+i,n.bry+o,n.blx+i,n.bly+o,e)):t.quadTex(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly,e)},i.prototype.OnURLLoaded=function(){return!0},t.cnds=new i,o.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},o.prototype.LoadURL=function(t,e){var i=new Image,o=this;i.onload=function(){o.texture_img=i,o.runtime.glwrap?(o.has_own_texture&&o.webGL_texture&&o.runtime.glwrap.deleteTexture(o.webGL_texture),o.webGL_texture=o.runtime.glwrap.loadTexture(i,!0,o.runtime.linearSampling)):o.pattern=o.runtime.ctx.createPattern(i,"repeat"),o.has_own_texture=!0,o.runtime.redraw=!0,o.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,o)},"data:"!==t.substr(0,5)&&0===e&&(i.crossOrigin="anonymous"),this.runtime.setImageSrc(i,t)},t.acts=new o,n.prototype.ImageWidth=function(t){t.set_float(this.texture_img.width)},n.prototype.ImageHeight=function(t){t.set_float(this.texture_img.height)},t.exps=new n}(),cr.plugins_.Touch=function(t){this.runtime=t},function(){var t=cr.plugins_.Touch.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.touches=[],this.mouseDown=!1};var e=t.Instance.prototype,c={left:0,top:0};e.findTouch=function(t){for(var e=0,i=this.touches.length;e<i;e++)if(this.touches[e].id===t)return e;return-1};var i=0,o=0,n=0;function a(t){i=t.x,o=t.y,n=t.z}var s=[];function h(t,e,i,o){var n=s.length?s.pop():new l;return n.init(t,e,i,o),n}function r(t){s.length<100&&s.push(t)}function l(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}l.prototype.init=function(t,e,i,o){var n=cr.performance_now();this.time=n,this.lasttime=n,this.starttime=n,this.startx=t,this.starty=e,this.x=t,this.y=e,this.lastx=t,this.lasty=e,this.width=0,this.height=0,this.pressure=0,this.id=i,this.startindex=o,this.triggeredHold=!1,this.tooFarForHold=!1},l.prototype.update=function(t,e,i,o,n,s){this.lasttime=this.time,this.time=t,this.lastx=this.x,this.lasty=this.y,this.x=e,this.y=i,this.width=o,this.height=n,this.pressure=s,!this.tooFarForHold&&15<=cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.tooFarForHold=!0)},l.prototype.maybeTriggerHold=function(t,e){this.triggeredHold||500<=cr.performance_now()-this.starttime&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(this.triggeredHold=!0,t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,t),t.getTouchIndex=0)};var m=-1e3,u=-1e3,p=-1e4;function y(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents}function _(){}l.prototype.maybeTriggerTap=function(t,e){var i;this.triggeredHold||(i=cr.performance_now())-this.starttime<=333&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,p=i-p<=666&&cr.distanceTo(m,u,this.x,this.y)<25?(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,t),u=m=-1e3,-1e4):(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,t),m=this.x,u=this.y,i),t.getTouchIndex=0)},e.onCreate=function(){this.isWindows8=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.getTouchIndex=0,this.useMouseInput=0!==this.properties[0];var t=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,e=document;this.runtime.isDirectCanvas?e=t=window.Canvas:this.runtime.isCocoonJs&&(e=t=window);var i,o,n,s,r=this;"undefined"!=typeof PointerEvent?(t.addEventListener("pointerdown",function(t){r.onPointerStart(t)},!1),t.addEventListener("pointermove",function(t){r.onPointerMove(t)},!1),e.addEventListener("pointerup",function(t){r.onPointerEnd(t,!1)},!1),e.addEventListener("pointercancel",function(t){r.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(t){t.preventDefault()},!1),document.addEventListener("gesturehold",function(t){t.preventDefault()},!1))):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(t){r.onPointerStart(t)},!1),t.addEventListener("MSPointerMove",function(t){r.onPointerMove(t)},!1),e.addEventListener("MSPointerUp",function(t){r.onPointerEnd(t,!1)},!1),e.addEventListener("MSPointerCancel",function(t){r.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1))):(t.addEventListener("touchstart",function(t){r.onTouchStart(t)},!1),t.addEventListener("touchmove",function(t){r.onTouchMove(t)},!1),e.addEventListener("touchend",function(t){r.onTouchEnd(t,!1)},!1),e.addEventListener("touchcancel",function(t){r.onTouchEnd(t,!0)},!1)),this.isWindows8?(i=function(t){t=t.reading;r.acc_x=t.accelerationX,r.acc_y=t.accelerationY,r.acc_z=t.accelerationZ},o=function(t){t=t.reading;r.orient_alpha=t.yawDegrees,r.orient_beta=t.pitchDegrees,r.orient_gamma=t.rollDegrees},(n=Windows.Devices.Sensors.Accelerometer.getDefault())&&(n.reportInterval=Math.max(n.minimumReportInterval,16),n.addEventListener("readingchanged",i)),(s=Windows.Devices.Sensors.Inclinometer.getDefault())&&(s.reportInterval=Math.max(s.minimumReportInterval,16),s.addEventListener("readingchanged",o)),document.addEventListener("visibilitychange",function(t){document.hidden||document.msHidden?(n&&n.removeEventListener("readingchanged",i),s&&s.removeEventListener("readingchanged",o)):(n&&n.addEventListener("readingchanged",i),s&&s.addEventListener("readingchanged",o))},!1)):(window.addEventListener("deviceorientation",function(t){r.orient_alpha=t.alpha||0,r.orient_beta=t.beta||0,r.orient_gamma=t.gamma||0},!1),window.addEventListener("devicemotion",function(t){t.accelerationIncludingGravity&&(r.acc_g_x=t.accelerationIncludingGravity.x||0,r.acc_g_y=t.accelerationIncludingGravity.y||0,r.acc_g_z=t.accelerationIncludingGravity.z||0),t.acceleration&&(r.acc_x=t.acceleration.x||0,r.acc_y=t.acceleration.y||0,r.acc_z=t.acceleration.z||0)},!1)),this.useMouseInput&&!this.runtime.isDomFree&&(jQuery(document).mousemove(function(t){r.onMouseMove(t)}),jQuery(document).mousedown(function(t){r.onMouseDown(t)}),jQuery(document).mouseup(function(t){r.onMouseUp(t)})),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(a,null,{frequency:40}),this.runtime.tick2Me(this)},e.onPointerMove=function(t){var e,i,o;t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&t.preventDefault(),o=this.findTouch(t.pointerId),e=cr.performance_now(),0<=o&&(i=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset(),e-(o=this.touches[o]).time<2||o.update(e,t.pageX-i.left,t.pageY-i.top,t.width||0,t.height||0,t.pressure||0)))},e.onPointerStart=function(t){var e,i;t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),i=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset(),e=t.pageX-i.left,i=t.pageY-i.top,cr.performance_now(),this.trigger_index=this.touches.length,this.trigger_id=t.pointerId,this.touches.push(h(e,i,t.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=e,this.curTouchY=i,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1)},e.onPointerEnd=function(t,e){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),t=this.findTouch(t.pointerId),this.trigger_index=0<=t?this.touches[t].startindex:-1,this.trigger_id=0<=t?this.touches[t].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=t&&(e||this.touches[t].maybeTriggerTap(this,t),r(this.touches[t]),this.touches.splice(t,1)),this.runtime.isInUserInputEvent=!1)},e.onTouchMove=function(t){t.preventDefault&&t.preventDefault();for(var e,i=cr.performance_now(),o=0,n=t.changedTouches.length;o<n;o++){e=t.changedTouches[o];var s,r,a,h,l=this.findTouch(e.identifier);0<=l&&(s=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset(),i-(r=this.touches[l]).time<2||(a=2*(e.radiusX||e.webkitRadiusX||e.mozRadiusX||e.msRadiusX||0),h=2*(e.radiusY||e.webkitRadiusY||e.mozRadiusY||e.msRadiusY||0),l=e.force||e.webkitForce||e.mozForce||e.msForce||0,r.update(i,e.pageX-s.left,e.pageY-s.top,a,h,l)))}},e.onTouchStart=function(t){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var e,i,o=this.runtime.isDomFree?c:jQuery(this.runtime.canvas).offset();cr.performance_now();for(this.runtime.isInUserInputEvent=!0,e=0,i=t.changedTouches.length;e<i;e++){var n,s,r=t.changedTouches[e];-1===this.findTouch(r.identifier)&&(n=r.pageX-o.left,s=r.pageY-o.top,this.trigger_index=this.touches.length,this.trigger_id=r.identifier,this.touches.push(h(n,s,r.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=n,this.curTouchY=s,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this))}this.runtime.isInUserInputEvent=!1},e.onTouchEnd=function(t,e){var i,o,n;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.runtime.isInUserInputEvent=!0,i=0,o=t.changedTouches.length;i<o;i++)n=t.changedTouches[i],0<=(n=this.findTouch(n.identifier))&&(this.trigger_index=this.touches[n].startindex,this.trigger_id=this.touches[n].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),e||this.touches[n].maybeTriggerTap(this,n),r(this.touches[n]),this.touches.splice(n,1));this.runtime.isInUserInputEvent=!1},e.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==n?90*n:this.orient_alpha},e.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==o?90*o:this.orient_beta},e.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==i?90*i:this.orient_gamma},e.onMouseDown=function(t){y(t)||(t={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]},this.onTouchStart(t),this.mouseDown=!0)},e.onMouseMove=function(t){this.mouseDown&&(y(t)||(t={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]},this.onTouchMove(t)))},e.onMouseUp=function(t){t.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&t.preventDefault(),this.runtime.had_a_click=!0,y(t)||(t={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]},this.onTouchEnd(t),this.mouseDown=!1)},e.tick2=function(){for(var t,e=cr.performance_now(),i=0,o=this.touches.length;i<o;++i)(t=this.touches[i]).time<=e-50&&(t.lasttime=e),t.maybeTriggerHold(this,i)},_.prototype.OnTouchStart=function(){return!0},_.prototype.OnTouchEnd=function(){return!0},_.prototype.IsInTouch=function(){return this.touches.length},_.prototype.OnTouchObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)};var d=[];function f(){}_.prototype.IsTouchingObject=function(t){if(!t)return!1;for(var e,i,o=t.getCurrentSol(),n=o.getObjects(),s=0,r=n.length;s<r;s++){var a=n[s];for(a.update_bbox(),e=0,i=this.touches.length;e<i;e++){var h=this.touches[e],l=a.layer.canvasToLayer(h.x,h.y,!0),h=a.layer.canvasToLayer(h.x,h.y,!1);if(a.contains_pt(l,h)){d.push(a);break}}}return!!d.length&&(o.select_all=!1,cr.shallowAssignArray(o.instances,d),t.applySolToContainer(),cr.clearArray(d),!0)},_.prototype.CompareTouchSpeed=function(t,e,i){if((t=Math.floor(t))<0||t>=this.touches.length)return!1;var o=this.touches[t],t=cr.distanceTo(o.x,o.y,o.lastx,o.lasty),o=(o.time-o.lasttime)/1e3,o=0<o?t/o:0;return cr.do_cmp(o,e,i)},_.prototype.OrientationSupported=function(){return void 0!==window.DeviceOrientationEvent},_.prototype.MotionSupported=function(){return void 0!==window.DeviceMotionEvent},_.prototype.CompareOrientation=function(t,e,i){var o=0,o=0===t?this.getAlpha():1===t?this.getBeta():this.getGamma();return cr.do_cmp(o,e,i)},_.prototype.CompareAcceleration=function(t,e,i){var o=0;return 0===t?o=this.acc_g_x:1===t?o=this.acc_g_y:2===t?o=this.acc_g_z:3===t?o=this.acc_x:4===t?o=this.acc_y:5===t&&(o=this.acc_z),cr.do_cmp(o,e,i)},_.prototype.OnNthTouchStart=function(t){return(t=Math.floor(t))===this.trigger_index},_.prototype.OnNthTouchEnd=function(t){return(t=Math.floor(t))===this.trigger_index},_.prototype.HasNthTouch=function(t){return t=Math.floor(t),this.touches.length>=t+1},_.prototype.OnHoldGesture=function(){return!0},_.prototype.OnTapGesture=function(){return!0},_.prototype.OnDoubleTapGesture=function(){return!0},_.prototype.OnHoldGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},_.prototype.OnTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},_.prototype.OnDoubleTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},t.cnds=new _,f.prototype.TouchCount=function(t){t.set_int(this.touches.length)},f.prototype.X=function(t,e){var i,o,n,s,r,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(o=(i=this.runtime.getLayerByNumber(0)).scale,n=i.zoomRate,s=i.parallaxX,r=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)),i.scale=o,i.zoomRate=n,i.parallaxX=s,i.angle=r):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)):t.set_float(0)},f.prototype.XAt=function(t,e,i){var o,n,s,r,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(n=(o=this.runtime.getLayerByNumber(0)).scale,s=o.zoomRate,r=o.parallaxX,a=o.angle,o.scale=1,o.zoomRate=1,o.parallaxX=1,o.angle=0,t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)),o.scale=n,o.zoomRate=s,o.parallaxX=r,o.angle=a):(o=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)):t.set_float(0)},f.prototype.XForID=function(t,e,i){var o,n,s,r,a=this.findTouch(e);a<0?t.set_float(0):(o=this.touches[a],cr.is_undefined(i)?(s=(n=this.runtime.getLayerByNumber(0)).scale,r=n.zoomRate,e=n.parallaxX,a=n.angle,n.scale=1,n.zoomRate=1,n.parallaxX=1,n.angle=0,t.set_float(n.canvasToLayer(o.x,o.y,!0)),n.scale=s,n.zoomRate=r,n.parallaxX=e,n.angle=a):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(n.canvasToLayer(o.x,o.y,!0)):t.set_float(0))},f.prototype.Y=function(t,e){var i,o,n,s,r,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(o=(i=this.runtime.getLayerByNumber(0)).scale,n=i.zoomRate,s=i.parallaxY,r=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)),i.scale=o,i.zoomRate=n,i.parallaxY=s,i.angle=r):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)):t.set_float(0)},f.prototype.YAt=function(t,e,i){var o,n,s,r,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(n=(o=this.runtime.getLayerByNumber(0)).scale,s=o.zoomRate,r=o.parallaxY,a=o.angle,o.scale=1,o.zoomRate=1,o.parallaxY=1,o.angle=0,t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)),o.scale=n,o.zoomRate=s,o.parallaxY=r,o.angle=a):(o=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)):t.set_float(0)},f.prototype.YForID=function(t,e,i){var o,n,s,r,a=this.findTouch(e);a<0?t.set_float(0):(o=this.touches[a],cr.is_undefined(i)?(s=(n=this.runtime.getLayerByNumber(0)).scale,r=n.zoomRate,e=n.parallaxY,a=n.angle,n.scale=1,n.zoomRate=1,n.parallaxY=1,n.angle=0,t.set_float(n.canvasToLayer(o.x,o.y,!1)),n.scale=s,n.zoomRate=r,n.parallaxY=e,n.angle=a):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(n.canvasToLayer(o.x,o.y,!1)):t.set_float(0))},f.prototype.AbsoluteX=function(t){this.touches.length?t.set_float(this.touches[0].x):t.set_float(0)},f.prototype.AbsoluteXAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].x)},f.prototype.AbsoluteXForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.x))},f.prototype.AbsoluteY=function(t){this.touches.length?t.set_float(this.touches[0].y):t.set_float(0)},f.prototype.AbsoluteYAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].y)},f.prototype.AbsoluteYForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.y))},f.prototype.SpeedAt=function(t,e){var i;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):(i=this.touches[e],e=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),(i=(i.time-i.lasttime)/1e3)<=0?t.set_float(0):t.set_float(e/i))},f.prototype.SpeedForID=function(t,e){var i=this.findTouch(e);i<0?t.set_float(0):(e=this.touches[i],i=cr.distanceTo(e.x,e.y,e.lastx,e.lasty),(e=(e.time-e.lasttime)/1e3)<=0?t.set_float(0):t.set_float(i/e))},f.prototype.AngleAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):(e=this.touches[e],t.set_float(cr.to_degrees(cr.angleTo(e.lastx,e.lasty,e.x,e.y))))},f.prototype.AngleForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(cr.to_degrees(cr.angleTo(e.lastx,e.lasty,e.x,e.y))))},f.prototype.Alpha=function(t){t.set_float(this.getAlpha())},f.prototype.Beta=function(t){t.set_float(this.getBeta())},f.prototype.Gamma=function(t){t.set_float(this.getGamma())},f.prototype.AccelerationXWithG=function(t){t.set_float(this.acc_g_x)},f.prototype.AccelerationYWithG=function(t){t.set_float(this.acc_g_y)},f.prototype.AccelerationZWithG=function(t){t.set_float(this.acc_g_z)},f.prototype.AccelerationX=function(t){t.set_float(this.acc_x)},f.prototype.AccelerationY=function(t){t.set_float(this.acc_y)},f.prototype.AccelerationZ=function(t){t.set_float(this.acc_z)},f.prototype.TouchIndex=function(t){t.set_int(this.trigger_index)},f.prototype.TouchID=function(t){t.set_float(this.trigger_id)},f.prototype.WidthForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.width))},f.prototype.HeightForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.height))},f.prototype.PressureForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.pressure))},t.exps=new f}(),cr.plugins_.vooxe=function(t){this.runtime=t},function(){var t=cr.plugins_.vooxe.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,window.vooxe={},window.GD_OPTIONS={}};var e=t.Instance.prototype,i=!1;function o(){}function n(){}e.onCreate=function(){var o;window.vooxe||window.GD_OPTIONS?(i=!1,this.vooxe=window.vooxe,(o=this).vooxe.onInit=function(){cr.logexport("Gamedistribution.com SDK: onInit"),o.isShowingBannerAd=!1,o.runtime.trigger(cr.plugins_.vooxe.prototype.cnds.onInit,o)},this.vooxe.onError=function(){cr.logexport("Gamedistribution.com SDK: onError"),o.isShowingBannerAd=!1,o.runtime.trigger(cr.plugins_.vooxe.prototype.cnds.onError,o)},this.vooxe.onResumeGame=function(){cr.logexport("Gamedistribution.com SDK: onResume"),o.isShowingBannerAd=!1,o.runtime.trigger(cr.plugins_.vooxe.prototype.cnds.onResumeGame,o)},this.vooxe.onPauseGame=function(){cr.logexport("Gamedistribution.com SDK: onPauseGame"),o.isShowingBannerAd=!1,o.runtime.trigger(cr.plugins_.vooxe.prototype.cnds.onPauseGame,o)},this.vooxe.InitAds=function(){var t,e,i;window.GD_OPTIONS={gameId:o.properties[0],userId:o.properties[1],advertisementSettings:{autoplay:!1},onEvent:function(t){switch(t.name){case"SDK_GAME_START":o.vooxe.onResumeGame();break;case"SDK_GAME_PAUSE":o.vooxe.onPauseGame();break;case"SDK_READY":o.vooxe.onInit();break;case"SDK_ERROR":o.vooxe.onError()}}},t=document,e="gamedistribution-jssdk",i=t.getElementsByTagName("script")[0],t.getElementById(e)||((t=t.createElement("script")).id=e,t.src="",i.parentNode.insertBefore(t,i))}):cr.logexport("[Construct 2] Gamedistribution.com SDK is required to show advertisements within Cordova; other platforms are not supported.")},o.prototype.IsShowingBanner=function(){return this.isShowingBannerAd},o.prototype.onInit=function(){return!0},o.prototype.onError=function(t){return!0},o.prototype.onResumeGame=function(t){return!0},o.prototype.onPauseGame=function(t){return!0},t.cnds=new o,n.prototype.ShowBanner=function(){if(i){if(void 0===window.gdsdk.showBanner)return cr.logexport("Gamedistribution.com SDK is not loaded or an ad blocker is present."),void this.vooxe.onResumeGame();window.gdsdk.showBanner(),cr.logexport("ShowBanner"),this.isShowingBannerAd=!1}},n.prototype.PlayLog=function(){if(i)return void 0===window.gdsdk.play?(cr.logexport("Gamedistribution.com SDK is not loaded."),void this.vooxe.onResumeGame()):void window.gdsdk.play()},n.prototype.CustomLog=function(){if(i)return void 0===window.gdsdk.customLog?(cr.logexport("Gamedistribution.com SDK is not loaded."),void this.vooxe.onResumeGame()):void window.gdsdk.customLog()},n.prototype.InitAds=function(){i&&this.vooxe.InitAds()},t.acts=new n,t.exps=new function(){}}();var Box2D={};function c2inherit(t,e){for(var i in e.prototype)e.prototype.hasOwnProperty(i)&&(t.prototype[i]=e.prototype[i])}Box2D.Dynamics={},Box2D.Dynamics.Joints={},Box2D.Common={},Box2D.Common.Math={},Box2D.Collision={},Box2D.Collision.Shapes={},Box2D.Collision.b2Collision={},Box2D.Collision.b2Distance={},Box2D.Common.b2Settings={},Box2D.Common.Math.b2Math={},Box2D.Consts={},Box2D.Dynamics.Contacts={},Box2D.Dynamics.Controllers={},Box2D.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},Box2D.Consts.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.b2Settings.b2MixFriction=function(t,e){return Math.sqrt(t*e)},Box2D.Common.b2Settings.b2MixRestitution=function(t,e){return e<t?t:e},Box2D.Common.b2Settings.VERSION="2.1alpha-illandril",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*Math.PI,Box2D.Common.b2Settings.b2_toiSlop=8*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*Math.PI,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=Box2D.Common.b2Settings.b2_maxTranslation*Box2D.Common.b2Settings.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*Math.PI,Box2D.Common.b2Settings.b2_maxRotationSquared=Box2D.Common.b2Settings.b2_maxRotation*Box2D.Common.b2Settings.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_linearSleepToleranceSquared=Box2D.Common.b2Settings.b2_linearSleepTolerance*Box2D.Common.b2Settings.b2_linearSleepTolerance,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*Math.PI,Box2D.Common.b2Settings.b2_angularSleepToleranceSquared=Box2D.Common.b2Settings.b2_angularSleepTolerance*Box2D.Common.b2Settings.b2_angularSleepTolerance,Box2D.Common.b2Settings.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.Math.b2Math.Dot=function(t,e){return t.x*e.x+t.y*e.y},Box2D.Common.Math.b2Math.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},Box2D.Common.Math.b2Math.CrossVF=function(t,e){return Box2D.Common.Math.b2Vec2.Get(e*t.y,-e*t.x)},Box2D.Common.Math.b2Math.CrossFV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(-t*e.y,t*e.x)},Box2D.Common.Math.b2Math.MulMV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},Box2D.Common.Math.b2Math.MulTMV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(e,t.col1),Box2D.Common.Math.b2Math.Dot(e,t.col2))},Box2D.Common.Math.b2Math.MulX=function(t,e){e=Box2D.Common.Math.b2Math.MulMV(t.R,e);return e.x+=t.position.x,e.y+=t.position.y,e},Box2D.Common.Math.b2Math.MulXT=function(t,e){var i=Box2D.Common.Math.b2Math.SubtractVV(e,t.position),e=i.x*t.R.col1.x+i.y*t.R.col1.y;return i.y=i.x*t.R.col2.x+i.y*t.R.col2.y,i.x=e,i},Box2D.Common.Math.b2Math.AddVV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.x+e.x,t.y+e.y)},Box2D.Common.Math.b2Math.SubtractVV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.x-e.x,t.y-e.y)},Box2D.Common.Math.b2Math.Distance=function(t,e){t.x,e.x,t.y,e.y;return Math.sqrt(Box2D.Common.Math.b2Math.DistanceSquared(t,e))},Box2D.Common.Math.b2Math.DistanceSquared=function(t,e){var i=t.x-e.x,e=t.y-e.y;return i*i+e*e},Box2D.Common.Math.b2Math.MulFV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t*e.x,t*e.y)},Box2D.Common.Math.b2Math.AddMM=function(t,e){return Box2D.Common.Math.b2Mat22.FromVV(Box2D.Common.Math.b2Math.AddVV(t.col1,e.col1),Box2D.Common.Math.b2Math.AddVV(t.col2,e.col2))},Box2D.Common.Math.b2Math.MulMM=function(t,e){return Box2D.Common.Math.b2Mat22.FromVV(Box2D.Common.Math.b2Math.MulMV(t,e.col1),Box2D.Common.Math.b2Math.MulMV(t,e.col2))},Box2D.Common.Math.b2Math.MulTMM=function(t,e){var i=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(t.col1,e.col1),Box2D.Common.Math.b2Math.Dot(t.col2,e.col1)),e=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(t.col1,e.col2),Box2D.Common.Math.b2Math.Dot(t.col2,e.col2));return Box2D.Common.Math.b2Mat22.FromVV(i,e)},Box2D.Common.Math.b2Math.AbsV=function(t){return Box2D.Common.Math.b2Vec2.Get(Math.abs(t.x),Math.abs(t.y))},Box2D.Common.Math.b2Math.AbsM=function(t){return Box2D.Common.Math.b2Mat22.FromVV(Box2D.Common.Math.b2Math.AbsV(t.col1),Box2D.Common.Math.b2Math.AbsV(t.col2))},Box2D.Common.Math.b2Math.Clamp=function(t,e,i){return t<e?e:i<t?i:t},Box2D.Common.Math.b2Math.ClampV=function(t,e,i){var o=Box2D.Common.Math.b2Math.Clamp(t.x,e.x,i.x),i=Box2D.Common.Math.b2Math.Clamp(t.y,e.y,i.y);return Box2D.Common.Math.b2Vec2.Get(o,i)},Box2D.Common.Math.b2Mat22=function(){this.col1=Box2D.Common.Math.b2Vec2.Get(0,0),this.col2=Box2D.Common.Math.b2Vec2.Get(0,0),this.SetIdentity()},Box2D.Common.Math.b2Mat22.FromAngle=function(t){var e=new Box2D.Common.Math.b2Mat22;return e.Set(t),e},Box2D.Common.Math.b2Mat22.FromVV=function(t,e){var i=new Box2D.Common.Math.b2Mat22;return i.SetVV(t,e),i},Box2D.Common.Math.b2Mat22.prototype.Set=function(t){var e=Math.cos(t),t=Math.sin(t);this.col1.Set(e,t),this.col2.Set(-t,e)},Box2D.Common.Math.b2Mat22.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},Box2D.Common.Math.b2Mat22.prototype.Copy=function(){var t=new Box2D.Common.Math.b2Mat22;return t.SetM(this),t},Box2D.Common.Math.b2Mat22.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},Box2D.Common.Math.b2Mat22.prototype.AddM=function(t){this.col1.Add(t.col1),this.col2.Add(t.col2)},Box2D.Common.Math.b2Mat22.prototype.SetIdentity=function(){this.col1.Set(1,0),this.col2.Set(0,1)},Box2D.Common.Math.b2Mat22.prototype.SetZero=function(){this.col1.Set(0,0),this.col2.Set(0,0)},Box2D.Common.Math.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},Box2D.Common.Math.b2Mat22.prototype.GetInverse=function(t){var e=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==e&&(e=1/e),t.col1.x=e*this.col2.y,t.col2.x=-e*this.col2.x,t.col1.y=-e*this.col1.y,t.col2.y=e*this.col1.x,t},Box2D.Common.Math.b2Mat22.prototype.Solve=function(t,e,i){var o=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==o&&(o=1/o),t.x=o*(this.col2.y*e-this.col2.x*i),t.y=o*(this.col1.x*i-this.col1.y*e),t},Box2D.Common.Math.b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},Box2D.Common.Math.b2Mat33=function(t,e,i){this.col1=new Box2D.Common.Math.b2Vec3(0,0,0),this.col2=new Box2D.Common.Math.b2Vec3(0,0,0),this.col3=new Box2D.Common.Math.b2Vec3(0,0,0),t&&this.col1.SetV(t),e&&this.col2.SetV(e),i&&this.col3.SetV(i)},Box2D.Common.Math.b2Mat33.prototype.SetVVV=function(t,e,i){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)},Box2D.Common.Math.b2Mat33.prototype.Copy=function(){return new Box2D.Common.Math.b2Mat33(this.col1,this.col2,this.col3)},Box2D.Common.Math.b2Mat33.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},Box2D.Common.Math.b2Mat33.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},Box2D.Common.Math.b2Mat33.prototype.SetIdentity=function(){this.col1.Set(1,0,0),this.col2.Set(0,1,0),this.col3.Set(0,0,1)},Box2D.Common.Math.b2Mat33.prototype.SetZero=function(){this.col1.Set(0,0,0),this.col2.Set(0,0,0),this.col3.Set(0,0,0)},Box2D.Common.Math.b2Mat33.prototype.Solve22=function(t,e,i){var o=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=o*r-n*s;return 0!=a&&(a=1/a),t.x=a*(r*e-n*i),t.y=a*(o*i-s*e),t},Box2D.Common.Math.b2Mat33.prototype.Solve33=function(t,e,i,o){var n=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,h=this.col2.y,l=this.col2.z,c=this.col3.x,m=this.col3.y,u=this.col3.z,p=n*(h*u-l*m)+s*(l*c-a*u)+r*(a*m-h*c);return 0!=p&&(p=1/p),t.x=p*(e*(h*u-l*m)+i*(l*c-a*u)+o*(a*m-h*c)),t.y=p*(n*(i*u-o*m)+s*(o*c-e*u)+r*(e*m-i*c)),t.z=p*(n*(h*o-l*i)+s*(l*e-a*o)+r*(a*i-h*e)),t},Box2D.Common.Math.b2Sweep=function(){this.localCenter=Box2D.Common.Math.b2Vec2.Get(0,0),this.c0=Box2D.Common.Math.b2Vec2.Get(0,0),this.c=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Common.Math.b2Sweep.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},Box2D.Common.Math.b2Sweep.prototype.Copy=function(){var t=new Box2D.Common.Math.b2Sweep;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},Box2D.Common.Math.b2Sweep.prototype.GetTransform=function(t,e){void 0===e&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y;e=(1-e)*this.a0+e*this.a;t.R.Set(e);e=t.R;t.position.x-=e.col1.x*this.localCenter.x+e.col2.x*this.localCenter.y,t.position.y-=e.col1.y*this.localCenter.x+e.col2.y*this.localCenter.y},Box2D.Common.Math.b2Sweep.prototype.Advance=function(t){var e;void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE&&(e=(t-this.t0)/(1-this.t0),this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t)},Box2D.Common.Math.b2Transform=function(t,e){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.R=new Box2D.Common.Math.b2Mat22,t&&this.position.SetV(t),e&&this.R.SetM(e)},Box2D.Common.Math.b2Transform.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},Box2D.Common.Math.b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},Box2D.Common.Math.b2Transform.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},Box2D.Common.Math.b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},Box2D.Common.Math.b2Vec2=function(t,e){this.x=t,this.y=e},Box2D.Common.Math.b2Vec2._freeCache=[],Box2D.Common.Math.b2Vec2.Get=function(t,e){if(0<Box2D.Common.Math.b2Vec2._freeCache.length){var i=Box2D.Common.Math.b2Vec2._freeCache.pop();return i.Set(t,e),i}return new Box2D.Common.Math.b2Vec2(t,e)},Box2D.Common.Math.b2Vec2.Free=function(t){Box2D.Common.Math.b2Vec2._freeCache.push(t)},Box2D.Common.Math.b2Vec2.prototype.SetZero=function(){this.x=0,this.y=0},Box2D.Common.Math.b2Vec2.prototype.Set=function(t,e){this.x=t,this.y=e},Box2D.Common.Math.b2Vec2.prototype.SetV=function(t){this.x=t.x,this.y=t.y},Box2D.Common.Math.b2Vec2.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec2.Get(-this.x,-this.y)},Box2D.Common.Math.b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},Box2D.Common.Math.b2Vec2.prototype.Copy=function(){return Box2D.Common.Math.b2Vec2.Get(this.x,this.y)},Box2D.Common.Math.b2Vec2.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},Box2D.Common.Math.b2Vec2.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},Box2D.Common.Math.b2Vec2.prototype.Multiply=function(t){this.x*=t,this.y*=t},Box2D.Common.Math.b2Vec2.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},Box2D.Common.Math.b2Vec2.prototype.MulTM=function(t){var e=this.x*t.col1.x+this.y*t.col1.y;this.y=this.x*t.col2.x+this.y*t.col2.y,this.x=e},Box2D.Common.Math.b2Vec2.prototype.CrossVF=function(t){var e=this.x;this.x=t*this.y,this.y=-t*e},Box2D.Common.Math.b2Vec2.prototype.CrossFV=function(t){var e=this.x;this.x=-t*this.y,this.y=t*e},Box2D.Common.Math.b2Vec2.prototype.MinV=function(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y)},Box2D.Common.Math.b2Vec2.prototype.MaxV=function(t){this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y)},Box2D.Common.Math.b2Vec2.prototype.Abs=function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Box2D.Common.Math.b2Vec2.prototype.Length=function(){return Math.sqrt(this.LengthSquared())},Box2D.Common.Math.b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},Box2D.Common.Math.b2Vec2.prototype.Normalize=function(){var t=this.Length();if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},Box2D.Common.Math.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},Box2D.Common.Math.b2Vec3=function(t,e,i){this.x=t,this.y=e,this.z=i},Box2D.Common.Math.b2Vec3.prototype.SetZero=function(){this.x=0,this.y=0,this.z=0},Box2D.Common.Math.b2Vec3.prototype.Set=function(t,e,i){this.x=t,this.y=e,this.z=i},Box2D.Common.Math.b2Vec3.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},Box2D.Common.Math.b2Vec3.prototype.GetNegative=function(){return new Box2D.Common.Math.b2Vec3(-this.x,-this.y,-this.z)},Box2D.Common.Math.b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},Box2D.Common.Math.b2Vec3.prototype.Copy=function(){return new Box2D.Common.Math.b2Vec3(this.x,this.y,this.z)},Box2D.Common.Math.b2Vec3.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},Box2D.Common.Math.b2Vec3.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},Box2D.Common.Math.b2Vec3.prototype.Multiply=function(t){this.x*=t,this.y*=t,this.z*=t},Box2D.Collision.Shapes.b2Shape=function(){this.m_radius=Box2D.Common.b2Settings.b2_linearSlop},Box2D.Collision.Shapes.b2Shape.prototype.GetTypeName=function(){},Box2D.Collision.Shapes.b2Shape.prototype.Copy=function(){},Box2D.Collision.Shapes.b2Shape.prototype.Set=function(t){this.m_radius=t.m_radius},Box2D.Collision.Shapes.b2Shape.prototype.TestPoint=function(){},Box2D.Collision.Shapes.b2Shape.prototype.RayCast=function(){},Box2D.Collision.Shapes.b2Shape.prototype.ComputeAABB=function(){},Box2D.Collision.Shapes.b2Shape.prototype.ComputeMass=function(){},Box2D.Collision.Shapes.b2Shape.prototype.ComputeSubmergedArea=function(){},Box2D.Collision.Shapes.b2Shape.prototype.SetDistanceProxy=function(){},Box2D.Collision.Shapes.b2Shape.TestOverlap=function(t,e,i,o){var n=new Box2D.Collision.b2DistanceInput;n.proxyA=new Box2D.Collision.b2DistanceProxy,n.proxyA.Set(t),n.proxyB=new Box2D.Collision.b2DistanceProxy,n.proxyB.Set(i),n.transformA=e,n.transformB=o,n.useRadii=!0;e=new Box2D.Collision.b2SimplexCache;e.count=0;o=new Box2D.Collision.b2DistanceOutput;return Box2D.Collision.b2Distance.Distance(o,e,n),o.distance<10*Number.MIN_VALUE},Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2CircleShape=function(t){Box2D.Collision.Shapes.b2Shape.call(this),this.m_radius=t,this.m_radiusSquared=t*t,this.m_p=Box2D.Common.Math.b2Vec2.Get(0,0)},c2inherit(Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2CircleShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2CircleShape.NAME},Box2D.Collision.Shapes.b2CircleShape.prototype.Copy=function(){var t=new Box2D.Collision.Shapes.b2CircleShape(this.m_radius);return t.Set(this),t},Box2D.Collision.Shapes.b2CircleShape.prototype.Set=function(t){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,t),t instanceof Box2D.Collision.Shapes.b2CircleShape&&this.m_p.SetV(t.m_p)},Box2D.Collision.Shapes.b2CircleShape.prototype.TestPoint=function(t,e){t.R;var i=e.x-(t.position.x+(t.R.col1.x*this.m_p.x+t.R.col2.x*this.m_p.y)),t=e.y-(t.position.y+(t.R.col1.y*this.m_p.x+t.R.col2.y*this.m_p.y));return i*i+t*t<=this.m_radiusSquared},Box2D.Collision.Shapes.b2CircleShape.prototype.RayCast=function(t,e,i){var o=i.R,n=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),s=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y),r=e.p1.x-n,a=e.p1.y-s,h=r*r+a*a-this.m_radiusSquared,i=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,n=r*i+a*o,s=i*i+o*o,h=n*n-s*h;if(h<0||s<Number.MIN_VALUE)return!1;h=-(n+Math.sqrt(h));return 0<=h&&h<=e.maxFraction*s&&(h/=s,t.fraction=h,t.normal.x=r+h*i,t.normal.y=a+h*o,t.normal.Normalize(),!0)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),i=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound_.Set(o-this.m_radius,i-this.m_radius),t.upperBound_.Set(o+this.m_radius,i+this.m_radius)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeMass=function(t,e){t.mass=e*Math.PI*this.m_radiusSquared,t.center.SetV(this.m_p),t.I=t.mass*(.5*this.m_radiusSquared+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeSubmergedArea=function(t,e,i,o){var n=Box2D.Common.Math.b2Math.MulX(i,this.m_p),i=-(Box2D.Common.Math.b2Math.Dot(t,n)-e);if(i<-this.m_radius+Number.MIN_VALUE)return 0;if(i>this.m_radius)return o.SetV(n),Math.PI*this.m_radiusSquared;e=i*i,i=this.m_radiusSquared*(Math.asin(i/this.m_radius)+Math.PI/2)+i*Math.sqrt(this.m_radiusSquared-e),e=-2/3*Math.pow(this.m_radiusSquared-e,1.5)/i;return o.x=n.x+t.x*e,o.y=n.y+t.y*e,i},Box2D.Collision.Shapes.b2CircleShape.prototype.SetDistanceProxy=function(t){t.m_vertices=[this.m_p],t.m_count=1,t.m_radius=this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},Box2D.Collision.Shapes.b2CircleShape.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetRadius=function(){return this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.SetRadius=function(t){this.m_radius=t,this.m_radiusSquared=t*t},Box2D.Collision.Shapes.b2CircleShape.NAME="b2CircleShape",Box2D.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.Collision.Shapes.b2EdgeShape=function(t,e){Box2D.Collision.Shapes.b2Shape.call(this),this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=t,this.m_v2=e,this.m_direction=Box2D.Common.Math.b2Vec2.Get(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal=Box2D.Common.Math.b2Vec2.Get(this.m_direction.y,-this.m_direction.x),this.m_coreV1=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2=Box2D.Common.Math.b2Vec2.Get(-this.m_normal.x,-this.m_normal.y),this.m_cornerConvex1=!1,this.m_cornerConvex2=!1},c2inherit(Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2EdgeShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2EdgeShape.NAME},Box2D.Collision.Shapes.b2EdgeShape.prototype.TestPoint=function(t,e){return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.RayCast=function(t,e,i){var o=e.p2.x-e.p1.x,n=e.p2.y-e.p1.y,s=i.R,r=i.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),a=i.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),h=i.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y)-a,l=-(i.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y)-r),c=100*Number.MIN_VALUE,i=-(o*h+n*l);if(c<i){s=e.p1.x-r,r=e.p1.y-a,a=s*h+r*l;if(0<=a&&a<=e.maxFraction*i){s=-o*r+n*s;if(-c*i<=s&&s<=i*(1+c)){a/=i,t.fraction=a;a=Math.sqrt(h*h+l*l);return t.normal.x=h/a,t.normal.y=l/a,!0}}}return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),n=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),s=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),i=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);o<s?(t.lowerBound_.x=o,t.upperBound_.x=s):(t.lowerBound_.x=s,t.upperBound_.x=o),n<i?(t.lowerBound_.y=n,t.upperBound_.y=i):(t.lowerBound_.y=i,t.upperBound_.y=n)},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeMass=function(t,e){t.mass=0,t.center.SetV(this.m_v1),t.I=0},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeSubmergedArea=function(t,e,i,o){void 0===e&&(e=0);var n=Box2D.Common.Math.b2Vec2.Get(t.x*e,t.y*e),s=Box2D.Common.Math.b2Math.MulX(i,this.m_v1),r=Box2D.Common.Math.b2Math.MulX(i,this.m_v2),i=Box2D.Common.Math.b2Math.Dot(t,s)-e,e=Box2D.Common.Math.b2Math.Dot(t,r)-e;if(0<i){if(0<e)return 0;s.x=-e/(i-e)*s.x+i/(i-e)*r.x,s.y=-e/(i-e)*s.y+i/(i-e)*r.y}else 0<e&&(r.x=-e/(i-e)*s.x+i/(i-e)*r.x,r.y=-e/(i-e)*s.y+i/(i-e)*r.y);return o.x=(n.x+s.x+r.x)/3,o.y=(n.y+s.y+r.y)/3,.5*((s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetLength=function(){return this.m_length},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetFirstVertex=function(t){var e=t.R;return Box2D.Common.Math.b2Vec2.Get(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.Support=function(t,e,i){var o=t.R,n=t.position.x+(o.col1.x*this.m_coreV1.x+o.col2.x*this.m_coreV1.y),s=t.position.y+(o.col1.y*this.m_coreV1.x+o.col2.y*this.m_coreV1.y),r=t.position.x+(o.col1.x*this.m_coreV2.x+o.col2.x*this.m_coreV2.y),o=t.position.y+(o.col1.y*this.m_coreV2.x+o.col2.y*this.m_coreV2.y);return r*e+o*i<n*e+s*i?Box2D.Common.Math.b2Vec2.Get(n,s):Box2D.Common.Math.b2Vec2.Get(r,o)},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetPrevEdge=function(t,e,i,o){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=i,this.m_cornerConvex1=o},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetNextEdge=function(t,e,i,o){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=i,this.m_cornerConvex2=o},Box2D.Collision.Shapes.b2EdgeShape.NAME="b2EdgeShape",Box2D.Collision.Shapes.b2MassData=function(){this.mass=0,this.center=Box2D.Common.Math.b2Vec2.Get(0,0),this.I=0},Box2D.Collision.Shapes.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.call(this),this.m_centroid=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[],this.m_normals=[]},c2inherit(Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2PolygonShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2PolygonShape.NAME},Box2D.Collision.Shapes.b2PolygonShape.prototype.Copy=function(){var t=new Box2D.Collision.Shapes.b2PolygonShape;return t.Set(this),t},Box2D.Collision.Shapes.b2PolygonShape.prototype.Set=function(t){if(Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,t),t instanceof Box2D.Collision.Shapes.b2PolygonShape){this.m_centroid.SetV(t.m_centroid),this.m_vertexCount=t.m_vertexCount,this.Reserve(this.m_vertexCount);for(var e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(t.m_vertices[e]),this.m_normals[e].SetV(t.m_normals[e])}},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsArray=function(t){this.SetAsVector(t)},Box2D.Collision.Shapes.b2PolygonShape.AsArray=function(t){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.SetAsArray(t),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsVector=function(t){var e=t.length;this.m_vertexCount=e,this.Reserve(e);for(var i=0,i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(t[i]);for(i=0;i<this.m_vertexCount;++i){var o=i+1<this.m_vertexCount?i+1:0,o=Box2D.Common.Math.b2Math.SubtractVV(this.m_vertices[o],this.m_vertices[i]);this.m_normals[i].SetV(Box2D.Common.Math.b2Math.CrossVF(o,1)),this.m_normals[i].Normalize()}this.m_centroid=Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},Box2D.Collision.Shapes.b2PolygonShape.AsVector=function(t){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.SetAsVector(t),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsBox=function(t,e){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},Box2D.Collision.Shapes.b2PolygonShape.AsBox=function(t,e){var i=new Box2D.Collision.Shapes.b2PolygonShape;return i.SetAsBox(t,e),i},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsOrientedBox=function(t,e,i,o){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i;e=new Box2D.Common.Math.b2Mat22;e.Set(o);for(var n=new Box2D.Common.Math.b2Transform(i,e),s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=Box2D.Common.Math.b2Math.MulX(n,this.m_vertices[s]),this.m_normals[s]=Box2D.Common.Math.b2Math.MulMV(n.R,this.m_normals[s])},Box2D.Collision.Shapes.b2PolygonShape.AsOrientedBox=function(t,e,i,o){var n=new Box2D.Collision.Shapes.b2PolygonShape;return n.SetAsOrientedBox(t,e,i,o),n},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y),this.m_normals[0]=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(e,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},Box2D.Collision.Shapes.b2PolygonShape.AsEdge=function(t,e){var i=new Box2D.Collision.Shapes.b2PolygonShape;return i.SetAsEdge(t,e),i},Box2D.Collision.Shapes.b2PolygonShape.prototype.TestPoint=function(t,e){for(var i,o=t.R,n=e.x-t.position.x,s=e.y-t.position.y,r=n*o.col1.x+s*o.col1.y,a=n*o.col2.x+s*o.col2.y,h=0;h<this.m_vertexCount;++h){n=r-(i=this.m_vertices[h]).x,s=a-i.y;if(0<(i=this.m_normals[h]).x*n+i.y*s)return!1}return!0},Box2D.Collision.Shapes.b2PolygonShape.prototype.RayCast=function(t,e,i){var o,n=0,s=e.maxFraction,r=e.p1.x-i.position.x,a=e.p1.y-i.position.y,h=i.R,l=r*h.col1.x+a*h.col1.y,c=r*h.col2.x+a*h.col2.y;r=e.p2.x-i.position.x,a=e.p2.y-i.position.y;for(var m=r*(h=i.R).col1.x+a*h.col1.y-l,u=r*h.col2.x+a*h.col2.y-c,p=-1,y=0;y<this.m_vertexCount;++y){r=(o=this.m_vertices[y]).x-l,a=o.y-c;var _=(o=this.m_normals[y]).x*r+o.y*a,d=o.x*m+o.y*u;if(0==d){if(_<0)return!1}else d<0&&_<n*d?(n=_/d,p=y):0<d&&_<s*d&&(s=_/d);if(s<n-Number.MIN_VALUE)return!1}return 0<=p&&(t.fraction=n,h=i.R,o=this.m_normals[p],t.normal.x=h.col1.x*o.x+h.col2.x*o.y,t.normal.y=h.col1.y*o.x+h.col2.y*o.y,!0)},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeAABB=function(t,e){for(var i=e.R,o=this.m_vertices[0],n=l=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),s=c=e.position.y+(i.col1.y*o.x+i.col2.y*o.y),r=1;r<this.m_vertexCount;++r){o=this.m_vertices[r];var a=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),h=e.position.y+(i.col1.y*o.x+i.col2.y*o.y),l=l<a?l:a,c=c<h?c:h,n=a<n?n:a,s=h<s?s:h}t.lowerBound_.x=l-this.m_radius,t.lowerBound_.y=c-this.m_radius,t.upperBound_.x=n+this.m_radius,t.upperBound_.y=s+this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeMass=function(t,e){if(2==this.m_vertexCount)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,void(t.I=0);for(var i=0,o=0,n=0,s=0,r=0;r<this.m_vertexCount;++r){var a=this.m_vertices[r],h=r+1<this.m_vertexCount?this.m_vertices[r+1]:this.m_vertices[0],l=+a.x,c=+a.y,m=+h.x,u=+h.y,p=l*u-c*m,y=.5*p;n+=y,i+=1/3*y*(0+a.x+h.x),o+=1/3*y*(0+a.y+h.y);s+=p*(1/3*(.25*(l*l+m*l+m*m)+(0*l+0*m))+0+(1/3*(.25*(c*c+u*c+u*u)+(0*c+0*u))+0))}t.mass=e*n,i*=1/n,o*=1/n,t.center.Set(i,o),t.I=e*s},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeSubmergedArea=function(t,e,i,o){for(var n=Box2D.Common.Math.b2Math.MulTMV(i.R,t),s=e-Box2D.Common.Math.b2Math.Dot(t,i.position),r=[],a=0,h=-1,l=-1,c=!1,m=0,m=0;m<this.m_vertexCount;++m){r[m]=Box2D.Common.Math.b2Math.Dot(n,this.m_vertices[m])-s;var u=r[m]<-Number.MIN_VALUE;0<m&&(u?c||(h=m-1,a++):c&&(l=m-1,a++)),c=u}switch(a){case 0:if(c){var p=new Box2D.Collision.Shapes.b2MassData;return this.ComputeMass(p,1),o.SetV(Box2D.Common.Math.b2Math.MulX(i,p.center)),p.mass}return 0;case 1:-1==h?h=this.m_vertexCount-1:l=this.m_vertexCount-1}var y,_=(h+1)%this.m_vertexCount,d=(l+1)%this.m_vertexCount,e=(0-r[h])/(r[_]-r[h]),t=(0-r[l])/(r[d]-r[l]),f=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[h].x*(1-e)+this.m_vertices[_].x*e,this.m_vertices[h].y*(1-e)+this.m_vertices[_].y*e),x=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[l].x*(1-t)+this.m_vertices[d].x*t,this.m_vertices[l].y*(1-t)+this.m_vertices[d].y*t),g=0,b=Box2D.Common.Math.b2Vec2.Get(0,0),v=this.m_vertices[_];for(m=_;m!=d;){y=(m=(m+1)%this.m_vertexCount)==d?x:this.m_vertices[m];var B=.5*((v.x-f.x)*(y.y-f.y)-(v.y-f.y)*(y.x-f.x));g+=B,b.x+=B*(f.x+v.x+y.x)/3,b.y+=B*(f.y+v.y+y.y)/3,v=y}return b.Multiply(1/g),o.SetV(Box2D.Common.Math.b2Math.MulX(i,b)),g},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_vertexCount,t.m_radius=this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_vertexCount;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;i<n&&(e=o,i=n)}return e},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_vertexCount;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;i<n&&(e=o,i=n)}return this.m_vertices[e]},Box2D.Collision.Shapes.b2PolygonShape.prototype.Reserve=function(t){this.m_vertices=[],this.m_normals=[];for(var e=this.m_vertices.length;e<t;e++)this.m_vertices[e]=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_normals[e]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid=function(t,e){for(var i=Box2D.Common.Math.b2Vec2.Get(0,0),o=0,n=0;n<e;++n){var s=t[n],r=n+1<e?t[n+1]:t[0],a=+s.x,h=+s.y,l=+r.x,l=.5*(a*+r.y-h*l);o+=l,i.x+=1/3*l*(0+s.x+r.x),i.y+=1/3*l*(0+s.y+r.y)}return i.x*=1/o,i.y*=1/o,i},Box2D.Collision.Shapes.b2PolygonShape.s_mat=new Box2D.Common.Math.b2Mat22,Box2D.Collision.Shapes.b2PolygonShape.NAME="b2PolygonShape",Box2D.Collision.b2ContactID=function(){this._key=0,this._referenceEdge=0,this._incidentEdge=0,this._incidentVertex=0},Box2D.Collision.b2ContactID.prototype.GetKey=function(){return this._key},Box2D.Collision.b2ContactID.prototype.SetKey=function(t){this._key=t,this._referenceEdge=255&this._key,this._incidentEdge=(65280&this._key)>>8&255,this._incidentVertex=(16711680&this._key)>>16&255,this._flip=(4278190080&this._key)>>24&255},Box2D.Collision.b2ContactID.prototype.Set=function(t){this.SetKey(t._key)},Box2D.Collision.b2ContactID.prototype.SetReferenceEdge=function(t){this._referenceEdge=t,this._key=4294967040&this._key|255&this._referenceEdge},Box2D.Collision.b2ContactID.prototype.SetIncidentEdge=function(t){this._incidentEdge=t,this._key=4294902015&this._key|this._incidentEdge<<8&65280},Box2D.Collision.b2ContactID.prototype.SetIncidentVertex=function(t){this._incidentVertex=t,this._key=4278255615&this._key|this._incidentVertex<<16&16711680},Box2D.Collision.b2ContactID.prototype.SetFlip=function(t){this._flip=t,this._key=16777215&this._key|this._flip<<24&4278190080},Box2D.Collision.b2ContactID.prototype.Copy=function(){var t=new Box2D.Collision.b2ContactID;return t.Set(this),t},Box2D.Collision.ClipVertex=function(){this.v=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.ClipVertex.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=function(){this.lowerBound_=Box2D.Common.Math.b2Vec2.Get(0,0),this.upperBound_=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2AABB._freeCache=[],Box2D.Collision.b2AABB.Get=function(){if(0<Box2D.Collision.b2AABB._freeCache.length){var t=Box2D.Collision.b2AABB._freeCache.pop();return t.SetZero(),t}return new Box2D.Collision.b2AABB},Box2D.Collision.b2AABB.Free=function(t){Box2D.Collision.b2AABB._freeCache.push(t)},Box2D.Collision.b2AABB.prototype.SetZero=function(){this.lowerBound_.Set(0,0),this.upperBound_.Set(0,0)},Box2D.Collision.b2AABB.prototype.IsValid=function(){return!(this.upperBound_.x-this.lowerBound_.x<0)&&(!(this.upperBound_.y-this.lowerBound_.y<0)&&(this.lowerBound_.IsValid()&&this.upperBound_.IsValid()))},Box2D.Collision.b2AABB.prototype.GetCenter=function(){return Box2D.Common.Math.b2Vec2.Get((this.lowerBound_.x+this.upperBound_.x)/2,(this.lowerBound_.y+this.upperBound_.y)/2)},Box2D.Collision.b2AABB.prototype.SetCenter=function(t){var e=this.GetCenter();this.lowerBound_.Subtract(e),this.upperBound_.Subtract(e),this.lowerBound_.Add(t),this.upperBound_.Add(t),Box2D.Common.Math.b2Vec2.Free(e)},Box2D.Collision.b2AABB.prototype.GetExtents=function(){return Box2D.Common.Math.b2Vec2.Get((this.upperBound_.x-this.lowerBound_.x)/2,(this.upperBound_.y-this.lowerBound_.y)/2)},Box2D.Collision.b2AABB.prototype.Contains=function(t){return this.lowerBound_.x<=t.lowerBound_.x&&this.lowerBound_.y<=t.lowerBound_.y&&t.upperBound_.x<=this.upperBound_.x&&t.upperBound_.y<=this.upperBound_.y},Box2D.Collision.b2AABB.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE,o=Number.MAX_VALUE,n=e.p2.x-e.p1.x;if(Math.abs(n)<Number.MIN_VALUE){if(e.p1.x<this.lowerBound_.x||this.upperBound_.x<e.p1.x)return!1}else{var s=1/n,r=(this.lowerBound_.x-e.p1.x)*s,a=-1;if((h=(this.upperBound_.x-e.p1.x)*s)<r&&(l=r,r=h,h=l,a=1),i<r&&(t.normal.x=a,t.normal.y=0,i=r),(o=Math.min(o,h))<i)return!1}n=e.p2.y-e.p1.y;if(Math.abs(n)<Number.MIN_VALUE){if(e.p1.y<this.lowerBound_.y||this.upperBound_.y<e.p1.y)return!1}else{var h,l,s=1/n,r=(this.lowerBound_.y-e.p1.y)*s,a=-1;if((h=(this.upperBound_.y-e.p1.y)*s)<r&&(l=r,r=h,h=l,a=1),i<r&&(t.normal.y=a,t.normal.x=0,i=r),(o=Math.min(o,h))<i)return!1}return t.fraction=i,!0},Box2D.Collision.b2AABB.prototype.TestOverlap=function(t){return!(0<t.lowerBound_.x-this.upperBound_.x)&&(!(0<t.lowerBound_.y-this.upperBound_.y)&&(!(0<this.lowerBound_.x-t.upperBound_.x)&&!(0<this.lowerBound_.y-t.upperBound_.y)))},Box2D.Collision.b2AABB.Combine=function(t,e){var i=Box2D.Collision.b2AABB.Get();return i.Combine(t,e),i},Box2D.Collision.b2AABB.prototype.Combine=function(t,e){this.lowerBound_.x=Math.min(t.lowerBound_.x,e.lowerBound_.x),this.lowerBound_.y=Math.min(t.lowerBound_.y,e.lowerBound_.y),this.upperBound_.x=Math.max(t.upperBound_.x,e.upperBound_.x),this.upperBound_.y=Math.max(t.upperBound_.y,e.upperBound_.y)},Box2D.Collision.b2Collision.ClipSegmentToLine=function(t,e,i,o){var n=0,s=e[0].v,r=e[1].v,a=i.x*s.x+i.y*s.y-o,i=i.x*r.x+i.y*r.y-o;return a<=0&&t[n++].Set(e[0]),i<=0&&t[n++].Set(e[1]),a*i<0&&(o=a/(a-i),(i=t[n].v).x=s.x+o*(r.x-s.x),i.y=s.y+o*(r.y-s.y),t[n].id=(0<a?e[0]:e[1]).id,n++),n},Box2D.Collision.b2Collision.EdgeSeparation=function(t,e,i,o,n){for(var s=e.R.col1.x*t.m_normals[i].x+e.R.col2.x*t.m_normals[i].y,r=e.R.col1.y*t.m_normals[i].x+e.R.col2.y*t.m_normals[i].y,a=n.R.col1.x*s+n.R.col1.y*r,h=n.R.col2.x*s+n.R.col2.y*r,l=0,c=Number.MAX_VALUE,m=0;m<o.m_vertexCount;m++){var u=o.m_vertices[m].x*a+o.m_vertices[m].y*h;u<c&&(c=u,l=m)}var p=e.position.x+(e.R.col1.x*t.m_vertices[i].x+e.R.col2.x*t.m_vertices[i].y),i=e.position.y+(e.R.col1.y*t.m_vertices[i].x+e.R.col2.y*t.m_vertices[i].y);return(n.position.x+(n.R.col1.x*o.m_vertices[l].x+n.R.col2.x*o.m_vertices[l].y)-p)*s+(n.position.y+(n.R.col1.y*o.m_vertices[l].x+n.R.col2.y*o.m_vertices[l].y)-i)*r},Box2D.Collision.b2Collision.FindMaxSeparation=function(t,e,i,o){var n=o.position.x+(o.R.col1.x*i.m_centroid.x+o.R.col2.x*i.m_centroid.y),s=o.position.y+(o.R.col1.y*i.m_centroid.x+o.R.col2.y*i.m_centroid.y);n-=e.position.x+(e.R.col1.x*t.m_centroid.x+e.R.col2.x*t.m_centroid.y),s-=e.position.y+(e.R.col1.y*t.m_centroid.x+e.R.col2.y*t.m_centroid.y);for(var r=n*e.R.col1.x+s*e.R.col1.y,a=n*e.R.col2.x+s*e.R.col2.y,h=0,l=-Number.MAX_VALUE,c=0;c<t.m_vertexCount;++c){var m=t.m_normals[c].x*r+t.m_normals[c].y*a;l<m&&(l=m,h=c)}var u=Box2D.Collision.b2Collision.EdgeSeparation(t,e,h,i,o),p=h-1;p<0&&(p=t.m_vertexCount-1);var y=Box2D.Collision.b2Collision.EdgeSeparation(t,e,p,i,o),n=h+1;n>=t.m_vertexCount&&(n=0);var s=Box2D.Collision.b2Collision.EdgeSeparation(t,e,n,i,o),_=0,d=0;if(u<y&&s<y)for(_=p,d=y;(h=_-1)<0&&(h=t.m_vertexCount-1),d<(u=Box2D.Collision.b2Collision.EdgeSeparation(t,e,h,i,o));)_=h,d=u;else if(u<s)for(_=n,d=s;(h=_+1)>=t.m_vertexCount&&(h=0),d<(u=Box2D.Collision.b2Collision.EdgeSeparation(t,e,h,i,o));)_=h,d=u;else _=h,d=u;return{bestEdge:_,separation:d}},Box2D.Collision.b2Collision.FindIncidentEdge=function(t,e,i,o,n,s){void 0===o&&(o=0);for(var r=i.R.col1.x*e.m_normals[o].x+i.R.col2.x*e.m_normals[o].y,a=i.R.col1.y*e.m_normals[o].x+i.R.col2.y*e.m_normals[o].y,e=s.R.col1.x*r+s.R.col1.y*a,a=s.R.col2.x*r+s.R.col2.y*a,r=e,h=0,l=Number.MAX_VALUE,c=0;c<n.m_vertexCount;c++){var m=r*n.m_normals[c].x+a*n.m_normals[c].y;m<l&&(l=m,h=c)}e=h+1;e>=n.m_vertexCount&&(e=0),t[0].v.x=s.position.x+(s.R.col1.x*n.m_vertices[h].x+s.R.col2.x*n.m_vertices[h].y),t[0].v.y=s.position.y+(s.R.col1.y*n.m_vertices[h].x+s.R.col2.y*n.m_vertices[h].y),t[0].id.SetReferenceEdge(o),t[0].id.SetIncidentEdge(h),t[0].id.SetIncidentVertex(0),t[1].v.x=s.position.x+(s.R.col1.x*n.m_vertices[e].x+s.R.col2.x*n.m_vertices[e].y),t[1].v.y=s.position.y+(s.R.col1.y*n.m_vertices[e].x+s.R.col2.y*n.m_vertices[e].y),t[1].id.SetReferenceEdge(o),t[1].id.SetIncidentEdge(e),t[1].id.SetIncidentVertex(1)},Box2D.Collision.b2Collision.MakeClipPointVector=function(){return[new Box2D.Collision.ClipVertex,new Box2D.Collision.ClipVertex]},Box2D.Collision.b2Collision.CollidePolygons=function(t,e,i,o,n){t.m_pointCount=0;var s=e.m_radius+o.m_radius,r=Box2D.Collision.b2Collision.FindMaxSeparation(e,i,o,n),a=r.bestEdge;if(!(r.separation>s)){var h=Box2D.Collision.b2Collision.FindMaxSeparation(o,n,e,i);if(!(h.separation>s)){var l=e,c=o,m=i,u=n,p=0;t.m_type=Box2D.Collision.b2Manifold.e_faceA,h.separation>.98*r.separation+.001&&(l=o,c=e,m=n,u=i,a=h.bestEdge,t.m_type=Box2D.Collision.b2Manifold.e_faceB,p=1);h=Box2D.Collision.b2Collision.s_incidentEdge;Box2D.Collision.b2Collision.FindIncidentEdge(h,l,m,a,c,u);c=l.m_vertices[a],l=a+1<l.m_vertexCount?l.m_vertices[a+1]:l.m_vertices[0];Box2D.Collision.b2Collision.s_localTangent.Set(l.x-c.x,l.y-c.y),Box2D.Collision.b2Collision.s_localTangent.Normalize(),Box2D.Collision.b2Collision.s_localNormal.x=Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_localNormal.y=-Box2D.Collision.b2Collision.s_localTangent.x,Box2D.Collision.b2Collision.s_planePoint.Set(.5*(c.x+l.x),.5*(c.y+l.y)),Box2D.Collision.b2Collision.s_tangent.x=m.R.col1.x*Box2D.Collision.b2Collision.s_localTangent.x+m.R.col2.x*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent.y=m.R.col1.y*Box2D.Collision.b2Collision.s_localTangent.x+m.R.col2.y*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent2.x=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_tangent2.y=-Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.x=Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.y=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_v11.x=m.position.x+(m.R.col1.x*c.x+m.R.col2.x*c.y),Box2D.Collision.b2Collision.s_v11.y=m.position.y+(m.R.col1.y*c.x+m.R.col2.y*c.y),Box2D.Collision.b2Collision.s_v12.x=m.position.x+(m.R.col1.x*l.x+m.R.col2.x*l.y),Box2D.Collision.b2Collision.s_v12.y=m.position.y+(m.R.col1.y*l.x+m.R.col2.y*l.y);l=-Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v11.x-Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v11.y+s;if(!(Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints1,h,Box2D.Collision.b2Collision.s_tangent2,l)<2)){l=Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v12.x+Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v12.y+s;if(!(Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints2,Box2D.Collision.b2Collision.s_clipPoints1,Box2D.Collision.b2Collision.s_tangent,l)<2)){t.m_localPlaneNormal.SetV(Box2D.Collision.b2Collision.s_localNormal),t.m_localPoint.SetV(Box2D.Collision.b2Collision.s_planePoint);for(var y,_,d=Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_v11.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_v11.y,f=0,x=0;x<Box2D.Common.b2Settings.b2_maxManifoldPoints;++x)Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_clipPoints2[x].v.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_clipPoints2[x].v.y-d<=s&&(y=Box2D.Collision.b2Collision.s_clipPoints2[x].v.x-u.position.x,_=Box2D.Collision.b2Collision.s_clipPoints2[x].v.y-u.position.y,t.m_points[f].m_localPoint.x=y*u.R.col1.x+_*u.R.col1.y,t.m_points[f].m_localPoint.y=y*u.R.col2.x+_*u.R.col2.y,t.m_points[f].m_id.Set(Box2D.Collision.b2Collision.s_clipPoints2[x].id),t.m_points[f].m_id.SetFlip(p),f++);t.m_pointCount=f}}}}},Box2D.Collision.b2Collision.CollideCircles=function(t,e,i,o,n){t.m_pointCount=0;var s=i.position.x+(i.R.col1.x*e.m_p.x+i.R.col2.x*e.m_p.y),i=i.position.y+(i.R.col1.y*e.m_p.x+i.R.col2.y*e.m_p.y),s=n.position.x+(n.R.col1.x*o.m_p.x+n.R.col2.x*o.m_p.y)-s,i=n.position.y+(n.R.col1.y*o.m_p.x+n.R.col2.y*o.m_p.y)-i,s=s*s+i*i,i=e.m_radius+o.m_radius;i*i<s||(t.m_type=Box2D.Collision.b2Manifold.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0))},Box2D.Collision.b2Collision.CollidePolygonAndCircle=function(t,e,i,o,n){t.m_pointCount=0;for(var s=n.position.x+(n.R.col1.x*o.m_p.x+n.R.col2.x*o.m_p.y)-i.position.x,n=n.position.y+(n.R.col1.y*o.m_p.x+n.R.col2.y*o.m_p.y)-i.position.y,r=s*i.R.col1.x+n*i.R.col1.y,a=s*i.R.col2.x+n*i.R.col2.y,h=0,l=-Number.MAX_VALUE,c=e.m_radius+o.m_radius,m=0;m<e.m_vertexCount;++m){var u=e.m_normals[m].x*(r-e.m_vertices[m].x)+e.m_normals[m].y*(a-e.m_vertices[m].y);if(c<u)return;l<u&&(l=u,h=m)}s=h+1;s>=e.m_vertexCount&&(s=0);n=e.m_vertices[h],i=e.m_vertices[s];l<Number.MIN_VALUE?(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.SetV(e.m_normals[h]),t.m_localPoint.x=.5*(n.x+i.x),t.m_localPoint.y=.5*(n.y+i.y),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0)):(r-n.x)*(i.x-n.x)+(a-n.y)*(i.y-n.y)<=0?(r-n.x)*(r-n.x)+(a-n.y)*(a-n.y)>c*c||(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=r-n.x,t.m_localPlaneNormal.y=a-n.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(n),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0)):(r-i.x)*(n.x-i.x)+(a-i.y)*(n.y-i.y)<=0?(r-i.x)*(r-i.x)+(a-i.y)*(a-i.y)>c*c||(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=r-i.x,t.m_localPlaneNormal.y=a-i.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(i),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0)):(s=.5*(n.x+i.x),i=.5*(n.y+i.y),c<(l=(r-s)*e.m_normals[h].x+(a-i)*e.m_normals[h].y)||(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=e.m_normals[h].x,t.m_localPlaneNormal.y=e.m_normals[h].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(s,i),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0)))},Box2D.Collision.b2Collision.TestOverlap=function(t,e){return!(0<e.lowerBound_.x-t.upperBound_.x)&&(!(0<e.lowerBound_.y-t.upperBound_.y)&&(!(0<t.lowerBound_.x-e.upperBound_.x)&&!(0<t.lowerBound_.y-e.upperBound_.y)))},Box2D.Collision.b2ContactPoint=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.b2Distance.Distance=function(t,e,i){var o=new Box2D.Collision.b2Simplex;o.ReadCache(e,i.proxyA,i.transformA,i.proxyB,i.transformB),o.m_count<1||o.m_count;for(var n,s,r=0;r<20;){for(var a=[],h=0;h<o.m_count;h++)a[h]={},a[h].indexA=o.m_vertices[h].indexA,a[h].indexB=o.m_vertices[h].indexB;if(2==o.m_count?o.Solve2():3==o.m_count&&o.Solve3(),3==o.m_count)break;var l=o.GetSearchDirection();if(l.LengthSquared()<Box2D.Common.b2Settings.MIN_VALUE_SQUARED)break;var c=l.GetNegative();o.m_vertices[o.m_count].indexA=i.proxyA.GetSupport(Box2D.Common.Math.b2Math.MulTMV(i.transformA.R,c)),o.m_vertices[o.m_count].wA=Box2D.Common.Math.b2Math.MulX(i.transformA,i.proxyA.GetVertex(o.m_vertices[o.m_count].indexA)),o.m_vertices[o.m_count].indexB=i.proxyB.GetSupport(Box2D.Common.Math.b2Math.MulTMV(i.transformB.R,l)),o.m_vertices[o.m_count].wB=Box2D.Common.Math.b2Math.MulX(i.transformB,i.proxyB.GetVertex(o.m_vertices[o.m_count].indexB)),o.m_vertices[o.m_count].w=Box2D.Common.Math.b2Math.SubtractVV(o.m_vertices[o.m_count].wB,o.m_vertices[o.m_count].wA),Box2D.Common.Math.b2Vec2.Free(l),Box2D.Common.Math.b2Vec2.Free(c),r++;for(var m=!1,h=0;h<a.length;h++)if(o.m_vertices[o.m_count].indexA==a[h].indexA&&o.m_vertices[o.m_count].indexB==a[h].indexB){m=!0;break}if(m)break;o.m_count++}o.GetWitnessPoints(t.pointA,t.pointB),t.distance=Box2D.Common.Math.b2Math.SubtractVV(t.pointA,t.pointB).Length(),o.WriteCache(e),i.useRadii&&(n=i.proxyA.m_radius,e=i.proxyB.m_radius,t.distance>n+e&&t.distance>Number.MIN_VALUE?(t.distance-=n+e,(s=Box2D.Common.Math.b2Math.SubtractVV(t.pointB,t.pointA)).Normalize(),t.pointA.x+=n*s.x,t.pointA.y+=n*s.y,t.pointB.x-=e*s.x,t.pointB.y-=e*s.y,Box2D.Common.Math.b2Vec2.Free(s)):((s=Box2D.Common.Math.b2Vec2.Get(0,0)).x=.5*(t.pointA.x+t.pointB.x),s.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=s.x,t.pointA.y=t.pointB.y=s.y,t.distance=0,Box2D.Common.Math.b2Vec2.Free(s)))},Box2D.Collision.b2DistanceInput=function(){},Box2D.Collision.b2DistanceOutput=function(){this.pointA=Box2D.Common.Math.b2Vec2.Get(0,0),this.pointB=Box2D.Common.Math.b2Vec2.Get(0,0),this.distance=0},Box2D.Collision.b2DistanceProxy=function(){},Box2D.Collision.b2DistanceProxy.prototype.Set=function(t){t.SetDistanceProxy(this)},Box2D.Collision.b2DistanceProxy.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_count;o++){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;i<n&&(e=o,i=n)}return e},Box2D.Collision.b2DistanceProxy.prototype.GetSupportVertex=function(t){return this.m_vertices[this.GetSupport(t)]},Box2D.Collision.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},Box2D.Collision.b2DistanceProxy.prototype.GetVertex=function(t){return void 0===t&&(t=0),this.m_vertices[t]},Box2D.Collision.b2DynamicTree=function(){this.m_root=null,this.m_path=0,this.m_insertionCount=0},Box2D.Collision.b2DynamicTree.prototype.CreateProxy=function(t,e){var i=Box2D.Collision.b2DynamicTreeNode.Get(e),o=Box2D.Common.b2Settings.b2_aabbExtension,e=Box2D.Common.b2Settings.b2_aabbExtension;return i.aabb.lowerBound_.x=t.lowerBound_.x-o,i.aabb.lowerBound_.y=t.lowerBound_.y-e,i.aabb.upperBound_.x=t.upperBound_.x+o,i.aabb.upperBound_.y=t.upperBound_.y+e,this.InsertLeaf(i),i},Box2D.Collision.b2DynamicTree.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),t.Destroy()},Box2D.Collision.b2DynamicTree.prototype.MoveProxy=function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var o=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(i.x),i=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(i.y);return t.aabb.lowerBound_.x=e.lowerBound_.x-o,t.aabb.lowerBound_.y=e.lowerBound_.y-i,t.aabb.upperBound_.x=e.upperBound_.x+o,t.aabb.upperBound_.y=e.upperBound_.y+i,this.InsertLeaf(t),!0},Box2D.Collision.b2DynamicTree.prototype.Rebalance=function(t){if(null!==this.m_root)for(var e=0;e<t;e++){for(var i=this.m_root,o=0;!i.IsLeaf();)i=this.m_path>>o&1?i.child2:i.child1,o=o+1&31;this.m_path++,this.RemoveLeaf(i),this.InsertLeaf(i)}},Box2D.Collision.b2DynamicTree.prototype.GetFatAABB=function(t){return t.aabb},Box2D.Collision.b2DynamicTree.prototype.Query=function(t,e){if(null!==this.m_root){var i=[];for(i.push(this.m_root);0<i.length;){var o=i.pop();if(o.aabb.TestOverlap(e))if(o.IsLeaf()){if(!t(o.fixture))return}else i.push(o.child1),i.push(o.child2)}}},Box2D.Collision.b2DynamicTree.prototype.RayCast=function(t,e){if(null!==this.m_root){var i=Box2D.Common.Math.b2Math.SubtractVV(e.p1,e.p2);i.Normalize();var o=Box2D.Common.Math.b2Math.CrossFV(1,i),n=Box2D.Common.Math.b2Math.AbsV(o),s=e.maxFraction,r=e.p1.x+s*(e.p2.x-e.p1.x),a=e.p1.y+s*(e.p2.y-e.p1.y),h=Box2D.Collision.b2AABB.Get();h.lowerBound_.x=Math.min(e.p1.x,r),h.lowerBound_.y=Math.min(e.p1.y,a),h.upperBound_.x=Math.max(e.p1.x,r),h.upperBound_.y=Math.max(e.p1.y,a);var l=[];for(l.push(this.m_root);0<l.length;){var c=l.pop();if(c.aabb.TestOverlap(h)){var m=c.aabb.GetCenter(),u=c.aabb.GetExtents();if(!(0<Math.abs(o.x*(e.p1.x-m.x)+o.y*(e.p1.y-m.y))-n.x*u.x-n.y*u.y))if(c.IsLeaf()){new Box2D.Collision.b2RayCastInput(e.p1,e.p2,e.maxFraction);if(0==(s=t(e,c.fixture)))break;0<s&&(r=e.p1.x+s*(e.p2.x-e.p1.x),a=e.p1.y+s*(e.p2.y-e.p1.y),h.lowerBound_.x=Math.min(e.p1.x,r),h.lowerBound_.y=Math.min(e.p1.y,a),h.upperBound_.x=Math.max(e.p1.x,r),h.upperBound_.y=Math.max(e.p1.y,a))}else l.push(c.child1),l.push(c.child2)}}Box2D.Collision.b2AABB.Free(h)}},Box2D.Collision.b2DynamicTree.prototype.InsertLeaf=function(t){if(this.m_insertionCount++,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);var e=this.GetBestSibling(t),i=e.parent,o=Box2D.Collision.b2DynamicTreeNode.Get();if(o.parent=i,o.aabb.Combine(t.aabb,e.aabb),i)for(e.parent.child1==e?i.child1=o:i.child2=o,o.child1=e,o.child2=t,e.parent=o,t.parent=o;i&&!i.aabb.Contains(o.aabb);)i.aabb.Combine(i.child1.aabb,i.child2.aabb),i=(o=i).parent;else o.child1=e,o.child2=t,e.parent=o,t.parent=o,this.m_root=o},Box2D.Collision.b2DynamicTree.prototype.GetBestSibling=function(t){for(var e=t.aabb.GetCenter(),i=this.m_root;!i.IsLeaf();)var o=i.child1,n=i.child2,i=Math.abs((o.aabb.lowerBound_.x+o.aabb.upperBound_.x)/2-e.x)+Math.abs((o.aabb.lowerBound_.y+o.aabb.upperBound_.y)/2-e.y)<Math.abs((n.aabb.lowerBound_.x+n.aabb.upperBound_.x)/2-e.x)+Math.abs((n.aabb.lowerBound_.y+n.aabb.upperBound_.y)/2-e.y)?o:n;return Box2D.Common.Math.b2Vec2.Free(e),i},Box2D.Collision.b2DynamicTree.prototype.RemoveLeaf=function(t){if(t!=this.m_root){var e=t.parent,i=e.parent,t=e.child1==t?e.child2:e.child1;if(i)for(i.child1==e?i.child1=t:i.child2=t,t.parent=i;i;){var o=i.aabb;if(i.aabb.Combine(i.child1.aabb,i.child2.aabb),o.Contains(i.aabb))break;i=i.parent}else(this.m_root=t).parent=null;e.Destroy()}else this.m_root=null},Box2D.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new Box2D.Collision.b2DynamicTree,this.m_moveBuffer=[]},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.CreateProxy=function(t,e){e=this.m_tree.CreateProxy(t,e);return this.BufferMove(e),e},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(t){this.UnBufferMove(t),this.m_tree.DestroyProxy(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.TestOverlap=function(t,e){t=this.m_tree.GetFatAABB(t),e=this.m_tree.GetFatAABB(e);return t.TestOverlap(e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_tree.length},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(t){for(var e=[];0<this.m_moveBuffer.length;){var i=this.m_moveBuffer.pop(),o=this.m_tree.GetFatAABB(i);this.m_tree.Query(function(t){return t!=i.fixture&&e.push(new Box2D.Collision.b2DynamicTreePair(i.fixture,t)),!0},o)}for(var n=0;n<e.length;){var s=e[n];for(t(s.fixtureA,s.fixtureB),n++;n<e.length;){var r=e[n];if(!(r.fixtureA==s.fixtureA&&r.fixtureB==s.fixtureB||r.fixtureA==s.fixtureB&&r.fixtureB==s.fixtureA))break;n++}}},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Query=function(t,e){this.m_tree.Query(t,e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Rebalance=function(t){this.m_tree.Rebalance(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.BufferMove=function(t){this.m_moveBuffer.push(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(t){cr.arrayFindRemove(this.m_moveBuffer,t)},Box2D.Collision.b2DynamicTreeBroadPhase.__implements={},Box2D.Collision.b2DynamicTreeBroadPhase.__implements[Box2D.Collision.IBroadPhase]=!0,Box2D.Collision.b2DynamicTreeNode=function(t){this.aabb=Box2D.Collision.b2AABB.Get(),this.child1=null,this.child2=null,this.parent=null,this.fixture=null,void 0!==t&&(this.fixture=t)},Box2D.Collision.b2DynamicTreeNode._freeCache=[],Box2D.Collision.b2DynamicTreeNode.Get=function(t){if(0<Box2D.Collision.b2DynamicTreeNode._freeCache.length){var e=Box2D.Collision.b2DynamicTreeNode._freeCache.pop();return void 0!==t&&(e.fixture=t),e.aabb.SetZero(),e}return new Box2D.Collision.b2DynamicTreeNode(t)},Box2D.Collision.b2DynamicTreeNode.prototype.Destroy=function(){this.child1=null,this.child2=null,this.parent=null,this.fixture=null,Box2D.Collision.b2DynamicTreeNode._freeCache.push(this)},Box2D.Collision.b2DynamicTreeNode.prototype.IsLeaf=function(){return null===this.child1},Box2D.Collision.b2DynamicTreePair=function(t,e){this.fixtureA=t,this.fixtureB=e},Box2D.Collision.b2Manifold=function(){this.m_pointCount=0,this.m_type=0,this.m_points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=new Box2D.Collision.b2ManifoldPoint;this.m_localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Manifold.prototype.Reset=function(){for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},Box2D.Collision.b2Manifold.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.m_points[e].Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},Box2D.Collision.b2Manifold.prototype.Copy=function(){var t=new Box2D.Collision.b2Manifold;return t.Set(this),t},Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4,Box2D.Collision.b2ManifoldPoint=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_id=new Box2D.Collision.b2ContactID,this.Reset()},Box2D.Collision.b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.SetKey(0)},Box2D.Collision.b2ManifoldPoint.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},Box2D.Collision.b2RayCastInput=function(t,e,i){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0),void 0===i&&(i=1),t&&this.p1.SetV(t),e&&this.p2.SetV(e),this.maxFraction=i},Box2D.Collision.b2RayCastOutput=function(){this.normal=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment=function(){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment.prototype.TestSegment=function(t,e,i,o){void 0===o&&(o=0);var n=i.p1,s=i.p2.x-n.x,r=i.p2.y-n.y,a=this.p2.x-this.p1.x,h=this.p2.y-this.p1.y,l=-a,c=100*Number.MIN_VALUE,m=-(s*h+r*l);if(c<m){i=n.x-this.p1.x,a=n.y-this.p1.y,n=i*h+a*l;if(0<=n&&n<=o*m){i=-s*a+r*i;if(-c*m<=i&&i<=m*(1+c)){n/=m;m=Math.sqrt(h*h+l*l);return h/=m,l/=m,t[0]=n,e.Set(h,l),!0}}}return!1},Box2D.Collision.b2Segment.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},Box2D.Collision.b2Segment.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,t=Math.min(0<e?(t.upperBound_.x-this.p1.x)/e:e<0?(t.lowerBound_.x-this.p1.x)/e:Number.POSITIVE_INFINITY,0<i?(t.upperBound_.y-this.p1.y)/i:i<0?(t.lowerBound_.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*t,this.p2.y=this.p1.y+i*t},Box2D.Collision.b2Segment.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y,t=Math.min(0<e?(t.upperBound_.x-this.p2.x)/e:e<0?(t.lowerBound_.x-this.p2.x)/e:Number.POSITIVE_INFINITY,0<i?(t.upperBound_.y-this.p2.y)/i:i<0?(t.lowerBound_.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*t,this.p1.y=this.p2.y+i*t},Box2D.Collision.b2SeparationFunction=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2SeparationFunction.prototype.Initialize=function(t,e,i,o,n){this.m_proxyA=e,this.m_proxyB=o;var s,r,a,h,l,c,m,u,p,y,_,d=0,f=0,x=0,g=0,b=0,v=0,B=0;1==t.count?(this.m_type=Box2D.Collision.b2SeparationFunction.e_points,s=this.m_proxyA.GetVertex(t.indexA[0]),h=this.m_proxyB.GetVertex(t.indexB[0]),u=s,m=i.R,d=i.position.x+(m.col1.x*u.x+m.col2.x*u.y),f=i.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=h,m=n.R,x=n.position.x+(m.col1.x*u.x+m.col2.x*u.y),g=n.position.y+(m.col1.y*u.x+m.col2.y*u.y),this.m_axis.x=x-d,this.m_axis.y=g-f,this.m_axis.Normalize()):t.indexB[0]==t.indexB[1]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,r=this.m_proxyA.GetVertex(t.indexA[0]),a=this.m_proxyA.GetVertex(t.indexA[1]),h=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(r.x+a.x),this.m_localPoint.y=.5*(r.y+a.y),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(a,r),1),this.m_axis.Normalize(),u=this.m_axis,b=(m=i.R).col1.x*u.x+m.col2.x*u.y,v=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=i.R,d=i.position.x+(m.col1.x*u.x+m.col2.x*u.y),f=i.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=h,m=n.R,(B=((x=n.position.x+(m.col1.x*u.x+m.col2.x*u.y))-d)*b+((g=n.position.y+(m.col1.y*u.x+m.col2.y*u.y))-f)*v)<0&&this.m_axis.NegativeSelf()):t.indexA[0]==t.indexA[0]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,l=this.m_proxyB.GetVertex(t.indexB[0]),c=this.m_proxyB.GetVertex(t.indexB[1]),s=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(l.x+c.x),this.m_localPoint.y=.5*(l.y+c.y),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(c,l),1),this.m_axis.Normalize(),u=this.m_axis,b=(m=n.R).col1.x*u.x+m.col2.x*u.y,v=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=n.R,x=n.position.x+(m.col1.x*u.x+m.col2.x*u.y),g=n.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=s,m=i.R,(B=((d=i.position.x+(m.col1.x*u.x+m.col2.x*u.y))-x)*b+((f=i.position.y+(m.col1.y*u.x+m.col2.y*u.y))-g)*v)<0&&this.m_axis.NegativeSelf()):(r=this.m_proxyA.GetVertex(t.indexA[0]),a=this.m_proxyA.GetVertex(t.indexA[1]),l=this.m_proxyB.GetVertex(t.indexB[0]),c=this.m_proxyB.GetVertex(t.indexB[1]),y=Box2D.Common.Math.b2Math.MulMV(i.R,Box2D.Common.Math.b2Math.SubtractVV(a,r)),_=Box2D.Common.Math.b2Math.MulMV(n.R,Box2D.Common.Math.b2Math.SubtractVV(c,l)),p=y.x*y.x+y.y*y.y,e=_.x*_.x+_.y*_.y,o=Box2D.Common.Math.b2Math.SubtractVV(_,y),t=y.x*o.x+y.y*o.y,o=_.x*o.x+_.y*o.y,(B=0)!=(_=p*e-(y=y.x*_.x+y.y*_.y)*y)&&(B=Box2D.Common.Math.b2Math.Clamp((y*o-t*e)/_,0,1)),(y*B+o)/e<0&&(B=Box2D.Common.Math.b2Math.Clamp((y-t)/p,0,1)),(s=Box2D.Common.Math.b2Vec2.Get(0,0)).x=r.x+B*(a.x-r.x),s.y=r.y+B*(a.y-r.y),(h=Box2D.Common.Math.b2Vec2.Get(0,0)).x=l.x+B*(c.x-l.x),h.y=l.y+B*(c.y-l.y),0==B||1==B?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(c,l),1),this.m_axis.Normalize(),this.m_localPoint=h,u=this.m_axis,b=(m=n.R).col1.x*u.x+m.col2.x*u.y,v=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=n.R,x=n.position.x+(m.col1.x*u.x+m.col2.x*u.y),g=n.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=s,m=i.R,d=i.position.x+(m.col1.x*u.x+m.col2.x*u.y),f=i.position.y+(m.col1.y*u.x+m.col2.y*u.y)):(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(a,r),1),this.m_localPoint=s,u=this.m_axis,b=(m=i.R).col1.x*u.x+m.col2.x*u.y,v=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=i.R,d=i.position.x+(m.col1.x*u.x+m.col2.x*u.y),f=i.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=h,m=n.R,x=n.position.x+(m.col1.x*u.x+m.col2.x*u.y),g=n.position.y+(m.col1.y*u.x+m.col2.y*u.y)),B<0&&this.m_axis.NegativeSelf())},Box2D.Collision.b2SeparationFunction.prototype.Evaluate=function(t,e){var i,o,n,s,r,a,h,l=0;switch(this.m_type){case Box2D.Collision.b2SeparationFunction.e_points:i=Box2D.Common.Math.b2Math.MulTMV(t.R,this.m_axis),o=Box2D.Common.Math.b2Math.MulTMV(e.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(i),s=this.m_proxyB.GetSupportVertex(o),r=Box2D.Common.Math.b2Math.MulX(t,n),l=((a=Box2D.Common.Math.b2Math.MulX(e,s)).x-r.x)*this.m_axis.x+(a.y-r.y)*this.m_axis.y;break;case Box2D.Collision.b2SeparationFunction.e_faceA:h=Box2D.Common.Math.b2Math.MulMV(t.R,this.m_axis),r=Box2D.Common.Math.b2Math.MulX(t,this.m_localPoint),o=Box2D.Common.Math.b2Math.MulTMV(e.R,h.GetNegative()),s=this.m_proxyB.GetSupportVertex(o),l=((a=Box2D.Common.Math.b2Math.MulX(e,s)).x-r.x)*h.x+(a.y-r.y)*h.y;break;case Box2D.Collision.b2SeparationFunction.e_faceB:h=Box2D.Common.Math.b2Math.MulMV(e.R,this.m_axis),a=Box2D.Common.Math.b2Math.MulX(e,this.m_localPoint),i=Box2D.Common.Math.b2Math.MulTMV(t.R,h.GetNegative()),n=this.m_proxyA.GetSupportVertex(i),l=((r=Box2D.Common.Math.b2Math.MulX(t,n)).x-a.x)*h.x+(r.y-a.y)*h.y}return l},Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4,Box2D.Collision.b2Simplex=function(){this.m_v1=new Box2D.Collision.b2SimplexVertex,this.m_v2=new Box2D.Collision.b2SimplexVertex,this.m_v3=new Box2D.Collision.b2SimplexVertex,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]},Box2D.Collision.b2Simplex.prototype.ReadCache=function(t,e,i,o,n){var s,r;this.m_count=t.count;for(var a,h,l=this.m_vertices,c=0;c<this.m_count;c++){var m=l[c];m.indexA=t.indexA[c],m.indexB=t.indexB[c],s=e.GetVertex(m.indexA),r=o.GetVertex(m.indexB),m.wA=Box2D.Common.Math.b2Math.MulX(i,s),m.wB=Box2D.Common.Math.b2Math.MulX(n,r),m.w=Box2D.Common.Math.b2Math.SubtractVV(m.wB,m.wA),m.a=0}1<this.m_count&&(a=t.metric,((h=this.GetMetric())<.5*a||2*a<h||h<Number.MIN_VALUE)&&(this.m_count=0)),0==this.m_count&&((m=l[0]).indexA=0,m.indexB=0,s=e.GetVertex(0),r=o.GetVertex(0),m.wA=Box2D.Common.Math.b2Math.MulX(i,s),m.wB=Box2D.Common.Math.b2Math.MulX(n,r),m.w=Box2D.Common.Math.b2Math.SubtractVV(m.wB,m.wA),this.m_count=1)},Box2D.Collision.b2Simplex.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;i++)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},Box2D.Collision.b2Simplex.prototype.GetSearchDirection=function(){if(1==this.m_count)return this.m_v1.w.GetNegative();if(2!=this.m_count)return Box2D.Common.Math.b2Vec2.Get(0,0);var t=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<Box2D.Common.Math.b2Math.CrossVV(t,this.m_v1.w.GetNegative())?Box2D.Common.Math.b2Math.CrossFV(1,t):Box2D.Common.Math.b2Math.CrossVF(t,1)},Box2D.Collision.b2Simplex.prototype.GetClosestPoint=function(){return 1==this.m_count?this.m_v1.w:2==this.m_count?Box2D.Common.Math.b2Vec2.Get(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Simplex.prototype.GetWitnessPoints=function(t,e){1==this.m_count?(t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB)):2==this.m_count?(t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y):3==this.m_count&&(e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y)},Box2D.Collision.b2Simplex.prototype.GetMetric=function(){return 1==this.m_count?0:2==this.m_count?Box2D.Common.Math.b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length():3==this.m_count?Box2D.Common.Math.b2Math.CrossVV(Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),Box2D.Common.Math.b2Math.SubtractVV(this.m_v3.w,this.m_v1.w)):0},Box2D.Collision.b2Simplex.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=Box2D.Common.Math.b2Math.SubtractVV(e,t),t=-(t.x*i.x+t.y*i.y);if(t<=0)return this.m_v1.a=1,void(this.m_count=1);e=e.x*i.x+e.y*i.y;if(e<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);i=1/(e+t);this.m_v1.a=e*i,this.m_v2.a=t*i,this.m_count=2},Box2D.Collision.b2Simplex.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,o=Box2D.Common.Math.b2Math.SubtractVV(e,t),n=Box2D.Common.Math.b2Math.Dot(t,o),s=Box2D.Common.Math.b2Math.Dot(e,o),r=-n,a=Box2D.Common.Math.b2Math.SubtractVV(i,t),h=Box2D.Common.Math.b2Math.Dot(t,a),l=Box2D.Common.Math.b2Math.Dot(i,a),c=-h,n=Box2D.Common.Math.b2Math.SubtractVV(i,e),h=Box2D.Common.Math.b2Math.Dot(e,n),n=Box2D.Common.Math.b2Math.Dot(i,n),h=-h,o=Box2D.Common.Math.b2Math.CrossVV(o,a),a=o*Box2D.Common.Math.b2Math.CrossVV(e,i),i=o*Box2D.Common.Math.b2Math.CrossVV(i,t),e=o*Box2D.Common.Math.b2Math.CrossVV(t,e);if(r<=0&&c<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<s&&0<r&&e<=0){var m=1/(s+r);return this.m_v1.a=s*m,this.m_v2.a=r*m,void(this.m_count=2)}if(0<l&&0<c&&i<=0){m=1/(l+c);return this.m_v1.a=l*m,this.m_v3.a=c*m,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(s<=0&&h<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(l<=0&&n<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(0<n&&0<h&&a<=0){var u=1/(n+h);return this.m_v2.a=n*u,this.m_v3.a=h*u,this.m_count=2,void this.m_v1.Set(this.m_v3)}u=1/(a+i+e);this.m_v1.a=a*u,this.m_v2.a=i*u,this.m_v3.a=e*u,this.m_count=3},Box2D.Collision.b2SimplexCache=function(){this.indexA=[0,0,0],this.indexB=[0,0,0]},Box2D.Collision.b2SimplexVertex=function(){},Box2D.Collision.b2SimplexVertex.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},Box2D.Collision.b2TOIInput=function(){this.proxyA=new Box2D.Collision.b2DistanceProxy,this.proxyB=new Box2D.Collision.b2DistanceProxy,this.sweepA=new Box2D.Common.Math.b2Sweep,this.sweepB=new Box2D.Common.Math.b2Sweep},Box2D.Collision.b2TimeOfImpact={},Box2D.Collision.b2TimeOfImpact.TimeOfImpact=function(t){Box2D.Collision.b2TimeOfImpact.b2_toiCalls++;var e=t.proxyA,i=t.proxyB,o=t.sweepA,n=t.sweepB,s=e.m_radius+i.m_radius,r=t.tolerance,a=0,h=0,l=0;for(Box2D.Collision.b2TimeOfImpact.s_cache.count=0,Box2D.Collision.b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(o.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,a),n.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,a),Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyA=e,Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyB=i,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformA=Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformB=Box2D.Collision.b2TimeOfImpact.s_xfB,Box2D.Collision.b2Distance.Distance(Box2D.Collision.b2TimeOfImpact.s_distanceOutput,Box2D.Collision.b2TimeOfImpact.s_cache,Box2D.Collision.b2TimeOfImpact.s_distanceInput),Box2D.Collision.b2TimeOfImpact.s_distanceOutput.distance<=0){a=1;break}Box2D.Collision.b2TimeOfImpact.s_fcn.Initialize(Box2D.Collision.b2TimeOfImpact.s_cache,e,Box2D.Collision.b2TimeOfImpact.s_xfA,i,Box2D.Collision.b2TimeOfImpact.s_xfB);var c=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(c<=0){a=1;break}if(0==h&&(l=s<c?Math.max(s-r,.75*s):Math.max(c-r,.02*s)),c-l<.5*r){if(0!=h)break;a=1;break}var m=a,u=a,p=1,y=c;o.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,p),n.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,p);var _=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(l<=_){a=1;break}for(var d=0;;){var f=0,f=1&d?u+(l-y)*(p-u)/(_-y):.5*(u+p);o.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,f),n.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,f);var x=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(Math.abs(x-l)<.025*r){m=f;break}if(l<x?(u=f,y=x):(p=f,_=x),d++,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters++,50==d)break}if(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters,d),m<(1+100*Number.MIN_VALUE)*a)break;if(a=m,h++,Box2D.Collision.b2TimeOfImpact.b2_toiIters++,1e3==h)break}return Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters,h),a},Box2D.Collision.b2WorldManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_points=[];for(var t=this.m_pointCount=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2WorldManifold.prototype.Initialize=function(t,e,i,o,n){if(0!=t.m_pointCount){var s=0,r=0,a=0,h=0,l=0,c=0,m=0;switch(t.m_type){case Box2D.Collision.b2Manifold.e_circles:y=e.R,_=t.m_localPoint;var u=e.position.x+y.col1.x*_.x+y.col2.x*_.y,p=e.position.y+y.col1.y*_.x+y.col2.y*_.y,y=o.R,_=t.m_points[0].m_localPoint,d=o.position.x+y.col1.x*_.x+y.col2.x*_.y,f=o.position.y+y.col1.y*_.x+y.col2.y*_.y,x=d-u,g=f-p,b=x*x+g*g;b>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(b=Math.sqrt(b),this.m_normal.x=x/b,this.m_normal.y=g/b):(this.m_normal.x=1,this.m_normal.y=0);u=u+i*this.m_normal.x,p=p+i*this.m_normal.y,d=d-n*this.m_normal.x,f=f-n*this.m_normal.y;this.m_points[0].x=.5*(u+d),this.m_points[0].y=.5*(p+f);break;case Box2D.Collision.b2Manifold.e_faceA:for(y=e.R,_=t.m_localPlaneNormal,r=y.col1.x*_.x+y.col2.x*_.y,a=y.col1.y*_.x+y.col2.y*_.y,y=e.R,_=t.m_localPoint,h=e.position.x+y.col1.x*_.x+y.col2.x*_.y,l=e.position.y+y.col1.y*_.x+y.col2.y*_.y,this.m_normal.x=r,this.m_normal.y=a,s=0;s<t.m_pointCount;s++)y=o.R,_=t.m_points[s].m_localPoint,c=o.position.x+y.col1.x*_.x+y.col2.x*_.y,m=o.position.y+y.col1.y*_.x+y.col2.y*_.y,this.m_points[s].x=c+.5*(i-(c-h)*r-(m-l)*a-n)*r,this.m_points[s].y=m+.5*(i-(c-h)*r-(m-l)*a-n)*a;break;case Box2D.Collision.b2Manifold.e_faceB:for(y=o.R,_=t.m_localPlaneNormal,r=y.col1.x*_.x+y.col2.x*_.y,a=y.col1.y*_.x+y.col2.y*_.y,y=o.R,_=t.m_localPoint,h=o.position.x+y.col1.x*_.x+y.col2.x*_.y,l=o.position.y+y.col1.y*_.x+y.col2.y*_.y,this.m_normal.x=-r,this.m_normal.y=-a,s=0;s<t.m_pointCount;s++)y=e.R,_=t.m_points[s].m_localPoint,c=e.position.x+y.col1.x*_.x+y.col2.x*_.y,m=e.position.y+y.col1.y*_.x+y.col2.y*_.y,this.m_points[s].x=c+.5*(n-(c-h)*r-(m-l)*a-i)*r,this.m_points[s].y=m+.5*(n-(c-h)*r-(m-l)*a-i)*a}}},Box2D.Dynamics.b2Body=function(t,e){this.ID="Body"+Box2D.Dynamics.b2Body.NEXT_ID++,this.m_xf=new Box2D.Common.Math.b2Transform,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep=new Box2D.Common.Math.b2Sweep,this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle,this.m_sweep.c.x=this.m_xf.R.col1.x*this.m_sweep.localCenter.x+this.m_xf.R.col2.x*this.m_sweep.localCenter.y,this.m_sweep.c.y=this.m_xf.R.col1.y*this.m_sweep.localCenter.x+this.m_xf.R.col2.y*this.m_sweep.localCenter.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_linearVelocity=t.linearVelocity.Copy(),this.m_force=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_bullet=t.bullet,this.m_fixedRotation=t.fixedRotation,this.m_allowSleep=t.allowSleep,this.m_awake=t.awake,this.m_active=t.active,this.m_world=e,this.m_jointList=null,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_controllerCount=0,this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_mass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invMass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.fixtureList=new Box2D.Dynamics.b2FixtureList,this.m_lists=[]},Box2D.Dynamics.b2Body.prototype.CreateFixture=function(t){var e=new Box2D.Dynamics.b2Fixture(this,this.m_xf,t);return this.m_active&&(t=this.m_world.m_contactManager.m_broadPhase,e.CreateProxy(t,this.m_xf)),this.fixtureList.AddFixture(e),e.m_body=this,0<e.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},Box2D.Dynamics.b2Body.prototype.CreateFixture2=function(t,e){void 0===e&&(e=0);var i=new Box2D.Dynamics.b2FixtureDef;return i.shape=t,i.density=e,this.CreateFixture(i)},Box2D.Dynamics.b2Body.prototype.Destroy=function(){Box2D.Common.Math.b2Vec2.Free(this.m_linearVelocity),Box2D.Common.Math.b2Vec2.Free(this.m_force)},Box2D.Dynamics.b2Body.prototype.DestroyFixture=function(t){this.fixtureList.RemoveFixture(t);for(var e,i=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);i;i=i.GetNextNode())t!=i.contact.m_fixtureA&&t!=i.contact.m_fixtureB||this.m_world.m_contactManager.Destroy(i.contact);this.m_active&&(e=this.m_world.m_contactManager.m_broadPhase,t.DestroyProxy(e)),t.Destroy(),t.m_body=null,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.SetPositionAndAngle=function(t,e){this.m_xf.R.Set(e),this.m_xf.position.SetV(t);var i=this.m_xf.R,t=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*t.x+i.col2.x*t.y,this.m_sweep.c.y=i.col1.y*t.x+i.col2.y*t.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e;for(var o=this.m_world.m_contactManager.m_broadPhase,n=this.fixtureList.GetFirstNode();n;n=n.GetNextNode())n.fixture.Synchronize(o,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2Body.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetTransform=function(){return this.m_xf},Box2D.Dynamics.b2Body.prototype.GetPosition=function(){return this.m_xf.position},Box2D.Dynamics.b2Body.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetAngle=function(){return this.m_sweep.a},Box2D.Dynamics.b2Body.prototype.SetAngle=function(t){this.SetPositionAndAngle(this.GetPosition(),t)},Box2D.Dynamics.b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},Box2D.Dynamics.b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},Box2D.Dynamics.b2Body.prototype.SetLinearVelocity=function(t){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_linearVelocity.SetV(t)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},Box2D.Dynamics.b2Body.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_angularVelocity=t)},Box2D.Dynamics.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},Box2D.Dynamics.b2Body.prototype.GetDefinition=function(){var t=new Box2D.Dynamics.b2BodyDef;return t.type=this.GetType(),t.allowSleep=this.m_allowSleep,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotation,t.bullet=this.m_bullet,t.active=this.m_active,t.awake=this.m_awake,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t},Box2D.Dynamics.b2Body.prototype.ApplyForce=function(t,e){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},Box2D.Dynamics.b2Body.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_torque+=t)},Box2D.Dynamics.b2Body.prototype.ApplyImpulse=function(t,e){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},Box2D.Dynamics.b2Body.prototype.Split=function(t){for(var e=this.GetLinearVelocity().Copy(),i=this.GetAngularVelocity(),o=this.GetWorldCenter(),n=this.m_world.CreateBody(this.GetDefinition()),s=this.fixtureList.GetFirstNode();s;s=s.GetNextNode()){var r=s.fixture;t(r)&&(this.fixtureList.RemoveFixture(r),n.fixtureList.AddFixture(r))}this.ResetMassData(),n.ResetMassData();var a=this.GetWorldCenter(),h=n.GetWorldCenter(),a=Box2D.Common.Math.b2Math.AddVV(e,Box2D.Common.Math.b2Math.CrossFV(i,Box2D.Common.Math.b2Math.SubtractVV(a,o))),o=Box2D.Common.Math.b2Math.AddVV(e,Box2D.Common.Math.b2Math.CrossFV(i,Box2D.Common.Math.b2Math.SubtractVV(h,o)));return this.SetLinearVelocity(a),n.SetLinearVelocity(o),this.SetAngularVelocity(i),n.SetAngularVelocity(i),this.SynchronizeFixtures(),n.SynchronizeFixtures(),n},Box2D.Dynamics.b2Body.prototype.Merge=function(t){for(var e=t.fixtureList.GetFirstNode();e;e=e.GetNextNode())this.fixtureList.AddFixture(e.fixture),t.fixtureList.RemoveFixture(e.fixture);t.ResetMassData(),this.ResetMassData(),this.SynchronizeFixtures()},Box2D.Dynamics.b2Body.prototype.GetMass=function(){return this.m_mass},Box2D.Dynamics.b2Body.prototype.GetInertia=function(){return this.m_I},Box2D.Dynamics.b2Body.prototype.GetMassData=function(t){return(t=t||new Box2D.Collision.Shapes.b2MassData).mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter),t},Box2D.Dynamics.b2Body.prototype.SetMassData=function(t){var e;this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&!this.m_fixedRotation&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I),e=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(t.center),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-e.x))},Box2D.Dynamics.b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_type!=Box2D.Dynamics.b2BodyDef.b2_kinematicBody){for(var t=Box2D.Common.Math.b2Vec2.Get(0,0),e=this.fixtureList.GetFirstNode();e;e=e.GetNextNode()){var i=e.fixture;0!=i.m_density&&(i=i.GetMassData(),this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I)}0<this.m_mass?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&!this.m_fixedRotation?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var o=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-o.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-o.x),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(o)}},Box2D.Dynamics.b2Body.prototype.GetWorldPoint=function(t){var e=this.m_xf.R,t=Box2D.Common.Math.b2Vec2.Get(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,t},Box2D.Dynamics.b2Body.prototype.GetWorldVector=function(t){return Box2D.Common.Math.b2Math.MulMV(this.m_xf.R,t)},Box2D.Dynamics.b2Body.prototype.GetLocalPoint=function(t){return Box2D.Common.Math.b2Math.MulXT(this.m_xf,t)},Box2D.Dynamics.b2Body.prototype.GetLocalVector=function(t){return Box2D.Common.Math.b2Math.MulTMV(this.m_xf.R,t)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(t){return Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R,e=Box2D.Common.Math.b2Vec2.Get(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y;t=Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x));return Box2D.Common.Math.b2Vec2.Free(e),t},Box2D.Dynamics.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},Box2D.Dynamics.b2Body.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},Box2D.Dynamics.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},Box2D.Dynamics.b2Body.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},Box2D.Dynamics.b2Body.prototype.SetType=function(t){if(this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.FlagForFiltering();for(var i=0;i<this.m_lists.length;i++)this.m_lists[i].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.b2Body.prototype.SetBullet=function(t){this.m_bullet=t},Box2D.Dynamics.b2Body.prototype.IsBullet=function(){return this.m_bullet},Box2D.Dynamics.b2Body.prototype.SetSleepingAllowed=function(t){(this.m_allowSleep=t)||this.SetAwake(!0)},Box2D.Dynamics.b2Body.prototype.SetAwake=function(t){if(this.m_awake!=t){this.m_awake=t,this.m_sleepTime=0,t||(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0);for(var e=0;e<this.m_lists.length;e++)this.m_lists[e].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsAwake=function(){return this.m_awake},Box2D.Dynamics.b2Body.prototype.SetFixedRotation=function(t){this.m_fixedRotation=t,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotation},Box2D.Dynamics.b2Body.prototype.SetActive=function(t){if(t!=this.m_active){if(t){this.m_active=!0;for(var e=this.m_world.m_contactManager.m_broadPhase,i=this.fixtureList.GetFirstNode();i;i=i.GetNextNode())i.fixture.CreateProxy(e,this.m_xf)}else{this.m_active=!1;for(e=this.m_world.m_contactManager.m_broadPhase,i=this.fixtureList.GetFirstNode();i;i=i.GetNextNode())i.fixture.DestroyProxy(e);for(var o=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);o;o=o.GetNextNode())this.m_world.m_contactManager.Destroy(o.contact)}for(var n=0;n<this.m_lists.length;n++)this.m_lists[n].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsActive=function(){return this.m_active},Box2D.Dynamics.b2Body.prototype.IsSleepingAllowed=function(){return this.m_allowSleep},Box2D.Dynamics.b2Body.prototype.GetFixtureList=function(){return this.fixtureList},Box2D.Dynamics.b2Body.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2Body.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2Body.prototype.AddController=function(t){this.controllerList.AddController(t)},Box2D.Dynamics.b2Body.prototype.RemoveController=function(t){this.controllerList.RemoveController(t)},Box2D.Dynamics.b2Body.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2Body.prototype.GetWorld=function(){return this.m_world},Box2D.Dynamics.b2Body.prototype.SynchronizeFixtures=function(){var t=Box2D.Dynamics.b2Body.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R,i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y),t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);for(var o=this.m_world.m_contactManager.m_broadPhase,n=this.fixtureList.GetFirstNode();n;n=n.GetNextNode())n.fixture.Synchronize(o,t,this.m_xf)},Box2D.Dynamics.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},Box2D.Dynamics.b2Body.prototype.ShouldCollide=function(t){if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&t.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},Box2D.Dynamics.b2Body.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.Dynamics.b2Body.NEXT_ID=0,Box2D.Dynamics.b2BodyDef=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearVelocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.angle=0,this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,this.active=!0,this.inertiaScale=1},Box2D.Dynamics.b2BodyDef.b2_staticBody=0,Box2D.Dynamics.b2BodyDef.b2_kinematicBody=1,Box2D.Dynamics.b2BodyDef.b2_dynamicBody=2,Box2D.Dynamics.b2BodyList=function(){this.bodyFirstNodes=[];for(var t=0;t<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;t++)this.bodyFirstNodes[t]=null;this.bodyLastNodes=[];for(t=0;t<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;t++)this.bodyLastNodes[t]=null;this.bodyNodeLookup={},this.bodyCount=0},Box2D.Dynamics.b2BodyList.prototype.GetFirstNode=function(t){return this.bodyFirstNodes[t]},Box2D.Dynamics.b2BodyList.prototype.AddBody=function(t){var e=t.ID;null==this.bodyNodeLookup[e]&&(this.CreateNode(t,e,Box2D.Dynamics.b2BodyList.TYPES.allBodies),this.UpdateBody(t),t.m_lists.push(this),this.bodyCount++)},Box2D.Dynamics.b2BodyList.prototype.UpdateBody=function(t){var e=t.GetType(),i=t.ID,o=t.IsAwake(),n=t.IsActive();e==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies),e!=Box2D.Dynamics.b2BodyDef.b2_staticBody?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies),e!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&n&&o?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies),o?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies),n?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.activeBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.activeBodies)},Box2D.Dynamics.b2BodyList.prototype.RemoveBody=function(t){var e=t.ID;if(null!=this.bodyNodeLookup[e]){cr.arrayFindRemove(t.m_lists,this);for(var i=0;i<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;i++)this.RemoveNode(e,i);delete this.bodyNodeLookup[e],this.bodyCount--}},Box2D.Dynamics.b2BodyList.prototype.RemoveNode=function(t,e){var i=this.bodyNodeLookup[t];null==i||null!=(t=i[e])&&(i[e]=null,i=t.GetPreviousNode(),t=t.GetNextNode(),null==i?this.bodyFirstNodes[e]=t:i.SetNextNode(t),null==t?this.bodyLastNodes[e]=i:t.SetPreviousNode(i))},Box2D.Dynamics.b2BodyList.prototype.CreateNode=function(t,e,i){var o=this.bodyNodeLookup[e];if(null==o){o=[];for(var n=0;n<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;n++)o[n]=null;this.bodyNodeLookup[e]=o}null==o[i]&&(o[i]=new Box2D.Dynamics.b2BodyListNode(t),null!=(t=this.bodyLastNodes[i])?t.SetNextNode(o[i]):this.bodyFirstNodes[i]=o[i],o[i].SetPreviousNode(t),this.bodyLastNodes[i]=o[i])},Box2D.Dynamics.b2BodyList.prototype.GetBodyCount=function(){return this.bodyCount},Box2D.Dynamics.b2BodyList.TYPES={dynamicBodies:0,nonStaticBodies:1,activeBodies:2,nonStaticActiveAwakeBodies:3,awakeBodies:4,allBodies:5},Box2D.Dynamics.b2BodyListNode=function(t){this.body=t,this.next=null,this.previous=null},Box2D.Dynamics.b2BodyListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.b2BodyListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.b2BodyListNode.prototype.GetBody=function(){return this.body},Box2D.Dynamics.b2BodyListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2BodyListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.b2ContactFilter=function(){},Box2D.Dynamics.b2ContactFilter.prototype.ShouldCollide=function(t,e){t=t.GetFilterData(),e=e.GetFilterData();return t.groupIndex==e.groupIndex&&0!=t.groupIndex?0<t.groupIndex:0!=(t.maskBits&e.categoryBits)&&0!=(t.categoryBits&e.maskBits)},Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.b2ContactListener=function(){},Box2D.Dynamics.b2ContactListener.prototype.BeginContact=function(t){},Box2D.Dynamics.b2ContactListener.prototype.EndContact=function(t){},Box2D.Dynamics.b2ContactListener.prototype.PreSolve=function(t,e){},Box2D.Dynamics.b2ContactListener.prototype.PostSolve=function(t,e){},Box2D.Dynamics.b2ContactManager=function(t){this.m_world=t,this.m_contactFilter=Box2D.Dynamics.b2ContactFilter.b2_defaultFilter,this.m_contactListener=Box2D.Dynamics.b2ContactListener.b2_defaultListener,this.m_contactFactory=new Box2D.Dynamics.Contacts.b2ContactFactory,this.m_broadPhase=new Box2D.Collision.b2DynamicTreeBroadPhase},Box2D.Dynamics.b2ContactManager.prototype.AddPair=function(t,e){var i=t.GetBody(),o=e.GetBody();if(i!=o&&o.ShouldCollide(i)&&this.m_contactFilter.ShouldCollide(t,e)){for(var n=o.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode()){var s=n.contact.m_fixtureA;if(s==t){if(n.contact.m_fixtureB==e)return}else if(s==e)if(n.contact.m_fixtureB==t)return}this.m_contactFactory.Create(t,e)}},Box2D.Dynamics.b2ContactManager.prototype.FindNewContacts=function(){var i=this;this.m_broadPhase.UpdatePairs(function(t,e){i.AddPair(t,e)})},Box2D.Dynamics.b2ContactManager.prototype.Destroy=function(t){var e=t.m_fixtureA,i=t.m_fixtureB;e.GetBody(),i.GetBody();t.touching&&this.m_contactListener.EndContact(t),0<t.m_manifold.m_pointCount&&(t.m_fixtureA.GetBody().SetAwake(!0),t.m_fixtureB.GetBody().SetAwake(!0)),t.RemoveFromLists(),this.m_contactFactory.Destroy(t)},Box2D.Dynamics.b2ContactManager.prototype.Collide=function(){for(var t=this.m_world.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode()){var e=t.contact,i=e.m_fixtureA,o=e.m_fixtureB,n=i.GetBody(),s=o.GetBody();if(0!=n.IsAwake()||0!=s.IsAwake()){if(e.IsFiltering()){if(0==s.ShouldCollide(n)){this.Destroy(e);continue}if(0==this.m_contactFilter.ShouldCollide(i,o)){this.Destroy(e);continue}e.ClearFiltering()}i=i.m_proxy,o=o.m_proxy;0!=this.m_broadPhase.TestOverlap(i,o)?e.Update(this.m_contactListener):this.Destroy(e)}}},Box2D.Dynamics.b2DestructionListener=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeJoint=function(t){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeFixture=function(t){},Box2D.Dynamics.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},Box2D.Dynamics.b2FilterData.prototype.Copy=function(){var t=new Box2D.Dynamics.b2FilterData;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},Box2D.Dynamics.b2Fixture=function(t,e,i){this.ID="Fixture"+Box2D.Dynamics.b2Fixture.NEXT_ID++,this.m_filter=i.filter.Copy(),this.m_aabb=Box2D.Collision.b2AABB.Get(),this.m_body=t,this.m_shape=i.shape.Copy(),this.m_density=i.density,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_isSensor=i.isSensor},Box2D.Dynamics.b2Fixture.prototype.GetShape=function(){return this.m_shape},Box2D.Dynamics.b2Fixture.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(var e=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode()){var i=e.contact.m_fixtureA,o=e.contact.m_fixtureB;i!=this&&o!=this||e.contact.SetSensor(i.sensor||o.sensor)}},Box2D.Dynamics.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},Box2D.Dynamics.b2Fixture.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),null!=this.m_body)for(var e=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.m_fixtureA!=this&&e.contact.m_fixtureB!=this||e.contact.FlagForFiltering()},Box2D.Dynamics.b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},Box2D.Dynamics.b2Fixture.prototype.GetBody=function(){return this.m_body},Box2D.Dynamics.b2Fixture.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},Box2D.Dynamics.b2Fixture.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},Box2D.Dynamics.b2Fixture.prototype.GetMassData=function(t){return t=t||new Box2D.Collision.Shapes.b2MassData,this.m_shape.ComputeMass(t,this.m_density),t},Box2D.Dynamics.b2Fixture.prototype.SetDensity=function(t){this.m_density=t},Box2D.Dynamics.b2Fixture.prototype.GetDensity=function(){return this.m_density},Box2D.Dynamics.b2Fixture.prototype.GetFriction=function(){return this.m_friction},Box2D.Dynamics.b2Fixture.prototype.SetFriction=function(t){this.m_friction=t},Box2D.Dynamics.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},Box2D.Dynamics.b2Fixture.prototype.SetRestitution=function(t){this.m_restitution=t},Box2D.Dynamics.b2Fixture.prototype.GetAABB=function(){return this.m_aabb},Box2D.Dynamics.b2Fixture.prototype.Destroy=function(){Box2D.Collision.b2AABB.Free(this.m_aabb)},Box2D.Dynamics.b2Fixture.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},Box2D.Dynamics.b2Fixture.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},Box2D.Dynamics.b2Fixture.prototype.Synchronize=function(t,e,i){var o,n;this.m_proxy&&(o=Box2D.Collision.b2AABB.Get(),n=Box2D.Collision.b2AABB.Get(),this.m_shape.ComputeAABB(o,e),this.m_shape.ComputeAABB(n,i),this.m_aabb.Combine(o,n),Box2D.Collision.b2AABB.Free(o),Box2D.Collision.b2AABB.Free(n),e=Box2D.Common.Math.b2Math.SubtractVV(i.position,e.position),t.MoveProxy(this.m_proxy,this.m_aabb,e),Box2D.Common.Math.b2Vec2.Free(e))},Box2D.Dynamics.b2Fixture.NEXT_ID=0,Box2D.Dynamics.b2FixtureDef=function(){this.filter=new Box2D.Dynamics.b2FilterData,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.shape=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1},Box2D.Dynamics.b2FixtureList=function(){this.fixtureFirstNode=null,this.fixtureLastNode=null,this.fixtureNodeLookup={},this.fixtureCount=0},Box2D.Dynamics.b2FixtureList.prototype.GetFirstNode=function(){return this.fixtureFirstNode},Box2D.Dynamics.b2FixtureList.prototype.AddFixture=function(t){var e,i=t.ID;null==this.fixtureNodeLookup[i]&&(e=new Box2D.Dynamics.b2FixtureListNode(t),null!=(t=this.fixtureLastNode)?t.SetNextNode(e):this.fixtureFirstNode=e,e.SetPreviousNode(t),this.fixtureLastNode=e,this.fixtureNodeLookup[i]=e,this.fixtureCount++)},Box2D.Dynamics.b2FixtureList.prototype.RemoveFixture=function(t){var e=t.ID,i=this.fixtureNodeLookup[e];null!=i&&(t=i.GetPreviousNode(),i=i.GetNextNode(),null==t?this.fixtureFirstNode=i:t.SetNextNode(i),null==i?this.fixtureLastNode=t:i.SetPreviousNode(t),delete this.fixtureNodeLookup[e],this.fixtureCount--)},Box2D.Dynamics.b2FixtureList.prototype.GetFixtureCount=function(){return this.fixtureCount},Box2D.Dynamics.b2FixtureListNode=function(t){this.fixture=t,this.next=null,this.previous=null},Box2D.Dynamics.b2FixtureListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.b2FixtureListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.b2FixtureListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2FixtureListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.b2Island=function(t,e){this.m_listener=t,this.m_contactSolver=e,this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Clear=function(){this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Solve=function(t,e,i){this._InitializeVelocities(t,e),this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contacts.length),this._SolveVelocityConstraints(t),this._SolveBodies(t),this._SolvePositionConstraints(t),this.Report(this.m_contactSolver.m_constraints),i&&this._SleepIfTired(t)},Box2D.Dynamics.b2Island.prototype._InitializeVelocities=function(t,e){for(var i=0;i<this.m_dynamicBodies.length;i++){var o=this.m_dynamicBodies[i];o.m_linearVelocity.x+=t.dt*(e.x+o.m_invMass*o.m_force.x),o.m_linearVelocity.y+=t.dt*(e.y+o.m_invMass*o.m_force.y),o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque,o.m_linearVelocity.Multiply(Box2D.Common.Math.b2Math.Clamp(1-t.dt*o.m_linearDamping,0,1)),o.m_angularVelocity*=Box2D.Common.Math.b2Math.Clamp(1-t.dt*o.m_angularDamping,0,1)}},Box2D.Dynamics.b2Island.prototype._SolveVelocityConstraints=function(t){this.m_contactSolver.InitVelocityConstraints(t);for(var e=0;e<this.m_joints.length;e++)this.m_joints[e].InitVelocityConstraints(t);for(var i=0;i<t.velocityIterations;i++){for(var o=0;o<this.m_joints.length;o++)this.m_joints[o].SolveVelocityConstraints(t);this.m_contactSolver.SolveVelocityConstraints()}for(var n=0;n<this.m_joints.length;n++)this.m_joints[n].FinalizeVelocityConstraints();this.m_contactSolver.FinalizeVelocityConstraints()},Box2D.Dynamics.b2Island.prototype._SolveBodies=function(t){for(var e=0;e<this.m_nonStaticBodies.length;++e){var i=this.m_nonStaticBodies[e],o=t.dt*i.m_linearVelocity.x,n=t.dt*i.m_linearVelocity.y;o*o+n*n>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt,i.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt);n=t.dt*i.m_angularVelocity;n*n>Box2D.Common.b2Settings.b2_maxRotationSquared&&(i.m_angularVelocity<0?i.m_angularVelocity=-Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt:i.m_angularVelocity=Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=t.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=t.dt*i.m_linearVelocity.y,i.m_sweep.a+=t.dt*i.m_angularVelocity,i.SynchronizeTransform()}},Box2D.Dynamics.b2Island.prototype._SolvePositionConstraints=function(t){for(var e=0;e<t.positionIterations;e++){for(var i=this.m_contactSolver.SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),o=!0,n=0;n<this.m_joints.length;n++)var s=this.m_joints[n].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),o=o&&s;if(i&&o)break}},Box2D.Dynamics.b2Island.prototype._SleepIfTired=function(t){for(var e=Number.MAX_VALUE,i=0;i<this.m_nonStaticBodies.length;i++)var o=this.m_nonStaticBodies[i],e=!o.m_allowSleep||Math.abs(o.m_angularVelocity)>Box2D.Common.b2Settings.b2_angularSleepTolerance||Box2D.Common.Math.b2Math.Dot(o.m_linearVelocity,o.m_linearVelocity)>Box2D.Common.b2Settings.b2_linearSleepToleranceSquared?o.m_sleepTime=0:(o.m_sleepTime+=t.dt,Math.min(e,o.m_sleepTime));if(e>=Box2D.Common.b2Settings.b2_timeToSleep)for(var n=0;n<this.m_bodies.length;n++)this.m_bodies[n].SetAwake(!1)},Box2D.Dynamics.b2Island.prototype.SolveTOI=function(t){var e=0,i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contacts.length);for(var o=this.m_contactSolver,e=0;e<this.m_joints.length;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;++e)for(o.SolveVelocityConstraints(),i=0;i<this.m_joints.length;++i)this.m_joints[i].SolveVelocityConstraints(t);for(e=0;e<this.m_nonStaticBodies.length;++e){var n=this.m_nonStaticBodies[e],s=t.dt*n.m_linearVelocity.x,r=t.dt*n.m_linearVelocity.y;s*s+r*r>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt,n.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt);r=t.dt*n.m_angularVelocity;r*r>Box2D.Common.b2Settings.b2_maxRotationSquared&&(n.m_angularVelocity<0?n.m_angularVelocity=-Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt:n.m_angularVelocity=Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y,n.m_sweep.a+=t.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(e=0;e<t.positionIterations;++e){for(var a=o.SolvePositionConstraints(.75),h=!0,i=0;i<this.m_joints.length;++i)var l=this.m_joints[i].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),h=h&&l;if(a&&h)break}this.Report(o.m_constraints)},Box2D.Dynamics.b2Island.prototype.Report=function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contacts.length;++e){for(var i=this.m_contacts[e],o=t[e],n=new Box2D.Dynamics.b2ContactImpulse,s=0;s<o.pointCount;++s)n.normalImpulses[s]=o.points[s].normalImpulse,n.tangentImpulses[s]=o.points[s].tangentImpulse;this.m_listener.PostSolve(i,n)}},Box2D.Dynamics.b2Island.prototype.AddBody=function(t){this.m_bodies.push(t),t.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_nonStaticBodies.push(t),t.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&this.m_dynamicBodies.push(t))},Box2D.Dynamics.b2Island.prototype.AddContact=function(t){this.m_contacts.push(t)},Box2D.Dynamics.b2Island.prototype.AddJoint=function(t){this.m_joints.push(t)},Box2D.Dynamics.b2TimeStep=function(t,e,i,o,n){t=0<(this.dt=t)?1/t:0;this.inv_dt=t,this.dtRatio=e,this.positionIterations=i,this.velocityIterations=o,this.warmStarting=n},Box2D.Dynamics.b2World=function(t,e){this.m_contactManager=new Box2D.Dynamics.b2ContactManager(this),this.m_contactSolver=new Box2D.Dynamics.Contacts.b2ContactSolver,this.m_isLocked=!1,this.m_newFixture=!1,this.m_destructionListener=null,this.bodyList=new Box2D.Dynamics.b2BodyList,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.m_jointList=null,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_jointCount=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_allowSleep=e,this.m_gravity=t,this.m_inv_dt0=0,this.m_groundBody=this.CreateBody(new Box2D.Dynamics.b2BodyDef)},Box2D.Dynamics.b2World.MAX_TOI=1-100*Number.MIN_VALUE,Box2D.Dynamics.b2World.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},Box2D.Dynamics.b2World.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},Box2D.Dynamics.b2World.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},Box2D.Dynamics.b2World.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);i;i=i.GetNextNode())for(var o=i.body.GetFixtureList().GetFirstNode();o;o=o.GetNextNode()){var n=o.fixture;n.m_proxy=t.CreateProxy(e.GetFatAABB(n.m_proxy),n)}},Box2D.Dynamics.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},Box2D.Dynamics.b2World.prototype.CreateBody=function(t){t=new Box2D.Dynamics.b2Body(t,this);return this.bodyList.AddBody(t),t},Box2D.Dynamics.b2World.prototype.DestroyBody=function(t){for(var e=t.m_jointList;e;){var i=e,e=e.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint)}for(var o=t.GetControllerList().GetFirstNode();o;o=o.GetNextNode())o.controller.RemoveBody(t);for(var n=t.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode())this.m_contactManager.Destroy(n.contact);for(var s=t.GetFixtureList().GetFirstNode();s;s=s.GetNextNode())this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(s.fixture),t.DestroyFixture(s.fixture);t.Destroy(),this.bodyList.RemoveBody(t)},Box2D.Dynamics.b2World.prototype.CreateJoint=function(t){var e=Box2D.Dynamics.Joints.b2Joint.Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,this.m_jointCount++,(e.m_edgeA.joint=e).m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,(e.m_edgeB.joint=e).m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,o=t.bodyB;if(!t.collideConnected)for(var n=o.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode())n.contact.GetOther(o)==i&&n.contact.FlagForFiltering();return e},Box2D.Dynamics.b2World.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,o=t.m_bodyB;if(i.SetAwake(!0),o.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==o.m_jointList&&(o.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,this.m_jointCount--,!e)for(var n=o.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode())n.contact.GetOther(o)==i&&n.contact.FlagForFiltering()},Box2D.Dynamics.b2World.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2World.prototype.AddController=function(t){if(null!==t.m_world&&t.m_world!=this)throw new Error("Controller can only be a member of one world");return this.controllerList.AddController(t),t.m_world=this,t},Box2D.Dynamics.b2World.prototype.RemoveController=function(t){this.controllerList.RemoveController(t),t.m_world=null,t.Clear()},Box2D.Dynamics.b2World.prototype.CreateController=function(t){return this.AddController(t)},Box2D.Dynamics.b2World.prototype.DestroyController=function(t){this.RemoveController(t)},Box2D.Dynamics.b2World.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},Box2D.Dynamics.b2World.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},Box2D.Dynamics.b2World.prototype.GetBodyCount=function(){return this.bodyList.GetBodyCount()},Box2D.Dynamics.b2World.prototype.GetJointCount=function(){return this.m_jointCount},Box2D.Dynamics.b2World.prototype.GetContactCount=function(){return this.contactList.GetContactCount()},Box2D.Dynamics.b2World.prototype.SetGravity=function(t){this.m_gravity=t},Box2D.Dynamics.b2World.prototype.GetGravity=function(){return this.m_gravity},Box2D.Dynamics.b2World.prototype.GetGroundBody=function(){return this.m_groundBody},Box2D.Dynamics.b2World.prototype.Step=function(t,e,i){this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_isLocked=!0;i=new Box2D.Dynamics.b2TimeStep(t,this.m_inv_dt0*t,e,i,this.m_warmStarting);this.m_contactManager.Collide(),0<i.dt&&(this.Solve(i),this.m_continuousPhysics&&this.SolveTOI(i),this.m_inv_dt0=i.inv_dt),this.m_isLocked=!1},Box2D.Dynamics.b2World.prototype.ClearForces=function(){for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);t;t=t.GetNextNode())t.body.m_force.SetZero(),t.body.m_torque=0},Box2D.Dynamics.b2World.prototype.QueryAABB=function(t,e){this.m_contactManager.m_broadPhase.Query(t,e)},Box2D.Dynamics.b2World.prototype.QueryPoint=function(e,i){var t=Box2D.Collision.b2AABB.Get();t.lowerBound_.Set(i.x-Box2D.Common.b2Settings.b2_linearSlop,i.y-Box2D.Common.b2Settings.b2_linearSlop),t.upperBound_.Set(i.x+Box2D.Common.b2Settings.b2_linearSlop,i.y+Box2D.Common.b2Settings.b2_linearSlop),this.m_contactManager.m_broadPhase.Query(function(t){return!t.TestPoint(i)||e(t)},t),Box2D.Collision.b2AABB.Free(t)},Box2D.Dynamics.b2World.prototype.RayCast=function(o,n,s){var t=this.m_contactManager.m_broadPhase,r=new Box2D.Collision.b2RayCastOutput,e=new Box2D.Collision.b2RayCastInput(n,s,1);t.RayCast(function(t,e){if(e.RayCast(r,t)){var i=1-r.fraction,i=Box2D.Common.Math.b2Vec2.Get(i*n.x+r.fraction*s.x,i*n.y+r.fraction*s.y),e=o(e,i,r.normal,r.fraction);return Box2D.Common.Math.b2Vec2.Free(i),e}return t.maxFraction},e)},Box2D.Dynamics.b2World.prototype.RayCastOne=function(t,e){var n=null;return this.RayCast(function(t,e,i,o){return n=t,o},t,e),n},Box2D.Dynamics.b2World.prototype.RayCastAll=function(t,e){var n=[];return this.RayCast(function(t,e,i,o){return n.push(t),1},t,e),n},Box2D.Dynamics.b2World.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.b2World.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2World.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2World.prototype.IsLocked=function(){return this.m_isLocked};var b2solvearray=[];Box2D.Dynamics.b2World.prototype.Solve=function(t){for(var e=this.controllerList.GetFirstNode();e;e=e.GetNextNode())e.controller.Step(t);for(var i=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver),o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);o;o=o.GetNextNode())o.body.m_islandFlag=!1;for(var n=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode())n.contact.m_islandFlag=!1;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);o;o=o.GetNextNode()){var r=o.body;if(!r.m_islandFlag){i.Clear(),b2solvearray.length=0;var a=b2solvearray;for(a.push(r),r.m_islandFlag=!0;0<a.length;){var h=a.pop();if(i.AddBody(h),h.IsAwake()||h.SetAwake(!0),h.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody){for(n=h.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);n;n=n.GetNextNode()){var l=n.contact;l.m_islandFlag||(i.AddContact(l),l.m_islandFlag=!0,(l=l.GetOther(h)).m_islandFlag||(a.push(l),l.m_islandFlag=!0))}for(var c=h.m_jointList;c;c=c.next)!c.joint.m_islandFlag&&c.other.IsActive()&&(i.AddJoint(c.joint),c.joint.m_islandFlag=!0,c.other.m_islandFlag||(a.push(c.other),c.other.m_islandFlag=!0))}}i.Solve(t,this.m_gravity,this.m_allowSleep)}}for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);o;o=o.GetNextNode())o.body.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2World.prototype.SolveTOI=function(t){for(var e=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver),i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);i;i=i.GetNextNode())(c=i.body).m_islandFlag=!1,c.m_sweep.t0=0;for(var o=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);o;o=o.GetNextNode())o.contact.m_islandFlag=!1,o.contact.m_toi=null;for(var n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(;;){var s=this._SolveTOI2(t),r=s.minContact,a=s.minTOI;if(null===r||Box2D.Dynamics.b2World.MAX_TOI<a)break;var h=r.m_fixtureA.GetBody(),s=r.m_fixtureB.GetBody();if(Box2D.Dynamics.b2World.s_backupA.Set(h.m_sweep),Box2D.Dynamics.b2World.s_backupB.Set(s.m_sweep),h.Advance(a),s.Advance(a),r.Update(this.m_contactManager.m_contactListener),r.m_toi=null,!r.sensor&&r.enabled){if(r.touching){r=h;r.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(r=s),e.Clear(),b2solvearray.length=0;var l=b2solvearray;for(l.push(r),r.m_islandFlag=!0;0<l.length;){var c=l.pop();if(e.AddBody(c),c.IsAwake()||c.SetAwake(!0),c.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){for(o=c.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);o&&e.m_contactCount!=Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland;o=o.GetNextNode()){var m=o.contact;m.m_islandFlag||(e.AddContact(m),m.m_islandFlag=!0,(m=m.GetOther(c)).m_islandFlag||(m.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(m.Advance(a),m.SetAwake(!0),l.push(m)),m.m_islandFlag=!0))}for(var u=c.m_jointList;u;u=u.next)e.m_jointCount!=Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland&&!u.joint.m_islandFlag&&u.other.IsActive()&&(e.AddJoint(u.joint),u.joint.m_islandFlag=!0,u.other.m_islandFlag||(u.other.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(u.other.Advance(a),u.other.SetAwake(!0),l.push(u.other)),u.other.m_islandFlag=!0))}}e.SolveTOI(new Box2D.Dynamics.b2TimeStep((1-a)*t.dt,0,t.velocityIterations,t.positionIterations,!1));for(var p=0;p<e.m_bodies.length;p++)if(e.m_bodies[p].m_islandFlag=!1,e.m_bodies[p].IsAwake()&&e.m_bodies[p].GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){e.m_bodies[p].SynchronizeFixtures();for(o=e.m_bodies[p].contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);o;o=o.GetNextNode())o.contact.m_toi=null}for(p=0;p<e.m_contactCount;p++)e.m_contacts[p].m_islandFlag=!1,e.m_contacts[p].m_toi=null;for(p=0;p<e.m_jointCount;p++)e.m_joints[p].m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else h.m_sweep.Set(Box2D.Dynamics.b2World.s_backupA),s.m_sweep.Set(Box2D.Dynamics.b2World.s_backupB),h.SynchronizeTransform(),s.SynchronizeTransform()}},Box2D.Dynamics.b2World.prototype._SolveTOI2=function(t){for(var e=null,i=1,o=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts);o;o=o.GetNextNode()){var n,s,r,a,h=o.contact;this._SolveTOI2SkipContact(t,h)||(n=1,null!=h.m_toi?n=h.m_toi:(h.touching?n=1:(s=h.m_fixtureA.GetBody(),r=h.m_fixtureB.GetBody(),a=s.m_sweep.t0,s.m_sweep.t0<r.m_sweep.t0?(a=r.m_sweep.t0,s.m_sweep.Advance(a)):r.m_sweep.t0<s.m_sweep.t0&&(a=s.m_sweep.t0,r.m_sweep.Advance(a)),0<(n=h.ComputeTOI(s.m_sweep,r.m_sweep))&&n<1&&(n=(1-n)*a+n)),h.m_toi=n),Number.MIN_VALUE<n&&n<i&&(e=h,i=n))}return{minContact:e,minTOI:i}},Box2D.Dynamics.b2World.prototype._SolveTOI2SkipContact=function(t,e){var i=e.m_fixtureA.GetBody(),e=e.m_fixtureB.GetBody();return!(i.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&i.IsAwake()||e.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&e.IsAwake())},Box2D.Dynamics.Contacts.b2Contact=function(t,e){this.ID="Contact"+Box2D.Dynamics.Contacts.b2Contact.NEXT_ID++,this.m_manifold=new Box2D.Collision.b2Manifold,this.m_oldManifold=new Box2D.Collision.b2Manifold,this.touching=!1;var i=t.GetBody(),o=e.GetBody();this.continuous=i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet()||o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||o.IsBullet(),this.sensor=t.IsSensor()||e.IsSensor(),this.filtering=!1,this.m_fixtureA=t,this.m_fixtureB=e,this.enabled=!0,this.bodyAList=i.GetContactList(),this.bodyBList=o.GetContactList(),this.worldList=o.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.Reset=function(t,e){this.m_manifold.Reset(),this.m_oldManifold.Reset(),this.touching=!1;var i=t.GetBody(),o=e.GetBody();this.continuous=i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet()||o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||o.IsBullet(),this.sensor=t.IsSensor()||e.IsSensor(),this.filtering=!1,this.m_fixtureA=t,this.m_fixtureB=e,this.enabled=!0,this.bodyAList=i.GetContactList(),this.bodyBList=o.GetContactList(),this.worldList=o.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.AddToLists=function(){this.bodyAList.AddContact(this),this.bodyBList.AddContact(this),this.worldList.AddContact(this),this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.UpdateLists=function(){var t=!1,e=!1;!this.IsSensor()&&this.IsEnabled()&&(this.IsTouching()&&(t=!0),this.IsContinuous()&&(e=!0)),this.bodyAList.UpdateContact(this,t,e),this.bodyBList.UpdateContact(this,t,e),this.worldList.UpdateContact(this,t,e)},Box2D.Dynamics.Contacts.b2Contact.prototype.RemoveFromLists=function(){this.bodyAList.RemoveContact(this),this.bodyBList.RemoveContact(this),this.worldList.RemoveContact(this)},Box2D.Dynamics.Contacts.b2Contact.prototype.GetManifold=function(){return this.m_manifold},Box2D.Dynamics.Contacts.b2Contact.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,i.GetTransform(),n.m_radius)},Box2D.Dynamics.Contacts.b2Contact.prototype.IsTouching=function(){return this.touching},Box2D.Dynamics.Contacts.b2Contact.prototype.IsContinuous=function(){return this.continuous},Box2D.Dynamics.Contacts.b2Contact.prototype.SetSensor=function(t){this.sensor=t,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsSensor=function(){return this.sensor},Box2D.Dynamics.Contacts.b2Contact.prototype.SetEnabled=function(t){this.enabled=t,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsEnabled=function(){return this.enabled},Box2D.Dynamics.Contacts.b2Contact.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},Box2D.Dynamics.Contacts.b2Contact.prototype.GetOther=function(t){var e=this.m_fixtureA.GetBody();return e!=t?e:this.m_fixtureB.GetBody()},Box2D.Dynamics.Contacts.b2Contact.prototype.FlagForFiltering=function(){this.filtering=!0},Box2D.Dynamics.Contacts.b2Contact.prototype.ClearFiltering=function(){this.filtering=!1},Box2D.Dynamics.Contacts.b2Contact.prototype.IsFiltering=function(){return this.filtering},Box2D.Dynamics.Contacts.b2Contact.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e;var i=!(this.enabled=!0),o=this.IsTouching(),n=this.m_fixtureA.GetBody(),s=this.m_fixtureB.GetBody(),e=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.sensor)e&&(i=Box2D.Collision.Shapes.b2Shape.TestOverlap(this.m_fixtureA.GetShape(),n.GetTransform(),this.m_fixtureB.GetShape(),s.GetTransform())),this.m_manifold.m_pointCount=0;else{if(n.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||n.IsBullet()||s.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||s.IsBullet()?this.continuous=!0:this.continuous=!1,e){this.Evaluate(),i=0<this.m_manifold.m_pointCount;for(var r=0;r<this.m_manifold.m_pointCount;r++){var a=this.m_manifold.m_points[r];a.m_normalImpulse=0;for(var h=a.m_tangentImpulse=0;h<this.m_oldManifold.m_pointCount;h++){var l=this.m_oldManifold.m_points[h];if(l.m_id.GetKey()==a.m_id.GetKey()){a.m_normalImpulse=l.m_normalImpulse,a.m_tangentImpulse=l.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;i!=o&&(n.SetAwake(!0),s.SetAwake(!0))}(this.touching=i)!=o&&this.UpdateLists(),!o&&i&&t.BeginContact(this),o&&!i&&t.EndContact(this),this.sensor||t.PreSolve(this,this.m_oldManifold)},Box2D.Dynamics.Contacts.b2Contact.prototype.Evaluate=function(){},Box2D.Dynamics.Contacts.b2Contact.prototype.ComputeTOI=function(t,e){return Box2D.Dynamics.Contacts.b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.sweepA=t,Box2D.Dynamics.Contacts.b2Contact.s_input.sweepB=e,Box2D.Dynamics.Contacts.b2Contact.s_input.tolerance=Box2D.Common.b2Settings.b2_linearSlop,Box2D.Collision.b2TimeOfImpact.TimeOfImpact(Box2D.Dynamics.Contacts.b2Contact.s_input)},Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2Contact.NEXT_ID=0,Box2D.Dynamics.Contacts.b2CircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2CircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2CircleContact.prototype.Evaluate=function(){Box2D.Collision.b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.normalMass=new Box2D.Common.Math.b2Mat22,this.K=new Box2D.Common.Math.b2Mat22,this.points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.points[t]=new Box2D.Dynamics.Contacts.b2ContactConstraintPoint},Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.rA=Box2D.Common.Math.b2Vec2.Get(0,0),this.rB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Contacts.b2ContactConstraintPoint.prototype.Reset=function(){this.localPoint.Set(0,0),this.rA.Set(0,0),this.rB.Set(0,0)},Box2D.Dynamics.Contacts.b2ContactFactory=function(){this.m_registers={},this.m_freeContacts={},this.AddType(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Collision.Shapes.b2CircleShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2PolygonShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Collision.Shapes.b2EdgeShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2EdgeShape.NAME)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.AddType=function(t,e,i){this.m_freeContacts[e]=this.m_freeContacts[e]||{},this.m_freeContacts[e][i]=this.m_freeContacts[e][i]||[],this.m_registers[e]=this.m_registers[e]||{},this.m_registers[e][i]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[e][i].ctor=t,this.m_registers[e][i].primary=!0,e!=i&&(this.m_registers[i]=this.m_registers[i]||{},this.m_registers[i][e]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[i][e].ctor=t,this.m_registers[i][e].primary=!1)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Create=function(t,e){var i,o=t.GetShape().GetTypeName(),n=e.GetShape().GetTypeName(),s=this.m_registers[o][n],r=s.ctor;return null==r?null:s.primary?0<this.m_freeContacts[o][n].length?((i=this.m_freeContacts[o][n].pop()).Reset(t,e),i):new r(t,e):0<this.m_freeContacts[n][o].length?((i=this.m_freeContacts[n][o].pop()).Reset(e,t),i):new r(e,t)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Destroy=function(t){var e=t.m_fixtureA.GetShape().GetTypeName(),i=t.m_fixtureB.GetShape().GetTypeName();this.m_freeContacts[e][i].push(t)},Box2D.Dynamics.Contacts.b2ContactList=function(){this.contactFirstNodes=[];for(var t=0;t<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;t++)this.contactFirstNodes[t]=null;this.contactLastNodes=[];for(t=0;t<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;t++)this.contactLastNodes[t]=null;this.contactNodeLookup={},this.contactCount=0},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetFirstNode=function(t){return this.contactFirstNodes[t]},Box2D.Dynamics.Contacts.b2ContactList.prototype.AddContact=function(t){var e=t.ID;if(null==this.contactNodeLookup[e]){this.contactNodeLookup[e]=[];for(var i=0;i<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;i++)this.contactNodeLookup[e][i]=null;this.CreateNode(t,e,Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts),this.contactCount++}},Box2D.Dynamics.Contacts.b2ContactList.prototype.UpdateContact=function(t,e,i){e?this.CreateNode(t,t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts):this.RemoveNode(t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts),i?this.CreateNode(t,t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts):this.RemoveNode(t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts)},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveContact=function(t){var e=t.ID;if(null!=this.contactNodeLookup[e]){for(var i=0;i<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;i++)this.RemoveNode(e,i);delete this.contactNodeLookup[e],this.contactCount--}},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveNode=function(t,e){var i,o=this.contactNodeLookup[t];null==o||null!=(i=o[e])&&(o[e]=null,t=i.GetPreviousNode(),o=i.GetNextNode(),null==t?this.contactFirstNodes[e]=o:t.SetNextNode(o),null==o?this.contactLastNodes[e]=t:o.SetPreviousNode(t),Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode(i))},Box2D.Dynamics.Contacts.b2ContactList.prototype.CreateNode=function(t,e,i){e=this.contactNodeLookup[e];null==e[i]&&(e[i]=Box2D.Dynamics.Contacts.b2ContactListNode.GetNode(t),null!=(t=this.contactLastNodes[i])?(t.SetNextNode(e[i]),e[i].SetPreviousNode(t)):this.contactFirstNodes[i]=e[i],this.contactLastNodes[i]=e[i])},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetContactCount=function(){return this.contactCount},Box2D.Dynamics.Contacts.b2ContactList.TYPES={nonSensorEnabledTouchingContacts:0,nonSensorEnabledContinuousContacts:1,allContacts:2},Box2D.Dynamics.Contacts.b2ContactListNode=function(t){this.contact=t,this.next=null,this.previous=null},Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes=[],Box2D.Dynamics.Contacts.b2ContactListNode.GetNode=function(t){if(0<Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.length){var e=Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.pop();return e.next=null,e.previous=null,e.contact=t,e}return new Box2D.Dynamics.Contacts.b2ContactListNode(t)},Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode=function(t){Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.push(t)},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetContact=function(){return this.contact},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Contacts.b2ContactRegister=function(){this.pool=null,this.poolCount=0},Box2D.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_separations=[],this.m_points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype.Initialize=function(t){switch(t.type){case Box2D.Collision.b2Manifold.e_circles:this._InitializeCircles(t);break;case Box2D.Collision.b2Manifold.e_faceA:this._InitializeFaceA(t);break;case Box2D.Collision.b2Manifold.e_faceB:this._InitializeFaceB(t)}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeCircles=function(t){var e=t.bodyA.m_xf.R,i=t.localPoint,o=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),n=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),e=t.bodyB.m_xf.R,i=t.points[0].localPoint,s=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),r=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),a=s-o,e=r-n,i=a*a+e*e;i>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(i=Math.sqrt(i),this.m_normal.x=a/i,this.m_normal.y=e/i):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(o+s),this.m_points[0].y=.5*(n+r),this.m_separations[0]=a*this.m_normal.x+e*this.m_normal.y-t.radius},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceA=function(t){this.m_normal.x=t.bodyA.m_xf.R.col1.x*t.localPlaneNormal.x+t.bodyA.m_xf.R.col2.x*t.localPlaneNormal.y,this.m_normal.y=t.bodyA.m_xf.R.col1.y*t.localPlaneNormal.x+t.bodyA.m_xf.R.col2.y*t.localPlaneNormal.y;for(var e=t.bodyA.m_xf.position.x+(t.bodyA.m_xf.R.col1.x*t.localPoint.x+t.bodyA.m_xf.R.col2.x*t.localPoint.y),i=t.bodyA.m_xf.position.y+(t.bodyA.m_xf.R.col1.y*t.localPoint.x+t.bodyA.m_xf.R.col2.y*t.localPoint.y),o=0;o<t.pointCount;o++){var n=t.bodyB.m_xf.position.x+(t.bodyB.m_xf.R.col1.x*t.points[o].localPoint.x+t.bodyB.m_xf.R.col2.x*t.points[o].localPoint.y),s=t.bodyB.m_xf.position.y+(t.bodyB.m_xf.R.col1.y*t.points[o].localPoint.x+t.bodyB.m_xf.R.col2.y*t.points[o].localPoint.y);this.m_separations[o]=(n-e)*this.m_normal.x+(s-i)*this.m_normal.y-t.radius,this.m_points[o].x=n,this.m_points[o].y=s}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceB=function(t){this.m_normal.x=t.bodyB.m_xf.R.col1.x*t.localPlaneNormal.x+t.bodyB.m_xf.R.col2.x*t.localPlaneNormal.y,this.m_normal.y=t.bodyB.m_xf.R.col1.y*t.localPlaneNormal.x+t.bodyB.m_xf.R.col2.y*t.localPlaneNormal.y;for(var e=t.bodyB.m_xf.position.x+(t.bodyB.m_xf.R.col1.x*t.localPoint.x+t.bodyB.m_xf.R.col2.x*t.localPoint.y),i=t.bodyB.m_xf.position.y+(t.bodyB.m_xf.R.col1.y*t.localPoint.x+t.bodyB.m_xf.R.col2.y*t.localPoint.y),o=0;o<t.pointCount;o++){var n=t.bodyA.m_xf.position.x+(t.bodyA.m_xf.R.col1.x*t.points[o].localPoint.x+t.bodyA.m_xf.R.col2.x*t.points[o].localPoint.y),s=t.bodyA.m_xf.position.y+(t.bodyA.m_xf.R.col1.y*t.points[o].localPoint.x+t.bodyA.m_xf.R.col2.y*t.points[o].localPoint.y);this.m_separations[o]=(n-e)*this.m_normal.x+(s-i)*this.m_normal.y-t.radius,this.m_points[o].Set(n,s)}this.m_normal.x*=-1,this.m_normal.y*=-1},Box2D.Dynamics.Contacts.b2ContactSolver=function(){this.m_constraints=[]},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.Initialize=function(t,e,i){for(this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new Box2D.Dynamics.Contacts.b2ContactConstraint;for(var o=0;o<i;o++){var n=e[o],s=n.m_fixtureA,r=n.m_fixtureB,a=s.m_shape,h=r.m_shape,l=a.m_radius,c=h.m_radius,m=s.GetBody(),u=r.GetBody(),p=n.GetManifold(),y=Box2D.Common.b2Settings.b2MixFriction(s.GetFriction(),r.GetFriction()),_=Box2D.Common.b2Settings.b2MixRestitution(s.GetRestitution(),r.GetRestitution()),d=m.m_linearVelocity.x,f=m.m_linearVelocity.y,x=u.m_linearVelocity.x,g=u.m_linearVelocity.y,b=m.m_angularVelocity,v=u.m_angularVelocity;Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.Initialize(p,m.m_xf,l,u.m_xf,c);var B=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.x,D=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.y,C=this.m_constraints[o];C.bodyA=m,C.bodyB=u,C.manifold=p,C.normal.x=B,C.normal.y=D,C.pointCount=p.m_pointCount,C.friction=y,C.restitution=_,C.localPlaneNormal.x=p.m_localPlaneNormal.x,C.localPlaneNormal.y=p.m_localPlaneNormal.y,C.localPoint.x=p.m_localPoint.x,C.localPoint.y=p.m_localPoint.y,C.radius=l+c,C.type=p.m_type;for(var w,S=0;S<C.pointCount;++S){var A=p.m_points[S],M=C.points[S];M.normalImpulse=A.m_normalImpulse,M.tangentImpulse=A.m_tangentImpulse,M.localPoint.SetV(A.m_localPoint);var T=M.rA.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[S].x-m.m_sweep.c.x,I=M.rA.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[S].y-m.m_sweep.c.y,P=M.rB.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[S].x-u.m_sweep.c.x,L=M.rB.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[S].y-u.m_sweep.c.y,V=T*D-I*B,R=P*D-L*B;V*=V,R*=R;A=m.m_invMass+u.m_invMass+m.m_invI*V+u.m_invI*R;M.normalMass=1/A;A=m.m_mass*m.m_invMass+u.m_mass*u.m_invMass;A+=m.m_mass*m.m_invI*V+u.m_mass*u.m_invI*R,M.equalizedMass=1/A;R=-B,A=T*R-I*D,R=P*R-L*D;A*=A,R*=R;R=m.m_invMass+u.m_invMass+m.m_invI*A+u.m_invI*R;M.tangentMass=1/R,M.velocityBias=0;I=x+-v*L-d- -b*I,T=g+v*P-f-b*T,T=C.normal.x*I+C.normal.y*T;T<-Box2D.Common.b2Settings.b2_velocityThreshold&&(M.velocityBias+=-C.restitution*T)}2==C.pointCount&&(w=C.points[0],a=C.points[1],h=m.m_invMass,n=m.m_invI,s=u.m_invMass,r=u.m_invI,(l=h+s+n*(y=w.rA.x*D-w.rA.y*B)*y+r*(_=w.rB.x*D-w.rB.y*B)*_)*l<100*(l*(a=h+s+n*(c=a.rA.x*D-a.rA.y*B)*c+r*(w=a.rB.x*D-a.rB.y*B)*w)-(w=h+s+n*y*c+r*_*w)*w)?(C.K.col1.Set(l,w),C.K.col2.Set(w,a),C.K.GetInverse(C.normalMass)):C.pointCount=1)}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_constraintCount;++e){var i=this.m_constraints[e],o=i.bodyA,n=i.bodyB,s=o.m_invMass,r=o.m_invI,a=n.m_invMass,h=n.m_invI,l=i.normal.x,c=i.normal.y,m=c,u=-l,p=0,y=0;if(t.warmStarting)for(y=i.pointCount,p=0;p<y;++p){var _=i.points[p];_.normalImpulse*=t.dtRatio,_.tangentImpulse*=t.dtRatio;var d=_.normalImpulse*l+_.tangentImpulse*m,f=_.normalImpulse*c+_.tangentImpulse*u;o.m_angularVelocity-=r*(_.rA.x*f-_.rA.y*d),o.m_linearVelocity.x-=s*d,o.m_linearVelocity.y-=s*f,n.m_angularVelocity+=h*(_.rB.x*f-_.rB.y*d),n.m_linearVelocity.x+=a*d,n.m_linearVelocity.y+=a*f}else for(y=i.pointCount,p=0;p<y;++p){var x=i.points[p];x.normalImpulse=0,x.tangentImpulse=0}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;t++)this.SolveVelocityConstraints_Constraint(this.m_constraints[t])},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_Constraint=function(t){for(var e=t.normal.x,i=t.normal.y,o=0;o<t.pointCount;o++)Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint(t,t.points[o]);if(1==t.pointCount){var n=t.points[0],s=(t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*n.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*n.rA.y)*e+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*n.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*n.rA.x)*i,r=n.normalImpulse-n.normalMass*(s-n.velocityBias),a=(r=0<r?r:0)-n.normalImpulse,s=a*e,a=a*i;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*s,t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*a,t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(n.rA.x*a-n.rA.y*s),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*s,t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*a,t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(n.rB.x*a-n.rB.y*s),n.normalImpulse=r}else{var h=t.points[0],l=t.points[1],c=h.normalImpulse,m=l.normalImpulse,a=t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*h.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*h.rA.y,s=t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*h.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*h.rA.x,n=t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*l.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*l.rA.y,r=t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*l.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*l.rA.x,u=a*e+s*i-h.velocityBias,p=n*e+r*i-l.velocityBias;for(u-=t.K.col1.x*c+t.K.col2.x*m,p-=t.K.col1.y*c+t.K.col2.y*m;;){var y=-(t.normalMass.col1.x*u+t.normalMass.col2.x*p);if(0<=y){var _=-(t.normalMass.col1.y*u+t.normalMass.col2.y*p);if(0<=_){this.SolveVelocityConstraints_ConstraintPointUpdate(t,h,l,y-c,_-m),h.normalImpulse=y,l.normalImpulse=_;break}}_=-h.normalMass*u;if(0<=_&&0<=t.K.col1.y*_+p){this.SolveVelocityConstraints_ConstraintPointUpdate(t,h,l,_-c,-m),h.normalImpulse=_,l.normalImpulse=0;break}_=-l.normalMass*p;if(0<=_&&0<=t.K.col2.x*_+u){this.SolveVelocityConstraints_ConstraintPointUpdate(t,h,l,-c,_-m),h.normalImpulse=0,l.normalImpulse=_;break}if(0<=u&&0<=p){this.SolveVelocityConstraints_ConstraintPointUpdate(t,h,l,-c,-m),h.normalImpulse=0,l.normalImpulse=0;break}break}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint=function(t,e){var i=t.normal.y,o=-t.normal.x,n=(t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*e.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*e.rA.y)*i+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*e.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*e.rA.x)*o,s=t.friction*e.normalImpulse,n=Box2D.Common.Math.b2Math.Clamp(e.tangentImpulse-e.tangentMass*n,-s,s),s=n-e.tangentImpulse,i=s*i,o=s*o;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*i,t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*o,t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(e.rA.x*o-e.rA.y*i),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*i,t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*o,t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(e.rB.x*o-e.rB.y*i),e.tangentImpulse=n},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPointUpdate=function(t,e,i,o,n){var s=o*t.normal.x,r=o*t.normal.y,o=n*t.normal.x,n=n*t.normal.y;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*(s+o),t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*(r+n),t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(e.rA.x*r-e.rA.y*s+i.rA.x*n-i.rA.y*o),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*(s+o),t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*(r+n),t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(e.rB.x*r-e.rB.y*s+i.rB.x*n-i.rB.y*o),e.normalImpulse=0,i.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],i=e.manifold,o=0;o<e.pointCount;++o){var n=i.m_points[o],s=e.points[o];n.m_normalImpulse=s.normalImpulse,n.m_tangentImpulse=s.tangentImpulse}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<this.m_constraintCount;i++){var o=this.m_constraints[i],n=o.bodyA,s=o.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,h=s.m_mass*s.m_invMass,l=s.m_mass*s.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(o);for(var c=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,m=0;m<o.pointCount;m++){var u=o.points[m],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[m],y=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[m],_=p.x-n.m_sweep.c.x,d=p.y-n.m_sweep.c.y,f=p.x-s.m_sweep.c.x,p=p.y-s.m_sweep.c.y,e=e<y?e:y,y=Box2D.Common.Math.b2Math.Clamp(t*(y+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),u=-u.equalizedMass*y,y=u*c.x,u=u*c.y;n.m_sweep.c.x-=r*y,n.m_sweep.c.y-=r*u,n.m_sweep.a-=a*(_*u-d*y),n.SynchronizeTransform(),s.m_sweep.c.x+=h*y,s.m_sweep.c.y+=h*u,s.m_sweep.a+=l*(f*u-p*y),s.SynchronizeTransform()}}return e>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints_NEW=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<this.m_constraintCount;i++){var o=this.m_constraints[i],n=o.bodyA,s=o.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,h=s.m_mass*s.m_invMass,l=s.m_mass*s.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(o);for(var c=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,m=0;m<o.pointCount;m++){var u=o.points[m],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[m],y=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[m],_=p.x-n.m_sweep.c.x,d=p.y-n.m_sweep.c.y,f=p.x-s.m_sweep.c.x,p=p.y-s.m_sweep.c.y;y<e&&(e=y);0!=t&&Box2D.Common.Math.b2Math.Clamp(t*(y+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0);y=0*-u.equalizedMass,u=y*c.x,y=y*c.y;n.m_sweep.c.x-=r*u,n.m_sweep.c.y-=r*y,n.m_sweep.a-=a*(_*y-d*u),n.SynchronizeTransform(),s.m_sweep.c.x+=h*u,s.m_sweep.c.y+=h*y,s.m_sweep.a+=l*(f*y-p*u),s.SynchronizeTransform()}}return e>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Evaluate=function(){this.m_fixtureA.GetBody(),this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(t,e,i,o,n){},Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Evaluate=function(){Box2D.Collision.b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Evaluate=function(){this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(t,e,i,o,n){},Box2D.Dynamics.Contacts.b2PolygonContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Evaluate=function(){Box2D.Collision.b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Controllers.b2Controller=function(){this.ID="Controller"+Box2D.Dynamics.Controllers.b2Controller.NEXT_ID++,this.m_world=null,this.bodyList=new Box2D.Dynamics.b2BodyList},Box2D.Dynamics.Controllers.b2Controller.prototype.Step=function(t){},Box2D.Dynamics.Controllers.b2Controller.prototype.AddBody=function(t){this.bodyList.AddBody(t),t.AddController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.RemoveBody=function(t){this.bodyList.RemoveBody(t),t.RemoveController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.Clear=function(){for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);t;t=t.GetNextNode())this.RemoveBody(t.body)},Box2D.Dynamics.Controllers.b2Controller.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.Controllers.b2Controller.NEXT_ID=0,Box2D.Dynamics.Controllers.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.normal=Box2D.Common.Math.b2Vec2.Get(0,-1),this.offset=0,this.density=0,this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},c2inherit(Box2D.Dynamics.Controllers.b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Step=function(t){this.useWorldGravity&&(this.gravity=this.m_world.GetGravity().Copy());for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){for(var i,o=e.body,n=Box2D.Common.Math.b2Vec2.Get(0,0),s=Box2D.Common.Math.b2Vec2.Get(0,0),r=0,a=0,h=o.GetFixtureList().GetFirstNode();h;h=h.GetNextNode()){var l=Box2D.Common.Math.b2Vec2.Get(0,0),c=h.fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,o.GetTransform(),l);r+=c,n.x+=c*l.x,n.y+=c*l.y;var m=0;a+=c*(m=(this.useDensity,1)),s.x+=c*l.x*m,s.y+=c*l.y*m}r<Number.MIN_VALUE||(n.x/=r,n.y/=r,s.x/=a,s.y/=a,(i=this.gravity.GetNegative()).Multiply(this.density*r),o.ApplyForce(i,s),(i=o.GetLinearVelocityFromWorldPoint(n)).Subtract(this.velocity),i.Multiply(-this.linearDrag*r),o.ApplyForce(i,n),o.ApplyTorque(-o.GetInertia()/o.GetMass()*r*o.GetAngularVelocity()*this.angularDrag),Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(s))}},Box2D.Dynamics.Controllers.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.A=Box2D.Common.Math.b2Vec2.Get(0,0)},c2inherit(Box2D.Dynamics.Controllers.b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantAccelController.prototype.Step=function(t){for(var e=Box2D.Common.Math.b2Vec2.Get(this.A.x*t.dt,this.A.y*t.dt),i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);i;i=i.GetNextNode()){var o=i.body,n=o.GetLinearVelocity();o.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(n.x+e.x,n.y+e.y))}Box2D.Common.Math.b2Vec2.Free(e)},Box2D.Dynamics.Controllers.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.F=Box2D.Common.Math.b2Vec2.Get(0,0)},c2inherit(Box2D.Dynamics.Controllers.b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantForceController.prototype.Step=function(t){for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){var i=e.body;i.ApplyForce(this.F,i.GetWorldCenter())}},Box2D.Dynamics.Controllers.b2ControllerList=function(){this.controllerFirstNode=null,this.controllerLastNode=null,this.controllerNodeLookup={},this.controllerCount=0},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetFirstNode=function(){return this.controllerFirstNode},Box2D.Dynamics.Controllers.b2ControllerList.prototype.AddController=function(t){var e,i=t.ID;null==this.controllerNodeLookup[i]&&(e=new Box2D.Dynamics.Controllers.b2ControllerListNode(t),null!=(t=this.controllerLastNode)?t.SetNextNode(e):this.controllerFirstNode=e,e.SetPreviousNode(t),this.controllerLastNode=e,this.controllerNodeLookup[i]=e,this.controllerCount++)},Box2D.Dynamics.Controllers.b2ControllerList.prototype.RemoveController=function(t){var e=t.ID,i=this.controllerNodeLookup[e];null!=i&&(t=i.GetPreviousNode(),i=i.GetNextNode(),null==t?this.controllerFirstNode=i:t.SetNextNode(i),null==i?this.controllerLastNode=t:i.SetPreviousNode(t),delete this.controllerNodeLookup[e],this.controllerCount--)},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetControllerCount=function(){return this.controllerCount},Box2D.Dynamics.Controllers.b2ControllerListNode=function(t){this.controller=t,this.next=null,this.previous=null},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Controllers.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.G=1,this.invSqr=!0},c2inherit(Box2D.Dynamics.Controllers.b2GravityController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2GravityController.prototype.Step=function(t){var e=null,i=null,o=0,n=null,s=null,r=0,a=0,h=0,l=null;if(this.invSqr)for(var c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode())for(var i=(e=c.body).GetWorldCenter(),o=e.GetMass(),m=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);m;m=m.GetNextNode()){n=m.body;(e.IsAwake()||n.IsAwake())&&((h=(r=(s=n.GetWorldCenter()).x-i.x)*r+(a=s.y-i.y)*a)<Number.MIN_VALUE||((l=Box2D.Common.Math.b2Vec2.Get(r,a)).Multiply(this.G/h/Math.sqrt(h)*o*n.GetMass()),e.IsAwake()&&e.ApplyForce(l,i),l.Multiply(-1),n.IsAwake()&&n.ApplyForce(l,s),Box2D.Common.Math.b2Vec2.Free(l)))}else for(c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode())for(i=(e=bodyNode.body).GetWorldCenter(),o=e.GetMass(),m=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);m;m=m.GetNextNode()){n=bodyNode.body;(e.IsAwake()||n.IsAwake())&&((h=(r=(s=n.GetWorldCenter()).x-i.x)*r+(a=s.y-i.y)*a)<Number.MIN_VALUE||((l=Box2D.Common.Math.b2Vec2.Get(r,a)).Multiply(this.G/h*o*n.GetMass()),e.IsAwake()&&e.ApplyForce(l,i),l.Multiply(-1),n.IsAwake()&&n.ApplyForce(l,s),Box2D.Common.Math.b2Vec2.Free(l)))}},Box2D.Dynamics.Controllers.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.T=new Box2D.Common.Math.b2Mat22,this.maxTimestep=0},c2inherit(Box2D.Dynamics.Controllers.b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.SetAxisAligned=function(t,e){this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=0<t||0<e?1/Math.max(t,e):0},Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.Step=function(t){var e=t.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&0<this.maxTimestep&&(e=this.maxTimestep);for(var i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);i;i=i.GetNextNode()){var o=i.body,n=o.GetWorldVector(Box2D.Common.Math.b2Math.MulMV(this.T,o.GetLocalVector(o.GetLinearVelocity())));o.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(o.GetLinearVelocity().x+n.x*e,o.GetLinearVelocity().y+n.y*e))}}},Box2D.Dynamics.Joints.b2Joint=function(t){this.m_edgeA=new Box2D.Dynamics.Joints.b2JointEdge,this.m_edgeB=new Box2D.Dynamics.Joints.b2JointEdge,this.m_localCenterA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localCenterB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected},Box2D.Dynamics.Joints.b2Joint.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorA=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorB=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},Box2D.Dynamics.Joints.b2Joint.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Joints.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Box2D.Dynamics.Joints.b2Joint.Create=function(t){return t.Create()},Box2D.Dynamics.Joints.b2Joint.prototype.InitVelocityConstraints=function(t){},Box2D.Dynamics.Joints.b2Joint.prototype.SolveVelocityConstraints=function(t){},Box2D.Dynamics.Joints.b2Joint.prototype.FinalizeVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolvePositionConstraints=function(t){return!1},Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3,Box2D.Dynamics.Joints.b2JointDef=function(){this.type=Box2D.Dynamics.Joints.b2Joint.e_unknownJoint,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},Box2D.Dynamics.Joints.b2JointEdge=function(){},Box2D.Dynamics.Joints.b2DistanceJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},c2inherit(Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionForce=function(t){return Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionTorque=function(t){return 0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetLength=function(t){this.m_length=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.InitVelocityConstraints=function(t){var e=0,i=this.m_bodyA,o=this.m_bodyB,n=i.m_xf.R,s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,r=this.m_localAnchor1.y-i.m_sweep.localCenter.y,e=n.col1.x*s+n.col2.x*r,r=n.col1.y*s+n.col2.y*r,s=e;n=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y;e=n.col1.x*a+n.col2.x*h,h=n.col1.y*a+n.col2.y*h,a=e,this.m_u.x=o.m_sweep.c.x+a-i.m_sweep.c.x-s,this.m_u.y=o.m_sweep.c.y+h-i.m_sweep.c.y-r;var l=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);l>Box2D.Common.b2Settings.b2_linearSlop?this.m_u.Multiply(1/l):this.m_u.SetZero();var c=s*this.m_u.y-r*this.m_u.x,n=a*this.m_u.y-h*this.m_u.x,e=i.m_invMass+i.m_invI*c*c+o.m_invMass+o.m_invI*n*n;this.m_mass=0!=e?1/e:0,0<this.m_frequencyHz&&(c=l-this.m_length,n=2*Math.PI*this.m_frequencyHz,l=2*this.m_mass*this.m_dampingRatio*n,n=this.m_mass*n*n,this.m_gamma=t.dt*(l+t.dt*n),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=c*t.dt*n*this.m_gamma,this.m_mass=e+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0),t.warmStarting?(this.m_impulse*=t.dtRatio,e=this.m_impulse*this.m_u.x,t=this.m_impulse*this.m_u.y,i.m_linearVelocity.x-=i.m_invMass*e,i.m_linearVelocity.y-=i.m_invMass*t,i.m_angularVelocity-=i.m_invI*(s*t-r*e),o.m_linearVelocity.x+=o.m_invMass*e,o.m_linearVelocity.y+=o.m_invMass*t,o.m_angularVelocity+=o.m_invI*(a*t-h*e)):this.m_impulse=0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,o=this.m_bodyA.m_xf.R.col1.x*e+this.m_bodyA.m_xf.R.col2.x*i,i=this.m_bodyA.m_xf.R.col1.y*e+this.m_bodyA.m_xf.R.col2.y*i,e=o,n=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,s=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,o=this.m_bodyB.m_xf.R.col1.x*n+this.m_bodyB.m_xf.R.col2.x*s,s=this.m_bodyB.m_xf.R.col1.y*n+this.m_bodyB.m_xf.R.col2.y*s,n=o,r=this.m_bodyA.m_linearVelocity.x-this.m_bodyA.m_angularVelocity*i,a=this.m_bodyA.m_linearVelocity.y+this.m_bodyA.m_angularVelocity*e,h=this.m_bodyB.m_linearVelocity.x-this.m_bodyB.m_angularVelocity*s,o=this.m_bodyB.m_linearVelocity.y+this.m_bodyB.m_angularVelocity*n,o=this.m_u.x*(h-r)+this.m_u.y*(o-a),a=-this.m_mass*(o+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;o=a*this.m_u.x,a*=this.m_u.y;this.m_bodyA.m_linearVelocity.x-=this.m_bodyA.m_invMass*o,this.m_bodyA.m_linearVelocity.y-=this.m_bodyA.m_invMass*a,this.m_bodyA.m_angularVelocity-=this.m_bodyA.m_invI*(e*a-i*o),this.m_bodyB.m_linearVelocity.x+=this.m_bodyB.m_invMass*o,this.m_bodyB.m_linearVelocity.y+=this.m_bodyB.m_invMass*a,this.m_bodyB.m_angularVelocity+=this.m_bodyB.m_invI*(n*a-s*o)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolvePositionConstraints=function(t){if(0<this.m_frequencyHz)return!0;var e=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,o=this.m_bodyA.m_xf.R.col1.x*e+this.m_bodyA.m_xf.R.col2.x*i,i=this.m_bodyA.m_xf.R.col1.y*e+this.m_bodyA.m_xf.R.col2.y*i,e=o,n=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,s=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,o=this.m_bodyB.m_xf.R.col1.x*n+this.m_bodyB.m_xf.R.col2.x*s,s=this.m_bodyB.m_xf.R.col1.y*n+this.m_bodyB.m_xf.R.col2.y*s,n=o,r=this.m_bodyB.m_sweep.c.x+n-this.m_bodyA.m_sweep.c.x-e,a=this.m_bodyB.m_sweep.c.y+s-this.m_bodyA.m_sweep.c.y-i,h=Math.sqrt(r*r+a*a);r/=h,a/=h;o=Box2D.Common.Math.b2Math.Clamp(h-this.m_length,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),h=-this.m_mass*o;this.m_u.Set(r,a);a=h*this.m_u.x,h*=this.m_u.y;return this.m_bodyA.m_sweep.c.x-=this.m_bodyA.m_invMass*a,this.m_bodyA.m_sweep.c.y-=this.m_bodyA.m_invMass*h,this.m_bodyA.m_sweep.a-=this.m_bodyA.m_invI*(e*h-i*a),this.m_bodyB.m_sweep.c.x+=this.m_bodyB.m_invMass*a,this.m_bodyB.m_sweep.c.y+=this.m_bodyB.m_invMass*h,this.m_bodyB.m_sweep.a+=this.m_bodyB.m_invI*(n*h-s*a),this.m_bodyA.SynchronizeTransform(),this.m_bodyB.SynchronizeTransform(),Math.abs(o)<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},c2inherit(Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));e=o.x-i.x,i=o.y-i.y;this.length=Math.sqrt(e*e+i*i),this.frequencyHz=0,this.dampingRatio=0},Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2DistanceJoint(this)},Box2D.Dynamics.Joints.b2FrictionJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_linearMass=new Box2D.Common.Math.b2Mat22,this.m_linearImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},c2inherit(Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new b2Vec2(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.InitVelocityConstraints=function(t){var e=0,i=this.m_bodyA,o=this.m_bodyB,n=i.m_xf.R,s=this.m_localAnchorA.x-i.m_sweep.localCenter.x,r=this.m_localAnchorA.y-i.m_sweep.localCenter.y,e=n.col1.x*s+n.col2.x*r,r=n.col1.y*s+n.col2.y*r,s=e;n=o.m_xf.R;var a=this.m_localAnchorB.x-o.m_sweep.localCenter.x,h=this.m_localAnchorB.y-o.m_sweep.localCenter.y;e=n.col1.x*a+n.col2.x*h,h=n.col1.y*a+n.col2.y*h,a=e;var l=i.m_invMass,c=o.m_invMass,m=i.m_invI,n=o.m_invI,e=new Box2D.Common.Math.b2Mat22;e.col1.x=l+c,e.col2.x=0,e.col1.y=0,e.col2.y=l+c,e.col1.x+=m*r*r,e.col2.x+=-m*s*r,e.col1.y+=-m*s*r,e.col2.y+=m*s*s,e.col1.x+=n*h*h,e.col2.x+=-n*a*h,e.col1.y+=-n*a*h,e.col2.y+=n*a*a,e.GetInverse(this.m_linearMass),this.m_angularMass=m+n,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting?(this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio,t=this.m_linearImpulse,i.m_linearVelocity.x-=l*t.x,i.m_linearVelocity.y-=l*t.y,i.m_angularVelocity-=m*(s*t.y-r*t.x+this.m_angularImpulse),o.m_linearVelocity.x+=c*t.x,o.m_linearVelocity.y+=c*t.y,o.m_angularVelocity+=n*(a*t.y-h*t.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,n=e.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=e.m_invMass,h=i.m_invMass,l=e.m_invI,c=i.m_invI,m=e.m_xf.R,u=this.m_localAnchorA.x-e.m_sweep.localCenter.x,p=this.m_localAnchorA.y-e.m_sweep.localCenter.y,y=m.col1.x*u+m.col2.x*p,p=m.col1.y*u+m.col2.y*p,u=y;m=i.m_xf.R;var _=this.m_localAnchorB.x-i.m_sweep.localCenter.x,d=this.m_localAnchorB.y-i.m_sweep.localCenter.y;y=m.col1.x*_+m.col2.x*d,d=m.col1.y*_+m.col2.y*d,_=y;var m=r-n,y=-this.m_angularMass*m,m=this.m_angularImpulse,f=t.dt*this.m_maxTorque;this.m_angularImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_angularImpulse+y,-f,f),n-=l*(y=this.m_angularImpulse-m),r+=c*y;m=s.x-r*d-o.x+n*p,y=s.y+r*_-o.y-n*u,m=Box2D.Common.Math.b2Math.MulMV(this.m_linearMass,Box2D.Common.Math.b2Vec2.Get(-m,-y)),y=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(m),f=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(f)),m=Box2D.Common.Math.b2Math.SubtractVV(this.m_linearImpulse,y),o.x-=a*m.x,o.y-=a*m.y,n-=l*(u*m.y-p*m.x),s.x+=h*m.x,s.y+=h*m.y,r+=c*(_*m.y-d*m.x),e.m_angularVelocity=n,i.m_angularVelocity=r},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolvePositionConstraints=function(t){return!0},Box2D.Dynamics.Joints.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_frictionJoint,this.maxForce=0,this.maxTorque=0},c2inherit(Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))},Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2FrictionJoint(this)},Box2D.Dynamics.Joints.b2GearJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_J=new Box2D.Dynamics.Joints.b2Jacobian;var e=t.joint1.m_type,i=t.joint2.m_type;this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var o=0,n=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),o=e==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute1=t.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),n=i==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute2=t.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=o+this.m_ratio*n,this.m_impulse=0},c2inherit(Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var e=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,o=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=e.col1.x*i+e.col2.x*o,o=e.col1.y*i+e.col2.y*o,i=n,e=this.m_impulse*this.m_J.linearB.x,n=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*n+o*e)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2GearJoint.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},Box2D.Dynamics.Joints.b2GearJoint.prototype.InitVelocityConstraints=function(t){var e,i,o=this.m_ground1,n=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,h=0,l=0,c=0,m=0,u=0,p=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,p+=s.m_invI):(e=o.m_xf.R,i=this.m_prismatic1.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,h=e.col1.y*i.x+e.col2.y*i.y,e=s.m_xf.R,l=this.m_localAnchor1.x-s.m_sweep.localCenter.x,c=this.m_localAnchor1.y-s.m_sweep.localCenter.y,u=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,m=(l=u)*h-c*a,this.m_J.linearA.Set(-a,-h),this.m_J.angularA=-m,p+=s.m_invMass+s.m_invI*m*m),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,p+=this.m_ratio*this.m_ratio*r.m_invI):(e=n.m_xf.R,i=this.m_prismatic2.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,h=e.col1.y*i.x+e.col2.y*i.y,e=r.m_xf.R,l=this.m_localAnchor2.x-r.m_sweep.localCenter.x,c=this.m_localAnchor2.y-r.m_sweep.localCenter.y,u=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,m=(l=u)*h-c*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*h),this.m_J.angularB=-this.m_ratio*m,p+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*m*m)),this.m_mass=0<p?1/p:0,t.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),o=-this.m_mass*o;this.m_impulse+=o,e.m_linearVelocity.x+=e.m_invMass*o*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*o*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*o*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*o*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*o*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*o*this.m_J.angularB},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e=this.m_bodyA,i=this.m_bodyB,o=0,t=0,o=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),t=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),t=this.m_constant-(o+this.m_ratio*t),t=-this.m_mass*t;return e.m_sweep.c.x+=e.m_invMass*t*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*t*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*t*this.m_J.angularA,i.m_sweep.c.x+=i.m_invMass*t*this.m_J.linearB.x,i.m_sweep.c.y+=i.m_invMass*t*this.m_J.linearB.y,i.m_sweep.a+=i.m_invI*t*this.m_J.angularB,e.SynchronizeTransform(),i.SynchronizeTransform(),0<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.type=Box2D.Dynamics.Joints.b2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},c2inherit(Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2GearJointDef.prototype.Initialize=function(t,e,i){this.joint1=t,this.bodyA=t.GetBodyA(),this.joint2=e,this.bodyB=e.GetBodyA(),this.ratio=i},Box2D.Dynamics.Joints.b2GearJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2GearJoint(this)},Box2D.Dynamics.Joints.b2Jacobian=function(){this.linearA=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Joints.b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},Box2D.Dynamics.Joints.b2Jacobian.prototype.Set=function(t,e,i,o){void 0===e&&(e=0),void 0===o&&(o=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(i),this.angularB=o},Box2D.Dynamics.Joints.b2Jacobian.prototype.Compute=function(t,e,i,o){return void 0===e&&(e=0),void 0===o&&(o=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*o},Box2D.Dynamics.Joints.b2LineJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat22,this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},c2inherit(Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),e=o.x-i.x,i=o.y-i.y,t=t.GetWorldVector(this.m_localXAxis1);return t.x*e+t.y*i},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.m_xf.R,o=this.m_localAnchor1.x-t.m_sweep.localCenter.x,n=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=i.col1.x*o+i.col2.x*n,n=i.col1.y*o+i.col2.y*n,o=s;i=e.m_xf.R;var r=this.m_localAnchor2.x-e.m_sweep.localCenter.x,a=this.m_localAnchor2.y-e.m_sweep.localCenter.y,s=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=s,h=t.m_sweep.c.x+o,l=t.m_sweep.c.y+n,c=e.m_sweep.c.x+r-h,i=e.m_sweep.c.y+a-l,s=t.GetWorldVector(this.m_localXAxis1),h=t.m_linearVelocity,l=e.m_linearVelocity,t=t.m_angularVelocity,e=e.m_angularVelocity;return c*(-t*s.y)+i*(t*s.x)+(s.x*(l.x+-e*a-h.x- -t*n)+s.y*(l.y+e*r-h.y-t*o))},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2LineJoint.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=0;this.m_localCenterA.SetV(e.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var n=e.GetTransform(),s=(i.GetTransform(),e.m_xf.R),r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y,o=s.col1.x*r+s.col2.x*a,a=s.col1.y*r+s.col2.y*a,r=o;s=i.m_xf.R;var h=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*h+s.col2.x*l,l=s.col1.y*h+s.col2.y*l,h=o;s=i.m_sweep.c.x+h-e.m_sweep.c.x-r,o=i.m_sweep.c.y+l-e.m_sweep.c.y-a;this.m_invMassA=e.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=e.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localXAxis1)),this.m_a1=(s+r)*this.m_axis.y-(o+a)*this.m_axis.x,this.m_a2=h*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localYAxis1)),this.m_s1=(s+r)*this.m_perp.y-(o+a)*this.m_perp.x,this.m_s2=h*this.m_perp.y-l*this.m_perp.x;var c,r=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,l=this.m_invIB;this.m_K.col1.x=r+a+h*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=r+a+h*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(c=this.m_axis.x*s+this.m_axis.y*o,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:c<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.y=0):c>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,s=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,o=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,t=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,e.m_linearVelocity.x-=this.m_invMassA*s,e.m_linearVelocity.y-=this.m_invMassA*o,e.m_angularVelocity-=this.m_invIA*c,i.m_linearVelocity.x+=this.m_invMassB*s,i.m_linearVelocity.y+=this.m_invMassB*o,i.m_angularVelocity+=this.m_invIB*t):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,n=e.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=0,h=0,l=0,c=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(p=this.m_axis.x*(s.x-o.x)+this.m_axis.y*(s.y-o.y)+this.m_a2*r-this.m_a1*n,u=this.m_motorMass*(this.m_motorSpeed-p),m=this.m_motorImpulse,p=t.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+u,-p,p),a=(u=this.m_motorImpulse-m)*this.m_axis.x,h=u*this.m_axis.y,l=u*this.m_a1,c=u*this.m_a2,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,n-=this.m_invIA*l,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*h,r+=this.m_invIB*c);var m,u,p,y,t=this.m_perp.x*(s.x-o.x)+this.m_perp.y*(s.y-o.y)+this.m_s2*r-this.m_s1*n;c=this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(p=this.m_axis.x*(s.x-o.x)+this.m_axis.y*(s.y-o.y)+this.m_a2*r-this.m_a1*n,m=this.m_impulse.Copy(),y=this.m_K.Solve(Box2D.Common.Math.b2Vec2.Get(0,0),-t,-p),this.m_impulse.Add(y),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.y=Math.max(this.m_impulse.y,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.y=Math.min(this.m_impulse.y,0)),u=-t-(this.m_impulse.y-m.y)*this.m_K.col2.x,p=(p=0)!=this.m_K.col1.x?u/this.m_K.col1.x+m.x:m.x,this.m_impulse.x=p,y.x=this.m_impulse.x-m.x,y.y=this.m_impulse.y-m.y,a=y.x*this.m_perp.x+y.y*this.m_axis.x,h=y.x*this.m_perp.y+y.y*this.m_axis.y,l=y.x*this.m_s1+y.y*this.m_a1,y.x*this.m_s2+y.y*this.m_a2):(y=(y=0)!=this.m_K.col1.x?-t/this.m_K.col1.x:0,this.m_impulse.x+=y,a=y*this.m_perp.x,h=y*this.m_perp.y,l=y*this.m_s1,y*this.m_s2),o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,n-=this.m_invIA*l,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*h,r+=this.m_invIB*c,e.m_linearVelocity.SetV(o),e.m_angularVelocity=n,i.m_linearVelocity.SetV(s),i.m_angularVelocity=r},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e=this.m_bodyA,i=this.m_bodyB,o=e.m_sweep.c,n=e.m_sweep.a,s=i.m_sweep.c,r=i.m_sweep.a,a=0,h=0,l=0,c=0,m=0,u=0,p=!1,y=0,_=Box2D.Common.Math.b2Mat22.FromAngle(n),d=Box2D.Common.Math.b2Mat22.FromAngle(r),f=_,x=this.m_localAnchor1.x-this.m_localCenterA.x,g=this.m_localAnchor1.y-this.m_localCenterA.y,a=f.col1.x*x+f.col2.x*g,g=f.col1.y*x+f.col2.y*g,x=a;f=d;var b=this.m_localAnchor2.x-this.m_localCenterB.x,t=this.m_localAnchor2.y-this.m_localCenterB.y;a=f.col1.x*b+f.col2.x*t,t=f.col1.y*b+f.col2.y*t,b=a;d=s.x+b-o.x-x,f=s.y+t-o.y-g;this.m_enableLimit&&(this.m_axis=Box2D.Common.Math.b2Math.MulMV(_,this.m_localXAxis1),this.m_a1=(d+x)*this.m_axis.y-(f+g)*this.m_axis.x,this.m_a2=b*this.m_axis.y-t*this.m_axis.x,a=this.m_axis.x*d+this.m_axis.y*f,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(y=Box2D.Common.Math.b2Math.Clamp(a,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),u=Math.abs(a),p=!0):a<=this.m_lowerTranslation?(y=Box2D.Common.Math.b2Math.Clamp(a-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),u=this.m_lowerTranslation-a,p=!0):a>=this.m_upperTranslation&&(y=Box2D.Common.Math.b2Math.Clamp(a-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),u=a-this.m_upperTranslation,p=!0)),this.m_perp=Box2D.Common.Math.b2Math.MulMV(_,this.m_localYAxis1),this.m_s1=(d+x)*this.m_perp.y-(f+g)*this.m_perp.x,this.m_s2=b*this.m_perp.y-t*this.m_perp.x;t=Box2D.Common.Math.b2Vec2.Get(0,0),f=this.m_perp.x*d+this.m_perp.y*f,u=Math.max(u,Math.abs(f));p?(h=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,m=this.m_invIB,this.m_K.col1.x=h+l+c*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+l+c*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_K.Solve(t,-f,-y)):(h=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,m=this.m_invIB,B=(B=0)!=(v=h+l+c*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2)?-f/v:0,t.x=B,t.y=0);var f=t.x*this.m_perp.x+t.y*this.m_axis.x,v=t.x*this.m_perp.y+t.y*this.m_axis.y,B=t.x*this.m_s1+t.y*this.m_a1,t=t.x*this.m_s2+t.y*this.m_a2;return o.x-=this.m_invMassA*f,o.y-=this.m_invMassA*v,n-=this.m_invIA*B,s.x+=this.m_invMassB*f,s.y+=this.m_invMassB*v,r+=this.m_invIB*t,e.m_sweep.a=n,i.m_sweep.a=r,e.SynchronizeTransform(),i.SynchronizeTransform(),u<=Box2D.Common.b2Settings.b2_linearSlop&&0<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},c2inherit(Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2LineJointDef.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o)},Box2D.Dynamics.Joints.b2LineJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2LineJoint(this)},Box2D.Dynamics.Joints.b2PrismaticJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat33,this.m_impulse=new Box2D.Common.Math.b2Vec3(0,0,0),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},c2inherit(Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),e=o.x-i.x,i=o.y-i.y,t=t.GetWorldVector(this.m_localXAxis1);return t.x*e+t.y*i},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.m_xf.R,o=this.m_localAnchor1.x-t.m_sweep.localCenter.x,n=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=i.col1.x*o+i.col2.x*n,n=i.col1.y*o+i.col2.y*n,o=s;i=e.m_xf.R;var r=this.m_localAnchor2.x-e.m_sweep.localCenter.x,a=this.m_localAnchor2.y-e.m_sweep.localCenter.y,s=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=s,h=t.m_sweep.c.x+o,l=t.m_sweep.c.y+n,c=e.m_sweep.c.x+r-h,i=e.m_sweep.c.y+a-l,s=t.GetWorldVector(this.m_localXAxis1),h=t.m_linearVelocity,l=e.m_linearVelocity,t=t.m_angularVelocity,e=e.m_angularVelocity;return c*(-t*s.y)+i*(t*s.x)+(s.x*(l.x+-e*a-h.x- -t*n)+s.y*(l.y+e*r-h.y-t*o))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=0;this.m_localCenterA.SetV(e.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var n=e.GetTransform(),s=(i.GetTransform(),e.m_xf.R),r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y,o=s.col1.x*r+s.col2.x*a,a=s.col1.y*r+s.col2.y*a,r=o;s=i.m_xf.R;var h=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*h+s.col2.x*l,l=s.col1.y*h+s.col2.y*l,h=o;s=i.m_sweep.c.x+h-e.m_sweep.c.x-r,o=i.m_sweep.c.y+l-e.m_sweep.c.y-a;this.m_invMassA=e.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=e.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localXAxis1)),this.m_a1=(s+r)*this.m_axis.y-(o+a)*this.m_axis.x,this.m_a2=h*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localYAxis1)),this.m_s1=(s+r)*this.m_perp.y-(o+a)*this.m_perp.x,this.m_s2=h*this.m_perp.y-l*this.m_perp.x;var c,r=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,l=this.m_invIB;this.m_K.col1.x=r+a+h*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1+l*this.m_s2,this.m_K.col1.z=h*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+l,this.m_K.col2.z=h*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=r+a+h*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(c=this.m_axis.x*s+this.m_axis.y*o,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:c<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.z=0):c>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,s=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,o=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,t=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,e.m_linearVelocity.x-=this.m_invMassA*s,e.m_linearVelocity.y-=this.m_invMassA*o,e.m_angularVelocity-=this.m_invIA*c,i.m_linearVelocity.x+=this.m_invMassB*s,i.m_linearVelocity.y+=this.m_invMassB*o,i.m_angularVelocity+=this.m_invIB*t):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,n=e.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=0,h=0,l=0,c=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(_=this.m_axis.x*(s.x-o.x)+this.m_axis.y*(s.y-o.y)+this.m_a2*r-this.m_a1*n,p=this.m_motorMass*(this.m_motorSpeed-_),u=this.m_motorImpulse,m=t.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+p,-m,m),a=(p=this.m_motorImpulse-u)*this.m_axis.x,h=p*this.m_axis.y,l=p*this.m_a1,c=p*this.m_a2,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,n-=this.m_invIA*l,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*h,r+=this.m_invIB*c);var m,u,p,y=this.m_perp.x*(s.x-o.x)+this.m_perp.y*(s.y-o.y)+this.m_s2*r-this.m_s1*n,_=r-n;c=this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(t=this.m_axis.x*(s.x-o.x)+this.m_axis.y*(s.y-o.y)+this.m_a2*r-this.m_a1*n,m=this.m_impulse.Copy(),u=this.m_K.Solve33(new Box2D.Common.Math.b2Vec3(0,0,0),-y,-_,-t),this.m_impulse.Add(u),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z=Math.max(this.m_impulse.z,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=Math.min(this.m_impulse.z,0)),p=-y-(this.m_impulse.z-m.z)*this.m_K.col3.x,t=-_-(this.m_impulse.z-m.z)*this.m_K.col3.y,(t=this.m_K.Solve22(Box2D.Common.Math.b2Vec2.Get(0,0),p,t)).x+=m.x,t.y+=m.y,this.m_impulse.x=t.x,this.m_impulse.y=t.y,u.x=this.m_impulse.x-m.x,u.y=this.m_impulse.y-m.y,u.z=this.m_impulse.z-m.z,a=u.x*this.m_perp.x+u.z*this.m_axis.x,h=u.x*this.m_perp.y+u.z*this.m_axis.y,l=u.x*this.m_s1+u.y+u.z*this.m_a1,u.x*this.m_s2+u.y+u.z*this.m_a2):(_=this.m_K.Solve22(Box2D.Common.Math.b2Vec2.Get(0,0),-y,-_),this.m_impulse.x+=_.x,this.m_impulse.y+=_.y,a=_.x*this.m_perp.x,h=_.x*this.m_perp.y,l=_.x*this.m_s1+_.y,_.x*this.m_s2+_.y),o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,n-=this.m_invIA*l,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*h,r+=this.m_invIB*c,e.m_linearVelocity.SetV(o),e.m_angularVelocity=n,i.m_linearVelocity.SetV(s),i.m_angularVelocity=r},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e=this.m_bodyA,i=this.m_bodyB,o=e.m_sweep.c,n=e.m_sweep.a,s=i.m_sweep.c,r=i.m_sweep.a,a=0,h=0,l=0,c=0,m=0,u=0,p=!1,y=0,_=Box2D.Common.Math.b2Mat22.FromAngle(n),d=Box2D.Common.Math.b2Mat22.FromAngle(r),f=_,x=this.m_localAnchor1.x-this.m_localCenterA.x,g=this.m_localAnchor1.y-this.m_localCenterA.y,a=f.col1.x*x+f.col2.x*g,g=f.col1.y*x+f.col2.y*g,x=a;f=d;var b=this.m_localAnchor2.x-this.m_localCenterB.x,t=this.m_localAnchor2.y-this.m_localCenterB.y;a=f.col1.x*b+f.col2.x*t,t=f.col1.y*b+f.col2.y*t,b=a;d=s.x+b-o.x-x,f=s.y+t-o.y-g;this.m_enableLimit&&(this.m_axis=Box2D.Common.Math.b2Math.MulMV(_,this.m_localXAxis1),this.m_a1=(d+x)*this.m_axis.y-(f+g)*this.m_axis.x,this.m_a2=b*this.m_axis.y-t*this.m_axis.x,a=this.m_axis.x*d+this.m_axis.y*f,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(y=Box2D.Common.Math.b2Math.Clamp(a,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),u=Math.abs(a),p=!0):a<=this.m_lowerTranslation?(y=Box2D.Common.Math.b2Math.Clamp(a-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),u=this.m_lowerTranslation-a,p=!0):a>=this.m_upperTranslation&&(y=Box2D.Common.Math.b2Math.Clamp(a-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),u=a-this.m_upperTranslation,p=!0)),this.m_perp=Box2D.Common.Math.b2Math.MulMV(_,this.m_localYAxis1),this.m_s1=(d+x)*this.m_perp.y-(f+g)*this.m_perp.x,this.m_s2=b*this.m_perp.y-t*this.m_perp.x;var t=new Box2D.Common.Math.b2Vec3(0,0,0),d=this.m_perp.x*d+this.m_perp.y*f,f=r-n-this.m_refAngle,u=Math.max(u,Math.abs(d)),v=Math.abs(f);p?(h=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,m=this.m_invIB,this.m_K.col1.x=h+l+c*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1+m*this.m_s2,this.m_K.col1.z=c*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+m,this.m_K.col2.z=c*this.m_a1+m*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=h+l+c*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_K.Solve33(t,-d,-f,-y)):(h=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,m=this.m_invIB,h=h+l+c*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,l=c*this.m_s1+m*this.m_s2,B=c+m,this.m_K.col1.Set(h,l,0),this.m_K.col2.Set(l,B,0),B=this.m_K.Solve22(Box2D.Common.Math.b2Vec2.Get(0,0),-d,-f),t.x=B.x,t.y=B.y,t.z=0);var d=t.x*this.m_perp.x+t.z*this.m_axis.x,f=t.x*this.m_perp.y+t.z*this.m_axis.y,B=t.x*this.m_s1+t.y+t.z*this.m_a1,t=t.x*this.m_s2+t.y+t.z*this.m_a2;return o.x-=this.m_invMassA*d,o.y-=this.m_invMassA*f,n-=this.m_invIA*B,s.x+=this.m_invMassB*d,s.y+=this.m_invMassB*f,r+=this.m_invIB*t,e.m_sweep.a=n,i.m_sweep.a=r,e.SynchronizeTransform(),i.SynchronizeTransform(),u<=Box2D.Common.b2Settings.b2_linearSlop&&v<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},c2inherit(Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PrismaticJoint(this)},Box2D.Dynamics.Joints.b2PulleyJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=Math.min(t.maxLengthA,this.m_constant-this.m_ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=Math.min(t.maxLengthB,(this.m_constant-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},c2inherit(Box2D.Dynamics.Joints.b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,e=t.x-e,i=t.y-i;return Math.sqrt(e*e+i*i)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,e=t.x-e,i=t.y-i;return Math.sqrt(e*e+i*i)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_xf.R,n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=o.col1.x*n+o.col2.x*s,s=o.col1.y*n+o.col2.y*s,n=r;o=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,h=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=o.col1.x*a+o.col2.x*h,h=o.col1.y*a+o.col2.y*h,a=r,l=e.m_sweep.c.x+n,c=e.m_sweep.c.y+s,m=i.m_sweep.c.x+a,u=i.m_sweep.c.y+h,p=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,o=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,r=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(l-p,c-y),this.m_u2.Set(m-o,u-r);o=this.m_u1.Length(),u=this.m_u2.Length();o>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/o):this.m_u1.SetZero(),u>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),0<this.m_constant-o-this.m_ratio*u?(this.m_state=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,o<this.m_maxLength1?(this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,u<this.m_maxLength2?(this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit;r=n*this.m_u1.y-s*this.m_u1.x,o=a*this.m_u2.y-h*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*r*r,this.m_limitMass2=i.m_invMass+i.m_invI*o*o,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting?(this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio,u=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,r=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,o=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,t=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*u,e.m_linearVelocity.y+=e.m_invMass*r,e.m_angularVelocity+=e.m_invI*(n*r-s*u),i.m_linearVelocity.x+=i.m_invMass*o,i.m_linearVelocity.y+=i.m_invMass*t,i.m_angularVelocity+=i.m_invI*(a*t-h*o)):(this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_xf.R,n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=o.col1.x*n+o.col2.x*s,s=o.col1.y*n+o.col2.y*s,n=r;o=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,h=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=o.col1.x*a+o.col2.x*h,h=o.col1.y*a+o.col2.y*h,a=r,l=0,c=0,m=0,u=0,p=0,y=0,_=0,d=0,f=0,o=0,r=0;this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(l=e.m_linearVelocity.x+-e.m_angularVelocity*s,c=e.m_linearVelocity.y+e.m_angularVelocity*n,m=i.m_linearVelocity.x+-i.m_angularVelocity*h,u=i.m_linearVelocity.y+i.m_angularVelocity*a,f=-(this.m_u1.x*l+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*u),o=this.m_pulleyMass*-f,r=this.m_impulse,this.m_impulse=Math.max(0,this.m_impulse+o),p=-(o=this.m_impulse-r)*this.m_u1.x,y=-o*this.m_u1.y,_=-this.m_ratio*o*this.m_u2.x,d=-this.m_ratio*o*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*p,e.m_linearVelocity.y+=e.m_invMass*y,e.m_angularVelocity+=e.m_invI*(n*y-s*p),i.m_linearVelocity.x+=i.m_invMass*_,i.m_linearVelocity.y+=i.m_invMass*d,i.m_angularVelocity+=i.m_invI*(a*d-h*_)),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(l=e.m_linearVelocity.x+-e.m_angularVelocity*s,c=e.m_linearVelocity.y+e.m_angularVelocity*n,f=-(this.m_u1.x*l+this.m_u1.y*c),o=-this.m_limitMass1*f,r=this.m_limitImpulse1,this.m_limitImpulse1=Math.max(0,this.m_limitImpulse1+o),p=-(o=this.m_limitImpulse1-r)*this.m_u1.x,y=-o*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*p,e.m_linearVelocity.y+=e.m_invMass*y,e.m_angularVelocity+=e.m_invI*(n*y-s*p)),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(m=i.m_linearVelocity.x+-i.m_angularVelocity*h,u=i.m_linearVelocity.y+i.m_angularVelocity*a,f=-(this.m_u2.x*m+this.m_u2.y*u),o=-this.m_limitMass2*f,r=this.m_limitImpulse2,this.m_limitImpulse2=Math.max(0,this.m_limitImpulse2+o),_=-(o=this.m_limitImpulse2-r)*this.m_u2.x,d=-o*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*_,i.m_linearVelocity.y+=i.m_invMass*d,i.m_angularVelocity+=i.m_invI*(a*d-h*_))},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e,i=this.m_bodyA,o=this.m_bodyB,n=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,h=0,l=0,c=0,m=0,u=0,p=0,y=0,_=0,d=0,f=0,x=0,g=0,b=0,t=0;return this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(e=i.m_xf.R,h=this.m_localAnchor1.x-i.m_sweep.localCenter.x,l=this.m_localAnchor1.y-i.m_sweep.localCenter.y,b=e.col1.x*h+e.col2.x*l,l=e.col1.y*h+e.col2.y*l,h=b,e=o.m_xf.R,c=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,b=e.col1.x*c+e.col2.x*m,m=e.col1.y*c+e.col2.y*m,c=b,u=i.m_sweep.c.x+h,p=i.m_sweep.c.y+l,y=o.m_sweep.c.x+c,_=o.m_sweep.c.y+m,this.m_u1.Set(u-n,p-s),this.m_u2.Set(y-r,_-a),d=this.m_u1.Length(),f=this.m_u2.Length(),d>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/d):this.m_u1.SetZero(),f>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/f):this.m_u2.SetZero(),x=this.m_constant-d-this.m_ratio*f,t=Math.max(t,-x),x=Box2D.Common.Math.b2Math.Clamp(x+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),u=-(g=-this.m_pulleyMass*x)*this.m_u1.x,p=-g*this.m_u1.y,y=-this.m_ratio*g*this.m_u2.x,_=-this.m_ratio*g*this.m_u2.y,i.m_sweep.c.x+=i.m_invMass*u,i.m_sweep.c.y+=i.m_invMass*p,i.m_sweep.a+=i.m_invI*(h*p-l*u),o.m_sweep.c.x+=o.m_invMass*y,o.m_sweep.c.y+=o.m_invMass*_,o.m_sweep.a+=o.m_invI*(c*_-m*y),i.SynchronizeTransform(),o.SynchronizeTransform()),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(e=i.m_xf.R,h=this.m_localAnchor1.x-i.m_sweep.localCenter.x,l=this.m_localAnchor1.y-i.m_sweep.localCenter.y,b=e.col1.x*h+e.col2.x*l,l=e.col1.y*h+e.col2.y*l,h=b,u=i.m_sweep.c.x+h,p=i.m_sweep.c.y+l,this.m_u1.Set(u-n,p-s),(d=this.m_u1.Length())>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u1.x*=1/d,this.m_u1.y*=1/d):this.m_u1.SetZero(),x=this.m_maxLength1-d,t=Math.max(t,-x),x=Box2D.Common.Math.b2Math.Clamp(x+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),u=-(g=-this.m_limitMass1*x)*this.m_u1.x,p=-g*this.m_u1.y,i.m_sweep.c.x+=i.m_invMass*u,i.m_sweep.c.y+=i.m_invMass*p,i.m_sweep.a+=i.m_invI*(h*p-l*u),i.SynchronizeTransform()),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(e=o.m_xf.R,c=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,b=e.col1.x*c+e.col2.x*m,m=e.col1.y*c+e.col2.y*m,c=b,y=o.m_sweep.c.x+c,_=o.m_sweep.c.y+m,this.m_u2.Set(y-r,_-a),(f=this.m_u2.Length())>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u2.x*=1/f,this.m_u2.y*=1/f):this.m_u2.SetZero(),x=this.m_maxLength2-f,t=Math.max(t,-x),x=Box2D.Common.Math.b2Math.Clamp(x+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),y=-(g=-this.m_limitMass2*x)*this.m_u2.x,_=-g*this.m_u2.y,o.m_sweep.c.x+=o.m_invMass*y,o.m_sweep.c.y+=o.m_invMass*_,o.m_sweep.a+=o.m_invI*(c*_-m*y),o.SynchronizeTransform()),t<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=1,Box2D.Dynamics.Joints.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.groundAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.groundAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},c2inherit(Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Initialize=function(t,e,i,o,n,s,r){void 0===r&&(r=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(i),this.groundAnchorB.SetV(o),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(s);e=n.x-i.x,i=n.y-i.y;this.lengthA=Math.sqrt(e*e+i*i);i=s.x-o.x,o=s.y-o.y;this.lengthB=Math.sqrt(i*i+o*o),this.ratio=r;r=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=r-this.ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(r-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.ratio},Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PulleyJoint(this)},Box2D.Dynamics.Joints.b2RevoluteJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.K3=new Box2D.Common.Math.b2Mat22,this.impulse3=new Box2D.Common.Math.b2Vec3(0,0,0),this.impulse2=Box2D.Common.Math.b2Vec2.Get(0,0),this.reduced=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=new Box2D.Common.Math.b2Vec3(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit},c2inherit(Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse.x,t*this.m_impulse.y)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableLimit=function(t){this.m_enableLimit=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableMotor=function(t){this.m_enableMotor=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_xf.R,n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=o.col1.x*n+o.col2.x*s,s=o.col1.y*n+o.col2.y*s,n=r;o=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=o.col1.x*a+o.col2.x*h,h=o.col1.y*a+o.col2.y*h,a=r;var l,c=e.m_invMass,m=i.m_invMass,o=e.m_invI,r=i.m_invI;this.m_mass.col1.x=c+m+s*s*o+h*h*r,this.m_mass.col2.x=-s*n*o-h*a*r,this.m_mass.col3.x=-s*o-h*r,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+m+n*n*o+a*a*r,this.m_mass.col3.y=n*o+a*r,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=o+r,this.m_motorMass=1/(o+r),this.m_enableMotor||(this.m_motorImpulse=0),this.m_enableLimit?(l=i.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Box2D.Common.b2Settings.b2_angularSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:l<=this.m_lowerAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit):l>=this.m_upperAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,l=this.m_impulse.x,t=this.m_impulse.y,e.m_linearVelocity.x-=c*l,e.m_linearVelocity.y-=c*t,e.m_angularVelocity-=o*(n*t-s*l+this.m_motorImpulse+this.m_impulse.z),i.m_linearVelocity.x+=m*l,i.m_linearVelocity.y+=m*t,i.m_angularVelocity+=r*(a*t-h*l+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(t){var e,i,o,n,s=this.m_bodyA,r=this.m_bodyB,a=0,h=0,l=0,c=0,m=0,u=s.m_linearVelocity,p=s.m_angularVelocity,y=r.m_linearVelocity,_=r.m_angularVelocity,d=s.m_invMass,f=r.m_invMass,x=s.m_invI,g=r.m_invI;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(e=_-p-this.m_motorSpeed,o=this.m_motorMass*-e,i=this.m_motorImpulse,e=t.dt*this.m_maxMotorTorque,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+o,-e,e),p-=x*(o=this.m_motorImpulse-i),_+=g*o),this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(n=s.m_xf.R,h=this.m_localAnchor1.x-s.m_sweep.localCenter.x,l=this.m_localAnchor1.y-s.m_sweep.localCenter.y,a=n.col1.x*h+n.col2.x*l,l=n.col1.y*h+n.col2.y*l,h=a,n=r.m_xf.R,c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,m=this.m_localAnchor2.y-r.m_sweep.localCenter.y,a=n.col1.x*c+n.col2.x*m,m=n.col1.y*c+n.col2.y*m,c=a,e=y.x+-_*m-u.x- -p*l,i=y.y+_*c-u.y-p*h,o=_-p,this.m_mass.Solve33(this.impulse3,-e,-i,-o),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z+this.impulse3.z<0&&(this.m_mass.Solve22(this.reduced,-e,-i),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&0<this.m_impulse.z+this.impulse3.z&&(this.m_mass.Solve22(this.reduced,-e,-i),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0),u.x-=d*this.impulse3.x,u.y-=d*this.impulse3.y,p-=x*(h*this.impulse3.y-l*this.impulse3.x+this.impulse3.z),y.x+=f*this.impulse3.x,y.y+=f*this.impulse3.y,_+=g*(c*this.impulse3.y-m*this.impulse3.x+this.impulse3.z)):(n=s.m_xf.R,h=this.m_localAnchor1.x-s.m_sweep.localCenter.x,l=this.m_localAnchor1.y-s.m_sweep.localCenter.y,a=n.col1.x*h+n.col2.x*l,l=n.col1.y*h+n.col2.y*l,h=a,n=r.m_xf.R,c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,m=this.m_localAnchor2.y-r.m_sweep.localCenter.y,a=n.col1.x*c+n.col2.x*m,m=n.col1.y*c+n.col2.y*m,c=a,n=y.x+-_*m-u.x- -p*l,a=y.y+_*c-u.y-p*h,this.m_mass.Solve22(this.impulse2,-n,-a),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,u.x-=d*this.impulse2.x,u.y-=d*this.impulse2.y,p-=x*(h*this.impulse2.y-l*this.impulse2.x),y.x+=f*this.impulse2.x,y.y+=f*this.impulse2.y,_+=g*(c*this.impulse2.y-m*this.impulse2.x)),s.m_linearVelocity.SetV(u),s.m_angularVelocity=p,r.m_linearVelocity.SetV(y),r.m_angularVelocity=_},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e=0,i=this.m_bodyA,o=this.m_bodyB,n=0,s=0,r=0;this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit&&(f=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,x=0,this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?(e=Box2D.Common.Math.b2Math.Clamp(f-this.m_lowerAngle,-Box2D.Common.b2Settings.b2_maxAngularCorrection,Box2D.Common.b2Settings.b2_maxAngularCorrection),x=-this.m_motorMass*e,n=Math.abs(e)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(n=-(e=f-this.m_lowerAngle),e=Box2D.Common.Math.b2Math.Clamp(e+Box2D.Common.b2Settings.b2_angularSlop,-Box2D.Common.b2Settings.b2_maxAngularCorrection,0),x=-this.m_motorMass*e):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(n=e=f-this.m_upperAngle,e=Box2D.Common.Math.b2Math.Clamp(e-Box2D.Common.b2Settings.b2_angularSlop,0,Box2D.Common.b2Settings.b2_maxAngularCorrection),x=-this.m_motorMass*e),i.m_sweep.a-=i.m_invI*x,o.m_sweep.a+=o.m_invI*x,i.SynchronizeTransform(),o.SynchronizeTransform()),c=i.m_xf.R;var a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,h=this.m_localAnchor1.y-i.m_sweep.localCenter.y,l=c.col1.x*a+c.col2.x*h,h=c.col1.y*a+c.col2.y*h,a=l,c=o.m_xf.R,m=this.m_localAnchor2.x-o.m_sweep.localCenter.x,u=this.m_localAnchor2.y-o.m_sweep.localCenter.y;l=c.col1.x*m+c.col2.x*u,u=c.col1.y*m+c.col2.y*u,m=l;var p=o.m_sweep.c.x+m-i.m_sweep.c.x-a,y=o.m_sweep.c.y+u-i.m_sweep.c.y-h,_=p*p+y*y,t=Math.sqrt(_),d=t,f=i.m_invMass,e=o.m_invMass,x=i.m_invI,c=o.m_invI,l=10*Box2D.Common.b2Settings.b2_linearSlop;return l*l<_&&(s=(t=1/(f+e))*-p,r=t*-y,i.m_sweep.c.x-=.5*f*s,i.m_sweep.c.y-=.5*f*r,o.m_sweep.c.x+=.5*e*s,o.m_sweep.c.y+=.5*e*r,p=o.m_sweep.c.x+m-i.m_sweep.c.x-a,y=o.m_sweep.c.y+u-i.m_sweep.c.y-h),this.K1.col1.x=f+e,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=f+e,this.K2.col1.x=x*h*h,this.K2.col2.x=-x*a*h,this.K2.col1.y=-x*a*h,this.K2.col2.y=x*a*a,this.K3.col1.x=c*u*u,this.K3.col2.x=-c*m*u,this.K3.col1.y=-c*m*u,this.K3.col2.y=c*m*m,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse,-p,-y),s=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.x,r=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.y,i.m_sweep.c.x-=i.m_invMass*s,i.m_sweep.c.y-=i.m_invMass*r,i.m_sweep.a-=i.m_invI*(a*r-h*s),o.m_sweep.c.x+=o.m_invMass*s,o.m_sweep.c.y+=o.m_invMass*r,o.m_sweep.a+=o.m_invI*(m*r-u*s),i.SynchronizeTransform(),o.SynchronizeTransform(),d<=Box2D.Common.b2Settings.b2_linearSlop&&n<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Dynamics.Joints.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint,this.localAnchorA.SetZero(),this.localAnchorB.SetZero(),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},c2inherit(Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2RevoluteJoint(this)},Box2D.Dynamics.Joints.b2WeldJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=new Box2D.Common.Math.b2Vec3(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle},c2inherit(Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionForce=function(t){return Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse.x,t*this.m_impulse.y)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},Box2D.Dynamics.Joints.b2WeldJoint.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_xf.R,n=this.m_localAnchorA.x-e.m_sweep.localCenter.x,s=this.m_localAnchorA.y-e.m_sweep.localCenter.y,r=o.col1.x*n+o.col2.x*s,s=o.col1.y*n+o.col2.y*s,n=r;o=i.m_xf.R;var a=this.m_localAnchorB.x-i.m_sweep.localCenter.x,h=this.m_localAnchorB.y-i.m_sweep.localCenter.y;r=o.col1.x*a+o.col2.x*h,h=o.col1.y*a+o.col2.y*h,a=r;var l=e.m_invMass,c=i.m_invMass,o=e.m_invI,r=i.m_invI;this.m_mass.col1.x=l+c+s*s*o+h*h*r,this.m_mass.col2.x=-s*n*o-h*a*r,this.m_mass.col3.x=-s*o-h*r,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+c+n*n*o+a*a*r,this.m_mass.col3.y=n*o+a*r,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=o+r,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,e.m_linearVelocity.x-=l*this.m_impulse.x,e.m_linearVelocity.y-=l*this.m_impulse.y,e.m_angularVelocity-=o*(n*this.m_impulse.y-s*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=c*this.m_impulse.x,i.m_linearVelocity.y+=c*this.m_impulse.y,i.m_angularVelocity+=r*(a*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,n=e.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=e.m_invMass,h=i.m_invMass,l=e.m_invI,c=i.m_invI,m=e.m_xf.R,u=this.m_localAnchorA.x-e.m_sweep.localCenter.x,p=this.m_localAnchorA.y-e.m_sweep.localCenter.y,y=m.col1.x*u+m.col2.x*p,p=m.col1.y*u+m.col2.y*p,u=y;m=i.m_xf.R;var _=this.m_localAnchorB.x-i.m_sweep.localCenter.x,d=this.m_localAnchorB.y-i.m_sweep.localCenter.y;y=m.col1.x*_+m.col2.x*d,d=m.col1.y*_+m.col2.y*d,_=y;var f=s.x-r*d-o.x+n*p,x=s.y+r*_-o.y-n*u,m=r-n,y=new Box2D.Common.Math.b2Vec3(0,0,0);this.m_mass.Solve33(y,-f,-x,-m),this.m_impulse.Add(y),o.x-=a*y.x,o.y-=a*y.y,n-=l*(u*y.y-p*y.x+y.z),s.x+=h*y.x,s.y+=h*y.y,r+=c*(_*y.y-d*y.x+y.z),e.m_angularVelocity=n,i.m_angularVelocity=r},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e=this.m_bodyA,i=this.m_bodyB,o=e.m_xf.R,n=this.m_localAnchorA.x-e.m_sweep.localCenter.x,s=this.m_localAnchorA.y-e.m_sweep.localCenter.y,r=o.col1.x*n+o.col2.x*s,s=o.col1.y*n+o.col2.y*s,n=r;o=i.m_xf.R;var a=this.m_localAnchorB.x-i.m_sweep.localCenter.x,h=this.m_localAnchorB.y-i.m_sweep.localCenter.y;r=o.col1.x*a+o.col2.x*h,h=o.col1.y*a+o.col2.y*h,a=r;var l=e.m_invMass,c=i.m_invMass,m=e.m_invI,u=i.m_invI,p=i.m_sweep.c.x+a-e.m_sweep.c.x-n,y=i.m_sweep.c.y+h-e.m_sweep.c.y-s,_=i.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,t=10*Box2D.Common.b2Settings.b2_linearSlop,o=Math.sqrt(p*p+y*y),r=Math.abs(_);t<o&&(m*=1,u*=1),this.m_mass.col1.x=l+c+s*s*m+h*h*u,this.m_mass.col2.x=-s*n*m-h*a*u,this.m_mass.col3.x=-s*m-h*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+c+n*n*m+a*a*u,this.m_mass.col3.y=n*m+a*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+u;t=new Box2D.Common.Math.b2Vec3(0,0,0);return this.m_mass.Solve33(t,-p,-y,-_),e.m_sweep.c.x-=l*t.x,e.m_sweep.c.y-=l*t.y,e.m_sweep.a-=m*(n*t.y-s*t.x+t.z),i.m_sweep.c.x+=c*t.x,i.m_sweep.c.y+=c*t.y,i.m_sweep.a+=u*(a*t.y-h*t.x+t.z),e.SynchronizeTransform(),i.SynchronizeTransform(),o<=Box2D.Common.b2Settings.b2_linearSlop&&r<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_weldJoint,this.referenceAngle=0},c2inherit(Box2D.Dynamics.Joints.b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2WeldJoint(this)},Box2D.Collision.b2Collision.s_incidentEdge=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_localTangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_localNormal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_planePoint=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_normal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent2=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v11=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v12=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new Box2D.Collision.b2SimplexCache,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Box2D.Collision.b2DistanceInput,Box2D.Collision.b2TimeOfImpact.s_xfA=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_xfB=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_fcn=new Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new Box2D.Collision.b2DistanceOutput,Box2D.Dynamics.b2Body.s_xf1=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager.s_evalCP=new Box2D.Collision.b2ContactPoint,Box2D.Dynamics.b2World.s_xf=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World.s_backupA=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_backupB=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new Box2D.Collision.b2WorldManifold,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new Box2D.Dynamics.Contacts.b2PositionSolverManifold,cr.b2Separator=function(){},cr.b2Separator.det=function(t,e,i,o,n,s){return t*o+i*s+n*e-e*i-o*n-s*t},cr.b2Separator.hitRay=function(t,e,i,o,n,s,r,a){var h=i-t,l=o-e,c=r-n,m=a-s,m=(c*(s-e)-m*(n-t))/(l*c-h*m),h=t+m*h,l=e+m*l,e=cr.b2Separator.isOnSegment(i,o,t,e,h,l),a=cr.b2Separator.isOnSegment(h,l,n,s,r,a);return e&&a?Box2D.Common.Math.b2Vec2.Get(h,l):null},cr.b2Separator.isOnSegment=function(t,e,i,o,n,s){return(t<=i+.1&&n-.1<=t||i-.1<=t&&t<=n+.1)&&(e<=o+.1&&s-.1<=e||o-.1<=e&&e<=s+.1)&&cr.b2Separator.isOnLine(t,e,i,o,n,s)},cr.b2Separator.isOnLine=function(t,e,i,o,n,s){if(.1<Math.abs(n-i)){o=(s-o)/(n-i)*(t-i)+o;return Math.abs(o-e)<.1}return Math.abs(t-i)<.1},cr.b2Separator.pointsMatch=function(t,e,i,o){return Math.abs(i-t)<.1&&Math.abs(o-e)<.1},cr.b2Separator.Separate=function(t,e){for(var i,o,n,s,r,a,h,l=Box2D.Common.Math.b2Vec2,c=cr.b2Separator.calcShapes(t),m=[],u=0,p=c.length;u<p;u++){for(o=c[u],(i=[]).length=o.length,r=h=0,a=o.length;r<a;r++)n=o[r],s=o[(r+1)%a],h+=n.x*s.y-n.y*s.x,i[r]=l.Get(n.x,n.y);.001*e<=(h=Math.abs(h/2))&&m.push(i)}return m},cr.b2Separator.calcShapes=function(t){var e,i,o,n,s,r,a,h,l,c,m,u,p,y,_,d=0,f=0,x=0,g=0,b=0,v=0,B=0,D=[],C=[],w=!1,S=[],A=[];for(A.push(t);A.length;){for(i=(e=A[0]).length,w=!0,d=0;d<i;d++)if(a=(r=d)<i-1?d+1:d+1-i,h=d<i-2?d+2:d+2-i,l=e[r],c=e[a],m=e[h],cr.b2Separator.det(l.x,l.y,c.x,c.y,m.x,m.y)<0){for(w=!1,x=1e9,f=0;f<i;f++)f!==r&&f!==a&&(b=(g=f)<i-1?f+1:0,u=e[g],p=e[b],(y=cr.b2Separator.hitRay(l.x,l.y,c.x,c.y,u.x,u.y,p.x,p.y))&&(o=(n=c.x-y.x)*n+(s=c.y-y.y)*s)<x&&(B=g,v=b,_=y,x=o));if(1e9===x)return[];for(D=[],C=[],b=v,u=e[g=B],p=e[b],cr.b2Separator.pointsMatch(_.x,_.y,p.x,p.y)||D.push(_),cr.b2Separator.pointsMatch(_.x,_.y,u.x,u.y)||C.push(_),B=-1,v=r;;){if(v===b){if(B<0||i<=B)return[];cr.b2Separator.isOnSegment(p.x,p.y,e[B].x,e[B].y,l.x,l.y)||D.push(e[v]);break}D.push(e[v]),(B=v)-1<0?v=i-1:v--}for(D.reverse(),B=-1,v=a;;){if(v===g){if(B<0||i<=B)return[];v!==g||cr.b2Separator.isOnSegment(u.x,u.y,e[B].x,e[B].y,c.x,c.y)||C.push(e[v]);break}C.push(e[v]),i-1<(B=v)+1?v=0:v++}A.push(D,C),A.shift();break}w&&S.push(A.shift())}return S},cr.behaviors.Physics=function(t){for(var e=0;e<4e3;e++)Box2D.Common.Math.b2Vec2._freeCache.push(new Box2D.Common.Math.b2Vec2(0,0));this.runtime=t,this.world=new Box2D.Dynamics.b2World(Box2D.Common.Math.b2Vec2.Get(0,10),!0),this.worldG=10,this.lastUpdateTick=-1;t=new Box2D.Dynamics.b2ContactListener;t.behavior=this,t.BeginContact=function(t){var e=t.m_fixtureA.GetBody().c2userdata,t=t.m_fixtureB.GetBody().c2userdata;this.behavior.runtime.registerCollision(e.inst,t.inst)},this.world.SetContactListener(t);t=new Box2D.Dynamics.b2ContactFilter;t.behavior=this,t.ShouldCollide=function(t,e){if(this.behavior.allCollisionsEnabled)return!0;var i=t.GetBody().c2userdata.inst.type,t=e.GetBody().c2userdata.inst.type,e=i.extra.Physics_DisabledCollisions;return(!e||!e.contains(t))&&(!(e=t.extra.Physics_DisabledCollisions)||!e.contains(i))},this.world.SetContactFilter(t),this.steppingMode=0,this.velocityIterations=8,this.positionIterations=3,this.allCollisionsEnabled=!0},function(){var M=Box2D.Common.Math.b2Vec2,T=Box2D.Dynamics.b2BodyDef,I=(Box2D.Dynamics.b2Body,Box2D.Dynamics.b2FixtureDef),P=(Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2World,Box2D.Collision.Shapes.b2PolygonShape),L=Box2D.Collision.Shapes.b2CircleShape,c=Box2D.Dynamics.Joints.b2DistanceJointDef,r=Box2D.Dynamics.Joints.b2RevoluteJointDef,t=(Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Mat22,cr.behaviors.Physics.prototype);t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.world=this.behavior.world};var e=t.Instance.prototype;e.onCreate=function(){this.immovable=0!==this.properties[0],this.collisionmask=this.properties[1],this.preventRotation=0!==this.properties[2],this.density=this.properties[3],this.friction=this.properties[4],this.restitution=this.properties[5],this.linearDamping=this.properties[6],this.angularDamping=this.properties[7],this.bullet=0!==this.properties[8],this.enabled=0!==this.properties[9],this.body=null,this.inst.update_bbox(),this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=0,this.lastHeight=0,this.lastTickOverride=!1,this.recreateBody=!1,this.lastAnimation=null,this.lastAnimationFrame=-1,this.myJoints?(this.myJoints.length=0,this.myCreatedJoints.length=0,this.joiningMe.clear()):(this.myJoints=[],this.myCreatedJoints=[],this.joiningMe=new cr.ObjectSet);var e=this;this.recycled||(this.myDestroyCallback=function(t){e.onInstanceDestroyed(t)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},e.postCreate=function(){this.inst.update_bbox(),this.createBody(),this.lastAnimation=this.inst.cur_animation,this.lastAnimationFrame=this.inst.cur_frame},e.onDestroy=function(){this.destroyMyJoints(),this.myCreatedJoints.length=0,this.joiningMe.clear(),this.body&&(this.world.DestroyBody(this.body),this.body=null),this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.saveToJSON=function(){var t,e={e:this.enabled,im:this.immovable,pr:this.preventRotation,d:this.density,fr:this.friction,re:this.restitution,ld:this.linearDamping,ad:this.angularDamping,b:this.bullet,mcj:this.myCreatedJoints};return this.enabled&&((t=M.Get(0,0)).SetV(this.body.GetLinearVelocity()),e.vx=t.x,e.vy=t.y,e.om=this.body.GetAngularVelocity()),e},e.loadFromJSON=function(t){this.destroyMyJoints(),this.myCreatedJoints.length=0,this.joiningMe.clear(),this.body&&(this.world.DestroyBody(this.body),this.body=null),this.enabled=t.e,this.immovable=t.im,this.preventRotation=t.pr,this.density=t.d,this.friction=t.fr,this.restitution=t.re,this.linearDamping=t.ld,this.angularDamping=t.ad,this.bullet=t.b,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=this.inst.width,this.lastHeight=this.inst.height,this.enabled&&(this.createBody(),this.body.SetLinearVelocity(M.Get(t.vx,t.vy)),this.body.SetAngularVelocity(t.om),0===t.vx&&0===t.vy&&0===t.om||this.body.SetAwake(!0),this.myCreatedJoints=t.mcj)},e.afterLoad=function(){this.enabled&&this.recreateMyJoints(),this.behavior.lastUpdateTick=this.runtime.tickcount-1},e.onInstanceDestroyed=function(t){for(var e=t.uid,i=0,o=0,n=this.myCreatedJoints.length;i<n;i++)this.myCreatedJoints[o]=this.myCreatedJoints[i],o<this.myJoints.length&&(this.myJoints[o]=this.myJoints[i]),this.myCreatedJoints[i].params[1]==e?this.world.DestroyJoint(this.myJoints[i]):o++;(this.myCreatedJoints.length=o)<this.myJoints.length&&(this.myJoints.length=o),this.joiningMe.remove(t)},e.destroyMyJoints=function(){for(var t=0,e=this.myJoints.length;t<e;t++)this.world.DestroyJoint(this.myJoints[t]);this.myJoints.length=0},e.recreateMyJoints=function(){for(var t,e=0,i=this.myCreatedJoints.length;e<i;e++)switch((t=this.myCreatedJoints[e]).type){case 0:this.doCreateDistanceJoint(t.params[0],t.params[1],t.params[2],t.params[3],t.params[4]);break;case 1:this.doCreateRevoluteJoint(t.params[0],t.params[1]);break;case 2:this.doCreateLimitedRevoluteJoint(t.params[0],t.params[1],t.params[2],t.params[3])}},e.destroyBody=function(){this.body&&(this.destroyMyJoints(),this.world.DestroyBody(this.body),this.body=null,this.inst.extra.box2dbody=null)};var V=[];function i(){}function o(){}function n(t,e,i){i?((i=t.extra.Physics_DisabledCollisions)&&i.remove(e),(i=e.extra.Physics_DisabledCollisions)&&i.remove(t)):(t.extra.Physics_DisabledCollisions||(t.extra.Physics_DisabledCollisions=new cr.ObjectSet),t.extra.Physics_DisabledCollisions.add(e),e.extra.Physics_DisabledCollisions||(e.extra.Physics_DisabledCollisions=new cr.ObjectSet),e.extra.Physics_DisabledCollisions.add(t))}function s(){}e.createBody=function(){if(this.enabled){var t,e,i,o,n,s,r,a,h,l,c,m,u,p,y,_,d=this.inst,f=!1,x=null,g=null;if(this.body){for(f=!0,(x=M.Get(0,0)).SetV(this.body.GetLinearVelocity()),g=this.body.GetAngularVelocity(),t=0,e=(a=this.joiningMe.valuesRef()).length;t<e;t++)a[t].extra.box2dbody.c2userdata.destroyMyJoints();this.destroyBody()}var b=new I;b.density=this.density,b.friction=this.friction,b.restitution=this.restitution;var v=new T;this.immovable?v.type=0:v.type=2,d.update_bbox(),v.position.x=.02*d.bquad.midX(),v.position.y=.02*d.bquad.midY(),v.angle=d.angle,v.fixedRotation=this.preventRotation,v.linearDamping=this.linearDamping,v.angularDamping=this.angularDamping,v.bullet=this.bullet;var B=this.inst.collision_poly&&!this.inst.collision_poly.is_empty();this.body=this.world.CreateBody(v);var D=(this.body.c2userdata=this).collisionmask;B||this.inst.tilemap_exists||0!==this.collisionmask||(D=1);var C=Math.max(Math.abs(d.width),1),w=Math.max(Math.abs(d.height),1),S=d.width<0,v=d.height<0;if(0===D)if(d.tilemap_exists)for(y=d.bquad.midX()-d.x,_=d.bquad.midY()-d.y,d.getAllCollisionRects(V),a=[],t=0,e=V.length;t<e;++t){if(l=(h=V[t]).rc,h.poly){if(!h.poly.convexpolys){for(c=h.poly.pts_cache,m=h.poly.pts_count,i=0;i<m;++i)a.push(M.Get(c[2*i],c[2*i+1]));var A=3758096384&h.id;for((-2147483648==A||1073741824==A||536870912==A||-2147483648&A&&1073741824&A&&536870912&A)&&a.reverse(),h.poly.convexpolys=cr.b2Separator.Separate(a,(l.right-l.left)*(l.bottom-l.top)),i=0,o=a.length;i<o;++i)M.Free(a[i]);a.length=0}for(i=0,o=h.poly.convexpolys.length;i<o;++i){for(n=0,s=(p=h.poly.convexpolys[i]).length;n<s;++n)a.push(M.Get(.02*(l.left+p[n].x-y),.02*(l.top+p[n].y-_)));for(b.shape=new P,b.shape.SetAsArray(a,a.length),this.body.CreateFixture(b),n=0,s=a.length;n<s;++n)M.Free(a[n]);a.length=0}}else a.push(M.Get(.02*(l.left-y),.02*(l.top-_))),a.push(M.Get(.02*(l.right-y),.02*(l.top-_))),a.push(M.Get(.02*(l.right-y),.02*(l.bottom-_))),a.push(M.Get(.02*(l.left-y),.02*(l.bottom-_))),b.shape=new P,b.shape.SetAsArray(a,a.length),this.body.CreateFixture(b);for(i=0,o=a.length;i<o;++i)M.Free(a[i]);a.length=0}else{for(B=d.angle,d.angle=0,d.set_bbox_changed(),d.update_bbox(),y=d.bquad.midX()-d.x,_=d.bquad.midY()-d.y,d.angle=B,d.set_bbox_changed(),d.collision_poly.cache_poly(S?-C:C,v?-w:w,0),c=d.collision_poly.pts_cache,m=d.collision_poly.pts_count,(a=[]).length=m,t=0;t<m;t++)a[t]=M.Get(c[2*t]-y,c[2*t+1]-_);for(S!=v&&a.reverse(),u=cr.b2Separator.Separate(a,C*w),t=0;t<m;t++)M.Free(a[t]);if(u.length)for(t=0,e=u.length;t<e;t++){for(i=0,o=(a=u[t]).length;i<o;i++)(r=a[i]).x*=.02,r.y*=.02;for(b.shape=new P,b.shape.SetAsArray(a,a.length),this.body.CreateFixture(b),i=0,o=a.length;i<o;i++)M.Free(a[i])}else b.shape=new P,b.shape.SetAsBox(.02*C*.5,.02*w*.5),this.body.CreateFixture(b)}else 1===D?(b.shape=new P,b.shape.SetAsBox(.02*C*.5,.02*w*.5)):b.shape=new L(.02*Math.min(C,w)*.5),this.body.CreateFixture(b);if(d.extra.box2dbody=this.body,this.lastWidth=d.width,this.lastHeight=d.height,f)for(this.body.SetLinearVelocity(x),this.body.SetAngularVelocity(g),M.Free(x),this.recreateMyJoints(),t=0,e=(a=this.joiningMe.valuesRef()).length;t<e;t++)a[t].extra.box2dbody.c2userdata.recreateMyJoints();V.length=0}},e.tick=function(){var t,e,i,o,n,s;this.enabled&&(t=this.inst,0===this.behavior.steppingMode?e=this.runtime.timescale/60:1/30<(e=this.runtime.getDt(this.inst))&&(e=1/30),this.runtime.tickcount>this.behavior.lastUpdateTick&&0<this.runtime.timescale&&(this.world.Step(e,this.behavior.velocityIterations,this.behavior.positionIterations),this.world.ClearForces(),this.behavior.lastUpdateTick=this.runtime.tickcount),(this.recreateBody||t.width!==this.lastWidth||t.height!==this.lastHeight||t.cur_animation!==this.lastAnimation||t.cur_frame!==this.lastAnimationFrame||t.tilemap_exists&&t.physics_changed)&&(this.createBody(),this.recreateBody=!1,this.lastAnimation=t.cur_animation,this.lastAnimationFrame=t.cur_frame,t.tilemap_exists&&t.physics_changed&&(t.physics_changed=!1)),i=t.x!==this.lastKnownX||t.y!==this.lastKnownY,n=t.angle!==this.lastKnownAngle,i?(t.update_bbox(),e=t.bquad.midX(),i=t.bquad.midY(),s=e-this.lastKnownX,o=i-this.lastKnownY,this.body.SetPosition(M.Get(.02*e,.02*i)),this.body.SetLinearVelocity(M.Get(s,o)),this.lastTickOverride=!0,this.body.SetAwake(!0)):this.lastTickOverride&&(this.lastTickOverride=!1,this.body.SetLinearVelocity(M.Get(0,0)),this.body.SetPosition(M.Get(.02*t.bquad.midX(),.02*t.bquad.midY()))),n&&(this.body.SetAngle(t.angle),this.body.SetAwake(!0)),o=(s=this.body.GetPosition()).x/.02,n=s.y/.02,s=this.body.GetAngle(),o===t.x&&n===t.y&&s===t.angle||(t.x=o,t.y=n,t.angle=s,t.set_bbox_changed(),t.update_bbox(),n=t.bquad.midX()-t.x,s=t.bquad.midY()-t.y,0==n&&0==s||(t.x-=n,t.y-=s,t.set_bbox_changed())),this.lastKnownX=t.x,this.lastKnownY=t.y,this.lastKnownAngle=t.angle)},e.getInstImgPointX=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().x+this.body.GetLocalCenter().x)/.02:this.inst.getImagePoint(t,!0):this.inst.x},e.getInstImgPointY=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().y+this.body.GetLocalCenter().y)/.02:this.inst.getImagePoint(t,!1):this.inst.y},i.prototype.IsSleeping=function(){return!!this.enabled&&!this.body.IsAwake()},i.prototype.CompareVelocity=function(t,e,i){if(!this.enabled)return!1;var o=this.body.GetLinearVelocity(),n=0===t?o.x/.02:1===t?o.y/.02:(t=o.x/.02,n=o.y/.02,cr.distanceTo(0,0,t,n));return cr.do_cmp(n,e,i)},i.prototype.CompareAngularVelocity=function(t,e){if(!this.enabled)return!1;var i=cr.to_degrees(this.body.GetAngularVelocity());return cr.do_cmp(i,t,e)},i.prototype.CompareMass=function(t,e){if(!this.enabled)return!1;var i=this.body.GetMass()/.02;return cr.do_cmp(i,t,e)},i.prototype.IsEnabled=function(){return this.enabled},t.cnds=new i,o.prototype.ApplyForce=function(t,e,i){var o;this.enabled&&(o=this.getInstImgPointX(i),i=this.getInstImgPointY(i),this.body.ApplyForce(M.Get(t,e),M.Get(.02*o,.02*i)))},o.prototype.ApplyForceToward=function(t,e,i,o){var n;this.enabled&&(n=this.getInstImgPointX(o),o=this.getInstImgPointY(o),i=cr.angleTo(n,o,e,i),this.body.ApplyForce(M.Get(Math.cos(i)*t,Math.sin(i)*t),M.Get(.02*n,.02*o)))},o.prototype.ApplyForceAtAngle=function(t,e,i){var o;this.enabled&&(e=cr.to_radians(e),o=this.getInstImgPointX(i),i=this.getInstImgPointY(i),this.body.ApplyForce(M.Get(Math.cos(e)*t,Math.sin(e)*t),M.Get(.02*o,.02*i)))},o.prototype.ApplyImpulse=function(t,e,i){var o;this.enabled&&(o=this.getInstImgPointX(i),i=this.getInstImgPointY(i),this.body.ApplyImpulse(M.Get(t,e),M.Get(.02*o,.02*i)),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},o.prototype.ApplyImpulseToward=function(t,e,i,o){var n;this.enabled&&(n=this.getInstImgPointX(o),o=this.getInstImgPointY(o),i=cr.angleTo(n,o,e,i),this.body.ApplyImpulse(M.Get(Math.cos(i)*t,Math.sin(i)*t),M.Get(.02*n,.02*o)),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},o.prototype.ApplyImpulseAtAngle=function(t,e,i){var o;this.enabled&&(e=cr.to_radians(e),o=this.getInstImgPointX(i),i=this.getInstImgPointY(i),this.body.ApplyImpulse(M.Get(Math.cos(e)*t,Math.sin(e)*t),M.Get(.02*o,.02*i)),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},o.prototype.ApplyTorque=function(t){this.enabled&&this.body.ApplyTorque(cr.to_radians(t))},o.prototype.ApplyTorqueToAngle=function(t,e){this.enabled&&(t=cr.to_radians(t),e=cr.to_radians(e),cr.angleClockwise(this.inst.angle,e)?this.body.ApplyTorque(-t):this.body.ApplyTorque(t))},o.prototype.ApplyTorqueToPosition=function(t,e,i){this.enabled&&(t=cr.to_radians(t),i=cr.angleTo(this.inst.x,this.inst.y,e,i),cr.angleClockwise(this.inst.angle,i)?this.body.ApplyTorque(-t):this.body.ApplyTorque(t))},o.prototype.SetAngularVelocity=function(t){this.enabled&&(this.body.SetAngularVelocity(cr.to_radians(t)),this.body.SetAwake(!0))},o.prototype.CreateDistanceJoint=function(t,e,i,o,n){e&&this.enabled&&((e=e.getFirstPicked(this.inst))&&e!=this.inst&&e.extra.box2dbody&&(this.myCreatedJoints.push({type:0,params:[t,e.uid,i,o,n]}),this.doCreateDistanceJoint(t,e.uid,i,o,n)))},e.doCreateDistanceJoint=function(t,e,i,o,n){var s,r,a,h,l;!this.enabled||(s=this.runtime.getObjectByUID(e))&&s!=this.inst&&s.extra.box2dbody&&(s.extra.box2dbody.c2userdata.joiningMe.add(this.inst),r=this.getInstImgPointX(t),a=this.getInstImgPointY(t),l=s.getImagePoint?(h=s.getImagePoint(i,!0),s.getImagePoint(i,!1)):(h=s.x,s.y),e=r-h,t=a-l,(i=new c).Initialize(this.body,s.extra.box2dbody,M.Get(.02*r,.02*a),M.Get(.02*h,.02*l)),i.length=.02*Math.sqrt(e*e+t*t),i.dampingRatio=o,i.frequencyHz=n,this.myJoints.push(this.world.CreateJoint(i)))},o.prototype.CreateRevoluteJoint=function(t,e){e&&this.enabled&&((e=e.getFirstPicked(this.inst))&&e!=this.inst&&e.extra.box2dbody&&(this.myCreatedJoints.push({type:1,params:[t,e.uid]}),this.doCreateRevoluteJoint(t,e.uid)))},e.doCreateRevoluteJoint=function(t,e){var i,o;!this.enabled||(i=this.runtime.getObjectByUID(e))&&i!=this.inst&&i.extra.box2dbody&&(i.extra.box2dbody.c2userdata.joiningMe.add(this.inst),o=this.getInstImgPointX(t),e=this.getInstImgPointY(t),(t=new r).Initialize(this.body,i.extra.box2dbody,M.Get(.02*o,.02*e)),this.myJoints.push(this.world.CreateJoint(t)))},o.prototype.CreateLimitedRevoluteJoint=function(t,e,i,o){e&&this.enabled&&((e=e.getFirstPicked(this.inst))&&e!=this.inst&&e.extra.box2dbody&&(this.myCreatedJoints.push({type:2,params:[t,e.uid,i,o]}),this.doCreateLimitedRevoluteJoint(t,e.uid,i,o)))},e.doCreateLimitedRevoluteJoint=function(t,e,i,o){var n,s;!this.enabled||(n=this.runtime.getObjectByUID(e))&&n!=this.inst&&n.extra.box2dbody&&(n.extra.box2dbody.c2userdata.joiningMe.add(this.inst),s=this.getInstImgPointX(t),e=this.getInstImgPointY(t),(t=new r).Initialize(this.body,n.extra.box2dbody,M.Get(.02*s,.02*e)),t.enableLimit=!0,t.lowerAngle=cr.to_radians(i),t.upperAngle=cr.to_radians(o),this.myJoints.push(this.world.CreateJoint(t)))},o.prototype.SetWorldGravity=function(t){if(t!==this.behavior.worldG){this.world.SetGravity(M.Get(0,t)),this.behavior.worldG=t;for(var e=this.behavior.my_instances.valuesRef(),i=0,o=e.length;i<o;i++)e[i].extra.box2dbody&&e[i].extra.box2dbody.SetAwake(!0)}},o.prototype.SetSteppingMode=function(t){this.behavior.steppingMode=t},o.prototype.SetIterations=function(t,e){t<1&&(t=1),e<1&&(e=1),this.behavior.velocityIterations=t,this.behavior.positionIterations=e},o.prototype.SetVelocity=function(t,e){this.enabled&&(this.body.SetLinearVelocity(M.Get(.02*t,.02*e)),this.body.SetAwake(!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},o.prototype.SetDensity=function(t){this.enabled&&this.density!==t&&(this.density=t,this.recreateBody=!0)},o.prototype.SetFriction=function(t){this.enabled&&this.friction!==t&&(this.friction=t,this.recreateBody=!0)},o.prototype.SetElasticity=function(t){this.enabled&&this.restitution!==t&&(this.restitution=t,this.recreateBody=!0)},o.prototype.SetLinearDamping=function(t){this.enabled&&this.linearDamping!==t&&(this.linearDamping=t,this.body.SetLinearDamping(t))},o.prototype.SetAngularDamping=function(t){this.enabled&&this.angularDamping!==t&&(this.angularDamping=t,this.body.SetAngularDamping(t))},o.prototype.SetImmovable=function(t){this.enabled&&this.immovable!==(0!==t)&&(this.immovable=0!==t,this.body.SetType(this.immovable?0:2),this.body.SetAwake(!0))},o.prototype.EnableCollisions=function(t,e){if(t&&this.enabled){var i,o;if(t.is_family)for(i=0,o=t.members.length;i<o;i++)n(this.inst.type,t.members[i],0!==e);else n(this.inst.type,t,0!==e);this.behavior.allCollisionsEnabled=!1}},o.prototype.SetPreventRotate=function(t){this.enabled&&this.preventRotation!==(0!==t)&&(this.preventRotation=0!==t,this.body.SetFixedRotation(this.preventRotation),this.body.m_torque=0,this.body.SetAngularVelocity(0),this.body.SetAwake(!0))},o.prototype.SetBullet=function(t){this.enabled&&this.bullet!==(0!==t)&&(this.bullet=0!==t,this.body.SetBullet(this.bullet),this.body.SetAwake(!0))},o.prototype.RemoveJoints=function(){this.enabled&&(this.destroyMyJoints(),this.myCreatedJoints.length=0,this.joiningMe.clear())},o.prototype.SetEnabled=function(t){this.enabled&&0===t?(this.destroyBody(),this.enabled=!1):this.enabled||1!==t||(this.enabled=!0,this.createBody())},t.acts=new o,s.prototype.VelocityX=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().x/.02:0)},s.prototype.VelocityY=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().y/.02:0)},s.prototype.AngularVelocity=function(t){t.set_float(this.enabled?cr.to_degrees(this.body.GetAngularVelocity()):0)},s.prototype.Mass=function(t){t.set_float(this.enabled?this.body.GetMass()/.02:0)},s.prototype.CenterOfMassX=function(t){t.set_float(this.enabled?(this.body.GetPosition().x+this.body.GetLocalCenter().x)/.02:0)},s.prototype.CenterOfMassY=function(t){t.set_float(this.enabled?(this.body.GetPosition().y+this.body.GetLocalCenter().y)/.02:0)},s.prototype.Density=function(t){t.set_float(this.enabled?this.density:0)},s.prototype.Friction=function(t){t.set_float(this.enabled?this.friction:0)},s.prototype.Elasticity=function(t){t.set_float(this.enabled?this.restitution:0)},s.prototype.LinearDamping=function(t){t.set_float(this.enabled?this.linearDamping:0)},s.prototype.AngularDamping=function(t){t.set_float(this.enabled?this.angularDamping:0)},t.exps=new s}(),cr.behaviors.Pin=function(t){this.runtime=t},function(){var t=cr.behaviors.Pin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}function n(){}e.onCreate=function(){this.pinObject=null,this.pinObjectUid=-1,this.pinAngle=0,this.pinDist=0,this.myStartAngle=0,this.theirStartAngle=0,this.lastKnownAngle=0,this.mode=0;var e=this;this.recycled||(this.myDestroyCallback=function(t){e.onInstanceDestroyed(t)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},e.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}},e.loadFromJSON=function(t){this.pinObjectUid=t.uid,this.pinAngle=t.pa,this.pinDist=t.pd,this.myStartAngle=t.msa,this.theirStartAngle=t.tsa,this.lastKnownAngle=t.lka,this.mode=t.m},e.afterLoad=function(){-1===this.pinObjectUid?this.pinObject=null:this.pinObject=this.runtime.getObjectByUID(this.pinObjectUid),this.pinObjectUid=-1},e.onInstanceDestroyed=function(t){this.pinObject==t&&(this.pinObject=null)},e.onDestroy=function(){this.pinObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.tick=function(){},e.tick2=function(){var t,e,i,o;this.pinObject&&(this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle))),e=this.inst.x,i=this.inst.y,3===this.mode||4===this.mode?((t=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y))>this.pinDist||4===this.mode&&t<this.pinDist)&&(o=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y),e=this.pinObject.x+Math.cos(o)*this.pinDist,i=this.pinObject.y+Math.sin(o)*this.pinDist):(e=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,i=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist),o=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle)),this.lastKnownAngle=o,0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===e&&this.inst.y===i||(this.inst.x=e,this.inst.y=i,this.inst.set_bbox_changed()),0!==this.mode&&2!==this.mode||this.inst.angle===o||(this.inst.angle=o,this.inst.set_bbox_changed()))},i.prototype.IsPinned=function(){return!!this.pinObject},t.cnds=new i,o.prototype.Pin=function(t,e){!t||(t=t.getFirstPicked(this.inst))&&(this.pinObject=t,this.pinAngle=cr.angleTo(t.x,t.y,this.inst.x,this.inst.y)-t.angle,this.pinDist=cr.distanceTo(t.x,t.y,this.inst.x,this.inst.y),this.myStartAngle=this.inst.angle,this.lastKnownAngle=this.inst.angle,this.theirStartAngle=t.angle,this.mode=e)},o.prototype.Unpin=function(){this.pinObject=null},t.acts=new o,n.prototype.PinnedUID=function(t){t.set_int(this.pinObject?this.pinObject.uid:-1)},t.exps=new n}();var easeOutBounceArray=[],easeInElasticArray=[],easeOutElasticArray=[],easeInOutElasticArray=[],easeInCircle=[],easeOutCircle=[],easeInOutCircle=[],easeInBack=[],easeOutBack=[],easeInOutBack=[],litetween_precision=1e4,updateLimit=0;function easeOutBouncefunc(t){return result=(t/=1)<1/2.75?7.5625*t*t*1+0:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,result}function integerize(t,e){return Math.round(t/e*litetween_precision)}function easeFunc(t,e,i,o,n,s,r){var a,h,l,c,m=0;switch(t){case 0:m=o*e/n+i;break;case 1:m=o*(e/=n)*e+i;break;case 2:m=-o*(e/=n)*(e-2)+i;break;case 3:m=(e/=n/2)<1?o/2*e*e+i:-o/2*(--e*(e-2)-1)+i;break;case 4:m=o*(e/=n)*e*e+i;break;case 5:m=o*((e=e/n-1)*e*e+1)+i;break;case 6:m=(e/=n/2)<1?o/2*e*e*e+i:o/2*((e-=2)*e*e+2)+i;break;case 7:m=o*(e/=n)*e*e*e+i;break;case 8:m=-o*((e=e/n-1)*e*e*e-1)+i;break;case 9:m=(e/=n/2)<1?o/2*e*e*e*e+i:-o/2*((e-=2)*e*e*e-2)+i;break;case 10:m=o*(e/=n)*e*e*e*e+i;break;case 11:m=o*((e=e/n-1)*e*e*e*e+1)+i;break;case 12:m=(e/=n/2)<1?o/2*e*e*e*e*e+i:o/2*((e-=2)*e*e*e*e+2)+i;break;case 13:m=r.optimized?easeInCircle[integerize(e,n)]:-(Math.sqrt(1-e*e)-1);break;case 14:m=r.optimized?easeOutCircle[integerize(e,n)]:Math.sqrt(1-(e-1)*(e-1));break;case 15:m=r.optimized?easeInOutCircle[integerize(e,n)]:(e/=n/2)<1?-o/2*(Math.sqrt(1-e*e)-1)+i:o/2*(Math.sqrt(1-(e-=2)*e)+1)+i;break;case 16:m=r.optimized?easeInBack[integerize(e,n)]:o*(e/=n)*e*(((l=r.s)+1)*e-l)+i;break;case 17:m=r.optimized?easeOutBack[integerize(e,n)]:o*((e=e/n-1)*e*(((l=r.s)+1)*e+l)+1)+i;break;case 18:m=r.optimized?easeInOutBack[integerize(e,n)]:(l=r.s,(e/=n/2)<1?o/2*(e*e*((1+(l*=1.525))*e-l))+i:o/2*((e-=2)*e*((1+(l*=1.525))*e+l)+2)+i);break;case 19:m=r.optimized?easeInElasticArray[integerize(e,n)]:(a=r.a,(l=0)==e&&(m=i),1==(e/=n)&&(m=i+o),0==(h=r.p)&&(h=.3*n),l=0==a||a<Math.abs(o)?(a=o,h/4):h/(2*Math.PI)*Math.asin(o/a),-(a*Math.pow(2,10*--e)*Math.sin((e*n-l)*(2*Math.PI)/h))+i);break;case 20:m=r.optimized?easeOutElasticArray[integerize(e,n)]:(a=r.a,(l=0)==e&&(m=i),1==(e/=n)&&(m=i+o),0==(h=r.p)&&(h=.3*n),l=0==a||a<Math.abs(o)?(a=o,h/4):h/(2*Math.PI)*Math.asin(o/a),a*Math.pow(2,-10*e)*Math.sin((e*n-l)*(2*Math.PI)/h)+o+i);break;case 21:m=r.optimized?easeInOutElasticArray[integerize(e,n)]:(a=r.a,(l=0)==e&&(m=i),2==(e/=n/2)&&(m=i+o),0==(h=r.p)&&(h=n*(.3*1.5)),l=0==a||a<Math.abs(o)?(a=o,h/4):h/(2*Math.PI)*Math.asin(o/a),e<1?a*Math.pow(2,10*--e)*Math.sin((e*n-l)*(2*Math.PI)/h)*-.5+i:a*Math.pow(2,-10*--e)*Math.sin((e*n-l)*(2*Math.PI)/h)*.5+o+i);break;case 22:m=r.optimized?o-easeOutBounceArray[integerize(n-e,n)]+i:o-easeOutBouncefunc(n-e/n)+i;break;case 23:m=r.optimized?easeOutBounceArray[integerize(e,n)]:easeOutBouncefunc(e/n);break;case 24:m=r.optimized?e<n/2?.5*(o-easeOutBounceArray[integerize(n-2*e,n)]+i)+i:.5*easeOutBounceArray[integerize(2*e-n,n)]+.5*o+i:e<n/2?.5*(o-easeOutBouncefunc(n-2*e)+i)+i:.5*easeOutBouncefunc((2*e-n)/n)+.5*o+i;break;case 25:m=(c=e/n/2)*c*(3-2*c)*2;break;case 26:m=(c=(e/n+1)/2)*c*(3-2*c)*2-1;break;case 27:m=(c=e/n)*c*(3-2*c)}return s?o-i-m:m}!function(){for(var t=0,e=0,i=0,o=0,n=0,s=0;s<=litetween_precision;s++){o=s/litetween_precision,t=(o/=1)<1/2.75?7.5625*o*o*1+0:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375;easeOutBounceArray[s]=t,(i=e=0)==(o=s/litetween_precision)&&(t=0),1==(o/=1)&&(t=1),0==i&&(i=.3),n=0==e||e<Math.abs(1)?(e=1,i/4):i/(2*Math.PI)*Math.asin(1/e),t=0-e*Math.pow(2,10*--o)*Math.sin((+o-n)*(2*Math.PI)/i),easeInElasticArray[s]=t,(i=e=0)==(o=s/litetween_precision)&&(t=0),1==(o/=1)&&(t=1),0==i&&(i=.3),n=0==e||e<Math.abs(1)?(e=1,i/4):i/(2*Math.PI)*Math.asin(1/e),t=e*Math.pow(2,-10*o)*Math.sin((+o-n)*(2*Math.PI)/i)+1,easeOutElasticArray[s]=t,(i=e=0)==(o=s/litetween_precision)&&(t=0),2==(o/=.5)&&(t=1),0==i&&(i=.3*1.5*1),n=0==e||e<Math.abs(1)?(e=1,i/4):i/(2*Math.PI)*Math.asin(1/e),t=o<1?e*Math.pow(2,10*--o)*Math.sin((+o-n)*(2*Math.PI)/i)*-.5+0:e*Math.pow(2,-10*--o)*Math.sin((+o-n)*(2*Math.PI)/i)*.5+1,easeInOutElasticArray[s]=t,o=s/litetween_precision,easeInCircle[s]=-(Math.sqrt(1-o*o)-1),o=s/litetween_precision,easeOutCircle[s]=Math.sqrt(1-(o-1)*(o-1)),o=s/litetween_precision,t=(o/=.5)<1?-.5*(Math.sqrt(1-o*o)-1)+0:.5*(Math.sqrt(1-(o-=2)*o)+1)+0,easeInOutCircle[s]=t,o=s/litetween_precision,(n=0)==n&&(n=1.70158),t=(o/=1)*o*((n+1)*o-n)+0,easeInBack[s]=t,(n=0)==n&&(n=1.70158),t=(o=+(o=s/litetween_precision)-1)*o*((n+1)*o+n)+1,easeOutBack[s]=t,o=s/litetween_precision,(n=0)==n&&(n=1.70158),t=(o/=.5)<1?o*o*((1+(n*=1.525))*o-n)*.5+0:.5*((o-=2)*o*((1+(n*=1.525))*o+n)+2)+0,easeInOutBack[s]=t}}();var TweenObject=function(t,e,i,o,n,s,r){this.name=t,this.value=0,this.setInitial(o),this.setTarget(n),this.easefunc=i,this.tweened=e,this.duration=s,this.progress=0,this.state=0,this.onStart=!1,this.onEnd=!1,this.onReverseStart=!1,this.onReverseEnd=!1,this.lastKnownValue=0,this.lastKnownValue2=0,this.enforce=r,this.pingpong=1,this.flipEase=!1,this.easingparam=[],this.lastState=1;for(var a=0;a<28;a++)this.easingparam[a]={},this.easingparam[a].a=0,this.easingparam[a].p=0,this.easingparam[a].t=0,this.easingparam[a].s=0,this.easingparam[a].optimized=!0};function trim(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}TweenObject.prototype={},TweenObject.prototype.flipTarget=function(){var t=this.initialparam1,e=this.initialparam2;this.initialparam1=this.targetparam1,this.initialparam2=this.targetparam2,this.targetparam1=t,this.targetparam2=e,this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setInitial=function(t){this.initialparam1=parseFloat(t.split(",")[0]),this.initialparam2=parseFloat(t.split(",")[1]),this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setTarget=function(t){this.targetparam1=parseFloat(t.split(",")[0]),this.targetparam2=parseFloat(t.split(",")[1]),isNaN(this.targetparam2)&&(this.targetparam2=this.targetparam1)},TweenObject.prototype.OnTick=function(t){return 0===this.state?-1:(1===this.state&&(this.progress+=t),2===this.state&&(this.progress-=t),3===this.state&&(this.state=0),4!==this.state&&6!==this.state||(this.progress+=t*this.pingpong),5===this.state&&(this.progress+=t*this.pingpong),this.progress<0?(this.progress=0,4===this.state?this.pingpong=1:6===this.state?(this.pingpong=1,this.flipEase=!1):this.state=0,this.onReverseEnd=!0,0):this.progress>this.duration?(this.progress=this.duration,4===this.state?this.pingpong=-1:6===this.state?(this.pingpong=-1,this.flipEase=!0):5===this.state?this.progress=0:this.state=0,this.onEnd=!0,1):this.flipEase?easeFunc(this.easefunc,this.duration-this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]):easeFunc(this.easefunc,this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]))},cr.behaviors.lunarray_LiteTween=function(t){this.runtime=t},function(){var t=cr.behaviors.lunarray_LiteTween.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var e=t.Instance.prototype;e.onCreate=function(){this.playmode=this.properties[0],this.active=1==this.playmode||2==this.playmode||3==this.playmode||4==this.playmode,this.tweened=this.properties[1],this.easing=this.properties[2],this.target=this.properties[3],this.targetmode=this.properties[4],this.useCurrent=!1,1===this.targetmode&&(this.target="relative("+this.target+")"),this.duration=this.properties[5],this.enforce=1===this.properties[6],this.value=0,this.tween_list={},this.addToTweenList("default",this.tweened,this.easing,"current",this.target,this.duration,this.enforce),1===this.properties[0]&&this.startTween(0),2===this.properties[0]&&this.startTween(2),3===this.properties[0]&&this.startTween(3),4===this.properties[0]&&this.startTween(4)},e.parseCurrent=function(t,e){void 0===e&&(e="current");var i=trim(e);e=trim(e);var o=this.value;if("current"===e)switch(t){case 0:i=this.inst.x+","+this.inst.y;break;case 1:case 2:case 3:i=this.inst.width+","+this.inst.height;break;case 4:i=cr.to_degrees(this.inst.angle)+","+cr.to_degrees(this.inst.angle);break;case 5:i=100*this.inst.opacity+","+100*this.inst.opacity;break;case 6:i=o+","+o;break;case 7:case 8:i=this.inst.x+","+this.inst.y;break;case 9:i=void 0!==this.inst.curFrame?this.inst.width/this.inst.curFrame.width+","+this.inst.height/this.inst.curFrame.height:"1,1"}if("relative"===e.substring(0,8)){var n,s,e=e.match(/\((.*?)\)/);switch(e&&(n=parseFloat(e[1].split(",")[0]),s=parseFloat(e[1].split(",")[1])),isNaN(n)&&(n=0),isNaN(s)&&(s=0),t){case 0:i=this.inst.x+n+","+(this.inst.y+s);break;case 1:case 2:case 3:i=this.inst.width+n+","+(this.inst.height+s);break;case 4:i=cr.to_degrees(this.inst.angle)+n+","+(cr.to_degrees(this.inst.angle)+s);break;case 5:i=100*this.inst.opacity+n+","+(100*this.inst.opacity+s);break;case 6:i=o+n+","+o+n;break;case 7:i=this.inst.x+n+","+this.inst.y;break;case 8:i=this.inst.x+","+(this.inst.y+n);break;case 9:i=n+","+s}}return i},e.addToTweenList=function(t,e,i,o,n,s,r){o=this.parseCurrent(e,o),n=this.parseCurrent(e,n),void 0!==this.tween_list[t]&&delete this.tween_list[t],this.tween_list[t]=new TweenObject(t,e,i,o,n,s,r),this.tween_list[t].dt=0},e.saveToJSON=function(){JSON.stringify(this.tween_list.default);return{playmode:this.playmode,active:this.active,tweened:this.tweened,easing:this.easing,target:this.target,targetmode:this.targetmode,useCurrent:this.useCurrent,duration:this.duration,enforce:this.enforce,value:this.value,tweenlist:JSON.stringify(this.tween_list.default)}},TweenObject.Load=function(t,e,i,o,n,s,r,a){var h,l=new TweenObject(e,i,o,n,s,r,a);for(h in t)l[h]=t[h];return l},e.loadFromJSON=function(t){var e=JSON.parse(t.tweenlist),e=TweenObject.Load(e,e.name,e.tweened,e.easefunc,e.initialparam1+","+e.initialparam2,e.targetparam1+","+e.targetparam2,e.duration,e.enforce);this.tween_list.default=e,this.playmode=t.playmode,this.active=t.active,this.movement=t.tweened,this.easing=t.easing,this.target=t.target,this.targetmode=t.targetmode,this.useCurrent=t.useCurrent,this.duration=t.duration,this.enforce=t.enforce,this.value=t.value},e.setProgressTo=function(t){for(var e in 1<t&&(t=1),t<0&&(t=0),this.tween_list){var i=this.tween_list[e];i.lastKnownValue=0,i.lastKnownValue2=0,i.state=3,i.progress=t*i.duration;var o=i.OnTick(0);this.updateTween(i,o)}},e.startTween=function(t){for(var e in this.tween_list){var i,o,n=this.tween_list[e];this.useCurrent&&(i=this.parseCurrent(n.tweened,"current"),o=this.parseCurrent(n.tweened,this.target),n.setInitial(i),n.setTarget(o)),0===t&&(n.progress=1e-6,n.lastKnownValue=0,n.lastKnownValue2=0,n.onStart=!0,n.state=1),1===t&&(n.state=n.lastState),2!==t&&4!==t||(n.progress=1e-6,n.lastKnownValue=0,n.lastKnownValue2=0,n.onStart=!0,2==t&&(n.state=4),4==t&&(n.state=6)),3===t&&(n.progress=1e-6,n.lastKnownValue=0,n.lastKnownValue2=0,n.onStart=!0,n.state=5)}},e.stopTween=function(t){for(var e in this.tween_list){var i=this.tween_list[e];3!=i.state&&0!=i.state&&(i.lastState=i.state),1===t&&(i.progress=0),2===t&&(i.progress=i.duration),i.state=3;var o=i.OnTick(0);this.updateTween(i,o)}},e.reverseTween=function(t){for(var e in this.tween_list){var i=this.tween_list[e];1===t&&(i.progress=i.duration,i.lastKnownValue=0,i.lastKnownValue2=0,i.onReverseStart=!0),i.state=2}},e.updateTween=function(t,e){var i,o;0===t.tweened?t.enforce?(this.inst.x=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.y=t.initialparam2+(t.targetparam2-t.initialparam2)*e):(this.inst.x+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.y+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):1===t.tweened?t.enforce?(this.inst.width=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.height=t.initialparam2+(t.targetparam2-t.initialparam2)*e):(this.inst.width+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.height+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):2===t.tweened?t.enforce?this.inst.width=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.inst.width+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):3===t.tweened?t.enforce?this.inst.height=t.initialparam2+(t.targetparam2-t.initialparam2)*e:(this.inst.height+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):4===t.tweened?t.enforce?(o=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.angle=cr.clamp_angle(cr.to_radians(o))):(o=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.angle=cr.clamp_angle(this.inst.angle+cr.to_radians(o)),t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):5===t.tweened?t.enforce?this.inst.opacity=(t.initialparam1+(t.targetparam1-t.initialparam1)*e)/100:(this.inst.opacity+=((t.targetparam1-t.initialparam1)*e-t.lastKnownValue)/100,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):6===t.tweened?t.enforce?this.value=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.value+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):7===t.tweened?t.enforce?this.inst.x=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.inst.x+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):8===t.tweened?t.enforce?this.inst.y=t.initialparam2+(t.targetparam2-t.initialparam2)*e:(this.inst.y+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):9===t.tweened&&(i=t.initialparam1+(t.targetparam1-t.initialparam1)*e,o=t.initialparam2+(t.targetparam2-t.initialparam2)*e,this.inst.width<0&&(i=t.initialparam1+(t.targetparam1+t.initialparam1)*-e),this.inst.height<0&&(o=t.initialparam2+(t.targetparam2+t.initialparam2)*-e),t.enforce?(this.inst.width=this.inst.curFrame.width*i,this.inst.height=this.inst.curFrame.height*o):(this.inst.width<0?(this.inst.width=i*(this.inst.width/(-1+t.lastKnownValue)),t.lastKnownValue=i+1):(this.inst.width=i*(this.inst.width/(1+t.lastKnownValue)),t.lastKnownValue=i-1),this.inst.height<0?(this.inst.height=o*(this.inst.height/(-1+t.lastKnownValue2)),t.lastKnownValue2=o+1):(this.inst.height=o*(this.inst.height/(1+t.lastKnownValue2)),t.lastKnownValue2=o-1))),this.inst.set_bbox_changed()},e.tick=function(){var t=this.runtime.getDt(this.inst),e=this.tween_list.default;0!==e.state&&(e.onStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnStart,this.inst),e.onStart=!1),e.onReverseStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseStart,this.inst),e.onReverseStart=!1),this.active=1==e.state||2==e.state||4==e.state||5==e.state||6==e.state,t=e.OnTick(t),this.updateTween(e,t),e.onEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,this.inst),e.onEnd=!1),e.onReverseEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,this.inst),e.onReverseEnd=!1))},t.cnds={},(e=t.cnds).IsActive=function(){return 0!==this.tween_list.default.state},e.IsReversing=function(){return 2==this.tween_list.default.state},e.CompareProgress=function(t,e){var i=this.tween_list.default;return cr.do_cmp(i.progress/i.duration,t,e)},e.OnThreshold=function(t,e){var i=this.tween_list.default;this.threshold=cr.do_cmp(i.progress/i.duration,t,e);e=this.oldthreshold!=this.threshold&&this.threshold;return e&&(this.oldthreshold=this.threshold),e},e.OnStart=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onStart},e.OnReverseStart=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onReverseStart},e.OnEnd=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onEnd},e.OnReverseEnd=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onReverseEnd},t.acts={},(e=t.acts).Start=function(t,e){this.threshold=!1,this.oldthreshold=!1,this.useCurrent=1==e,this.startTween(t)},e.Stop=function(t){this.stopTween(t)},e.Reverse=function(t){this.threshold=!1,this.oldthreshold=!1,this.reverseTween(t)},e.ProgressTo=function(t){this.setProgressTo(t)},e.SetDuration=function(t){isNaN(t)||t<0||void 0!==this.tween_list.default&&(this.tween_list.default.duration=t)},e.SetEnforce=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.enforce=1===t)},e.SetInitial=function(t){void 0!==this.tween_list.default&&(t=this.parseCurrent(this.tween_list.default.tweened,t),this.tween_list.default.setInitial(t))},e.SetTarget=function(t,e,i){if(void 0!==this.tween_list.default&&!isNaN(i)){var o=this.tween_list.default,n=i+"",s="",r="";if(1===(this.targetmode=e)){switch(this.target="relative("+n+")",t){case 0:s=this.inst.x+i,r=o.targetparam2;break;case 1:s=o.targetparam1,r=this.inst.y+i;break;case 2:r=s=""+cr.to_degrees(this.inst.angle+cr.to_radians(i));break;case 3:r=s=""+100*this.inst.opacity+i;break;case 4:s=this.inst.width+i,r=o.targetparam2;break;case 5:s=o.targetparam1,r=this.inst.height+i;break;case 6:r=s=i}n=s+","+r}else{switch(t){case 0:s=i,r=o.targetparam2;break;case 1:s=o.targetparam1,r=i;break;case 2:case 3:r=s=i;break;case 4:s=i,r=o.targetparam2;break;case 5:s=o.targetparam1,r=i;break;case 6:r=s=i}n=s+","+r,this.target=n}t=this.parseCurrent(this.tween_list.default.tweened,"current"),n=this.parseCurrent(this.tween_list.default.tweened,n);o.setInitial(t),o.setTarget(n)}},e.SetTweenedProperty=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.tweened=t)},e.SetEasing=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.easefunc=t)},e.SetEasingParam=function(t,e,i,o,n){void 0!==this.tween_list.default&&(this.tween_list.default.easingparam[t].optimized=!1,this.tween_list.default.easingparam[t].a=e,this.tween_list.default.easingparam[t].p=i,this.tween_list.default.easingparam[t].t=o,this.tween_list.default.easingparam[t].s=n)},e.ResetEasingParam=function(){void 0!==this.tween_list.default&&(this.tween_list.default.optimized=!0)},e.SetValue=function(t){var e=this.tween_list.default;this.value=t,6===e.tweened&&e.setInitial(this.parseCurrent(e.tweened,"current"))},e.SetParameter=function(t,e,i,o,n){var s;void 0===this.tween_list.default?this.addToTweenList("default",t,e,initial,i,o,n,0):((s=this.tween_list.default).tweened=t,s.easefunc=e,s.setInitial(this.parseCurrent(t,"current")),s.setTarget(this.parseCurrent(t,i)),s.duration=o,s.enforce=1===n)},t.exps={},(t=t.exps).State=function(t){var e="N/A";switch(this.tween_list.default.state){case 0:e="paused";break;case 1:e="playing";break;case 2:e="reversing";break;case 3:e="seeking"}t.set_string(e)},t.Progress=function(t){var e=this.tween_list.default.progress/this.tween_list.default.duration;t.set_float(e)},t.Duration=function(t){t.set_float(this.tween_list.default.duration)},t.Target=function(t){var e=this.tween_list.default,i="N/A";switch(e.tweened){case 0:i=e.targetparam1;break;case 1:i=e.targetparam2;break;case 2:case 3:case 4:i=e.targetparam1;break;case 5:i=e.targetparam2;break;case 6:i=e.targetparam1}t.set_float(i)},t.Value=function(t){var e=this.value;t.set_float(e)},t.Tween=function(t,e,i,o,n){o=1<o?1:o,o=easeFunc(n,o<0?0:o,0,1,1,!1,!1);t.set_float(e+o*(i-e))}}(),cr.behaviors.scrollto=function(t){this.runtime=t,this.shakeMag=0,this.shakeStart=0,this.shakeEnd=0,this.shakeMode=0},function(){var t=cr.behaviors.scrollto.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}e.onCreate=function(){this.enabled=0!==this.properties[0]},e.saveToJSON=function(){return{smg:this.behavior.shakeMag,ss:this.behavior.shakeStart,se:this.behavior.shakeEnd,smd:this.behavior.shakeMode}},e.loadFromJSON=function(t){this.behavior.shakeMag=t.smg,this.behavior.shakeStart=t.ss,this.behavior.shakeEnd=t.se,this.behavior.shakeMode=t.smd},e.tick=function(){},e.tick2=function(){if(this.enabled){for(var t,e=this.behavior.my_instances.valuesRef(),i=0,o=0,n=0,s=0,r=e.length;s<r;s++)(t=function(t){for(var e,i=0,o=t.behavior_insts.length;i<o;++i)if((e=t.behavior_insts[i]).behavior instanceof cr.behaviors.scrollto)return e;return null}(e[s]))&&t.enabled&&(i+=e[s].x,o+=e[s].y,++n);var a,h=this.inst.layer.layout,l=this.runtime.kahanTime.sum,c=0,m=0;l>=this.behavior.shakeStart&&l<this.behavior.shakeEnd&&(a=this.behavior.shakeMag*Math.min(this.runtime.timescale,1),0===this.behavior.shakeMode&&(a*=1-(l-this.behavior.shakeStart)/(this.behavior.shakeEnd-this.behavior.shakeStart)),l=Math.random()*Math.PI*2,a=Math.random()*a,c=Math.cos(l)*a,m=Math.sin(l)*a),h.scrollToX(i/n+c),h.scrollToY(o/n+m)}},i.prototype.Shake=function(t,e,i){this.behavior.shakeMag=t,this.behavior.shakeStart=this.runtime.kahanTime.sum,this.behavior.shakeEnd=this.behavior.shakeStart+e,this.behavior.shakeMode=i},i.prototype.SetEnabled=function(t){this.enabled=0!==t},t.acts=new i}(),cr.getObjectRefTable=function(){return[cr.plugins_.AJAX,cr.plugins_.ScirraArcadeV4,cr.plugins_.Browser,cr.plugins_.Dictionary,cr.plugins_.LocalStorage,cr.plugins_.vooxe,cr.plugins_.Spritefont2,cr.plugins_.Text,cr.plugins_.Sprite,cr.plugins_.Touch,cr.plugins_.TiledBg,cr.behaviors.Physics,cr.behaviors.scrollto,cr.behaviors.Pin,cr.behaviors.lunarray_LiteTween,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.Sprite.prototype.cnds.PickDistance,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.acts.SetPos,cr.plugins_.Text.prototype.acts.SetText,cr.plugins_.Dictionary.prototype.exps.Get,cr.plugins_.TiledBg.prototype.acts.SetPos,cr.behaviors.Physics.prototype.acts.SetWorldGravity,cr.behaviors.Physics.prototype.acts.SetIterations,cr.behaviors.Physics.prototype.acts.CreateRevoluteJoint,cr.behaviors.Physics.prototype.acts.CreateLimitedRevoluteJoint,cr.behaviors.Physics.prototype.acts.CreateDistanceJoint,cr.system_object.prototype.acts.SetLayerScale,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.plugins_.Sprite.prototype.acts.MoveToBottom,cr.system_object.prototype.cnds.Compare,cr.plugins_.TiledBg.prototype.acts.SetX,cr.system_object.prototype.exps.int,cr.plugins_.Sprite.prototype.acts.SetX,cr.behaviors.Physics.prototype.acts.EnableCollisions,cr.behaviors.Pin.prototype.acts.Pin,cr.plugins_.Sprite.prototype.acts.MoveToTop,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.system_object.prototype.cnds.ForEachOrdered,cr.plugins_.Sprite.prototype.exps.X,cr.system_object.prototype.exps.distance,cr.plugins_.Sprite.prototype.exps.Y,cr.system_object.prototype.exps.anglediff,cr.plugins_.Sprite.prototype.exps.Angle,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.system_object.prototype.cnds.Else,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.behaviors.Physics.prototype.acts.ApplyTorque,cr.behaviors.Physics.prototype.acts.SetAngularVelocity,cr.behaviors.Physics.prototype.acts.SetAngularDamping,cr.plugins_.Dictionary.prototype.acts.SetKey,cr.system_object.prototype.exps.str,cr.plugins_.LocalStorage.prototype.acts.SetItem,cr.plugins_.Dictionary.prototype.exps.AsJSON,cr.behaviors.Physics.prototype.cnds.CompareVelocity,cr.behaviors.Physics.prototype.acts.ApplyForce,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Sprite.prototype.acts.MoveAtAngle,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.exps.Count,cr.system_object.prototype.cnds.Every,cr.plugins_.Text.prototype.acts.SetFontSize,cr.system_object.prototype.exps.round,cr.plugins_.Text.prototype.exps.FaceSize,cr.system_object.prototype.acts.Wait,cr.plugins_.TiledBg.prototype.exps.X,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.system_object.prototype.acts.SetVar,cr.plugins_.ScirraArcadeV4.prototype.acts.SubmitScore,cr.behaviors.Physics.prototype.acts.SetLinearDamping,cr.system_object.prototype.acts.CreateObject,cr.behaviors.lunarray_LiteTween.prototype.acts.Start,cr.plugins_.Text.prototype.acts.SetVisible,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.plugins_.Sprite.prototype.cnds.CompareOpacity,cr.plugins_.vooxe.prototype.acts.ShowBanner,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.system_object.prototype.acts.RestartLayout,cr.plugins_.LocalStorage.prototype.acts.ClearStorage,cr.system_object.prototype.exps.choose,cr.system_object.prototype.exps.loopindex,cr.system_object.prototype.exps.random,cr.plugins_.LocalStorage.prototype.acts.CheckItemExists,cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,cr.plugins_.AJAX.prototype.acts.RequestFile,cr.plugins_.AJAX.prototype.cnds.OnComplete,cr.plugins_.Dictionary.prototype.acts.JSONLoad,cr.plugins_.AJAX.prototype.exps.LastData,cr.system_object.prototype.acts.GoToLayout,cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,cr.plugins_.LocalStorage.prototype.acts.GetItem,cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,cr.plugins_.LocalStorage.prototype.exps.ItemValue,cr.plugins_.vooxe.prototype.acts.InitAds,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.vooxe.prototype.cnds.IsShowingBanner,cr.plugins_.vooxe.prototype.cnds.onPauseGame,cr.system_object.prototype.acts.SetTimescale,cr.plugins_.vooxe.prototype.cnds.onResumeGame]};